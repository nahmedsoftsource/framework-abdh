-- Built by xConcat at Mon 08/24/2009  9:17:21.29 
SET ANSI_NULLS ON
GO
SET ANSI_PADDING ON
GO
SET ANSI_WARNINGS ON
GO
SET ARITHABORT ON
GO
SET CONCAT_NULL_YIELDS_NULL ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET NUMERIC_ROUNDABORT OFF
GO
SET NOCOUNT ON
GO

if db_name() in ('master','msdb', 'model', 'temp') 
begin
     RAISERROR 21000 'Cannot run this script in system databases. Please contact DBA.'
end
GO
 
 
-- USE [SMM-Trunk]
IF EXISTS
(
	select name from sys.objects where name like '%SMM_CheckExists%'
)
	DROP FUNCTION SMM_CheckExists 
-- ================================================
-- Template generated from Template Explorer using:
-- Create Scalar Function (New Menu).SQL
--
-- Use the Specify Values for Template Parameters 
-- command (Ctrl-Shift-M) to fill in the parameter 
-- values below.
--
-- This block of comments will not be included in
-- the definition of the function.
-- ================================================
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date, ,>
-- Description:	<Description, ,>
-- =============================================
CREATE FUNCTION SMM_CheckExists 
--ALTER FUNCTION SMM_CheckExists 
(
	-- Add the parameters for the function here
	@objType int, @objName varchar(80), @tableName varchar(80) 
)
RETURNS int
AS
BEGIN

IF @objType = 1 -- Table
BEGIN
    IF EXISTS (
        SELECT * FROM sysobjects WHERE id = object_id(@objName)
        AND OBJECTPROPERTY(id, N'IsUserTable') = 1)
	        RETURN 0 --Found
END

IF @objType = 2 -- Constraint
BEGIN
    IF EXISTS (
		SELECT * FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS 
        WHERE constraint_name  = @objName
              AND table_name = @tableName
    )
	        RETURN 0 --Found
END

IF @objType = 3 -- Temp Table
BEGIN
    IF EXISTS (
        SELECT * 
        FROM tempdb.dbo.sysobjects 
        WHERE name like '%' + @objName+ '%'
)
	        RETURN 0 --Found
END

IF @objType = 4 -- COLUMN_DEAULT
BEGIN
    IF EXISTS (
		SELECT * FROM sys.objects
        WHERE name = @objName
	)
	        RETURN 0 --Found
END

IF @objType = 5 -- Index
BEGIN
    IF EXISTS (
		SELECT * FROM sys.indexes
        WHERE name = @objName
	)
	        RETURN 0 --Found
END

IF @objType = 6-- Column
BEGIN
    IF EXISTS (
		SELECT * FROM information_schema.columns
        WHERE column_name = @objName And  table_name = @tableName
	)
	        RETURN 0 --Found
END


RETURN -1 -- Not Found
END
GO
/*
IF dbo.SMM_CheckExists(1, '#ChangeScript001_stat') = 0
BEGIN
    PRINT 'EXIST'
    RETURN
END
   PRINT 'NOT EXIST'
GO

IF EXISTS (

		SELECT * FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS    
        WHERE constraint_name  like '%' + 'DF_InsuranceLab' + '%'


SELECT *
                         FROM SYSOBJECTs
*/
 
 
/*
 db.01.00.001:
 Does the following:
	Add metadata

Modifications:
	

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 001

*/

set nocount on
IF dbo.SMM_CheckExists(3, '#ChangeScript001_stat', '') = 0
	DROP TABLe #ChangeScript001_stat
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript001_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 001)
begin
	print '**************************************************'
	print '*  db.01.00.001: already applied                    *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript001_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript001_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add metadata                                                        *'
	print '***********************************************************************'

INSERT INTO [metadata].[EmailFormat] ([ID], [Name], [Inactive]) VALUES (1, N'Text plain', 0)
INSERT INTO [metadata].[EmailFormat] ([ID], [Name], [Inactive]) VALUES (2, N'HTML', 0)
INSERT INTO [metadata].[Country] ([ID], [Name], [CallingCode]) VALUES (0, N'Unknown', NULL)
INSERT INTO [metadata].[Country] ([ID], [Name], [CallingCode]) VALUES (1, N'United States of America', NULL)
INSERT INTO [metadata].[Country] ([ID], [Name], [CallingCode]) VALUES (2147483647, N'Other', NULL)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (0, N'Unknown', N'', 0, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (1, N'Alabama', N'AL', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (2, N'Alaska', N'AK', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (3, N'American Samoa', N'AS', 1, 1)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (4, N'Arizona', N'AZ', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (5, N'Arkansas', N'AR', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (6, N'California', N'CA', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (7, N'Colorado', N'CO', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (8, N'Connecticut', N'CT', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (9, N'Delaware', N'DE', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (10, N'District of Columbia', N'DC', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (11, N'Federated States of Micronesia', N'FS', 1, 1)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (12, N'Florida', N'FL', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (13, N'Georgia', N'GA', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (14, N'Guam', N'GU', 1, 1)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (15, N'Hawaii', N'HI', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (16, N'Idaho', N'ID', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (17, N'Illinois', N'IL', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (18, N'Indiana', N'IN', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (19, N'Iowa', N'IA', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (20, N'Kansas', N'KS', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (21, N'Kentucky', N'KY', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (22, N'Louisiana', N'LA', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (23, N'Maine', N'ME', 1, 1)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (24, N'Marshall Islands', N'MH', 1, 1)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (25, N'Maryland', N'MD', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (26, N'Massachusetts', N'MA', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (27, N'Michigan', N'MI', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (28, N'Minnesota', N'MN', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (29, N'Mississippi', N'MS', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (30, N'Missouri', N'MO', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (31, N'Montana', N'MT', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (32, N'Nebraska', N'NE', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (33, N'Nevada', N'NV', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (34, N'New Hampshire', N'NH', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (35, N'New Jersey', N'NJ', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (36, N'New Mexico', N'NM', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (37, N'New York', N'NY', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (38, N'North Carolina', N'NC', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (39, N'North Dakota', N'ND', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (40, N'Northern Mariana Islands', N'MP', 1, 1)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (41, N'Ohio', N'OH', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (42, N'Oklahoma', N'OK', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (43, N'Oregon', N'OR', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (44, N'Palau Island', N'PW', 1, 1)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (45, N'Pennsylvania', N'PA', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (46, N'Puerto Rico', N'PR', 1, 1)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (47, N'Rhode Island', N'RI', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (48, N'South Carolina', N'SC', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (49, N'South Dakota', N'SD', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (50, N'Tennessee', N'TN', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (51, N'Texas', N'TX', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (52, N'Utah', N'UT', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (53, N'Vermont', N'VT', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (54, N'Virgin Islands', N'VI', 1, 1)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (55, N'Virginia', N'VA', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (56, N'Washington', N'WA', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (57, N'West Virginia', N'WV', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (58, N'Wisconsin', N'WI', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (59, N'Wyoming', N'WY', 1, 0)
INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (2147483647, N'Other', NULL, 2147483647, 0)
INSERT INTO [metadata].[ApprovalStatus] ([ID], [Name]) VALUES (0, N'New')
INSERT INTO [metadata].[ApprovalStatus] ([ID], [Name]) VALUES (1, N'Pending')
INSERT INTO [metadata].[ApprovalStatus] ([ID], [Name]) VALUES (2, N'Approved')
INSERT INTO [metadata].[ApprovalStatus] ([ID], [Name]) VALUES (3, N'Declined')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (0, N'Unknown')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (1, N'Residence')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (2, N'Business')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (3, N'Vacation')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (9, N'Regional Office')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (11, N'Temporary')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (12, N'Previous')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (13, N'Appointment Purposes')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (14, N'Billing Return To Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (15, N'Individual Work Location')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (16, N'Shipping Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (17, N'Mailing Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (18, N'Claim Center')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (19, N'Overnight Mail Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (20, N'Policy Mailing Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (21, N'Commission Mailing Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (24, N'Agent Customer Service Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (25, N'Client Customer Service Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (26, N'Billing Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (27, N'Headquarters Address')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (100, N'Drop Ship')
INSERT INTO [metadata].[AddressType] ([ID], [Name]) VALUES (2147483647, N'Other')
INSERT INTO [metadata].[PartyType] ([ID], [Name]) VALUES (1, N'Person')
INSERT INTO [metadata].[PartyType] ([ID], [Name]) VALUES (2, N'Organization')
INSERT INTO [metadata].[DocumentFormat] ([ID], [Name]) VALUES (0, N'Unknown')
INSERT INTO [metadata].[DocumentFormat] ([ID], [Name]) VALUES (1, N'JPEG')
INSERT INTO [metadata].[DocumentFormat] ([ID], [Name]) VALUES (2, N'GIF')
INSERT INTO [metadata].[DocumentFormat] ([ID], [Name]) VALUES (3, N'TIF')
INSERT INTO [metadata].[DocumentFormat] ([ID], [Name]) VALUES (4, N'PDF')
INSERT INTO [metadata].[DocumentFormat] ([ID], [Name]) VALUES (2147483647, N'Other')
INSERT INTO [metadata].[CredentialingStatus] ([ID], [Name]) VALUES (0, N'New')
INSERT INTO [metadata].[CredentialingStatus] ([ID], [Name]) VALUES (1, N'Received')
INSERT INTO [metadata].[CredentialingStatus] ([ID], [Name]) VALUES (2, N'Expired')
INSERT INTO [metadata].[CredentialingStatus] ([ID], [Name]) VALUES (3, N'Renew')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (0, N'Unknown')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (1, N'Mail')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (2, N'Electronic')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (3, N'Fax')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (4, N'Phone')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (5, N'Recovered Data Present')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (6, N'Document On File')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (7, N'External Attachment')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (8, N'Attachment')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (10, N'Voice Response Unit')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (11, N'Paper Later Time')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (12, N'Internet')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (13, N'Other Permitted Methods')
INSERT INTO [metadata].[SubmissionType] ([ID], [Name]) VALUES (2147483647, N'Other')
INSERT INTO [metadata].[EmailType] ([ID], [Name], [Inactive]) VALUES (0, N'Unknown', 0)
INSERT INTO [metadata].[EmailType] ([ID], [Name], [Inactive]) VALUES (1, N'Business', 0)
INSERT INTO [metadata].[EmailType] ([ID], [Name], [Inactive]) VALUES (2, N'Personal', 0)
INSERT INTO [metadata].[EmailType] ([ID], [Name], [Inactive]) VALUES (2147483647, N'Other', 0)
INSERT INTO [metadata].[DocumentClassifier] ([ID], [Name]) VALUES (1, N'Insurance Document')
INSERT INTO [metadata].[DocumentClassifier] ([ID], [Name]) VALUES (2, N'Credential')
INSERT INTO [metadata].[DocumentClassifier] ([ID], [Name]) VALUES (3, N'Paperwork')
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (1, N'Carrier Form', 1)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (2, N'Paramed Exam', 1)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (3, N'Consent Form', 1)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (4, N'Replacement Form', 1)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (5, N'Other Form', 1)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (6, N'Addendum', 2)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (7, N'Application Form', 2)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (8, N'Auto Insurance', 2)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (9, N'CCR Authorization', 2)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (10, N'Credential', 2)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (11, N'Driver License', 2)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (12, N'Employment Verify', 2)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (13, N'Privacy Agreement', 2)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (14, N'Tax Document', 2)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (15, N'Paramed Exam', 3)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (16, N'PKT', 3)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (17, N'Labslip', 3)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (18, N'EKG', 3)
INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID]) VALUES (19, N'Other', 3)
INSERT INTO [metadata].[OrderStatus] ([ID], [Name]) VALUES (1, N'New')
INSERT INTO [metadata].[OrderStatus] ([ID], [Name]) VALUES (2, N'Processing')
INSERT INTO [metadata].[OrderStatus] ([ID], [Name]) VALUES (3, N'On-Hold')
INSERT INTO [metadata].[OrderStatus] ([ID], [Name]) VALUES (4, N'Complete')
INSERT INTO [metadata].[OrderStatus] ([ID], [Name]) VALUES (5, N'Cancelled')
INSERT INTO [metadata].[OrderStatus] ([ID], [Name]) VALUES (6, N'Verified')
INSERT INTO [metadata].[OrderStatus] ([ID], [Name]) VALUES (7, N'Closed')
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (0, N'Unknown', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (1, N'No Show by applicant for appointment', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (2, N'Left message at applicant''s home', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (3, N'Appointment canceled by applicant', 1)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (4, N'Additional forms needed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (5, N'Address and telephone # verified', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (6, N'Advised customer completed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (7, N'Applicant cancelled request', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (8, N'Applicant has not returned call', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (9, N'Applicant made/cancelled many appts', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (10, N'Applicant not ready to schedule', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (11, N'Applicant refused service', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (12, N'Applicant stated did not apply for insurance', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (13, N'Applicant unavailable until', 1)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (14, N'Applicant wants to talk to agent/agency', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (15, N'Application package not picked up', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (16, N'Application package picked up', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (17, N'Application package sent', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (18, N'Application package sent to customer', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (19, N'Appointment confirmed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (20, N'Assigned to Branch', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (21, N'Assigned to Call Center', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (22, N'Assigned to Copy Service', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (23, N'Assigned to Examiner/Interviewer', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (24, N'Attempted to contact agent/agency', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (25, N'Called Bank for check status', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (26, N'Cannot locate applicant', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (27, N'Check mailed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (28, N'Completed as scheduled', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (29, N'Completed different date', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (30, N'Completed package received at branch', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (31, N'Completed package sent', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (32, N'Confirm request received', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (33, N'Contacted customer', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (34, N'Copy Service Will Bill', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (35, N'Criminal records ordered', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (36, N'Customer contacted for addl info/clarification', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (37, N'Customer notified of appointment', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (38, N'Customer notified of status', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (39, N'Doctor''s practice closed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (40, N'Facility has not received payment', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (41, N'Facility received payment', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (42, N'Facility received request', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (43, N'Facility/MD/Service will bill', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (44, N'Fee activity', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (45, N'Follow up scheduled', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (46, N'Hold due to "Act of an agent", requires resolution', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (47, N'Image processing', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (48, N'Images Posted', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (49, N'In queue, next available Interviewer', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (50, N'Insufficient Quantity', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (51, N'Interview done/ to be typed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (52, N'Interview started/suspended', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (53, N'Lab results sent per client instructions', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (54, N'Left message work', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (55, N'Left message cell', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (56, N'Left message home', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (57, N'Letter sent to applicant', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (58, N'Missing Information', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (59, N'MVR ordered by provider', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (60, N'No answer/no machine', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (61, N'No records found', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (62, N'No show by applicant', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (63, N'No show by examiner', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (64, N'Order cancelled by electronic notification', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (65, N'Original order reopened', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (66, N'Over-limit fee approval', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (67, N'Package sent to carrier', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (68, N'Paperwork sent in Lab kit', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (69, N'Paramed appointment scheduled', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (70, N'Part I', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (71, N'Part II', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (72, N'Pending signatures', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (73, N'Preset Appointment Confirmed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (74, N'Preset date changed to', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (75, N'Provider accepts order', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (76, N'Provider cannot accept order', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (77, N'Provider receives order request', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (78, N'Received additional information', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (79, N'Records Delivered to', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (80, N'Records located', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (81, N'Records located; offsite', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (82, N'Records Mailed On', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (83, N'Records outside US', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (84, N'Records Received', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (85, N'Records Received by Phone', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (86, N'Records Retrieved', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (87, N'Records to be copied by service', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (88, N'Refuse to release records', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (89, N'Rescheduled appt. date', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (90, N'Rescheduled due to applicant', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (91, N'Rescheduled due to Examiner/Interviewer', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (92, N'Specimens Damaged', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (93, N'Second check mailed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (94, N'Second request mailed to facility', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (95, N'Sent', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (96, N'Sent facility/MD request', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (97, N'Specimens Received at Lab', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (98, N'Still looking for records', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (99, N'Temporarily suspended by Applicant', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (100, N'Temporarily suspended by Provider', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (101, N'Testing Completed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (102, N'Testing delayed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (103, N'Unable to draw blood', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (104, N'Unable to obtain urine', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (105, N'Waiting for applicant signature', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (106, N'Waiting for doctor signature for release', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (107, N'Will not provide status update via phone', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (108, N'Applicant refused offer', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (109, N'Policy mailed to applicant', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (110, N'Applicant accepted offer', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (111, N'Outstanding requirements received', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (112, N'Applicant accepted amended offer', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (113, N'Additional forms received', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (114, N'Signatures received', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (115, N'Applicant considering offer', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (154, N'Over-limit Fee Denied', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (181, N'Documents Received', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (182, N'Acknowledge', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (184, N'Cancel', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (185, N'Complete', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (186, N'Error', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (187, N'Evaluate', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (188, N'Publish', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (189, N'Receive', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (190, N'Evaluation Failed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (191, N'Resume', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (192, N'Submit', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (193, N'Warn', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (194, N'Facility did not receive request', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (195, N'Initiate interview', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (196, N'Conclude interview', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (205, N'Canceled by carrier', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (206, N'Specimens Not Received at Lab', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (207, N'Call attempt', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (208, N'Missing Form', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (209, N'Missing Signature', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (210, N'Patient number required', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (211, N'Records retrieved', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (212, N'Received call from applicant', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (213, N'Pending per company request', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (214, N'Contacted producer for assistance', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (215, N'Attempted to verify records', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (216, N'Additional records printed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (217, N'Additional records created', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (218, N'Duplicate request', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (219, N'A special authorization is required', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (220, N'Left message for applicant', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (221, N'Awaiting response from insurance company', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (222, N'Unable to locate address or phone number', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (223, N'Temporarily suspended by agent', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (224, N'Order incomplete', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (225, N'Results transmitted', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (226, N'Case closed', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (227, N'Second follow up sent to provider', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (228, N'No response from service provider, please handle', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (229, N'Follow up sent to provider', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (230, N'Services changed or corrected', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (231, N'Processing delay', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (232, N'Need producer information', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (233, N'Need applicant information', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (234, N'Faxed to company', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (235, N'Completed by another company', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (236, N'Agent cancelled request', 0)
INSERT INTO [metadata].[OrderAssignmentStatus] ([ID], [Name], [NoteRequired]) VALUES (2147483647, N'Other', 0)
INSERT INTO [metadata].[OrderType] ([ID], [Name]) VALUES (1, N'Paramed')
INSERT INTO [metadata].[OrderType] ([ID], [Name]) VALUES (2, N'Direct Order')
INSERT INTO [metadata].[Language] ([ID], [Name]) VALUES (1, N'English')
INSERT INTO [metadata].[Language] ([ID], [Name]) VALUES (2, N'French')
INSERT INTO [metadata].[Language] ([ID], [Name]) VALUES (3, N'Spanish')
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (0, N'Unknown', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (1, N'Home', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (2, N'Business', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (3, N'Vacation', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (4, N'Business Fax', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (6, N'Marine', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (7, N'Corporate Office', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (9, N'Regional Office', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (10, N'Emergency', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (11, N'Temporary', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (12, N'Mobile', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (13, N'Pager', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (14, N'Modem / Data Line', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (15, N'Home Fax', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (16, N'General Voice', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (17, N'Business Toll-Free', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (18, N'Claim Center', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (19, N'Fax', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (20, N'Agent CS', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (21, N'Client CS', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (22, N'Headquarters Main', 0)
INSERT INTO [metadata].[PhoneType] ([ID], [Name], [Inactive]) VALUES (2147483647, N'Other', 0)
INSERT INTO [metadata].[SurchargeType] ([ID], [Name]) VALUES (1, N'Geographical Surcharge')
INSERT INTO [metadata].[SurchargeType] ([ID], [Name]) VALUES (2, N'Gas Surcharge')
INSERT INTO [metadata].[SurchargeType] ([ID], [Name]) VALUES (3, N'Admin Fee')
INSERT INTO [metadata].[SurchargeType] ([ID], [Name]) VALUES (4, N'Extra Fee')
INSERT INTO [metadata].[SurchargeType] ([ID], [Name]) VALUES (5, N'Document Fee')
INSERT INTO [metadata].[Gender] ([ID], [Name], [Inactive]) VALUES (0, N'Unknown', 0)
INSERT INTO [metadata].[Gender] ([ID], [Name], [Inactive]) VALUES (1, N'Male', 0)
INSERT INTO [metadata].[Gender] ([ID], [Name], [Inactive]) VALUES (2, N'Female', 0)
INSERT INTO [metadata].[Gender] ([ID], [Name], [Inactive]) VALUES (3, N'Unisex', 1)
INSERT INTO [metadata].[Gender] ([ID], [Name], [Inactive]) VALUES (4, N'Combined Rate', 1)
INSERT INTO [metadata].[Gender] ([ID], [Name], [Inactive]) VALUES (2147483647, N'Other', 0)
INSERT INTO [metadata].[OrderPaperworkStatus] ([ID], [Name]) VALUES (0, N'Unknown')
INSERT INTO [metadata].[OrderPaperworkStatus] ([ID], [Name]) VALUES (1, N'Pending')
INSERT INTO [metadata].[OrderPaperworkStatus] ([ID], [Name]) VALUES (8, N'Cancelled')
INSERT INTO [metadata].[OrderPaperworkStatus] ([ID], [Name]) VALUES (11, N'Completed')
INSERT INTO [metadata].[OrderPaperworkStatus] ([ID], [Name]) VALUES (12, N'In Error')
INSERT INTO [metadata].[OrderPaperworkStatus] ([ID], [Name]) VALUES (13, N'Completed with Warnings')
INSERT INTO [metadata].[OrderPaperworkStatus] ([ID], [Name]) VALUES (22, N'Order')
INSERT INTO [metadata].[OrderPaperworkStatus] ([ID], [Name]) VALUES (2147483647, N'Other')
INSERT INTO [metadata].[PricingUnit] ([ID], [Name]) VALUES (1, N'USD')
INSERT INTO [metadata].[PricingUnit] ([ID], [Name]) VALUES (2, N'%')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (0, N'Unknown')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (1, N'Social Security Number US')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (2, N'Taxpayer Identification Number')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (3, N'Social Insurance Number in Canada')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (4, N'Tax Reference Number South Africa')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (5, N'ACN number Australia')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (6, N'ARBN number Australia')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (7, N'SIS number Australia')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (8, N'US Employer Identification Number')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (9, N'Tax ID for US non-resident alien')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (10, N'Generic Foreign ID')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (11, N'Canadian Business Number')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (12, N'Canadian Quebec Enterprise Number')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (13, N'Canadian Employer Identification Number')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (17, N'Passport Number')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (18, N'Green Card (US)')
INSERT INTO [metadata].[GovIDType] ([ID], [Name]) VALUES (2147483647, N'Other')

INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (0, N'Unknown')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (1, N'Active')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (2, N'Inactive')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (3, N'Disabled')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (4, N'Leave of Absence')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (5, N'Terminated')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (6, N'Laid Off')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (7, N'On Strike')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (8, N'Retired')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (9, N'Deceased')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (10, N'Early Retiree')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (11, N'Resigned')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (12, N'Leave due to military service')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (13, N'Leave due to childbirth')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (14, N'Transferred')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (15, N'Short Term Disability')
INSERT INTO [metadata].[EmployeeStatus] ([ID], [Name]) VALUES (2147483647, N'Other')
INSERT INTO [metadata].[OrderPriority] ([ID], [Name]) VALUES (1, N'Low')
INSERT INTO [metadata].[OrderPriority] ([ID], [Name]) VALUES (2, N'Medium')
INSERT INTO [metadata].[OrderPriority] ([ID], [Name]) VALUES (3, N'High')
INSERT INTO [metadata].[OrderPriority] ([ID], [Name]) VALUES (4, N'Rush')

        Insert into #ChangeScript001_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript001_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript001_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 001, 'Add metadata'

		print '**************************************************'
		print '*  db.01.00.001: Done                               *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.001: NOT completed successfully         *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript001_stat%')
Begin
	drop table #ChangeScript001_stat
End
go
 
 
/*
 db.01.00.002:
 Does the following:
	TODO: 
	add insurance product type requirement, InsuranceProductTypeRequirementColumn, 
	add InsuranceProductTypeRequirementCommand, InsuranceProductTypeRequirementRow

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 002
*/

set nocount on
IF dbo.SMM_CheckExists(3, '#ChangeScript002_stat', '') = -1
-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript002_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 002)
begin
	print '**************************************************'
	print '*  db.01.00.002: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript002_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript002_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add insurance product type requirement, InsuranceProductTypeRequirementColumn, *'
	print '* and add InsuranceProductTypeRequirementCommand, InsuranceProductTypeRequirementRow *'
	print '***********************************************************************'

	/* add InsuranceProductTypeRequirementRow */
	IF dbo.SMM_CheckExists(1, 'InsuranceProductTypeRequirementRow', '') = -1
		CREATE TABLE [dbo].[InsuranceProductTypeRequirementRow](
		[ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_InsuranceProductTypeRequirementRow_ID]  DEFAULT (newid()),
		[Position] [int] NOT NULL,
		[AgeFrom] [int] NOT NULL,
		[AgeTo] [int] NOT NULL,
		 CONSTRAINT [PK_InsuranceProductTypeRequirementRow] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
	ELSE
		PRINT 'INFO: db.01.00.002 Table InsuranceProductTypeRequirementRow already exists'
		
	IF dbo.SMM_CheckExists(1, 'InsuranceProductTypeRequirementCommand', '') = -1
		/* add InsuranceProductTypeRequirementCommand */
		CREATE TABLE [dbo].[InsuranceProductTypeRequirementCommand](
		[ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_InsuranceProductTypeRequirementCommand_ID]  DEFAULT (newid()),
		[Name] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
		[Command] [text] COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		 CONSTRAINT [PK_InsuranceProductTypeRequirementCommand] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
	ELSE
		PRINT 'INFO: db.01.00.002 Table InsuranceProductTypeRequirementCommand already exists'

	IF dbo.SMM_CheckExists(1, 'InsuranceProductTypeRequirementColumn', '') = -1
		/* add InsuranceProductTypeRequirementColumn */
		CREATE TABLE [dbo].[InsuranceProductTypeRequirementColumn](
		[ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_InsuranceProductTypeRequirementColumn_ID]  DEFAULT (newid()),
		[Position] [int] NOT NULL,
		[AmountFrom] [int] NOT NULL,
		[AmountTo] [int] NOT NULL,
		 CONSTRAINT [PK_InsuranceProductTypeRequirementColumn] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
	ELSE
		PRINT 'INFO: db.01.00.002 Table InsuranceProductTypeRequirementColumn already exists'

	
	/* add insurance product type requirement */
	IF dbo.SMM_CheckExists(1, 'InsuranceProductTypeRequirement', '') = -1
		CREATE TABLE [dbo].[InsuranceProductTypeRequirement](
			[ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL 
			CONSTRAINT [DF_InsuranceProductTypeRequirement_ID]  DEFAULT (newid()),
			[InsuranceProductTypeID] [uniqueidentifier] NOT NULL,
			[RowID] [uniqueidentifier] NOT NULL,
			[ColumnID] [uniqueidentifier] NOT NULL,
			[CommandID] [uniqueidentifier] NOT NULL,
		 CONSTRAINT [PK_InsuranceProductTypeRequirement] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
	ELSE
		PRINT 'INFO: db.01.00.002 Table InsuranceProductTypeRequirement already exists'


	IF dbo.SMM_CheckExists(2, 'FK_InsuranceProductTypeRequirement_InsuranceProductType', 
		'InsuranceProductTypeRequirement') = -1
		ALTER TABLE [dbo].[InsuranceProductTypeRequirement]  
		WITH CHECK ADD  CONSTRAINT [FK_InsuranceProductTypeRequirement_InsuranceProductType] 
		FOREIGN KEY([InsuranceProductTypeID])
		REFERENCES [dbo].[InsuranceProductType] ([ID])
		ON DELETE CASCADE
	ELSE
		PRINT 'INFO: db.01.00.002 constraint FK_InsuranceProductTypeRequirement_InsuranceProductType already exists'

	ALTER TABLE [dbo].[InsuranceProductTypeRequirement] 
		CHECK CONSTRAINT [FK_InsuranceProductTypeRequirement_InsuranceProductType]

	IF dbo.SMM_CheckExists(2, 'FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementColumn', 
		'InsuranceProductTypeRequirement') = -1
		ALTER TABLE [dbo].[InsuranceProductTypeRequirement]  WITH CHECK 
		ADD  CONSTRAINT [FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementColumn] 
		FOREIGN KEY([ColumnID])
		REFERENCES [dbo].[InsuranceProductTypeRequirementColumn] ([ID])
		ON DELETE CASCADE
	ELSE
		PRINT 'INFO: db.01.00.002 constraint FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementColumn already exists'

	ALTER TABLE [dbo].[InsuranceProductTypeRequirement] 
		CHECK CONSTRAINT [FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementColumn]

	IF dbo.SMM_CheckExists(2, 'FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementCommand', 
		'InsuranceProductTypeRequirement') = -1
		ALTER TABLE [dbo].[InsuranceProductTypeRequirement]  WITH CHECK 
		ADD  CONSTRAINT [FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementCommand] FOREIGN KEY([CommandID])
			REFERENCES [dbo].[InsuranceProductTypeRequirementCommand] ([ID])
			ON DELETE CASCADE
	ELSE
		PRINT 'INFO: db.01.00.002 constraint FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementCommand already exists'

	ALTER TABLE [dbo].[InsuranceProductTypeRequirement] CHECK CONSTRAINT [FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementCommand]

	IF dbo.SMM_CheckExists(2, 'FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementRow', 
		'InsuranceProductTypeRequirement') = -1
		ALTER TABLE [dbo].[InsuranceProductTypeRequirement]  
		WITH CHECK ADD  CONSTRAINT [FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementRow] FOREIGN KEY([RowID])
		REFERENCES [dbo].[InsuranceProductTypeRequirementRow] ([ID])
		ON DELETE CASCADE
	ELSE
		PRINT 'INFO: db.01.00.002 constraint FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementRow already exists'

	ALTER TABLE [dbo].[InsuranceProductTypeRequirement] CHECK CONSTRAINT [FK_InsuranceProductTypeRequirement_InsuranceProductTypeRequirementRow]
	
    Insert into #ChangeScript002_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript002_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript002_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)

		select 1.0, 002, 'Add insurance product type requirement, InsuranceProductTypeRequirementColumn, and add InsuranceProductTypeRequirementCommand, InsuranceProductTypeRequirementRow *'

		print '**************************************************'
		print '*  db.01.00.002: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.002: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript002_stat%')
Begin
	drop table #ChangeScript002_stat
End
go
 
 
/*
 db.01.00.003:
 Does the following:
	Add User Permissions

Modifications:

Undo:
DROP TABLE [dbo].[UserPermission]
DROP TABLE [metadata].[PermissionType]
DELETE FROM metadata.Version where release = 1.0 and build = 003

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript003_stat', '') = 0
   drop table #ChangeScript003_stat
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript003_stat
	go

if exists (select * from metadata.Version where Release = 1.0 and Build = 003)
begin
	print '**************************************************'
	print '*  db.01.00.003: already applied                    *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript003_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript003_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add User Permission                                                 *'
	print '***********************************************************************'

	CREATE TABLE [metadata].[PermissionType](
		[ID] [int] NOT NULL,
		[Name] [nvarchar](50) NOT NULL,
		[Description] [nvarchar](100)
		CONSTRAINT [PK_PermissionType] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	) ON [PRIMARY]


	CREATE TABLE [dbo].[UserPermission](
		[UserID] [uniqueidentifier] NOT NULL,
		[PemissionTypeID] [int] NOT NULL,
	CONSTRAINT [PK_UserPermission] PRIMARY KEY CLUSTERED 
	(
		[UserID] ASC,
		[PemissionTypeID] ASC
	)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	) ON [PRIMARY]

	ALTER TABLE [dbo].[UserPermission]  WITH CHECK ADD  CONSTRAINT [FK_UserPermission_PermissionType] FOREIGN KEY([PemissionTypeID])
	REFERENCES [metadata].[PermissionType] ([ID])

	ALTER TABLE [dbo].[UserPermission]  WITH CHECK ADD  CONSTRAINT [FK_UserPermission_User] FOREIGN KEY([UserID])
	REFERENCES [dbo].[User] ([ID])

    Insert into #ChangeScript003_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript003_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript003_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 003, 'Add User Permission'

		print '**************************************************'
		print '*  db.01.00.003: Done                               *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.003: NOT completed successfully         *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript003_stat%')
Begin
	drop table #ChangeScript003_stat
End
go
 
 
/*
 db.01.00.004:
 Does the following:
	TODO: modify the tables in smm database relating to insurance management task, including Insurance, Organization, Party, InsuranceLocation, InsuranceLab

Modifications:
	TODO: Add a new unique field named ID, typed uniqueidentifier into InsuranceLab table, remove unique attribute and relation in InsuranceID and LabID field, change the direction of constrain between party and person

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 004

*/

set nocount on
IF dbo.SMM_CheckExists(3, '#ChangeScript004_stat%', '') = 0
    DROP TABLE #ChangeScript004_stat

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript004_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 004)
begin
	print '**************************************************'
	print '*  db.01.00.004: already applied                    *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript004_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript004_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Add a new unique field named ID type uniqueidentifier into InsuranceLab table, remove unique attribute and relation in InsuranceID and LabID field, change the direction of constrain between party and person*'
	print '***********************************************************************'

IF dbo.SMM_CheckExists(2, 'PK_InsuranceLab_1', 'InsuranceLab') = 0
	ALTER TABLE dbo.InsuranceLab
	DROP CONSTRAINT PK_InsuranceLab_1
ELSE
	PRINT 'INFO: db.01.00.004 - Constraint PK_InsuranceLab_1 already exists'
	
IF dbo.SMM_CheckExists(2, 'PK_InsuranceLab', 'InsuranceLab') = 0
	ALTER TABLE dbo.InsuranceLab DROP CONSTRAINT PK_InsuranceLab
ELSE
	PRINT 'INFO: db.01.00.004 - Constraint PK_InsuranceLab already exists'
	
	
IF dbo.SMM_CheckExists(4, 'DF_InsuranceLab_ID', 'InsuranceLab') = 0
	ALTER TABLE dbo.InsuranceLab DROP CONSTRAINT DF_InsuranceLab_ID
IF dbo.SMM_CheckExists(6, 'ID', 'InsuranceLab') = 0
	ALTER TABLE dbo.InsuranceLab DROP COLUMN ID

ALTER TABLE dbo.InsuranceLab ADD ID uniqueidentifier ROWGUIDCOL NOT NULL CONSTRAINT DF_InsuranceLab_ID DEFAULT (NEWID())

ALTER TABLE dbo.InsuranceLab ADD CONSTRAINT [PK_InsuranceLab] PRIMARY KEY NONCLUSTERED 
(
	[ID] ASC
) ON [PRIMARY]

IF dbo.SMM_CheckExists(5, 'IX_InsuranceLab', 'InsuranceLab') = -1
	CREATE CLUSTERED INDEX IX_InsuranceLab ON dbo.InsuranceLab
		(
			InsuranceID, StateID
	) ON [PRIMARY]

ALTER TABLE dbo.InsuranceLab ALTER COLUMN StateID int NULL

        Insert into #ChangeScript004_stat (PatchStatus) Values (1)


IF dbo.SMM_CheckExists(2, 'FK_Party_Person', 'Party') = 0
	ALTER TABLE dbo.Party
		DROP CONSTRAINT FK_Party_Person

IF dbo.SMM_CheckExists(2, 'FK_Person_Party', 'Person') = -1
	ALTER TABLE dbo.Person ADD CONSTRAINT
		FK_Person_Party FOREIGN KEY
		(
		ID
		) REFERENCES dbo.Party
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
IF dbo.SMM_CheckExists(2, 'FK_Party_Organization', 'Party') = 0
	ALTER TABLE dbo.Party
		DROP CONSTRAINT FK_Party_Organization

IF dbo.SMM_CheckExists(2, 'FK_Organization_Party', 'Organization') = -1
	ALTER TABLE dbo.Organization ADD CONSTRAINT
		FK_Organization_Party FOREIGN KEY
		(
		ID
		) REFERENCES dbo.Party
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
	 
    COMMIT TRANSACTION 

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript004_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript004_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 004, 'TODO: Add a new unique field named ID, typed uniqueidentifier into InsuranceLab table, remove unique attribute and relation in InsuranceID and LabID field, change the direction of constrain between party and person'

		print '**************************************************'
		print '*  db.01.00.004: Done                               *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.004: NOT completed successfully         *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript004_stat%')
Begin
	drop table #ChangeScript004_stat
End
go
 
 
/*
 db.01.00.005:
 Does the following:
	create configuration table which is used to store configurations of smm website.

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 005

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript005_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 005)
begin
	print '**************************************************'
	print '*  db.01.00.005: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript005_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript005_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*****************************************************************************************'
	print '*  create configuration table which is used to store configurations of smm website.*'
	print '*****************************************************************************************'
IF dbo.SMM_CheckExists(1, 'Configuration', '') = -1
	CREATE TABLE [dbo].[Configuration](
		[ID] [int] NOT NULL,
		[Name] [nvarchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[Value] [nvarchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[Description] [nvarchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	 CONSTRAINT [PK_Configuration] PRIMARY KEY CLUSTERED 
	(
		[ID] ASC
	)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
	) ON [PRIMARY]

        Insert into #ChangeScript005_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript005_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript005_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 005, 'create configuration table which is used to store configurations of smm website.'

		print '**************************************************'
		print '*  db.01.00.005: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.005: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript005_stat%')
Begin
	drop table #ChangeScript005_stat
End
go
 
 
/*
 db.01.00.006:
 Does the following:
	insert data to configuration table of smm website.

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 006

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript006_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 006)
begin
	print '**************************************************'
	print '*  db.01.00.006: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript006_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript006_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '************************************************************************************'
	print '*  insert data to configuration table of smm website.                         *'
	print '************************************************************************************'

IF NOT EXISTS
(
    SELECT * FROM [dbo].[Configuration]
    WHERE ID = 1
)
BEGIN
	INSERT INTO [dbo].[Configuration]([ID],[Name],[Value],[Description]) VALUES(1,'SmmMailToInstruction','Mail to SMM','SMM Mailing Instruction - Mail To')
	INSERT INTO [dbo].[Configuration]([ID],[Name],[Value],[Description]) VALUES(2,'SmmFaxToInstruction','Fax to SMM','SMM Mailing Instruction - Fax To')
	INSERT INTO [dbo].[Configuration]([ID],[Name],[Value],[Description]) VALUES(3,'DefaultPageSize','10','Default Page Size')
END
        Insert into #ChangeScript006_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript006_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript006_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 006, 'insert data to configuration table of smm website.'

		print '**************************************************'
		print '*  db.01.00.006: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.006: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript006_stat%')
Begin
	drop table #ChangeScript006_stat
End
go
 
 
/*
 db.01.00.007:
 Does the following:
	Change size of Password field of table User
	Add ResetPasswordToken field to table User
	Insert data to table PermissionType
	Insert data to table Configuration

Modifications:

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 007
*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript007_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript007_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 007)
begin
	print '**************************************************'
	print '*  db.01.00.007: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript007_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript007_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update fields in User and insert data to PermissionType and Configuration*'
	print '***********************************************************************'

	ALTER TABLE dbo.[User] ALTER COLUMN Password char(40) NOT NULL

	IF dbo.SMM_CheckExists(6, 'ResetPasswordToken', 'User') = -1
    BEGIN
		ALTER TABLE dbo.[User] ADD ResetPasswordToken uniqueidentifier NULL
	END

		insert into metadata.PermissionType(ID, Name, Description) values(0, 'None', null)
		insert into metadata.PermissionType(ID, Name, Description) values(1, 'PlaceOrder', null)
		insert into metadata.PermissionType(ID, Name, Description) values(2, 'UpdateOrder', null)
		insert into metadata.PermissionType(ID, Name, Description) values(4, 'ViewOfficeNotes', null)
	
		insert into dbo.Configuration(ID, Name, Value, Description) values(4, 'AdminEmail', 'bthuy@tma.com.vn', null)

        Insert into #ChangeScript007_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript007_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript007_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 007, 'Update fields in User and insert data to PermissionType and Configuration'

		print '**************************************************'
		print '*  db.01.00.007: Done                               *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.007: NOT completed successfully         *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript007_stat%')
Begin
	drop table #ChangeScript007_stat
End
go
 
 
/*
 db.01.00.008:
 Does the following:
	Add column AbbrName to the table GovIDType 

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 008

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript008_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 008)
begin
	print '**************************************************'
	print '*  db.01.00.008: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript008_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript008_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add column AbbrName to the table GovIDType                          *'
	print '***********************************************************************'


	ALTER TABLE metadata.GovIDType ADD AbbrName VARCHAR(50) NULL 	

        Insert into #ChangeScript008_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript008_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript008_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 008, 'Add column AbbrName to the table GovIDType'

		print '**************************************************'
		print '*  db.01.00.008: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.008: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript008_stat%')
Begin
	drop table #ChangeScript008_stat
End
go
 
 
/*
 db.01.00.009:
 Does the following:
	+ change primary key name of Document table from  PK_InsuranceForm to PK_Document
	+ insert "FileExtension" column into DocumentFormat
	+ insert "ID" column into InsuranceForm
	+ set primary key of InsuranceForm is "ID" column

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 009

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript009_stat
go
if exists (select * from metadata.Version where Release = 1.0 and Build = 009)
begin
	print '**************************************************'
	print '*  db.01.00.009: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript009_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript009_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

		print '********************************************************************************'
		print '* Insert ID into InsuranceDocument and FileExtension into DocumentFormat   *'
		print '********************************************************************************'
		
		IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME =
		'DocumentFormat' AND COLUMN_NAME = 'FileExtension')
			ALTER TABLE [metadata].[DocumentFormat] ADD FileExtension nvarchar(50) NULL
		--**********************************************************************************

		IF  EXISTS (SELECT * FROM sys.foreign_keys
		 WHERE parent_object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'FK_InsuranceForm_Document')
			ALTER TABLE dbo.InsuranceForm DROP CONSTRAINT FK_InsuranceForm_Document

		
		IF  EXISTS (SELECT * FROM sys.foreign_keys 
		WHERE object_id = OBJECT_ID(N'[dbo].[FK_Credentialing_Document]')
			 AND parent_object_id = OBJECT_ID(N'[dbo].[Credentialing]'))
		ALTER TABLE [dbo].[Credentialing] DROP CONSTRAINT [FK_Credentialing_Document]	

		IF  EXISTS (SELECT * FROM sys.indexes
		 WHERE object_id = OBJECT_ID(N'[dbo].[Document]') AND name = N'PK_InsuranceForm')
			ALTER TABLE [dbo].[Document] DROP CONSTRAINT [PK_InsuranceForm] 

		IF  NOT EXISTS (SELECT * FROM sys.indexes
		 WHERE object_id = OBJECT_ID(N'[dbo].[Document]') AND name = N'PK_Document')
			ALTER TABLE dbo.Document ADD CONSTRAINT [PK_Document] PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			) ON [PRIMARY]

		ALTER TABLE  dbo.Credentialing ADD CONSTRAINT [FK_Credentialing_Document] FOREIGN KEY (DocumentID)
		REFERENCES dbo.Document (ID) ;

		--**********************************************************************************
		IF  EXISTS (SELECT * FROM sys.foreign_keys
		 WHERE parent_object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'FK_InsuranceForm_Insurance')
			ALTER TABLE dbo.InsuranceForm DROP CONSTRAINT FK_InsuranceForm_Insurance

		IF  EXISTS (SELECT * FROM sys.foreign_keys
		 WHERE parent_object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'FK_InsuranceForm_State')
			ALTER TABLE dbo.InsuranceForm DROP CONSTRAINT FK_InsuranceForm_State

		IF  EXISTS (SELECT * FROM sys.indexes
		 WHERE object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'PK_InsuranceForm_1')
			ALTER TABLE [dbo].InsuranceForm DROP CONSTRAINT PK_InsuranceForm_1

		IF  EXISTS (SELECT * FROM sys.indexes
		 WHERE object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'PK_InsuranceForm')
			ALTER TABLE [dbo].InsuranceForm DROP CONSTRAINT PK_InsuranceForm

		IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME =
		'InsuranceForm' AND COLUMN_NAME = 'ID')
			ALTER TABLE dbo.InsuranceForm ADD ID uniqueidentifier ROWGUIDCOL NOT NULL CONSTRAINT DF_InsuranceForm_ID DEFAULT (NEWID())

		ALTER TABLE dbo.InsuranceForm ALTER COLUMN StateID int NULL

		IF  NOT EXISTS (SELECT * FROM sys.indexes
				 WHERE object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'PK_InsuranceForm')			
		ALTER TABLE dbo.InsuranceForm ADD CONSTRAINT [PK_InsuranceForm] PRIMARY KEY NONCLUSTERED 
		(
			[ID] ASC
		) ON [PRIMARY]

		IF  NOT EXISTS (SELECT * FROM sys.indexes
				 WHERE object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'IX_InsuranceForm')			
		CREATE CLUSTERED INDEX IX_InsuranceForm ON dbo.InsuranceForm
			(
				InsuranceID, StateID,DocumentID
		) ON [PRIMARY]

		IF  NOT EXISTS (SELECT * FROM sys.foreign_keys
		 WHERE object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'FK_InsuranceForm_Document')
			ALTER TABLE  dbo.InsuranceForm
				ADD CONSTRAINT [FK_InsuranceForm_State] FOREIGN KEY (StateID)
				REFERENCES metadata.State (ID) ;

		IF  NOT EXISTS (SELECT * FROM sys.indexes
				 WHERE object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'FK_InsuranceForm_Document')	
		ALTER TABLE  dbo.InsuranceForm ADD CONSTRAINT [FK_InsuranceForm_Document] FOREIGN KEY (DocumentID)
		REFERENCES dbo.Document(ID) ;

		IF  NOT EXISTS (SELECT * FROM sys.indexes
				 WHERE object_id = OBJECT_ID(N'[dbo].InsuranceForm') AND name = N'FK_InsuranceForm_Insurance')	
		ALTER TABLE  dbo.InsuranceForm ADD CONSTRAINT [FK_InsuranceForm_Insurance] FOREIGN KEY (InsuranceID)
		REFERENCES dbo.Insurance(ID) ;

    COMMIT TRANSACTION

    Insert into #ChangeScript009_stat (PatchStatus) Values (1)
END
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript009_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript009_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 009, 'Insert ID into InsuranceDocument and FileExtension into DocumentFormat  '

		print '**************************************************'
		print '*  db.01.00.009: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.009: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript009_stat%')
Begin
	drop table #ChangeScript009_stat
End
go
 
 
/*
 db.01.00.010:
 Does the following:
	Create GeoSurcharge table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 010

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript010_stat', '') = -1
-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript010_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 010)
begin
	print '**************************************************'
	print '*  db.01.00.010: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript010_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript010_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Create GeoSurcharge table											*'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(1, 'GeoSurcharge', '') = -1
	BEGIN
		CREATE TABLE [dbo].[GeoSurcharge](
			[BillingInfoID] [uniqueidentifier] NOT NULL,
			[StateID] [int] NOT NULL,
			[Price] [money] NOT NULL,
			[CreatedDate] [datetime] NOT NULL,
			[ModifiedDate] [datetime] NOT NULL,
			[DeletedDate] [datetime] NULL,
		 CONSTRAINT [PK_GeoSurcharge] PRIMARY KEY CLUSTERED 
		(
			[BillingInfoID] ASC,
			[StateID] ASC
		)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
		) ON [PRIMARY]


		ALTER TABLE [dbo].[GeoSurcharge]  WITH CHECK ADD  CONSTRAINT [FK_GeoSurcharge_BillingInformation] FOREIGN KEY([BillingInfoID])
		REFERENCES [dbo].[BillingInformation] ([ID])

		ALTER TABLE [dbo].[GeoSurcharge] CHECK CONSTRAINT [FK_GeoSurcharge_BillingInformation]

		ALTER TABLE [dbo].[GeoSurcharge]  WITH CHECK ADD  CONSTRAINT [FK_GeoSurcharge_GeoSurcharge] FOREIGN KEY([BillingInfoID], [StateID])
		REFERENCES [dbo].[GeoSurcharge] ([BillingInfoID], [StateID])

		ALTER TABLE [dbo].[GeoSurcharge] CHECK CONSTRAINT [FK_GeoSurcharge_GeoSurcharge]

		ALTER TABLE [dbo].[GeoSurcharge]  WITH CHECK ADD  CONSTRAINT [FK_GeoSurcharge_State] FOREIGN KEY([StateID])
		REFERENCES [metadata].[State] ([ID])

		ALTER TABLE [dbo].[GeoSurcharge] CHECK CONSTRAINT [FK_GeoSurcharge_State]
				Insert into #ChangeScript010_stat (PatchStatus) Values (1)
	END
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript010_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript010_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 010, 'Create GeoSurcharge table '

		print '**************************************************'
		print '*  db.01.00.010: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.010: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript010_stat%')
Begin
	drop table #ChangeScript010_stat
End
go
 
 
/*
 db.01.00.011:
 Does the following:
	Update all AbbrName columns in table GovIDType 

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 011

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript011_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 011)
begin
	print '**************************************************'
	print '*  db.01.00.011: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript011_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript011_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update all AbbrName columns in table GovIDType                      *'
	print '***********************************************************************'

	
	update metadata.GovIDType set AbbrName='UNKNOWN' where ID =0
	update metadata.GovIDType set AbbrName='SSN' where ID = 1
	update metadata.GovIDType set AbbrName='TID' where ID = 2
	update metadata.GovIDType set AbbrName='SIN' where ID = 3
	update metadata.GovIDType set AbbrName='TRN' where ID = 4
	update metadata.GovIDType set AbbrName='ACN' where ID = 5
	update metadata.GovIDType set AbbrName='ARBN' where ID = 6
	update metadata.GovIDType set AbbrName='SIS ' where ID = 7
	update metadata.GovIDType set AbbrName='USEMPID ' where ID = 8
	update metadata.GovIDType set AbbrName='USNONRESTID ' where ID = 9
	update metadata.GovIDType set AbbrName='CITIZENSHIPID ' where ID = 10
	update metadata.GovIDType set AbbrName='CANBN' where ID = 11
	update metadata.GovIDType set AbbrName='CANNEQ' where ID = 12
	update metadata.GovIDType set AbbrName='CANEIN' where ID = 13
	update metadata.GovIDType set AbbrName='PASSPORTID' where ID = 17
	update metadata.GovIDType set AbbrName='GREENCARD' where ID = 18	
	update metadata.GovIDType set AbbrName='OTHER' where ID = 2147483647 	

        Insert into #ChangeScript011_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript011_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript011_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 011, 'Update all AbbrName columns in table GovIDType'

		print '**************************************************'
		print '*  db.01.00.011: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.011: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript011_stat%')
Begin
	drop table #ChangeScript011_stat
End
go
 
 
/*
 db.01.00.012:
 Does the following:
	+ add Description column into Requirement talbe

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 012

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript012_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 012)
begin
	print '**************************************************'
	print '*  db.01.00.012: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript012_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript012_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '*   add Description column into Requirement talbe                     *'
	print '***********************************************************************'
	
		
	IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS
	WHERE TABLE_NAME =	'Requirement' AND
			COLUMN_NAME = 'Description')
		ALTER TABLE [dbo].[Requirement]
			ADD Description nvarchar(50) NULL

	IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS
	WHERE TABLE_NAME =	'Requirement' AND
			COLUMN_NAME = 'DeletedDate')
		ALTER TABLE [dbo].[Requirement]
			ADD DeletedDate datetime NULL

	Insert into #ChangeScript012_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript012_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript012_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 012, 'add Description column into Requirement talbe'

		print '**************************************************'
		print '*  db.01.00.012: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.012: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript012_stat%')
Begin
	drop table #ChangeScript012_stat
End
go
 
 
/*
 db.01.00.013:
 Does the following:
	Create table ServiceProviderBlackList

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 013

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript013_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 013)
begin
	print '**************************************************'
	print '*  db.01.00.013: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript013_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript013_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Create table ServiceProviderBlackList                               *'
	print '***********************************************************************'

	CREATE TABLE [dbo].[ServiceProviderBlacklist](
	[ServiceProviderID] [uniqueidentifier] NOT NULL,
	[Notes] [varchar](150) NULL,
	[AppraiserID] [uniqueidentifier] NOT NULL,
	[AppraiserType] [int] NULL,
	[CreatedDate] [datetime] NULL,
	[ModifiedDate] [datetime] NULL,
	[DeletedDate] [datetime] NULL,
	CONSTRAINT [PK_ServiceProviderBlacklist] PRIMARY KEY CLUSTERED 
	(
		[ServiceProviderID] ASC,
		[AppraiserID] ASC
	)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	) ON [PRIMARY]

	ALTER TABLE [dbo].[ServiceProviderBlacklist]  WITH CHECK ADD  CONSTRAINT [FK_ServiceProviderBlacklist_ServiceProvider] FOREIGN KEY([ServiceProviderID])
	REFERENCES [dbo].[ServiceProvider] ([ID])

	ALTER TABLE [dbo].[ServiceProviderBlacklist] CHECK CONSTRAINT [FK_ServiceProviderBlacklist_ServiceProvider]

        Insert into #ChangeScript013_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript013_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript013_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 013, 'Create table ServiceProviderBlackList'

		print '**************************************************'
		print '*  db.01.00.013: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.013: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript013_stat%')
Begin
	drop table #ChangeScript013_stat
End
go
 
 
/*
 db.01.00.014:
 Does the following:
	+ Insert DeletedDate column into InsuranceProductType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 014

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript014_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript014_stat
go
if exists (select * from metadata.Version where Release = 1.0 and Build = 014)
begin
	print '**************************************************'
	print '*  db.01.00.014: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript014_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript014_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION


		print '********************************************************************************'
		print '* Insert DeletedDate column into InsuranceProductType								  *'
		print '********************************************************************************'
		
		IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME =
		'InsuranceProductType' AND COLUMN_NAME = 'DeletedDate')
			ALTER TABLE [dbo].[InsuranceProductType] ADD DeletedDate DATETIME NULL
		--**********************************************************************************

		

    COMMIT TRANSACTION

    Insert into #ChangeScript014_stat (PatchStatus) Values (1)
END
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript014_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript014_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 014, 'Insert DeletedDate column into InsuranceProductType  '

		print '**************************************************'
		print '*  db.01.00.014: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.014: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript014_stat%')
Begin
	drop table #ChangeScript014_stat
End
go
 
 
/*
 db.01.00.015:
 Does the following:
	TODO: change order table, insert OrderingParty field,
		insert relation key between order and orderingparty,
		insert SmokeStatus, FaceToFace, FemaleExaminer fields
		rename OrderingParty field to OrderingPartyID
		add new relationship between orderassignment and employee (receivedby and mailby)
		add new relationship between order and agent, agency tables
		add agentCode, agencyCode into order table, delete SmokeStatus fields

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 015

*/

set nocount on
IF dbo.SMM_CheckExists(3, '#ChangeScript015_stat', '') = -1
-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript015_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 015)
begin
	print '**************************************************'
	print '*  db.01.00.015: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript015_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript015_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print 'Change order, insert OrderingParty,key order-orderingparty, SmokeStatus, FaceToFace, FemaleExaminer, OrderingParty->OrderingPartyID, add orderassignment-employee,order-agent, agency , agentCode, agencyCode->order'
	print '***********************************************************************'

	/* Add metadata.SmokeStatus */
	IF dbo.SMM_CheckExists(1, 'metadata.SmokeStatus', '') = -1
		CREATE TABLE [metadata].[SmokeStatus](
		[ID] [int] NOT NULL,
		[Name] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
		[Inactive] [bit] NOT NULL,
		 CONSTRAINT [PK_SmokeStatus] PRIMARY KEY CLUSTERED
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
	
	
	IF dbo.SMM_CheckExists(6, 'OrderingPartyID', 'Order') = -1
		ALTER TABLE dbo.[Order] ADD
			OrderingPartyID uniqueidentifier NULL

	IF dbo.SMM_CheckExists(2, 'FK_Order_OrderingParty', 'Order') = -1
	BEGIN
		ALTER TABLE dbo.[Order] ADD CONSTRAINT
		FK_Order_OrderingParty FOREIGN KEY
		(
		OrderingPartyID
		) REFERENCES dbo.OrderingParty
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
	END

	--IF dbo.SMM_CheckExists(2, 'FK_Order_OrderType', 'Order') = -1
	--	ALTER TABLE dbo.[Order]
	--	DROP CONSTRAINT FK_Order_OrderType
	
	IF dbo.SMM_CheckExists(1, 'OrderApplicant', '') = 0
	BEGIN
		IF dbo.SMM_CheckExists(6, 'SmokeStatus', 'OrderApplicant') = -1
			ALTER TABLE dbo.OrderApplicant ADD SmokeStatus nvarchar(50) NULL

		IF dbo.SMM_CheckExists(6, 'FaceToFace', 'OrderApplicant') = -1
			ALTER TABLE dbo.OrderApplicant ADD FaceToFace bit NULL

		IF dbo.SMM_CheckExists(6, 'FemaleExaminer', 'OrderApplicant') = -1
			ALTER TABLE dbo.OrderApplicant ADD FemaleExaminer bit NULL
			
		IF dbo.SMM_CheckExists(6, 'SmokeStatusID', 'OrderApplicant') = -1
			ALTER TABLE dbo.OrderApplicant ADD SmokeStatusID int NULL;	
		EXECUTE sp_rename N'[dbo].[OrderApplicant]', N'Applicant', 'OBJECT'	
		EXECUTE sp_rename N'[dbo].[PK_OrderApplicant]', N'PK_Applicant', 'OBJECT'
		
	END
	ELSE
		PRINT 'ERROR: db.01.00.015 - Table OrderApplicant does not exist'

--IF dbo.SMM_CheckExists(6, 'OrderingPartyID', 'Order') = -1
--BEGIN
--	EXECUTE sp_rename N'dbo.[Order].OrderingParty', N'Tmp_OrderingPartyID', 'COLUMN' 
--	EXECUTE sp_rename N'dbo.[Order].Tmp_OrderingPartyID', N'OrderingPartyID', 'COLUMN' 
--END

IF dbo.SMM_CheckExists(2, 'FK_OrderAssignment_Employee', 'OrderAssignment') = -1
	ALTER TABLE dbo.OrderAssignment ADD CONSTRAINT
	FK_OrderAssignment_Employee FOREIGN KEY
	(
	ReceivedBy
	) REFERENCES dbo.Employee
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	
	/* Create Applicant */
	IF dbo.SMM_CheckExists(1, 'Applicant', '') = -1
	BEGIN
			CREATE TABLE [dbo].[Applicant](
			[ID] [uniqueidentifier] NOT NULL,
			[GovID] [nvarchar](15) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[GovIDTypeID] [int] NULL,
			[Prefix] [nvarchar](5) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[FirstName] [nvarchar](25) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[MiddleName] [nvarchar](15) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[LastName] [nvarchar](25) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[Suffix] [nvarchar](15) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[NickName] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[Title] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[GenderID] [int] NULL,
			[BirthDate] [datetime] NULL,
			[DOBEstimated] [bit] NULL,
			[CreatedDate] [datetime] NOT NULL,
			[ModifiedDate] [datetime] NOT NULL,
			[DeletedDate] [datetime] NULL,
			[FaceToFace] [bit] NULL,
			[FemaleExaminer] [bit] NULL,
			[SmokeStatusID] [int] NULL,
		 CONSTRAINT [PK_OrderApplicant_1] PRIMARY KEY CLUSTERED
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[Applicant]  WITH CHECK ADD  CONSTRAINT [FK_Applicant_SmokeStatus] FOREIGN KEY([SmokeStatusID])
		REFERENCES [metadata].[SmokeStatus] ([ID])
		ALTER TABLE [dbo].[Applicant] CHECK CONSTRAINT [FK_Applicant_SmokeStatus]
	END

	
IF dbo.SMM_CheckExists(2, 'FK_OrderAssignment_MailBy', 'OrderAssignment') = -1
	ALTER TABLE dbo.OrderAssignment ADD CONSTRAINT
	FK_OrderAssignment_MailBy FOREIGN KEY
	(
	MailBy
	) REFERENCES dbo.Employee
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 


IF dbo.SMM_CheckExists(2, 'FK_Order_Agent', 'Order') = -1
	ALTER TABLE dbo.[Order] ADD CONSTRAINT
	FK_Order_Agent FOREIGN KEY
	(
	AgentID
	) REFERENCES dbo.Agent
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	
IF dbo.SMM_CheckExists(2, 'FK_Order_Agency', 'Order') = -1
	ALTER TABLE dbo.[Order] ADD CONSTRAINT
	FK_Order_Agency FOREIGN KEY
	(
	AgencyID
	) REFERENCES dbo.Agency
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	
IF dbo.SMM_CheckExists(2, 'FK_Applicant_SmokeStatus', 'Applicant ') = -1	
	ALTER TABLE dbo.Applicant ADD CONSTRAINT
	FK_Applicant_SmokeStatus FOREIGN KEY
	(
	SmokeStatusID
	) REFERENCES metadata.SmokeStatus
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
    
IF dbo.SMM_CheckExists(6, 'AgentCode', 'Order') = -1
	ALTER TABLE dbo.[Order] ADD
	AgentCode nvarchar(50) NULL
IF dbo.SMM_CheckExists(6, 'AgencyCode', 'Order') = -1
	ALTER TABLE dbo.[Order] ADD
	AgencyCode nvarchar(50) NULL

IF dbo.SMM_CheckExists(6, 'SmokeStatus', 'Applicant') = 0
	ALTER TABLE dbo.Applicant
	DROP COLUMN SmokeStatus
	
    Insert into #ChangeScript015_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript015_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript015_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)

		select 1.0, 015, 'Change order, insert OrderingParty,key order-orderingparty, SmokeStatus, FaceToFace, FemaleExaminer, OrderingParty->OrderingPartyID, add orderassignment-employee,order-agent, agency , agentCode, agencyCode->order'

		print '**************************************************'
		print '*  db.01.00.015: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.015: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript015_stat%')
Begin
	drop table #ChangeScript015_stat
End
go
 
 
/*
 db.01.00.016:
 Does the following:
	Rename Column KetFee in table FeeLevelItem to KiFee

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 016

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript016_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 016)
begin
	print '**************************************************'
	print '*  db.01.00.016: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript016_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript016_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Rename Column KetFee in table FeeLevelItem to KiFee                            *'
	print '***********************************************************************'

		IF dbo.SMM_CheckExists(6, 'KetFee', 'FeeLevelItem') = 0
		BEGIN
			EXECUTE sp_rename N'dbo.FeeLevelItem.KetFee', N'KitFee', 'COLUMN' 
			Insert into #ChangeScript016_stat (PatchStatus) Values (1)
		END

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript016_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript016_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 016, 'Rename Column KetFee in table FeeLevelItem to KiFee'

		print '**************************************************'
		print '*  db.01.00.016: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.016: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript016_stat%')
Begin
	drop table #ChangeScript016_stat
End
go
 
 
/*
 db.01.00.017:
 Does the following:
	Add SPApprovalIncluded field into BillingCompany table
*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript017_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 017)
begin
	print '**************************************************'
	print '*  db.01.00.017: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript017_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript017_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add SPApprovalIncluded field into BillingCompany table *'
	print '***********************************************************************'

ALTER TABLE dbo.[BillingCompany] ADD
		[SPApprovalIncluded] [bit] NOT NULL CONSTRAINT [DF_BillingCompany_SPApprovalIncluded]  DEFAULT ((0))

        Insert into #ChangeScript017_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript017_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript017_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 017, 'Add SPApprovalIncluded field into BillingCompany table'

		print '**************************************************'
		print '*  db.01.00.017: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.017: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript017_stat%')
Begin
	drop table #ChangeScript017_stat
End
go
 
 
/*
 db.01.00.018:
 Does the following:
	TODO: change order table, insert OrderingParty field,
		insert relation key between order and orderingparty,
		insert FaceToFace, FemaleExaminer fields
		rename OrderingParty field to OrderingPartyID

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 015

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript018_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 018)
begin
	print '**************************************************'
	print '*  db.01.00.018: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript018_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript018_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Add dbo.IncompleteOrder table                                 *'
	print '***********************************************************************'

	/* Add dbo.IncompleteOrder */
	IF dbo.SMM_CheckExists(1, 'IncompleteOrder', '') = -1
		CREATE TABLE [dbo].[IncompleteOrder](
			[ID] [int] IDENTITY(1,1) NOT NULL,
			[InsuranceID] [uniqueidentifier] NOT NULL,
			[InsuranceLocationID] [uniqueidentifier] NULL,
			[InsuranceProductTypeID] [uniqueidentifier] NULL,
			[AgentID] [uniqueidentifier] NULL,
			[AgentName] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[AgentCode] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[AgencyID] [uniqueidentifier] NULL,
			[AgencyName] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[AgencyCode] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[CaseManagerID] [uniqueidentifier] NULL,
			[OrderApplicantID] [uniqueidentifier] NULL,
			[MailTo] [nvarchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[FaxTo] [nvarchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[OrderNotes] [nvarchar](1000) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[OrderTakerID] [uniqueidentifier] NULL,
			[OrderStatusID] [int] NULL,
			[FemaleRequired] [bit] NULL,
			[ReferenceCode] [nvarchar](36) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[OrderPriortyID] [int] NULL,
			[SmmMailTo] [nvarchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[SmmFaxTo] [nvarchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[CreatedDate] [datetime] NULL,
			[ModifiedDate] [datetime] NULL,
			[DiscountAmount] [money] NULL,
			[DiscountPercent] [float] NULL,
			[Price] [money] NULL,
			[KitPrice] [money] NULL,
			[OrderTypeID] [int] NULL,
			[OrderingPartyID] [uniqueidentifier] NULL,
			[MeetFaceToFace] [bit] NULL,
			[ApplicantID] [uniqueidentifier] NULL,
		 CONSTRAINT [PK_IncompleteOrder] PRIMARY KEY CLUSTERED
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
		) ON [PRIMARY]

	/* Add IncompleteOrderRequirement */
	IF dbo.SMM_CheckExists(1, 'IncompleteOrderRequirement', '') = -1
	BEGIN
		CREATE TABLE [dbo].[IncompleteOrderRequirement](
			[IncompleteOrderID] [int] NOT NULL,
			[RequirementID] [uniqueidentifier] NOT NULL,
			[CreatedDate] [datetime] NULL,
			[Modified] [bit] NULL,
			[Deleted] [bit] NULL,
		 CONSTRAINT [PK_IncompleteOrderRequirement_1] PRIMARY KEY CLUSTERED
		(
			[IncompleteOrderID] ASC,
			[RequirementID] ASC
		)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
		) ON [PRIMARY]
		ALTER TABLE [dbo].[IncompleteOrderRequirement]  WITH CHECK ADD  CONSTRAINT [FK_IncompleteOrderRequirement_IncompleteOrder] FOREIGN KEY([IncompleteOrderID])
		REFERENCES [dbo].[IncompleteOrder] ([ID])
		ALTER TABLE [dbo].[IncompleteOrderRequirement] CHECK CONSTRAINT [FK_IncompleteOrderRequirement_IncompleteOrder]
		ALTER TABLE [dbo].[IncompleteOrderRequirement]  WITH CHECK ADD  CONSTRAINT [FK_IncompleteOrderRequirement_Requirement] FOREIGN KEY([RequirementID])
		REFERENCES [dbo].[Requirement] ([ID])
		ALTER TABLE [dbo].[IncompleteOrderRequirement] CHECK CONSTRAINT [FK_IncompleteOrderRequirement_Requirement]
	END

	/* Add IncompleteOrderSchedule */
	IF dbo.SMM_CheckExists(1, 'IncompleteOrderSchedule', '') = -1
	BEGIN
		CREATE TABLE [dbo].[IncompleteOrderSchedule](
			[ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_IncompleteOrderSchedule_ID]  DEFAULT (newid()),
			[IncompleteOrderID] [int] NOT NULL,
			[IsAvailable] [bit] NOT NULL,
			[Weekday] [int] NOT NULL,
			[FromDate] [datetime] NULL,
			[ToDate] [datetime] NULL,
			[FromTime] [datetime] NULL,
			[ToTime] [datetime] NULL,
			[Inactive] [bit] NOT NULL,
			[Preset] [bit] NOT NULL,
		 CONSTRAINT [PK_[IncompleteOrderSchedule] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
		) ON [PRIMARY]
		ALTER TABLE [dbo].[IncompleteOrderSchedule]  WITH CHECK ADD  CONSTRAINT [FK_IncompleteOrderSchedule_IncompleteOrder] FOREIGN KEY([IncompleteOrderID])
		REFERENCES [dbo].[IncompleteOrder] ([ID])
		ALTER TABLE [dbo].[IncompleteOrderSchedule] CHECK CONSTRAINT [FK_IncompleteOrderSchedule_IncompleteOrder]	
	END
	
	/* Change table name OrderAppAddress  -> ApplicantAddress */
	EXECUTE sp_rename N'dbo.[OrderAppAddress]', N'ApplicantAddress', 'OBJECT'
	EXECUTE sp_rename N'dbo.[FK_OrderAppAddress_AddressType]', 'FK_ApplicantAddress_AddressType', 'OBJECT'
	
	/* Create ApplicantAddress*/
	IF dbo.SMM_CheckExists(1, 'ApplicantAddress', '') = -1
	BEGIN
		CREATE TABLE [dbo].[ApplicantAddress](
		[ID] [uniqueidentifier] NOT NULL,
		[ApplicantID] [uniqueidentifier] NOT NULL,
		[AddressTypeID] [int] NULL,
		[RefByName] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[AttentionLine] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[Line1] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[Line2] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[City] [nvarchar](35) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[StateOther] [nvarchar](15) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[StateID] [int] NULL,
		[Zip] [nvarchar](5) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[PostalDropCode] [nvarchar](25) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[CountryID] [int] NULL,
		[IsPreferred] [bit] NOT NULL,
		[StartDate] [datetime] NULL,
		[EndDate] [datetime] NULL,
		[IsValidated] [bit] NOT NULL,
		[PreventOverride] [bit] NOT NULL,
		[Inactive] [bit] NOT NULL,
		[CreateDate] [datetime] NOT NULL,
		[ModifiedDate] [datetime] NOT NULL,
		[DeletedDate] [datetime] NULL,
		 CONSTRAINT [PK_OrderAppAddress_1] PRIMARY KEY CLUSTERED
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[ApplicantAddress]  WITH CHECK ADD  CONSTRAINT [FK_OrderAppAddress_AddressType] FOREIGN KEY([AddressTypeID])
			REFERENCES [metadata].[AddressType] ([ID])

		ALTER TABLE [dbo].[ApplicantAddress] CHECK CONSTRAINT [FK_OrderAppAddress_AddressType]

		ALTER TABLE [dbo].[ApplicantAddress]  WITH CHECK ADD  CONSTRAINT [FK_OrderAppAddress_Country] FOREIGN KEY([CountryID])
			REFERENCES [metadata].[Country] ([ID])

		ALTER TABLE [dbo].[ApplicantAddress] CHECK CONSTRAINT [FK_OrderAppAddress_Country]

		ALTER TABLE [dbo].[ApplicantAddress]  WITH CHECK ADD  CONSTRAINT [FK_OrderAppAddress_OrderApplicant] FOREIGN KEY([ApplicantID])
			REFERENCES [dbo].[Applicant] ([ID])

		ALTER TABLE [dbo].[ApplicantAddress] CHECK CONSTRAINT [FK_OrderAppAddress_OrderApplicant]

		ALTER TABLE [dbo].[ApplicantAddress]  WITH CHECK ADD  CONSTRAINT [FK_OrderAppAddress_State] FOREIGN KEY([StateID])
			REFERENCES [metadata].[State] ([ID])

		ALTER TABLE [dbo].[ApplicantAddress] CHECK CONSTRAINT [FK_OrderAppAddress_State]
    END
	/* End Create ApplicantAddress*/
		
	IF dbo.SMM_CheckExists(6, 'ApplicantID', 'ApplicantAddress') = -1	
		ALTER TABLE dbo.ApplicantAddress
			ADD [ApplicantID] [uniqueidentifier] NULL

	EXECUTE sp_rename N'dbo.FK_OrderAppAddress_OrderApplicant', N'FK_ApplicantAddress_Applicant', 'OBJECT' 		 		
	/*ALTER TABLE dbo.ApplicantAddress ADD CONSTRAINT
		FK_ApplicantAddress_Applicant FOREIGN KEY
		(
		ApplicantID
		) REFERENCES dbo.Applicant
		(
		ID
		) ON UPDATE  NO ACTION
		 ON DELETE  NO ACTION
	*/
	/* Change table name OrderAppEmailAddress  -> ApplicantEmailAddress */	
	IF (dbo.SMM_CheckExists(1, 'OrderAppEmailAddress', '') = 0) AND
		(dbo.SMM_CheckExists(1, 'ApplicantEmailAddress', '') = -1)
		EXECUTE sp_rename N'dbo.[OrderAppEmailAddress]', N'ApplicantEmailAddress', 'OBJECT'
	IF dbo.SMM_CheckExists(1, 'ApplicantEmailAddress', '') = -1
		PRINT 'ERROR: db.01.00.018 - Can not create table ApplicantEmailAddress'
	
	/* Change table name OrderAppPhone  -> ApplicantPhone */
	IF (dbo.SMM_CheckExists(1, 'OrderAppPhone', '') = 0) AND
		(dbo.SMM_CheckExists(1, 'ApplicantPhone', '') = -1)
		EXECUTE sp_rename N'dbo.[OrderAppPhone]', N'ApplicantPhone', 'OBJECT'
	IF dbo.SMM_CheckExists(1, 'ApplicantPhone', '') = -1
		PRINT 'ERROR: db.01.00.018 - Can not create table ApplicantPhone'

    Insert into #ChangeScript018_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript018_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript018_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 018, 'Change order table, insert OrderingParty field, insert relation key between order and orderingparty, FaceToFace, FemaleExaminer fields, rename OrderingParty field to OrderingPartyID'

		print '**************************************************'
		print '*  db.01.00.018: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.018: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript018_stat%')
Begin
	drop table #ChangeScript018_stat
End
go
 
 
/*
 db.01.00.019:
 Does the following:
	Insert data into SmokeStatus

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 019

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript019_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 019)
begin
	print '**************************************************'
	print '*  db.01.00.019: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript019_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript019_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add data into metadata.SmokeStatus                                      *'
	print '***********************************************************************'

	IF NOT Exists
	(
		SELECT * FROM [metadata].[SmokeStatus] WHERE ID = 0
	)
	INSERT [metadata].[SmokeStatus] ([ID],[Name],[Inactive])VALUES(0,'Unknown',0)
	IF NOT Exists
	(
		SELECT * FROM [metadata].[SmokeStatus] WHERE ID = 1
	)
	INSERT [metadata].[SmokeStatus] ([ID],[Name],[Inactive])VALUES(1,'Never',0)
	IF NOT Exists
	(
		SELECT * FROM [metadata].[SmokeStatus] WHERE ID = 2
	)
	INSERT [metadata].[SmokeStatus] ([ID],[Name],[Inactive])VALUES(2,'Prior',0)
	IF NOT Exists
	(
		SELECT * FROM [metadata].[SmokeStatus] WHERE ID = 3
	)
		INSERT [metadata].[SmokeStatus] ([ID],[Name],[Inactive])VALUES(3,'Current',0)
	IF NOT Exists
	(
		SELECT * FROM [metadata].[SmokeStatus] WHERE ID = 2147483647
	)
		INSERT [metadata].[SmokeStatus] ([ID],[Name],[Inactive])VALUES(2147483647,'Other',0)

      Insert into #ChangeScript019_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript019_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript019_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 019, 'Add data into metadata.SmokeStatus'

		print '**************************************************'
		print '*  db.01.00.019: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.019: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript019_stat%')
Begin
	drop table #ChangeScript019_stat
End
go
 
 
/*
 db.01.00.020:
 Does the following:
	+ Insert table OrderSchedule

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 020

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript020_stat
go
if exists (select * from  metadata.Version where Release = 1.0 and Build = 020)
begin
	print '**************************************************'
	print '*  db.01.00.020: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript020_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript020_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

		print '********************************************************************************'
		print '* Insert table OrderSchedule   *'
		print '********************************************************************************'
        IF dbo.SMM_CheckExists(1, 'OrderSchedule', '') = -1
			CREATE TABLE [dbo].[OrderSchedule]
			(
				[ID] [uniqueidentifier] NOT NULL,
				[OrderID] [int] NOT NULL,
				[IsAvailable] [bit] NOT NULL,
				[Weekday] [int] NOT NULL,
				[FromDate] [datetime] NULL,
				[ToDate] [datetime] NULL,
				[FromTime] [datetime] NULL,
				[ToTime] [datetime] NULL,
				[Inactive] [bit] NOT NULL,
				 CONSTRAINT [PK_OrderSchedule] PRIMARY KEY CLUSTERED 
				(
					[ID] ASC
				)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
			) ON [PRIMARY]

	ALTER TABLE [dbo].[OrderSchedule]  WITH CHECK ADD  CONSTRAINT [FK_OrderSchedule_Order] FOREIGN KEY([OrderID])
	REFERENCES [dbo].[Order] ([ID])

	IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS 
				WHERE TABLE_NAME ='OrderAssignment' AND 
						COLUMN_NAME = 'ScheduleTime')
		ALTER TABLE [dbo].[OrderAssignment] DROP COLUMN ScheduleTime
    Insert into #ChangeScript020_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

END
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript020_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript020_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 020, 'Insert table OrderSchedule '

		print '**************************************************'
		print '*  db.01.00.020: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.020: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript020_stat%')
Begin
	drop table #ChangeScript020_stat
End
go
 
 
/*
 db.01.00.021:
 Does the following:
	Add column Name, DeletedDate into table ServiceProviderSchedule

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 021

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript021_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 021)
begin
	print '**************************************************'
	print '*  db.01.00.021: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript021_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript021_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add column Name, DeletedDate into table ServiceProviderSchedule     *'
	print '***********************************************************************'


	ALTER TABLE ServiceProviderSchedule ADD [Name] VARCHAR(150) NULL, DeletedDate Datetime NULL	

        Insert into #ChangeScript021_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript021_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript021_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 021, 'Add column Name, DeletedDate into table ServiceProviderSchedule'

		print '**************************************************'
		print '*  db.01.00.021: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.021: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript021_stat%')
Begin
	drop table #ChangeScript021_stat
End
go
 
 
/*
 db.01.00.022:
 Does the following:
	+  Insert table OrderRelative
	+  Insert HoldTill into Order
	+  Insert PostedBy into OrderStatusHistory

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 022

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript022_stat
go
if exists (select *  from  metadata.Version where Release = 1.0 and Build = 022)
begin
	print '**************************************************'
	print '*  db.01.00.022: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript022_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript022_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

		print '************************************************************************************************'
		print '* Insert table OrderRelative and Insert HoldTill into Order , PostedBy into OrderStatusHistory *'
		print '************************************************************************************************'
		IF dbo.SMM_CheckExists(1, 'OrderRelative', '') = -1
		BEGIN
			CREATE TABLE [dbo].[OrderRelative]
			(
				[OrderID] [int] NOT NULL,
				[OrderRelativeID][int] NOT NULL,
				[RelationType] nvarchar(50),
				[Notes] nvarchar(250) 
				 CONSTRAINT [PK_OrderRelative] PRIMARY KEY CLUSTERED
				(
					[OrderID] ASC,
					[OrderRelativeID]
				)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
			) ON [PRIMARY]

			
			ALTER TABLE [dbo].[OrderRelative]  WITH CHECK ADD  CONSTRAINT [FK_OrderRelative_Order1] FOREIGN KEY([OrderID])
			REFERENCES [dbo].[Order] ([ID])

			ALTER TABLE [dbo].[OrderRelative]  WITH CHECK ADD  CONSTRAINT [FK_OrderRelative_Order2] FOREIGN KEY([OrderRelativeID])
			REFERENCES [dbo].[Order] ([ID])
		END

		IF dbo.SMM_CheckExists(2, 'FK_OrderStatusHistory_User', 'OrderStatusHistory') = 0
			ALTER TABLE [dbo].[OrderStatusHistory] DROP CONSTRAINT [FK_OrderStatusHistory_User]

		IF dbo.SMM_CheckExists(6, 'PostedBy', 'OrderStatusHistory') = -1
			ALTER TABLE [dbo].[OrderStatusHistory] ADD  PostedBy nvarchar(50) NULL

		IF dbo.SMM_CheckExists(6, 'LabSlip', 'OrderAssignment') = -1
			ALTER TABLE [dbo].[OrderAssignment] ADD  LabSlip nvarchar(50) NULL

		IF dbo.SMM_CheckExists(6, 'PostedBy', 'OrderAssignmentStatusHistory') = -1
			ALTER TABLE [dbo].[OrderAssignmentStatusHistory]
			ADD PostedBy uniqueidentifier NULL

    Insert into #ChangeScript022_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

END
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript022_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript022_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 022, ' Insert table OrderRelative and Insert HoldTill into Order , PostedBy into OrderStatusHistory   	'

		print '**************************************************'
		print '*  db.01.00.022: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.022: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript022_stat%')
Begin
	drop table #ChangeScript022_stat
End
go
 
 
/*
 db.01.00.023:
 Does the following:
	TODO: insert create date, modified bit and deleted bit into order requirements table (need for revertion)

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 023

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript023_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 023)
begin
	print '**************************************************'
	print '*  db.01.00.023: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript023_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript023_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '*  insert modified bit and deleted bit, insert create date into order requirements table (need for revertion)*'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'CreatedDate', 'OrderRequirement') = -1
		ALTER TABLE dbo.OrderRequirement ADD
		CreatedDate datetime NULL
	IF dbo.SMM_CheckExists(6, 'Modified', 'OrderRequirement') = -1
		ALTER TABLE dbo.OrderRequirement ADD
		Modified bit NULL
	IF dbo.SMM_CheckExists(6, 'Deleted', 'OrderRequirement') = -1
		ALTER TABLE dbo.OrderRequirement ADD
		Deleted bit NULL

    Insert into #ChangeScript023_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript023_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript023_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 023, 'TODO: insert create date , modified bit and deleted bit into order requirements table (need for revertion)'

		print '**************************************************'
		print '*  db.01.00.023: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.023: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript023_stat%')
Begin
	drop table #ChangeScript023_stat
End
go
 
 
/*
 db.01.00.024:
 Does the following:
	Add foreign key in the Column CreatedBy in table Agent

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 024

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript024_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 024)
begin
	print '**************************************************'
	print '*  db.01.00.024: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript024_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript024_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add foreign key in the Column CreatedBy in table Agent			     *'
	print '***********************************************************************'


	ALTER TABLE dbo.Agent ADD CONSTRAINT FK_Agent_Person FOREIGN KEY 
	(CreatedBy) REFERENCES dbo.Person(ID)


        Insert into #ChangeScript024_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript024_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript024_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 024, 'Add foreign key in the Column CreatedBy in table Agent'

		print '**************************************************'
		print '*  db.01.00.024: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.024: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript024_stat%')
Begin
	drop table #ChangeScript024_stat
End
go
 
 
/*
 db.01.00.025:
 Does the following:
	Add Columns IsShared, Inactive in table Agent

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 025

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript025_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 025)
begin
	print '**************************************************'
	print '*  db.01.00.025: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript025_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript025_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add Columns IsShared, Inactive in table Agent						 *'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'IsShared', 'Agent') = -1
		ALTER TABLE Agent ADD IsShared bit NULL
	IF dbo.SMM_CheckExists(6, 'Inactive', 'Agent') = -1
		ALTER TABLE Agent ADD Inactive bit NULL

    INSERT INTO #ChangeScript025_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript025_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript025_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 025, 'Add Columns IsShared, Inactive in table Agent'

		print '**************************************************'
		print '*  db.01.00.025: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.025: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript025_stat%')
Begin
	drop table #ChangeScript025_stat
End
go
 
 
/*
 db.01.00.026:
 Does the following:
	Create table FavouriteList

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 026

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript026_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 026)
begin
	print '**************************************************'
	print '*  db.01.00.026: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript026_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript026_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '*		Create table FavouriteList									 *'
	print '***********************************************************************'


	
CREATE TABLE [dbo].[FavouriteList](
	[AgentID] [uniqueidentifier] NOT NULL,
	[OrderingPartyUserID] [uniqueidentifier] NOT NULL
) ON [PRIMARY]

ALTER TABLE dbo.FavouriteList ADD CONSTRAINT
	PK_FavouriteList PRIMARY KEY CLUSTERED 
	(
	AgentID,
	OrderingPartyUserID
	) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

ALTER TABLE dbo.FavouriteList ADD CONSTRAINT
	FK_FavouriteList_Agent FOREIGN KEY
	(
	AgentID
	) REFERENCES dbo.Agent
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	
ALTER TABLE dbo.FavouriteList ADD CONSTRAINT
	FK_FavouriteList_OrderingPartyUser FOREIGN KEY
	(
	OrderingPartyUserID
	) REFERENCES dbo.OrderingPartyUser
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 


        Insert into #ChangeScript026_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript026_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript026_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 026, 'Create table FavouriteList'

		print '**************************************************'
		print '*  db.01.00.026: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.026: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript026_stat%')
Begin
	drop table #ChangeScript026_stat
End
go
 
 
/*
 db.01.00.027:
 Does the following:
	+ Add field Inactive to table Agency

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 027

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript027_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 027)
begin
	print '**************************************************'
	print '*  db.01.00.027: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript027_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript027_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add field Inactive to table Agency                                  *'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'Inactive', 'Agency') = -1
		ALTER TABLE dbo.[Agency] ADD [Inactive] bit NOT NULL CONSTRAINT [DF_Agency_Inactive]  DEFAULT ((0))

    Insert into #ChangeScript027_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript027_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript027_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 027, 'Add field Inactive to table Agency'

		print '**************************************************'
		print '*  db.01.00.027: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.027: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript027_stat%')
Begin
	drop table #ChangeScript027_stat
End
go
 
 
/*
 db.01.00.028:
 Does the following:
	Add Mail to and Fax to to dbo.OrderingParty table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 028

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript028_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 028)
begin
	print '**************************************************'
	print '*  db.01.00.028: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript028_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript028_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add Mail to and Fax to to dbo.OrderingParty table                            *'
	print '***********************************************************************'

IF dbo.SMM_CheckExists(6,'MailTo' , 'OrderingParty') = -1
	ALTER TABLE dbo.OrderingParty ADD
				MailTo nvarchar(150) NULL
IF dbo.SMM_CheckExists(6,'FaxTo' , 'OrderingParty') = -1
	ALTER TABLE dbo.OrderingParty ADD			
				FaxTo nvarchar(150) NULL

        Insert into #ChangeScript028_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript028_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript028_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 028, 'Add Mail to and Fax to to dbo.OrderingParty table'

		print '**************************************************'
		print '*  db.01.00.028: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.028: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript028_stat%')
Begin
	drop table #ChangeScript028_stat
End
go
 
 
/*
 db.01.00.029:
 Does the following:
	TODO: add OrderRelative table, create relations with order table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 000

*/

set nocount on
IF dbo.SMM_CheckExists(3, '#ChangeScript029_stat', '') = -1
-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript029_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 029)
begin
	print '**************************************************'
	print '*  db.01.00.029: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript029_stat (PatchStatus) Values (-1)
end
go


if exists (select * from metadata.Version where Release = 1.0 and Build = 029)
begin
	print '**************************************************'
	print '*  db.01.00.029: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	IF dbo.SMM_CheckExists(3,'#ChangeScript029_stat' , '') = 0
		Insert into [#ChangeScript029_stat] (PatchStatus) Values (-1)
End
/*  Add the first and only script here, which is mandotary */

If not exists (select * from #ChangeScript029_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'

	print '* TODO:  add OrderRelative table, create relations with order table*'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'RelationType', 'OrderRelative') = -1
		ALTER TABLE [dbo].OrderRelative ADD RelationType nvarchar(50) NULL
	IF dbo.SMM_CheckExists(6, 'Notes', 'OrderRelative') = -1
		ALTER TABLE [dbo].OrderRelative ADD Notes nvarchar(250) NULL	
	
	IF dbo.SMM_CheckExists(2, 'FK_OrderRelative_Order', 'OrderRelative') = -1
		ALTER TABLE dbo.OrderRelative ADD CONSTRAINT
			FK_OrderRelative_Order FOREIGN KEY
			(
			OrderID
			) REFERENCES dbo.[Order]
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 
IF dbo.SMM_CheckExists(2, 'FK_OrderRelative_Order1', 'OrderRelative') = -1
	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT
		FK_OrderRelative_Order1 FOREIGN KEY
		(
		OrderRelativeID
		) REFERENCES dbo.[Order]
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 

IF dbo.SMM_CheckExists(2, 'PK_OrderRelative', 'OrderRelative') = -1
	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT
		PK_OrderRelative PRIMARY KEY CLUSTERED 
		(
		OrderID,
		OrderRelativeID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

        Insert into #ChangeScript029_stat (PatchStatus) Values (1)

	COMMIT TRANSACTION
End
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript029_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript029_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 029, 'TODO:  add OrderRelative table, create relations with order table'

		print '**************************************************'
		print '*  db.01.00.029: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.029: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript029_stat%')
Begin
	drop table #ChangeScript029_stat
End
go
 
 
/*
 db.01.00.030:
 Does the following:
	TODO: add relationship betwwen order assignmentrequirement and service provider (ID)'

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 030

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript030_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 030)
begin
	print '**************************************************'
	print '*  db.01.00.030: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript030_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript030_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: add relationship betwwen order assignmentrequirement and service provider (ID)*,'
	print '***********************************************************************'

IF dbo.SMM_CheckExists(2, 'FK_OrderAssignment_ServiceProvider', 'OrderAssignment') = -1
	ALTER TABLE dbo.OrderAssignment ADD CONSTRAINT
		FK_OrderAssignment_ServiceProvider FOREIGN KEY
		(
		ServiceProviderID
		) REFERENCES dbo.ServiceProvider
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 

        Insert into #ChangeScript030_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript030_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript030_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 030, 'TODO: add relationship betwwen order assignmentrequirement and service provider (ID),'

		print '**************************************************'
		print '*  db.01.00.030: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.030: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript030_stat%')
Begin
	drop table #ChangeScript030_stat
End
go
 
 
/*
 db.01.00.031:
 Does the following:
	Create table AgencyFavouriteList

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 031

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript031_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 031)
begin
	print '**************************************************'
	print '*  db.01.00.031: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript031_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript031_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '*		Create table AgencyFavouriteList		     *'
	print '***********************************************************************'


	
IF dbo.SMM_CheckExists(1, 'AgencyFavouriteList', '') = -1
Begin
	CREATE TABLE [dbo].[AgencyFavouriteList](
		[AgencyID] [uniqueidentifier] NOT NULL,
		[OrderingPartyUserID] [uniqueidentifier] NOT NULL
	) ON [PRIMARY]

	ALTER TABLE dbo.AgencyFavouriteList ADD CONSTRAINT
		PK_AgencyFavouriteList PRIMARY KEY CLUSTERED 
		(
		AgencyID,
		OrderingPartyUserID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

	ALTER TABLE dbo.AgencyFavouriteList ADD CONSTRAINT
		FK_AgencyFavouriteList_Agency FOREIGN KEY
		(
		AgencyID
		) REFERENCES dbo.Agency
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
		
	ALTER TABLE dbo.AgencyFavouriteList ADD CONSTRAINT
		FK_AgencyFavouriteList_OrderingPartyUser FOREIGN KEY
		(
		OrderingPartyUserID
		) REFERENCES dbo.OrderingPartyUser
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
	END
ELSE
	PRINT 'INFO: Table AgencyFavouriteList already exists !'

IF dbo.SMM_CheckExists(6, 'IsShared', 'Agency') = -1
	ALTER TABLE dbo.[Agency] ADD [IsShared] bit NOT NULL CONSTRAINT [DF_Agency_IsShared]  DEFAULT ((0))
ELSE
BEGIN
	UPDATE dbo.Agent SET Inactive=0 WHERE Inactive IS NULL
	ALTER TABLE dbo.[Agent] ALTER COLUMN [Inactive] bit NOT NULL 
	IF dbo.SMM_CheckExists(4, 'DF_Agent_Inactive', 'Agent') = -1
    BEGIN
		ALTER TABLE dbo.[Agent] ADD CONSTRAINT [DF_Agent_Inactive] DEFAULT ((0)) FOR Inactive
	END
END


        Insert into #ChangeScript031_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript031_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript031_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 031, 'Create table AgencyFavouriteList'

		print '**************************************************'
		print '*  db.01.00.031: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.031: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript031_stat%')
Begin
	drop table #ChangeScript031_stat
End
go
 
 
/*
 db.01.00.032:
 Does the following:
	Add IsMaster to dbo.OrderingPartyUser table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 032

*/
set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript032_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 032)
begin
	print '**************************************************'
	print '*  db.01.00.032: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript032_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript032_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add IsMaster to dbo.OrderingPartyUser table                            *'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'IsMaster', 'OrderingPartyUser') = -1		
		ALTER TABLE [dbo].[OrderingPartyUser] ADD  IsMaster bit NOT NULL CONSTRAINT [DF_IsMaster]  DEFAULT (0)

    Insert into #ChangeScript032_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript032_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript032_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 032, 'Add IsMaster to dbo.OrderingPartyUser table'

		print '**************************************************'
		print '*  db.01.00.032: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.032: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript032_stat%')
Begin
	drop table #ChangeScript032_stat
End
go
 
 
/*
 db.01.00.033:
 Does the following:
	Rename table FavouriteList to AgentFavouriteList, modify columns IsShared, Inactive in table Agent

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 033

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript033_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 033)
begin
	print '**************************************************'
	print '*  db.01.00.033: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript033_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript033_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Rename table FavouriteList to AgentFavouriteList, modify columns IsShared, Inactive in table Agent   *'
	print '***********************************************************************'

	exec sp_rename 'FavouriteList','AgentFavouriteList','OBJECT'
	
	UPDATE dbo.Agent SET Inactive=0 WHERE Inactive IS NULL
	ALTER TABLE dbo.[Agent] ALTER COLUMN [Inactive] bit NOT NULL 
	ALTER TABLE dbo.[Agent] ADD CONSTRAINT [DF_Agent_Inactive] DEFAULT ((0)) FOR Inactive

	UPDATE dbo.Agent SET IsShared=0 WHERE IsShared IS NULL
	ALTER TABLE dbo.[Agent] ALTER COLUMN IsShared bit NOT NULL 
	ALTER TABLE dbo.[Agent] ADD CONSTRAINT [DF_Agent_IsShared] DEFAULT ((0)) FOR IsShared

    Insert into #ChangeScript033_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript033_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript033_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 033, 'Rename table FavouriteList to AgentFavouriteList, modify columns IsShared, Inactive in table Agent'

		print '**************************************************'
		print '*  db.01.00.033: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.033: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript033_stat%')
Begin
	drop table #ChangeScript033_stat
End
go
 
 
/*
 db.01.00.034:
 Does the following:
	+ add table incompleteOrderDocument

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 034

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript034_stat
go

if exists (select * from  metadata.Version where Release = 1.0 and Build = 034)
begin
	print '**************************************************'
	print '*  db.01.00.034: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript034_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript034_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add table incompleteOrderDocument, IncompleteOrderDocumentItem*'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(1, 'IncompleteOrderDocumentItem', '') = -1
	BEGIN
		CREATE TABLE [dbo].[IncompleteOrderDocumentItem](
			[ID] [uniqueidentifier] NOT NULL,
			[IncompleteOrderID] [int] NOT NULL,
			[DocumentFormatID] [int]  NOT NULL,
			[SubmissionTypeID] [int]  NULL,
			[DocumentTypeID] [int] NULL,
			[Name] [nvarchar](75) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
			[Description] [nvarchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[FileName] [nvarchar](75) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
			[CreatedDate] [datetime] NOT NULL,
			[ArchivedDate] [datetime] NULL,
			[DeletedDate] [datetime] NULL,
			 CONSTRAINT [PK_IncompleteOrderDocumentItem] PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
			) ON [PRIMARY]


			ALTER TABLE [dbo].[IncompleteOrderDocumentItem]  WITH CHECK ADD  CONSTRAINT [FK_IncompleteOrderDocumentItem_DocumentFormat] FOREIGN KEY([DocumentFormatID])
			REFERENCES [metadata].[DocumentFormat] ([ID])

			ALTER TABLE [dbo].[IncompleteOrderDocumentItem] CHECK CONSTRAINT [FK_IncompleteOrderDocumentItem_DocumentFormat]
			
			ALTER TABLE [dbo].[IncompleteOrderDocumentItem]  WITH CHECK ADD  CONSTRAINT [FK_IncompleteOrderDocumentItem_DocumentType] FOREIGN KEY([DocumentTypeID])
			REFERENCES [metadata].[DocumentType] ([ID])
			
			ALTER TABLE [dbo].[IncompleteOrderDocumentItem] CHECK CONSTRAINT [FK_IncompleteOrderDocumentItem_DocumentType]
			
			ALTER TABLE [dbo].[IncompleteOrderDocumentItem]  WITH CHECK ADD  CONSTRAINT [FK_IncompleteOrderDocumentItem_IncompleteOrder] FOREIGN KEY([IncompleteOrderID])
			REFERENCES [dbo].[IncompleteOrder] ([ID])
			
			ALTER TABLE [dbo].[IncompleteOrderDocumentItem] CHECK CONSTRAINT [FK_IncompleteOrderDocumentItem_IncompleteOrder]
			
			ALTER TABLE [dbo].[IncompleteOrderDocumentItem]  WITH CHECK ADD  CONSTRAINT [FK_IncompleteOrderDocumentItem_SubmissionType] FOREIGN KEY([SubmissionTypeID])
			REFERENCES [metadata].[SubmissionType] ([ID])
			
			ALTER TABLE [dbo].[IncompleteOrderDocumentItem] CHECK CONSTRAINT [FK_IncompleteOrderDocumentItem_SubmissionType]
	END
	
	IF dbo.SMM_CheckExists(1, 'IncompleteOrderDocument', '') = -1
	BEGIN
		CREATE TABLE IncompleteOrderDocument
		(
			ID uniqueidentifier  NOT NULL,
			IncompleteOrderID int NOT NULL,
			OrderDocumentID uniqueidentifier NOT NULL 
			CONSTRAINT [PK_IncompleteOrderDocument] PRIMARY KEY NONCLUSTERED 
			(
				[ID] ASC
			)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[IncompleteOrderDocument] WITH CHECK ADD  CONSTRAINT [FK_IncompleteOrderDocument_IncompleteOrderDocumentItem] FOREIGN KEY([OrderDocumentID])
		REFERENCES [dbo].[IncompleteOrderDocumentItem] ([ID])

		ALTER TABLE [dbo].[IncompleteOrderDocument] WITH CHECK ADD  CONSTRAINT [FK_IncompleteOrderDocument_IncompleteOrder] FOREIGN KEY([IncompleteOrderID])
		REFERENCES [dbo].[IncompleteOrder] ([ID])
			Insert into #ChangeScript034_stat (PatchStatus) Values (1)

	END
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript034_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript034_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 034, 'Add table incompleteOrderDocument, IncompleteOrderDocumentItem *'

		print '**************************************************'
		print '*  db.01.00.034: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.034: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript034_stat%')
Begin
	drop table #ChangeScript034_stat
End
go
 
 
/*
 db.01.00.035:
 Does the following:
	TODO: Create CaseManagerID column for dbo.OrderingParty and add contrains this column with dbo.Employee.ID

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 035

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript035_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript035_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 035)
begin
	print '**************************************************'
	print '*  db.01.00.035: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript035_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript035_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Create CaseManagerID column for dbo.OrderingParty and add
				   contrains this column with dbo.Employee.ID                           *'
	print '***********************************************************************'

IF dbo.SMM_CheckExists(2, 'FK_OrderingParty_Employee', 'OrderingParty') = 0
	ALTER TABLE [dbo].[OrderingParty] DROP CONSTRAINT FK_OrderingParty_Employee
IF dbo.SMM_CheckExists(6, 'CaseManagerID', 'OrderingParty') = 0
	ALTER TABLE [dbo].[OrderingParty] DROP COLUMN CaseManagerID
ALTER TABLE dbo.OrderingParty ADD
	CaseManagerID uniqueidentifier NULL
ALTER TABLE dbo.OrderingParty ADD CONSTRAINT
	FK_OrderingParty_Employee FOREIGN KEY
	(
	CaseManagerID
	) REFERENCES dbo.Employee
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 

        Insert into #ChangeScript035_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript035_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript035_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 035, 'TODO: <summary of what this patch does?>'

		print '**************************************************'
		print '*  db.01.00.035: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.035: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript035_stat%')
Begin
	drop table #ChangeScript035_stat
End
go
 
 
/*
 db.01.00.036:
 Does the following:
	Modify the type of column MiddleName in table Person

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 036

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript036_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 036)
begin
	print '**************************************************'
	print '*  db.01.00.036: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript036_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript036_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Modify the type of column MiddleName in table Person				 *'
	print '***********************************************************************'


	alter table Person alter column MiddleName nvarchar(25) null

        Insert into #ChangeScript036_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript036_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript036_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 036, 'Modify the type of column MiddleName in table Person'

		print '**************************************************'
		print '*  db.01.00.036: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.036: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript036_stat%')
Begin
	drop table #ChangeScript036_stat
End
go
 
 
/*
 db.01.00.038:
 Does the following:
	Remove column CaseManagerID in OrderingPartyInsurance table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 038

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript038_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 038)
begin
	print '**************************************************'
	print '*  db.01.00.038: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript038_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript038_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Remove column CaseManagerID in OrderingPartyInsurance table		 *'
	print '***********************************************************************'


	ALTER TABLE [dbo].[OrderingPartyInsurance] DROP CONSTRAINT [FK_OrderingPartyInsurance_Employee]
	ALTER TABLE [dbo].[OrderingPartyInsurance] DROP COLUMN [CaseManagerID]

	Insert into #ChangeScript038_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript038_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript038_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 038, 'Remove column CaseManagerID in OrderingPartyInsurance table'

		print '**************************************************'
		print '*  db.01.00.038: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.038: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript038_stat%')
Begin
	drop table #ChangeScript038_stat
End
go
 
 
/*
 db.01.00.039:
 Does the following:
	TODO: insert policy amount and number in to order and incomplete order table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 039

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript039_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript039_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 039)
begin
	print '**************************************************'
	print '*  db.01.00.039: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript039_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript039_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Insert policy amount and number in to order and incomplete order table*'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'PolicyAmount', 'Order') = -1
		ALTER TABLE dbo.[Order] ADD
		PolicyAmount int NULL
	
	IF dbo.SMM_CheckExists(6, 'PolicyNumber', 'Order') = -1
		ALTER TABLE dbo.[Order] ADD
		PolicyNumber int NULL

	
	IF dbo.SMM_CheckExists(6, 'PolicyAmount', 'IncompleteOrder') = -1
		ALTER TABLE dbo.[IncompleteOrder] ADD
		PolicyAmount int NULL
	
	IF dbo.SMM_CheckExists(6, 'PolicyNumber', 'IncompleteOrder') = -1
		ALTER TABLE dbo.[IncompleteOrder] ADD
		PolicyNumber int NULL

    Insert into #ChangeScript039_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript039_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript039_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 039, 'Insert policy amount and number in to order and incomplete order table'

		print '**************************************************'
		print '*  db.01.00.039: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.039: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript039_stat%')
Begin
	drop table #ChangeScript039_stat
End
go
 
 
/*
 db.01.00.040:
 Does the following:
	TODO: insert policy amount and number in to order and incomplete order table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 040

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript040_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript040_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 040)
begin
	print '**************************************************'
	print '*  db.01.00.040: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript040_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript040_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update metadata and insert data for DOC & PNG to DocumentFormat table*'
	print '***********************************************************************'

	UPDATE [metadata].[DocumentFormat]
	SET FileExtension='.JPG;.JPEG'
	WHERE ID=1

	UPDATE [metadata].[DocumentFormat]
	SET FileExtension='.GIF'
	WHERE ID=2

	UPDATE [metadata].[DocumentFormat]
	SET FileExtension='.TIF'
	WHERE ID=3

	UPDATE [metadata].[DocumentFormat]
	SET FileExtension='.PDF'
	WHERE ID=4

	IF NOT EXISTS(
		SELECT * FROM [metadata].[DocumentFormat] WHERE ID = 5
	)
		INSERT INTO [metadata].[DocumentFormat] ([ID], [Name],[FileExtension]) VALUES (5, N'DOC',N'.DOC;.DOCX')
	IF NOT EXISTS(
		SELECT * FROM [metadata].[DocumentFormat] WHERE ID = 6
	)
		INSERT INTO [metadata].[DocumentFormat] ([ID], [Name],[FileExtension]) VALUES (6, N'PNG',N'.PNG')

    Insert into #ChangeScript040_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript040_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript040_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 040, 'Update metadata and insert data for DOC & PNG to DocumentFormat table'

		print '**************************************************'
		print '*  db.01.00.040: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.040: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript040_stat%')
Begin
	drop table #ChangeScript040_stat
End
go
 
 
/*
 db.01.00.041:
 Does the following:
	TODO: Insert user = admin, password = admin

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 041

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript041_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript041_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 041)
begin
	print '**************************************************'
	print '*  db.01.00.041: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript041_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript041_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Insert user = admin, password = admin                               *'
	print '***********************************************************************'

	IF NOT EXISTS(
		SELECT * FROM dbo.Party WHERE ID = 'B0A630FC-3F64-4FF8-B195-167F7A14DCA1'
	)
	BEGIN
		IF dbo.SMM_CheckExists(2, 'FK_Party', 'Party') = 0
			ALTER TABLE [dbo].Party 
					NOCHECK CONSTRAINT [FK_Party]
		IF dbo.SMM_CheckExists(2, 'FK_Party_Person', 'Party') = 0
			ALTER TABLE [dbo].Party 
					NOCHECK CONSTRAINT [FK_Party_Person]
		INSERT INTO Party(ID,FullName,PartyTypeID,GovID,GovIDTypeID,PartnerAdminSystem,ServiceSinceDate,Inactive,ResidenceZip,CreatedDate,DeletedDate,ModifiedDate) VALUES('B0A630FC-3F64-4FF8-B195-167F7A14DCA1' ,cast('admin' as nvarchar),1 ,cast('543534' as nvarchar),NULL,NULL,NULL,cast('0' as bit),NULL,'2009-04-14 18:18:47',NULL,'2009-04-17 17:00:00');
		
		INSERT INTO Person(ID,Prefix,FirstName,MiddleName,LastName,Suffix,NickName,Title,GenderID,BirthDate,DOBEstimated) VALUES('B0A630FC-3F64-4FF8-B195-167F7A14DCA1' ,NULL,cast('Admin User' as nvarchar),cast('' as nvarchar),cast('' as nvarchar),NULL,NULL,NULL,NULL,NULL,NULL);

		IF dbo.SMM_CheckExists(2, 'FK_Party', 'Party') = 0
			ALTER TABLE [dbo].Party 
					CHECK CONSTRAINT [FK_Party]
		IF dbo.SMM_CheckExists(2, 'FK_Party_Person', 'Party') = 0
			ALTER TABLE [dbo].Party 
					CHECK CONSTRAINT [FK_Party_Person]
		
		
		INSERT INTO [User](ID,PersonID,UserName,Password,Inactive,CreatedDate,ModifiedDate,DeletedDate,ResetPasswordToken) VALUES('CBF729E5-15A2-4A97-B2B8-0F041AB79A78' ,'B0A630FC-3F64-4FF8-B195-167F7A14DCA1' ,cast('admin' as nvarchar),'D033E22AE348AEB5660FC2140AEC35850C4DA997' ,cast('0' as bit),'2009-04-16  3:49:55','2009-04-16 3:49:55',NULL,NULL);
		Insert into #ChangeScript041_stat (PatchStatus) Values (1)
	END
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript041_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript041_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 041, 'Insert user = admin, password = admin'

		print '**************************************************'
		print '*  db.01.00.041: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.041: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript041_stat%')
Begin
	drop table #ChangeScript041_stat
End
go
 
 
/*
 db.01.00.043:
 Does the following:
	rename orderApplicantID to ApplicantID in order and incompleteOrder table, add relation between order, incomplete order and applicant

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 043

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript043_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript043_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 043)
begin
	print '**************************************************'
	print '*  db.01.00.043: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript043_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript043_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* rename orderApplicantID to ApplicantID in order and incompleteOrder table, add relation between order, incomplete order and applicant*'
	print '***********************************************************************'
	IF dbo.SMM_CheckExists(2, 'FK_IncompleteOrder_Applicant', 'IncompleteOrder') = -1
		ALTER TABLE dbo.IncompleteOrder ADD CONSTRAINT
			FK_IncompleteOrder_Applicant FOREIGN KEY
			(
			ApplicantID
			) REFERENCES dbo.Applicant
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 

	IF dbo.SMM_CheckExists(6, 'OrderApplicantID', 'IncompleteOrder') = 0
		ALTER TABLE dbo.IncompleteOrder
			DROP COLUMN OrderApplicantID

	EXECUTE sp_rename N'dbo.[Order].OrderApplicantID', N'ApplicantID', 'COLUMN' 
	
	IF dbo.SMM_CheckExists(2, 'FK_Order_OrderApplicant', 'Order') = 0
	BEGIN
		ALTER TABLE [dbo].[Order]
			DROP CONSTRAINT FK_Order_OrderApplicant
	END
	
	IF dbo.SMM_CheckExists(2, 'FK_Order_Applicant', 'Order') = -1	
	BEGIN
		PRINT 'Creating new FK...'
		ALTER TABLE dbo.[Order] ADD CONSTRAINT
			FK_Order_Applicant FOREIGN KEY
			(
			ApplicantID
			) REFERENCES dbo.Applicant
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 
	END
	

	IF dbo.SMM_CheckExists(6, 'OrderApplicantID', 'ApplicantPhone') = 0
		EXECUTE sp_rename N'dbo.ApplicantPhone.OrderApplicantID', N'ApplicantID', 'COLUMN' 


	IF dbo.SMM_CheckExists(2, 'FK_OrderAppPhone_OrderApplicant', 'ApplicantPhone') = 0
		ALTER TABLE dbo.ApplicantPhone
			DROP CONSTRAINT FK_OrderAppPhone_OrderApplicant
	IF dbo.SMM_CheckExists(2, 'FK_ApplicantPhone_Applicant', 'ApplicantPhone') = -1	
		ALTER TABLE dbo.ApplicantPhone ADD CONSTRAINT
			FK_ApplicantPhone_Applicant FOREIGN KEY
			(
			ApplicantID
			) REFERENCES dbo.Applicant
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 

		
	IF dbo.SMM_CheckExists(6, 'OrderApplicantID', 'ApplicantEmailAddress') = 0
		EXECUTE sp_rename N'dbo.ApplicantEmailAddress.OrderApplicantID', N'ApplicantID', 'COLUMN' 
	IF dbo.SMM_CheckExists(6, 'FK_OrderAppEmailAddress_OrderApplicant', 'ApplicantEmailAddress') = 0
		ALTER TABLE [dbo].[ApplicantEmailAddress] DROP CONSTRAINT [FK_OrderAppEmailAddress_OrderApplicant]
	IF dbo.SMM_CheckExists(6, 'FK_ApplicantEmailAddress_Applicant', 'ApplicantEmailAddress') = 0		
		ALTER TABLE dbo.ApplicantEmailAddress ADD CONSTRAINT
			FK_ApplicantEmailAddress_Applicant FOREIGN KEY
			(
			ApplicantID
			) REFERENCES dbo.Applicant
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 
	IF dbo.SMM_CheckExists(2, 'FK_IncompleteOrder_OrderingParty', 'IncompleteOrder') = -1
		ALTER TABLE dbo.IncompleteOrder ADD CONSTRAINT
			FK_IncompleteOrder_OrderingParty FOREIGN KEY
			(
			OrderingPartyID
			) REFERENCES dbo.OrderingParty
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 

	EXECUTE sp_rename N'dbo.FK_OrderAppAddress_Country', N'FK_ApplicantAddress_Country', 'OBJECT' 		 


	IF dbo.SMM_CheckExists(2, 'FK_ApplicantPhone_Applicant', 'ApplicantPhone') = 0
		ALTER TABLE dbo.[ApplicantPhone] DROP CONSTRAINT [FK_ApplicantPhone_Applicant]
	/* remove obsolete constraints*/
	
	IF dbo.SMM_CheckExists(2, 'FK_Order_Applicant', 'Order') = 0
		ALTER TABLE dbo.[Order] DROP CONSTRAINT [FK_Order_Applicant]
	/* remove obsolete constraints*/
	
	EXECUTE sp_rename N'dbo.PK_OrderAppAddress', N'PK_ApplicantAddress', 'OBJECT' 		 
	EXECUTE sp_rename N'dbo.FK_OrderAppAddress_State', N'FK_ApplicantAddress_State', 'OBJECT' 		 
	EXECUTE sp_rename N'dbo.PK_OrderAppEmailAddress', N'PK_ApplicantEmailAddress', 'OBJECT' 		 
	EXECUTE sp_rename N'dbo.FK_OrderAppEmailAddress_EmailFormat', N'FK_ApplicantEmailAddress_EmailFormat', 'OBJECT' 		 
	EXECUTE sp_rename N'dbo.FK_OrderAppEmailAddress_EmailType', N'FK_ApplicantEmailAddress_EmailType', 'OBJECT' 		 
	EXECUTE sp_rename N'dbo.PK_OrderAppPhone', N'PK_ApplicantPhone', 'OBJECT' 		 
	EXECUTE sp_rename N'dbo.FK_OrderAppPhone_Country', N'FK_ApplicantPhone_Country', 'OBJECT' 		 
	EXECUTE sp_rename N'dbo.FK_OrderAppPhone_PhoneType', N'FK_ApplicantPhone_PhoneType', 'OBJECT' 		 

    Insert into #ChangeScript043_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript043_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript043_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 043, 'rename orderApplicantID to ApplicantID in order and incompleteOrder table, add relation between order, incomplete order and applicant'

		print '**************************************************'
		print '*  db.01.00.043: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.043: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript043_stat%')
Begin
	drop table #ChangeScript043_stat
End
go
 
 
/*
 db.01.00.044:
 Does the following:
	Work around to fix missing constraints and field name

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 044

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript044_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript044_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 044)
begin
	print '**************************************************'
	print '*  db.01.00.044: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript044_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript044_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Work around to fix missing constraints and field name               *'
	print '***********************************************************************'
	
	--
	IF dbo.SMM_CheckExists(2, 'FK_Order_OrderApplicant', 'Order') = 0
	BEGIN
		ALTER TABLE [dbo].[Order]
			DROP CONSTRAINT FK_Order_OrderApplicant
	END
	
	IF dbo.SMM_CheckExists(2, 'FK_Order_Applicant', 'Order') = 0
		ALTER TABLE [dbo].[Order]
			DROP CONSTRAINT FK_Order_Applicant
		
	IF dbo.SMM_CheckExists(2, 'FK_Order_Applicant', 'Order') = -1
	BEGIN
		PRINT 'Creating new FK...'
		ALTER TABLE dbo.[Order] ADD CONSTRAINT
			FK_Order_Applicant FOREIGN KEY
			(
			ApplicantID
			) REFERENCES dbo.Applicant
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 
	END

	IF dbo.SMM_CheckExists(2, 'FK_OrderAppAddress_OrderApplicant', 'OrderAppAddress') = 0
		ALTER TABLE [dbo].[OrderAppAddress]
			DROP CONSTRAINT FK_OrderAppAddress_OrderApplicant
	IF dbo.SMM_CheckExists(2, 'FK_ApplicantAddress_Applicant', 'ApplicantAddress') = 0
		ALTER TABLE [dbo].[ApplicantAddress]
			DROP CONSTRAINT FK_ApplicantAddress_Applicant
	IF dbo.SMM_CheckExists(2, 'FK_ApplicantAddress_Applicant', 'ApplicantAddress') = -1		
	BEGIN
		PRINT 'Creating new FK_ApplicantAddress_Applicant...'
		ALTER TABLE dbo.[ApplicantAddress] ADD CONSTRAINT
			FK_ApplicantAddress_Applicant FOREIGN KEY
			(
			ApplicantID
			) REFERENCES dbo.Applicant
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 
	END
	
	
	IF dbo.SMM_CheckExists(2, 'FK_ApplicantPhone_Applicant', 'ApplicantPhone') = 0
	BEGIN
		ALTER TABLE dbo.ApplicantPhone
			DROP CONSTRAINT FK_ApplicantPhone_Applicant
		ALTER TABLE dbo.ApplicantPhone ADD CONSTRAINT
			FK_ApplicantPhone_Applicant FOREIGN KEY
			(
			ApplicantID
			) REFERENCES dbo.Applicant
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 
		PRINT 'INFO: db.01.00.044: update FK_ApplicantPhone_Applicant'
	END
	ELSE
		PRINT 'INFO: db.01.00.044: Can not update FK_ApplicantPhone_Applicant'
		
	IF dbo.SMM_CheckExists(2, 'FK_OrderAppEmailAddress_OrderApplicant', 'ApplicantEmailAddress') = 0	
		ALTER TABLE [dbo].[ApplicantEmailAddress] DROP CONSTRAINT [FK_OrderAppEmailAddress_OrderApplicant]
	IF dbo.SMM_CheckExists(2, 'FK_ApplicantEmailAddress_Applicant', 'ApplicantEmailAddress') = -1
	BEGIN
		ALTER TABLE dbo.ApplicantEmailAddress ADD CONSTRAINT
			FK_ApplicantEmailAddress_Applicant FOREIGN KEY
			(
			ApplicantID
			) REFERENCES dbo.Applicant
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 
		PRINT 'INFO: db.01.00.044: update FK_ApplicantEmailAddress_Applicant'
	END
	ELSE
		PRINT 'INFO: db.01.00.044: Can not update FK_OrderAppPhone_OrderApplicant'
		
		 
	IF dbo.SMM_CheckExists(2, 'FK_OrderAppAddress_Country', 'ApplicantAddress') = 0
		EXECUTE sp_rename N'dbo.FK_OrderAppAddress_Country', N'FK_ApplicantAddress_Country', 'OBJECT' 		 


	IF dbo.SMM_CheckExists(2, 'FK_ApplicantPhone_Applicant', 'ApplicantPhone') = 0
	BEGIN
		ALTER TABLE dbo.[ApplicantPhone] DROP CONSTRAINT [FK_ApplicantPhone_Applicant]
	
		ALTER TABLE dbo.ApplicantPhone ADD CONSTRAINT
			FK_ApplicantPhone_Applicant FOREIGN KEY
			(
			ApplicantID
			) REFERENCES dbo.Applicant
			(
			ID
			) ON UPDATE  NO ACTION 
			 ON DELETE  NO ACTION 
		PRINT 'INFO: db.01.00.044: Update FK_ApplicantPhone_Applicant'
	END
	ELSE
		PRINT 'INFO: db.01.00.044: Can not update FK_ApplicantPhone_Applicant'
	---
	
	IF dbo.SMM_CheckExists(4, 'DF_Agency_CreatedBy', 'Agency') = 0
		ALTER TABLE dbo.Agency DROP CONSTRAINT DF_Agency_CreatedBy
	IF dbo.SMM_CheckExists(4, 'DF_Agent_CreatedBy', 'Agent') = 0
		ALTER TABLE dbo.Agent DROP CONSTRAINT DF_Agent_CreatedBy
	IF dbo.SMM_CheckExists(4, 'DF_Employee_ID', 'Employee') = 0
		ALTER TABLE dbo.Employee DROP CONSTRAINT DF_Employee_ID
	IF dbo.SMM_CheckExists(4, 'DF_Insurance_ID', 'Insurance') = 0
		ALTER TABLE dbo.Insurance DROP CONSTRAINT DF_Insurance_ID
	IF dbo.SMM_CheckExists(4, 'DF_InsuranceLocation_ID', 'InsuranceLocation') = 0
		ALTER TABLE dbo.InsuranceLocation DROP CONSTRAINT DF_InsuranceLocation_ID
	IF dbo.SMM_CheckExists(4, 'DF_Insurance_OrgID', 'Insurance') = 0
		ALTER TABLE dbo.Insurance DROP CONSTRAINT DF_Insurance_OrgID	
	IF dbo.SMM_CheckExists(4, 'DF_InsuranceProductType_ID', 'InsuranceProductType') = 0
		ALTER TABLE dbo.InsuranceProductType DROP CONSTRAINT DF_InsuranceProductType_ID
	IF dbo.SMM_CheckExists(4, 'DF_Lab_ID', 'Lab') = 0
		ALTER TABLE dbo.Lab DROP CONSTRAINT DF_Lab_ID
	IF dbo.SMM_CheckExists(4, 'DF_OrderAssignmentStatusHistory_ID', 'OrderAssignmentStatusHistory') = 0
		ALTER TABLE dbo.OrderAssignmentStatusHistory DROP CONSTRAINT DF_OrderAssignmentStatusHistory_ID
	IF dbo.SMM_CheckExists(4, 'DF_OrderingParty_ID', 'OrderingParty') = 0
		ALTER TABLE dbo.OrderingParty DROP CONSTRAINT DF_OrderingParty_ID
		
		
		
	IF dbo.SMM_CheckExists(4, 'DF_Organization_ID', 'Organization') = 0
		ALTER TABLE dbo.Organization DROP CONSTRAINT DF_Organization_ID
	IF dbo.SMM_CheckExists(4, 'DF_Party_ID', 'Party') = 0
		ALTER TABLE dbo.Party DROP CONSTRAINT DF_Party_ID
	IF dbo.SMM_CheckExists(2, 'DF_Person_ID', 'Person') = 0
		ALTER TABLE dbo.Person DROP CONSTRAINT DF_Person_ID
	IF dbo.SMM_CheckExists(4, 'DF_Requirement_ID', 'Requirement') = 0
		ALTER TABLE dbo.Requirement DROP CONSTRAINT DF_Requirement_ID
	IF dbo.SMM_CheckExists(2, 'PK_InsRequirement', 'Requirement') = 0
		EXECUTE sp_rename N'dbo.PK_InsRequirement', N'PK_Requirement', 'OBJECT' 		 
	IF dbo.SMM_CheckExists(2, 'FK_InsRequirement_Insurance', 'Requirement') = 0
		ALTER TABLE dbo.Requirement DROP CONSTRAINT FK_InsRequirement_Insurance
	IF dbo.SMM_CheckExists(2, 'FK_Requirement_Insurance', 'Requirement') = 0
		ALTER TABLE dbo.Requirement DROP CONSTRAINT FK_Requirement_Insurance
	IF dbo.SMM_CheckExists(4, 'DF_RequirementType_ID', 'RequirementType') = 0
		ALTER TABLE dbo.RequirementType DROP CONSTRAINT DF_RequirementType_ID

	
	ALTER TABLE dbo.ApplicantAddress ALTER COLUMN AddressTypeID int NULL
	ALTER TABLE dbo.ApplicantAddress ALTER COLUMN ApplicantID uniqueidentifier NOT NULL
	ALTER TABLE dbo.ApplicantEmailAddress ALTER COLUMN ApplicantID uniqueidentifier NOT NULL
	IF dbo.SMM_CheckExists(2, 'FK_OrderAppEmailAddress_OrderApplicant', 'ApplicantEmailAddress') = 0
		ALTER TABLE [dbo].[ApplicantEmailAddress] DROP CONSTRAINT [FK_OrderAppEmailAddress_OrderApplicant]
	IF dbo.SMM_CheckExists(2, 'FK_ApplicantEmailAddress_Applicant', 'ApplicantEmailAddress') = -1
	BEGIN
		ALTER TABLE [dbo].[ApplicantEmailAddress]  WITH CHECK ADD  CONSTRAINT [FK_ApplicantEmailAddress_Applicant]
		FOREIGN KEY([ApplicantID])
		REFERENCES [dbo].[Applicant] ([ID])
		ALTER TABLE [dbo].[ApplicantEmailAddress] CHECK CONSTRAINT [FK_ApplicantEmailAddress_Applicant]		
	END
	
	UPDATE OrderingPartyUser SET IsMaster=0 WHERE IsMaster is NULL
	ALTER TABLE dbo.OrderingPartyUser ALTER COLUMN IsMaster bit NOT NULL 
	IF dbo.SMM_CheckExists(4, 'DF_IsMaster', 'OrderingPartyUser') = -1
		ALTER TABLE dbo.[OrderingPartyUser] ADD CONSTRAINT [DF_IsMaster] DEFAULT ((0)) FOR IsMaster

	
	UPDATE Party SET ModifiedDate=getdate() WHERE ModifiedDate is NULL
	ALTER TABLE dbo.Party ALTER COLUMN ModifiedDate datetime NOT NULL
	ALTER TABLE dbo.[Party] ADD CONSTRAINT [DF_ModifiedDate] DEFAULT (getDate()) FOR ModifiedDate
	
	IF dbo.SMM_CheckExists(1, 'OrderApplicant', '') = 0
		DROP TABLE dbo.OrderApplicant
	IF dbo.SMM_CheckExists(1, 'OrderAppAddress', '') = 0
		DROP TABLE dbo.OrderAppAddress

	IF dbo.SMM_CheckExists(6, 'HoldTill', 'Order') = -1
		ALTER TABLE dbo.[Order] ADD HoldTill datetime NULL		
	
    Insert into #ChangeScript044_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript044_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript044_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 044, 'Work around to fix missing constraints and field name'

		print '**************************************************'
		print '*  db.01.00.044: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.044: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript044_stat%')
Begin
	drop table #ChangeScript044_stat
End
go
 
 
/*
 db.01.00.045:
 Does the following:
	Add field ApprovedBySMM to table Agency

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 045

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript045_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript045_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 045)
begin
	print '**************************************************'
	print '*  db.01.00.045: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript045_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript045_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add field ApprovedBySMM to table Agency                             *'
	print '***********************************************************************'

	ALTER TABLE dbo.[Agency] ADD [ApprovedBySMM] bit NOT NULL CONSTRAINT [DF_Agency_ApprovedBySMM]  DEFAULT ((0))

        Insert into #ChangeScript045_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript045_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript045_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 045, 'Add field ApprovedBySMM to table Agency'

		print '**************************************************'
		print '*  db.01.00.045: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.045: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript045_stat%')
Begin
	drop table #ChangeScript045_stat
End
go
 
 
/*
 db.01.00.046:
 Does the following:
	Drop OrderApplicantID in ApplicantAddress

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 046

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript046_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript046_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 046)
begin
	print '**************************************************'
	print '*  db.01.00.046: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript046_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript046_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Drop OrderApplicantID in ApplicantAddress                           *'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'OrderApplicantID', 'ApplicantAddress') = 0
		ALTER TABLE dbo.[ApplicantAddress] DROP COLUMN [OrderApplicantID]
    
	Insert into #ChangeScript046_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript046_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript046_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 046, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.046: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.046: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript046_stat%')
Begin
	drop table #ChangeScript046_stat
End
go
 
 
/*
 db.01.00.047:
 Does the following:
	Add OrderID to PartyRating
	Add ForeignKey between Order and PartyRating
	change CreatedBy (datetime) to CreatedBy (guid)
	change DeletedBy (datetime) to DeletedBy (guid)
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 047

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript047_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript047_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 047)
begin
	print '**************************************************'
	print '*  db.01.00.047: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript047_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript047_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add OrderID to PartyRating                                          *'
	print '* Add ForeignKey between Order and PartyRating                        *'
	print '* change CreatedBy (datetime) to CreatedBy (guid)                        *'
	print '* change DeletedBy (datetime) to DeletedBy (guid)                        *'
	print '***********************************************************************'

		IF dbo.SMM_CheckExists(6, 'OrderID', 'PartyRating') = -1
			ALTER TABLE dbo.PartyRating ADD  OrderID int NOT NULL;


		ALTER TABLE dbo.PartyRating ADD CONSTRAINT
			FK_PartyRating_Order FOREIGN KEY
			(
				OrderID
			) REFERENCES dbo.[Order]
			(
				ID
			) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
	

	 
	 /* change CreatedBy (datetime) to CreatedBy (guid) */
	 /* change DeletedBy (datetime) to DeletedBy (guid) */
	IF dbo.SMM_CheckExists(6, 'CreatedBy', 'ErrorLog') = -1
		ALTER TABLE dbo.ErrorLog ALTER COLUMN  CreatedBy uniqueidentifier NOT NULL

	IF dbo.SMM_CheckExists(6, 'DeletedBy', 'ErrorLog') = -1
		ALTER TABLE dbo.ErrorLog ALTER COLUMN  DeletedBy uniqueidentifier NULL
    
	Insert into #ChangeScript047_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript047_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript047_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 047, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.047: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.047: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript047_stat%')
Begin
	drop table #ChangeScript047_stat
End
go
 
 
/*
 db.01.00.048:
 Does the following:
	Add Department table
	Add DepartmentID into Employee table
	Add EmployeeStatusID into Employee table
	Add Group table and relationship between Group and Party table
	Add ShortName field into Person table
	Add UserRole table and relationship between User Role and User
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 048

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript048_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript048_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 048)
begin
	print '**************************************************'
	print '*  db.01.00.048: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript048_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript048_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* Add Department table												*'
	print '* Add DepartmentID into Employee table								*'
	print '* Add EmployeeStatusID into Employee table							*'
	print '* Add Group table and relationship between Group and Party table		*'
	print '* Add ShortName field into Person table								*'
	print '* Add UserRole table and relationship between User Role and User		*'
	print '**********************************************************************'

		IF dbo.SMM_CheckExists(1, 'Department', '') = -1
			CREATE TABLE [dbo].[Department]
			(
				[ID] [uniqueidentifier] NOT NULL,
				[Name][nvarchar](100),
				CONSTRAINT [PK_Department] PRIMARY KEY(ID)
			)
		IF dbo.SMM_CheckExists(6, 'DepartmentID', 'Employee') = -1
			ALTER TABLE dbo.[Employee]
			ADD DepartmentID [uniqueidentifier]		
		IF dbo.SMM_CheckExists(2, 'FK_Employee_Department', 'Employee') = -1
			ALTER TABLE dbo.[Employee]
			ADD CONSTRAINT FK_Employee_Department FOREIGN KEY(DepartmentID)
			REFERENCES dbo.[Department](ID)
		
		IF dbo.SMM_CheckExists(6, 'EmployeeStatusID', 'Employee') = -1
			ALTER TABLE dbo.[Employee]
			ADD EmployeeStatusID int NOT NULL default 1
		IF dbo.SMM_CheckExists(2, 'FK_Employee_EmployeeStatus', 'Employee') = -1
			ALTER TABLE dbo.[Employee]
			ADD CONSTRAINT FK_Employee_Status FOREIGN KEY(EmployeeStatusID)
			REFERENCES metadata.[EmployeeStatus](ID)
							
		IF dbo.SMM_CheckExists(6, 'ShortName', 'Person') = -1
			ALTER TABLE dbo.[Person]
			ADD ShortName [nvarchar](100) not null constraint DF_Person_ShortName default('') 
		
		IF dbo.SMM_CheckExists(1, 'Group', '') = -1
			CREATE TABLE dbo.[Group]
			(
				[ID] [uniqueidentifier] NOT NULL,
				[Name]	[nvarchar](100) NOT NULL,
				[Description] [nvarchar](255),
				CONSTRAINT [PK_Group] PRIMARY KEY(ID)
			)
		
		IF dbo.SMM_CheckExists(1, 'PartyGroup', '') = -1
			CREATE TABLE [dbo].[PartyGroup](
				[PartyID] [uniqueidentifier] NOT NULL,
				[GroupID] [uniqueidentifier] NOT NULL,
				CONSTRAINT [PK_PartyGroup] PRIMARY KEY ([PartyID] ,[GroupID])
			)
		
		IF dbo.SMM_CheckExists(2, 'FK_UserGroup_Group', 'PartyGroup') = -1
			ALTER TABLE [dbo].[PartyGroup]  WITH CHECK ADD CONSTRAINT [FK_PartyGroup_Group] FOREIGN KEY([GroupID])
			REFERENCES dbo.[Group] ([ID])
		IF dbo.SMM_CheckExists(2, 'FK_UserGroup_User', 'PartyGroup') = -1
			ALTER TABLE [dbo].[PartyGroup]  WITH CHECK ADD CONSTRAINT [FK_PartyGroup_Party] FOREIGN KEY([PartyID])
			REFERENCES dbo.[Party] ([ID])
		
		IF dbo.SMM_CheckExists(1, 'UserRole', '') = -1
			CREATE TABLE [dbo].[UserRole](
				[ID] [uniqueidentifier] NOT NULL,
				[Name]	[nvarchar](100) NOT NULL,
				[Description] [nvarchar](255),
				CONSTRAINT [PK_UserRole] PRIMARY KEY(ID)
			)
		
		IF dbo.SMM_CheckExists(1, 'UserRoleAssignment', '') = -1
			CREATE TABLE [dbo].[UserRoleAssignment](
				[UserRoleID] [uniqueidentifier] NOT NULL,
				[UserID] [uniqueidentifier] NOT NULL,
				CONSTRAINT [PK_UserRoleAssignment] PRIMARY KEY ([UserRoleID] ,[UserID])
			)
		IF dbo.SMM_CheckExists(2, 'FK_UserRoleAssignment_UserRole', 'UserRoleAssignment') = -1
			ALTER TABLE [dbo].[UserRoleAssignment]  WITH CHECK ADD CONSTRAINT [FK_UserRoleAssignment_UserRole] FOREIGN KEY([UserRoleID])
			REFERENCES dbo.[UserRole] ([ID])
		IF dbo.SMM_CheckExists(2, 'FK_UserRoleAssignment_User', 'UserRoleAssignment') = -1
			ALTER TABLE [dbo].[UserRoleAssignment]  WITH CHECK ADD CONSTRAINT [FK_UserRoleAssignment_User] FOREIGN KEY([UserID])
			REFERENCES dbo.[User]([ID])
		
		IF dbo.SMM_CheckExists(1, 'UserRolePermission', '') = -1
			CREATE TABLE [dbo].[UserRolePermission](
				[UserRoleID] [uniqueidentifier] NOT NULL,
				[PermissionTypeID] [int] NOT NULL,
				CONSTRAINT [PK_UserRolePermission] PRIMARY KEY ([UserRoleID] ,[PermissionTypeID])
			)
		IF dbo.SMM_CheckExists(2, 'FK_UserRolePermission_UserRole', 'UserRolePermission') = -1
			ALTER TABLE [dbo].[UserRolePermission]  WITH CHECK ADD CONSTRAINT [FK_UserRolePermission_UserRole] FOREIGN KEY([UserRoleID])
			REFERENCES dbo.[UserRole] ([ID])
		IF dbo.SMM_CheckExists(2, 'FK_UserRolePermission_PermissionType', 'UserRolePermission') = -1
			ALTER TABLE [dbo].[UserRolePermission]  WITH CHECK ADD CONSTRAINT [FK_UserRolePermission_PermissionType] FOREIGN KEY([PermissionTypeID])
			REFERENCES metadata.[PermissionType] ([ID])				
		
		IF dbo.SMM_CheckExists(1, 'metadata.[EmployeeTitle]', '') = -1
			CREATE TABLE [metadata].[EmployeeTitle](
				[ID] [int] NOT NULL,
				[Name] [nvarchar](50) NOT NULL,
				CONSTRAINT [PK_EmployeeTitle] PRIMARY KEY ([ID])
			)
		
		INSERT INTO [metadata].[EmployeeTitle] ([ID], [Name]) VALUES (1,'Employee')
		INSERT INTO [metadata].[EmployeeTitle] ([ID], [Name]) VALUES (2,'Contractor')
		INSERT INTO [metadata].[EmployeeTitle] ([ID], [Name]) VALUES (3,'Manager(Supervisor)')
		INSERT INTO [metadata].[EmployeeTitle] ([ID], [Name]) VALUES (4,'Director')
		INSERT INTO [metadata].[EmployeeTitle] ([ID], [Name]) VALUES (5,'Case Manager')

		IF dbo.SMM_CheckExists(6, 'EmployeeTitleID', 'EmployeeTitle') = -1
			ALTER TABLE dbo.[Employee]
			ADD EmployeeTitleID int NOT NULL default 1
		IF dbo.SMM_CheckExists(2, 'FK_Employee_EmployeeTitle', 'EmployeeTitle') = -1
			ALTER TABLE dbo.[Employee]
			ADD CONSTRAINT FK_Employee_EmployeeTitle FOREIGN KEY(EmployeeTitleID)
			REFERENCES metadata.[EmployeeTitle](ID)	
		
	Insert into #ChangeScript048_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript048_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript048_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 048, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.048: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.048: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript048_stat%')
Begin
	drop table #ChangeScript048_stat
End
go
 
 
/*
 db.01.00.049:
 Does the following:
	add instruction column into OrderAssignment table, insert insuranceproducttypeID into order and create relation order->InsuranceProductType, add InsuranceLocation field

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 049

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript049_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript049_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 049)
begin
	print '**************************************************'
	print '*  db.01.00.049: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript049_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript049_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add instruction column into OrderAssignment table, insert insuranceproducttypeID into order and create relation order->InsuranceProductType, add InsuranceLocation field*'
	print '***********************************************************************'

	alter table orderassignment add Instruction nvarchar(250);

	alter table [order] add InsuranceProductTypeID uniqueidentifier not null;
	alter table dbo.[Order] add constraint FK_Order_InsuranceProductType Foreign key
		(InsuranceProductTypeID) references dbo.[InsuranceProductType] (ID) on update no action on delete no action;
	
	alter table dbo.[Order] add InsuranceLocation nvarchar(50) null;

        Insert into #ChangeScript049_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript049_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript049_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 049, 'add instruction column into OrderAssignment table, insert insuranceproducttypeID into order and create relation order->InsuranceProductType, add InsuranceLocation field'

		print '**************************************************'
		print '*  db.01.00.049: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.049: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript049_stat%')
Begin
	drop table #ChangeScript049_stat
End
go
 
 
/*
 db.01.00.051:
 Does the following:
	Update primary key of AgentInsurance
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 051

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript051_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript051_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 051)
begin
	print '**************************************************'
	print '*  db.01.00.051: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript051_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript051_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

  	print '**********************************************************************'
  	print '* Update Primary key of AgentInsurance								*'
  	print '**********************************************************************'
		IF dbo.SMM_CheckExists(6, 'ID', 'AgentInsurance') = -1
			ALTER TABLE AgentInsurance
			ADD ID [uniqueidentifier] NOT NULL ROWGUIDCOL CONSTRAINT DF_AgentInsurance_ID DEFAULT NEWID()

		IF dbo.SMM_CheckExists(6, 'ID', 'AgencyInsurance') = -1
			ALTER TABLE AgencyInsurance
			ADD ID [uniqueidentifier] NOT NULL ROWGUIDCOL CONSTRAINT DF_AgencyInsurance_ID DEFAULT NEWID()

		IF dbo.SMM_CheckExists(2, 'PK_AgentInsurance', 'AgentInsurance') = 0
			ALTER TABLE AgentInsurance
			DROP PK_AgentInsurance
		
		IF dbo.SMM_CheckExists(2, 'PK_AgentInsurance', 'AgentInsurance') = -1
			ALTER TABLE AgentInsurance
			ADD CONSTRAINT PK_AgentInsurance PRIMARY KEY(ID)

		IF dbo.SMM_CheckExists(2, 'PK_AgencyInsurance', 'AgencyInsurance') = 0
			ALTER TABLE AgencyInsurance
			DROP PK_AgencyInsurance

		IF dbo.SMM_CheckExists(2, 'PK_AgencyInsurance', 'AgencyInsurance') = -1
			ALTER TABLE AgencyInsurance
			ADD CONSTRAINT PK_AgencyInsurance PRIMARY KEY(ID)

		IF dbo.SMM_CheckExists(2, 'IX_AgentInsurance', 'AgentInsurance') = -1
			ALTER TABLE dbo.AgentInsurance 
			ADD CONSTRAINT	IX_AgentInsurance UNIQUE (AgentID,InsuranceID)

		IF dbo.SMM_CheckExists(2, 'IX_AgencyInsurance', 'AgencyInsurance') = -1
			ALTER TABLE dbo.AgencyInsurance 
			ADD CONSTRAINT	IX_AgencyInsurance UNIQUE (AgencyID,InsuranceID)
		
		IF dbo.SMM_CheckExists(6, 'CreateDate', 'Agency') = 0
			BEGIN
				EXECUTE sp_rename N'dbo.Agency.CreateDate', N'CreatedDate', 'COLUMN' 
			END
		
	Insert into #ChangeScript051_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript051_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript051_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 051, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.051: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.051: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript051_stat%')
Begin
	drop table #ChangeScript051_stat
End
go

 
 
/*
 db.01.00.052:
 Does the following:
	drop two columns: create date, modified date. Create new ones with not null properties, run with blank data base only

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 052

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript052_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript052_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 052)
begin
	print '**************************************************'
	print '*  db.01.00.052: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript052_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript052_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* drop two columns: create date, modified date. Create new ones with not null properties, run with blank data base only                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.[IncompleteOrder] ALTER COLUMN CreatedDate DATETIME not null;
	ALTER TABLE dbo.[IncompleteOrder] ALTER COLUMN ModifiedDate DATETIME not null;

        Insert into #ChangeScript052_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript052_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript052_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 052, 'drop two columns: create date, modified date. Create new ones with not null properties, run with blank data base only'

		print '**************************************************'
		print '*  db.01.00.052: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.052: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript052_stat%')
Begin
	drop table #ChangeScript052_stat
End
go
 
 
 /*
 db.01.00.053:
 Does the following:
	ModifiedDate of IncompleteOrder and  ServiceProviderBlacklist should be not null

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 053

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript053_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript053_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 053)
begin
	print '**************************************************'
	print '*  db.01.00.053: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript053_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript053_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* ModifiedDate of IncompleteOrder and  ServiceProviderBlacklist should be not null                            *'
	print '***********************************************************************'

	UPDATE dbo.IncompleteOrder SET  ModifiedDate = CreatedDate WHERE ModifiedDate is NULL
	ALTER TABLE dbo.IncompleteOrder ALTER COLUMN ModifiedDate datetime NOT NULL
	
	UPDATE dbo.ServiceProviderBlacklist SET  ModifiedDate = CreatedDate WHERE ModifiedDate is NULL
	ALTER TABLE dbo.ServiceProviderBlacklist ALTER COLUMN ModifiedDate datetime NOT NULL
	
	INSERT INTO #ChangeScript053_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript053_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript053_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 053, 'ModifiedDate of IncompleteOrder and  ServiceProviderBlacklist should be not null'

		print '**************************************************'
		print '*  db.01.00.053: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.053: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript053_stat%')
Begin
	drop table #ChangeScript053_stat
End
go
 
 
/*
 db.01.00.054:
 Does the following:
		Add column CredentialType to table Credentialing
		Change column DocumentID in table Credentialing to nullable
		Add colum CreatedBy to table Document

Modifications:

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 054
*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript054_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript054_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 054)
begin
	print '**************************************************'
	print '*  db.01.00.054: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript054_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript054_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add column CredentialType to table Credentialing                    *'
	print '***********************************************************************'

	ALTER TABLE dbo.[Credentialing] ADD [CredentialTypeID] int NOT NULL

	ALTER TABLE dbo.[Credentialing] ADD CONSTRAINT
			FK_Credentialing_CredentialTypeID FOREIGN KEY
			(
				CredentialTypeID
			) REFERENCES metadata.[DocumentType]
			(
				ID
			) ON UPDATE  NO ACTION 
			ON DELETE  NO ACTION
	ALTER TABLE dbo.[Credentialing] ALTER COLUMN DocumentID uniqueidentifier NULL

	ALTER TABLE dbo.[Document] ADD [CreatedBy] uniqueidentifier NOT NULL
		CONSTRAINT [DF_Document_CreatedBy]  DEFAULT (('B0A630FC-3F64-4FF8-B195-167F7A14DCA1'))

	ALTER TABLE dbo.[Document] ADD CONSTRAINT
			FK_Document_CreatedBy FOREIGN KEY
			(
				CreatedBy
			) REFERENCES dbo.[Person]
			(
				ID
			) ON UPDATE  NO ACTION 
			ON DELETE  NO ACTION
	ALTER TABLE dbo.[Credentialing] ADD [SequenceNumber] int NOT NULL identity(1,1)




	Insert into #ChangeScript054_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript054_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript054_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 054, 'Add column CredentialType to table Credentialing'

		print '**************************************************'
		print '*  db.01.00.054: Done                               *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.054: NOT completed successfully         *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript054_stat%')
Begin
	drop table #ChangeScript054_stat
End
go
 
 
/*
 db.01.00.055:
 Does the following:
	add CreateDate and CreateBy field into OfficeNote table
    add UID column into Order table
    create new metadata table ObjectType
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 055

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript055_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript055_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 055)
begin
	print '**************************************************'
	print '*  db.01.00.055: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript055_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript055_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add CreateDate and CreateBy field into OfficeNote table *'
    print '* add UID column into Order table *'
    print '* create new metadata table ObjectType *'
	print '***********************************************************************'

	CREATE TABLE [metadata].[ObjectType](
	[ID] [int] NOT NULL,
	[Name] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL UNIQUE,
     CONSTRAINT [PK_ObjectType] PRIMARY KEY CLUSTERED 
    (
        [ID] ASC
    )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
    ) ON [PRIMARY]

    ALTER TABLE dbo.OfficeNote ADD CONSTRAINT
                FK_OfficeNote_ObjectType FOREIGN KEY
                (
                    ObjectTypeID
                ) REFERENCES [metadata].[ObjectType]
                (
                    ID
                ) ON UPDATE  NO ACTION 
             ON DELETE  NO ACTION 

    ALTER TABLE [dbo].[Order] ADD UID [uniqueidentifier] ROWGUIDCOL  NOT NULL DEFAULT (newid())
    ALTER TABLE dbo.OfficeNote ADD CreatedBy uniqueidentifier NOT NULL
    ALTER TABLE dbo.OfficeNote ADD CONSTRAINT FK_OfficeNote_Person FOREIGN KEY 
	(CreatedBy) REFERENCES dbo.Person(ID)

    ALTER TABLE dbo.OfficeNote ADD CreatedDate datetime NULL

        Insert into #ChangeScript055_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript055_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript055_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 055, 'add CreateDate and CreateBy field into OfficeNote table, add UID column into Order table, create new metadata table ObjectType '

		print '**************************************************'
		print '*  db.01.00.055: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.055: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript055_stat%')
Begin
	drop table #ChangeScript055_stat
End
go
 
 
/*
 db.01.00.056:
 The script will add the following tables and set their relationship for the Inventory Management database:
	- [dbo].[Item]
	- [dbo].[ItemType]
	- [dbo].[MedicalItem]
	- [dbo].[MedicalItemType]
	- [dbo].[ItemBatch]
	- [dbo].[Supplier]
	- [dbo].[SupplierMedicalItemType]
	- [dbo].[PurchaseOrder]
	- [dbo].[PurchaseOrderDetail]
	- [dbo].[SupplyOrder]
	- [dbo].[SupplyOrderDetail]
	- [dbo].[SaleOrder]	
	- [dbo].[SaleOrderDetail]
	- [metadata].[PurchaseOrderStatus]
	- [metadata].[SupplyOrderStatus]
	- [metadata].[SaleOrderStatus]
	
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 056
*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript056_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript056_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 056)
begin
	print '**************************************************'
	print '*  db.01.00.056: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript056_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript056_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* Create table: [dbo].[Item]											*'
	print '* Create table: [dbo].[ItemType]										*'
	print '* Create table: [dbo].[MedicalItem]									*'
	print '* Create table: [dbo].[MedicalItemType]								*'
	print '* Create table: [dbo].[ItemBatch]									*'
	print '* Create table: [dbo].[Supplier]										*'
	print '* Create table: [dbo].[SupplierMedicalItemType]						*'
	print '* Create table: [dbo].[PurchaseOrder]								*'
	print '* Create table: [dbo].[PurchaseOrderDetail]							*'
	print '* Create table: [dbo].[SupplyOrder]									*'
	print '* Create table: [dbo].[SupplyOrderDetail]							*'
	print '* Create table: [dbo].[SaleOrder]									*'
	print '* Create table: [dbo].[SaleOrderDetail]								*'
	print '* Create table: [metadata].[PurchaseOrderStatus]						*'
	print '* Create table: [metadata].[SupplyOrderStatus]						*'
	print '* Create table: [metadata].[SaleOrderStatus]							*'
	print '* Add the relationship between these tables							*'
	print '**********************************************************************'

		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[metadata].[PurchaseOrderStatus]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [metadata].[PurchaseOrderStatus](
			[ID] [int] NOT NULL,
			[Name] [nvarchar](20) NOT NULL,
		 CONSTRAINT [PK_metadata.[Status]]] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ItemType]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[ItemType](
			[ID] [uniqueidentifier] NOT NULL,
			[Name] [nchar](20) NOT NULL,
		 CONSTRAINT [PK_ItemType] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MedicalItemType]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[MedicalItemType](
			[ID] [uniqueidentifier] NOT NULL,
			[Name] [nvarchar](20) NOT NULL,
		 CONSTRAINT [PK_MedicalItemType] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[metadata].[SupplyOrderStatus]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [metadata].[SupplyOrderStatus](
			[ID] [int] NOT NULL,
			[Name] [nvarchar](20) NOT NULL,
		 CONSTRAINT [PK_SupplyOrderStatus] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[metadata].[SaleOrderStatus]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [metadata].[SaleOrderStatus](
			[ID] [int] NOT NULL,
			[Name] [nvarchar](20) NOT NULL,
		 CONSTRAINT [PK_SaleOrderStatus] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Supplier]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[Supplier](
			[ID] [uniqueidentifier] NOT NULL,
		 CONSTRAINT [PK_Supplier] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PurchaseOrderDetail]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[PurchaseOrderDetail](
			[ID] [uniqueidentifier] NOT NULL,
			[PurchaseOrderID] [uniqueidentifier] NOT NULL,
			[ItemID] [uniqueidentifier] NOT NULL,
			[Quantity] [int] NOT NULL,
			[Price] [money] NOT NULL,
			[DeliveryDate] [datetime] NOT NULL,
		 CONSTRAINT [PK_PurchaseOrderDetail] PRIMARY KEY NONCLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SupplyOrderDetail]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[SupplyOrderDetail](
			[ID] [uniqueidentifier] NOT NULL,
			[SupplyOrderID] [uniqueidentifier] NOT NULL,
			[ItemID] [uniqueidentifier] NOT NULL,
			[Quantity] [int] NOT NULL,
		 CONSTRAINT [PK_SupplyOrderDetail] PRIMARY KEY NONCLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SaleOrder]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[SaleOrder](
			[ID] [uniqueidentifier] NOT NULL,
			[SupplyOrderID] [uniqueidentifier] NOT NULL,
			[TrackingCode] [nvarchar](50) NULL,
			[StatusID] [int] NOT NULL,
			[SaleOrderNumber] [bigint] IDENTITY(1,1) NOT NULL,
			[CreatedDate] [datetime] NOT NULL,
			[ModifiedDate] [datetime] NOT NULL,
			[DeletedDate] [datetime] NULL,
			[DueDate] [datetime] NOT NULL,
			[ShippingAddress] [nvarchar](100) NOT NULL,
			[ShippingZipCode] [nvarchar](5) NOT NULL,
			[ShippingCity] [nvarchar](30) NOT NULL,
			[ShippingState] [nvarchar](20) NOT NULL,
		 CONSTRAINT [PK_SaleOrder] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SaleOrderDetail]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[SaleOrderDetail](
			[ID] [uniqueidentifier] NOT NULL,
			[SaleOrderID] [uniqueidentifier] NOT NULL,
			[ItemID] [uniqueidentifier] NOT NULL,
			[Quantity] [int] NOT NULL,
			[Note] [nvarchar](150) NULL,
		 CONSTRAINT [PK_SaleOrderDetail] PRIMARY KEY NONCLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PurchaseOrder]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[PurchaseOrder](
			[ID] [uniqueidentifier] NOT NULL,
			[SupplierID] [uniqueidentifier] NOT NULL,
			[PurchaseOrderNumber] [bigint] IDENTITY(1,1) NOT NULL,
			[BillingAddress] [nvarchar](100) NOT NULL,
			[BillingZipCode] [nvarchar](5) NOT NULL,
			[BillingCity] [nvarchar](30) NOT NULL,
			[BillingState] [nvarchar](20) NOT NULL,
			[ShippingAddress] [nvarchar](100) NOT NULL,
			[ShippingZipCode] [nvarchar](5) NOT NULL,
			[ShippingCity] [nvarchar](30) NOT NULL,
			[ShippingState] [nvarchar](20) NOT NULL,
			[TrackingCode] [nvarchar](50) NOT NULL,
			[StatusID] [int] NOT NULL,
			[CreatedDate] [datetime] NOT NULL,
			[DeletedDate] [datetime] NULL,
			[ModifiedDate] [datetime] NOT NULL,
			[DueDate] [datetime] NOT NULL,
		 CONSTRAINT [PK_PurchaseOrder] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SupplierMedicalItemType]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[SupplierMedicalItemType](
			[SupplierID] [uniqueidentifier] NOT NULL,
			[MedicalItemTypeID] [uniqueidentifier] NOT NULL,
		 CONSTRAINT [PK_SupplierMedicalItemType] PRIMARY KEY CLUSTERED 
		(
			[SupplierID] ASC,
			[MedicalItemTypeID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MedicalItem]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[MedicalItem](
			[ID] [uniqueidentifier] NOT NULL,
			[MedicalItemTypeID] [uniqueidentifier] NOT NULL,
			[LabID] [uniqueidentifier] NULL,
		 CONSTRAINT [PK_MedicalItem] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Item]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[Item](
			[ID] [uniqueidentifier] NOT NULL,
			[ItemTypeID] [uniqueidentifier] NOT NULL,
			[Name] [nvarchar](50) NOT NULL,
			[QuantityInStock] [int] NOT NULL,
			[QuantityReorder] [int] NOT NULL,
			[QuantityIndemand] [int] NOT NULL,
		 CONSTRAINT [PK_Item] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SupplyOrder]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[SupplyOrder](
			[ID] [uniqueidentifier] NOT NULL,
			[ServiceProviderID] [uniqueidentifier] NOT NULL,
			[AdditionalNote] [nvarchar](200) NULL,
			[TrackingCode] [nvarchar](20) NOT NULL,
			[SupplyOrderNumber] [bigint] IDENTITY(1,1) NOT NULL,
			[CreatedDate] [datetime] NOT NULL,
			[ModifiedDate] [datetime] NOT NULL,
			[DeletedDate] [datetime] NULL,
			[DueDate] [datetime] NOT NULL,
			[StatusID] [int] NOT NULL,
		 CONSTRAINT [PK_SupplyOrder] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ItemBatch]') AND type in (N'U'))
		BEGIN
		CREATE TABLE [dbo].[ItemBatch](
			[ID] [uniqueidentifier] NOT NULL,
			[ItemID] [uniqueidentifier] NOT NULL,
			[ReceivedDate] [datetime] NULL,
			[ExpiredDate] [datetime] NULL,
		 CONSTRAINT [PK_ItemBatch] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		END
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Supplier_Organization]') AND parent_object_id = OBJECT_ID(N'[dbo].[Supplier]'))
		ALTER TABLE [dbo].[Supplier]  WITH CHECK ADD  CONSTRAINT [FK_Supplier_Organization] FOREIGN KEY([ID])
		REFERENCES [dbo].[Organization] ([ID])
		ALTER TABLE [dbo].[Supplier] CHECK CONSTRAINT [FK_Supplier_Organization]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_PurchaseOrderDetail_Item]') AND parent_object_id = OBJECT_ID(N'[dbo].[PurchaseOrderDetail]'))
		ALTER TABLE [dbo].[PurchaseOrderDetail]  WITH CHECK ADD  CONSTRAINT [FK_PurchaseOrderDetail_Item] FOREIGN KEY([ItemID])
		REFERENCES [dbo].[Item] ([ID])
		ALTER TABLE [dbo].[PurchaseOrderDetail] CHECK CONSTRAINT [FK_PurchaseOrderDetail_Item]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_PurchaseOrderDetail_PurchaseOrder]') AND parent_object_id = OBJECT_ID(N'[dbo].[PurchaseOrderDetail]'))
		ALTER TABLE [dbo].[PurchaseOrderDetail]  WITH CHECK ADD  CONSTRAINT [FK_PurchaseOrderDetail_PurchaseOrder] FOREIGN KEY([PurchaseOrderID])
		REFERENCES [dbo].[PurchaseOrder] ([ID])
		ALTER TABLE [dbo].[PurchaseOrderDetail] CHECK CONSTRAINT [FK_PurchaseOrderDetail_PurchaseOrder]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SupplyOrderDetail_Item]') AND parent_object_id = OBJECT_ID(N'[dbo].[SupplyOrderDetail]'))
		ALTER TABLE [dbo].[SupplyOrderDetail]  WITH CHECK ADD  CONSTRAINT [FK_SupplyOrderDetail_Item] FOREIGN KEY([ItemID])
		REFERENCES [dbo].[Item] ([ID])
		ALTER TABLE [dbo].[SupplyOrderDetail] CHECK CONSTRAINT [FK_SupplyOrderDetail_Item]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SupplyOrderDetail_SupplyOrder]') AND parent_object_id = OBJECT_ID(N'[dbo].[SupplyOrderDetail]'))
		ALTER TABLE [dbo].[SupplyOrderDetail]  WITH CHECK ADD  CONSTRAINT [FK_SupplyOrderDetail_SupplyOrder] FOREIGN KEY([SupplyOrderID])
		REFERENCES [dbo].[SupplyOrder] ([ID])
		ALTER TABLE [dbo].[SupplyOrderDetail] CHECK CONSTRAINT [FK_SupplyOrderDetail_SupplyOrder]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SaleOrder_SaleOrderStatus]') AND parent_object_id = OBJECT_ID(N'[dbo].[SaleOrder]'))
		ALTER TABLE [dbo].[SaleOrder]  WITH CHECK ADD  CONSTRAINT [FK_SaleOrder_SaleOrderStatus] FOREIGN KEY([StatusID])
		REFERENCES [metadata].[SaleOrderStatus] ([ID])
		ALTER TABLE [dbo].[SaleOrder] CHECK CONSTRAINT [FK_SaleOrder_SaleOrderStatus]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SaleOrder_SupplyOrder]') AND parent_object_id = OBJECT_ID(N'[dbo].[SaleOrder]'))
		ALTER TABLE [dbo].[SaleOrder]  WITH CHECK ADD  CONSTRAINT [FK_SaleOrder_SupplyOrder] FOREIGN KEY([SupplyOrderID])
		REFERENCES [dbo].[SupplyOrder] ([ID])
		ALTER TABLE [dbo].[SaleOrder] CHECK CONSTRAINT [FK_SaleOrder_SupplyOrder]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SaleOrderDetail_Item]') AND parent_object_id = OBJECT_ID(N'[dbo].[SaleOrderDetail]'))
		ALTER TABLE [dbo].[SaleOrderDetail]  WITH CHECK ADD  CONSTRAINT [FK_SaleOrderDetail_Item] FOREIGN KEY([ItemID])
		REFERENCES [dbo].[Item] ([ID])
		ALTER TABLE [dbo].[SaleOrderDetail] CHECK CONSTRAINT [FK_SaleOrderDetail_Item]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SaleOrderDetail_SaleOrder]') AND parent_object_id = OBJECT_ID(N'[dbo].[SaleOrderDetail]'))
		ALTER TABLE [dbo].[SaleOrderDetail]  WITH CHECK ADD  CONSTRAINT [FK_SaleOrderDetail_SaleOrder] FOREIGN KEY([SaleOrderID])
		REFERENCES [dbo].[SaleOrder] ([ID])
		ALTER TABLE [dbo].[SaleOrderDetail] CHECK CONSTRAINT [FK_SaleOrderDetail_SaleOrder]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_PurchaseOrder_PurChaseOrderStatus]') AND parent_object_id = OBJECT_ID(N'[dbo].[PurchaseOrder]'))
		ALTER TABLE [dbo].[PurchaseOrder]  WITH CHECK ADD  CONSTRAINT [FK_PurchaseOrder_PurChaseOrderStatus] FOREIGN KEY([StatusID])
		REFERENCES [metadata].[PurchaseOrderStatus] ([ID])
		ALTER TABLE [dbo].[PurchaseOrder] CHECK CONSTRAINT [FK_PurchaseOrder_PurChaseOrderStatus]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_PurchaseOrder_Supplier]') AND parent_object_id = OBJECT_ID(N'[dbo].[PurchaseOrder]'))
		ALTER TABLE [dbo].[PurchaseOrder]  WITH CHECK ADD  CONSTRAINT [FK_PurchaseOrder_Supplier] FOREIGN KEY([SupplierID])
		REFERENCES [dbo].[Supplier] ([ID])
		ALTER TABLE [dbo].[PurchaseOrder] CHECK CONSTRAINT [FK_PurchaseOrder_Supplier]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SupplierMedicalItemType_MedicalItemType]') AND parent_object_id = OBJECT_ID(N'[dbo].[SupplierMedicalItemType]'))
		ALTER TABLE [dbo].[SupplierMedicalItemType]  WITH CHECK ADD  CONSTRAINT [FK_SupplierMedicalItemType_MedicalItemType] FOREIGN KEY([MedicalItemTypeID])
		REFERENCES [dbo].[MedicalItemType] ([ID])
		ALTER TABLE [dbo].[SupplierMedicalItemType] CHECK CONSTRAINT [FK_SupplierMedicalItemType_MedicalItemType]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SupplierMedicalItemType_Supplier]') AND parent_object_id = OBJECT_ID(N'[dbo].[SupplierMedicalItemType]'))
		ALTER TABLE [dbo].[SupplierMedicalItemType]  WITH CHECK ADD  CONSTRAINT [FK_SupplierMedicalItemType_Supplier] FOREIGN KEY([SupplierID])
		REFERENCES [dbo].[Supplier] ([ID])
		ALTER TABLE [dbo].[SupplierMedicalItemType] CHECK CONSTRAINT [FK_SupplierMedicalItemType_Supplier]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_MedicalItem_Item]') AND parent_object_id = OBJECT_ID(N'[dbo].[MedicalItem]'))
		ALTER TABLE [dbo].[MedicalItem]  WITH CHECK ADD  CONSTRAINT [FK_MedicalItem_Item] FOREIGN KEY([ID])
		REFERENCES [dbo].[Item] ([ID])
		ALTER TABLE [dbo].[MedicalItem] CHECK CONSTRAINT [FK_MedicalItem_Item]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_MedicalItem_Lab]') AND parent_object_id = OBJECT_ID(N'[dbo].[MedicalItem]'))
		ALTER TABLE [dbo].[MedicalItem]  WITH CHECK ADD  CONSTRAINT [FK_MedicalItem_Lab] FOREIGN KEY([LabID])
		REFERENCES [dbo].[Lab] ([ID])
		ALTER TABLE [dbo].[MedicalItem] CHECK CONSTRAINT [FK_MedicalItem_Lab]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_MedicalItem_MedicalItemType]') AND parent_object_id = OBJECT_ID(N'[dbo].[MedicalItem]'))
		ALTER TABLE [dbo].[MedicalItem]  WITH CHECK ADD  CONSTRAINT [FK_MedicalItem_MedicalItemType] FOREIGN KEY([MedicalItemTypeID])
		REFERENCES [dbo].[MedicalItemType] ([ID])
		ALTER TABLE [dbo].[MedicalItem] CHECK CONSTRAINT [FK_MedicalItem_MedicalItemType]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Item_ItemType]') AND parent_object_id = OBJECT_ID(N'[dbo].[Item]'))
		ALTER TABLE [dbo].[Item]  WITH CHECK ADD  CONSTRAINT [FK_Item_ItemType] FOREIGN KEY([ItemTypeID])
		REFERENCES [dbo].[ItemType] ([ID])
		ALTER TABLE [dbo].[Item] CHECK CONSTRAINT [FK_Item_ItemType]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SupplyOrder_ServiceProvider]') AND parent_object_id = OBJECT_ID(N'[dbo].[SupplyOrder]'))
		ALTER TABLE [dbo].[SupplyOrder]  WITH CHECK ADD  CONSTRAINT [FK_SupplyOrder_ServiceProvider] FOREIGN KEY([ServiceProviderID])
		REFERENCES [dbo].[ServiceProvider] ([ID])
		ALTER TABLE [dbo].[SupplyOrder] CHECK CONSTRAINT [FK_SupplyOrder_ServiceProvider]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SupplyOrder_SupplyOrderStatus]') AND parent_object_id = OBJECT_ID(N'[dbo].[SupplyOrder]'))
		ALTER TABLE [dbo].[SupplyOrder]  WITH CHECK ADD  CONSTRAINT [FK_SupplyOrder_SupplyOrderStatus] FOREIGN KEY([StatusID])
		REFERENCES [metadata].[SupplyOrderStatus] ([ID])
		ALTER TABLE [dbo].[SupplyOrder] CHECK CONSTRAINT [FK_SupplyOrder_SupplyOrderStatus]
		IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ItemBatch_Item]') AND parent_object_id = OBJECT_ID(N'[dbo].[ItemBatch]'))
		ALTER TABLE [dbo].[ItemBatch]  WITH CHECK ADD  CONSTRAINT [FK_ItemBatch_Item] FOREIGN KEY([ItemID])
		REFERENCES [dbo].[Item] ([ID])
		ALTER TABLE [dbo].[ItemBatch] CHECK CONSTRAINT [FK_ItemBatch_Item]

		/*  Create metadata for SupplyOrderStatus */
		INSERT INTO [metadata].[SupplyOrderStatus] ([ID],[Name])VALUES(1,'New')
		INSERT INTO [metadata].[SupplyOrderStatus] ([ID],[Name])VALUES(2,'Pending')
		INSERT INTO [metadata].[SupplyOrderStatus] ([ID],[Name])VALUES(3,'On-going')
		INSERT INTO [metadata].[SupplyOrderStatus] ([ID],[Name])VALUES(4,'Completed')
		INSERT INTO [metadata].[SupplyOrderStatus] ([ID],[Name])VALUES(5,'Canceled')

		/*  Create metadata for SaleOrderStatus */
		INSERT INTO [metadata].[SaleOrderStatus] ([ID],[Name])VALUES(1,'New')
		INSERT INTO [metadata].[SaleOrderStatus] ([ID],[Name])VALUES(2,'Pending')
		INSERT INTO [metadata].[SaleOrderStatus] ([ID],[Name])VALUES(3,'On-going')
		INSERT INTO [metadata].[SaleOrderStatus] ([ID],[Name])VALUES(4,'Completed')
		INSERT INTO [metadata].[SaleOrderStatus] ([ID],[Name])VALUES(5,'Canceled')
		INSERT INTO [metadata].[SaleOrderStatus] ([ID],[Name])VALUES(6,'Wait-for-Confirm')

		/*  Create metadata for PurchaseOrderStatus */
		INSERT INTO [metadata].[PurchaseOrderStatus] ([ID],[Name])VALUES(1,'New')
		INSERT INTO [metadata].[PurchaseOrderStatus] ([ID],[Name])VALUES(2,'Pending')
		INSERT INTO [metadata].[PurchaseOrderStatus] ([ID],[Name])VALUES(3,'On-going')
		INSERT INTO [metadata].[PurchaseOrderStatus] ([ID],[Name])VALUES(4,'Completed')
		INSERT INTO [metadata].[PurchaseOrderStatus] ([ID],[Name])VALUES(5,'Canceled')

	Insert into #ChangeScript056_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */

If not exists (select 'x' from #ChangeScript056_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript056_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 056, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.056: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.056: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript056_stat%')
Begin
	drop table #ChangeScript056_stat
End
go
 
 
/*
 db.01.00.057:
 Does the following:
	Design database for Notififcation module

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 057

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript057_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript057_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 057)
begin
	print '**************************************************'
	print '*  db.01.00.057: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript057_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript057_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Design database for Notififcation module                            *'
	print '***********************************************************************'

	CREATE TABLE [metadata].[EmailStatus]
	(
		[ID] [int] NOT NULL,
		[Name] [nvarchar](50) NOT NULL,
		[Description] [nvarchar](200) NULL,
		CONSTRAINT [PK_EmailStatus] PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	)

	CREATE TABLE [dbo].[EmailTemplate]
	(
		[ID] [uniqueidentifier] NOT NULL,
		[Subject] [nvarchar](200) NOT NULL,
		[Body] [nvarchar](MAX) NOT NULL,
		[CreatedDate] [datetime] NOT NULL,
		[ModifiedDate] [datetime] NOT NULL,
		[DeletedDate] [datetime] NULL,
		CONSTRAINT [PK_EmailTemplate] PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	)

	CREATE TABLE [dbo].[EmailQueue]
	(
		[ID] [uniqueidentifier] NOT NULL,
		[EmailToID] [uniqueidentifier] NOT NULL,
		[EmailTemplateID] [uniqueidentifier] NOT NULL,
		[StatusID] [int] NOT NULL,
		[CreatedDate] [datetime] NOT NULL,
		[ModifiedDate] [datetime] NOT NULL,
		[DeletedDate] [datetime] NULL,
		CONSTRAINT [PK_EmailQueue] PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]

	)

	ALTER TABLE [dbo].[EmailQueue]  WITH CHECK ADD  CONSTRAINT [FK_EmailQueue_Person]
		FOREIGN KEY([EmailToID])
		REFERENCES [dbo].[Person] ([ID])

	ALTER TABLE [dbo].[EmailQueue]  WITH CHECK ADD  CONSTRAINT [FK_EmailQueue_EmailTemplate]
		FOREIGN KEY([EmailTemplateID])
		REFERENCES [dbo].[EmailTemplate] ([ID])

	ALTER TABLE [dbo].[EmailQueue]  WITH CHECK ADD  CONSTRAINT [FK_EmailQueue_Status]
		FOREIGN KEY([StatusID])
		REFERENCES [metadata].[EmailStatus] ([ID])

	CREATE NONCLUSTERED INDEX IX_EmailQueue ON dbo.EmailQueue
		(
			StatusID, DeletedDate
		) ON [PRIMARY]

	CREATE TABLE [dbo].[EmailValue]
	(
		[ID] [uniqueidentifier] NOT NULL,
		[EmailID] [uniqueidentifier] NOT NULL,
		[Name] [nvarchar](100) NOT NULL,
		[Value] [nvarchar](100) NOT NULL,
		[CreatedDate] [datetime] NOT NULL,
		[ModifiedDate] [datetime] NOT NULL,
		[DeletedDate] [datetime] NULL,
		CONSTRAINT [PK_EmailValue] PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	)

	ALTER TABLE [dbo].[EmailValue]  WITH CHECK ADD  CONSTRAINT [FK_EmailValue_EmailQueue]
		FOREIGN KEY([EmailID])
		REFERENCES [dbo].[EmailQueue] ([ID])

	INSERT INTO [metadata].[EmailStatus]([ID],[Name],[Description])
		VALUES(1,'New','Has just created')
	INSERT INTO [metadata].[EmailStatus]([ID],[Name],[Description])
		VALUES(2,'Sent','Has been sent')
	INSERT INTO [metadata].[EmailStatus]([ID],[Name],[Description])
		VALUES(-1,'Error','Sent but had error')

	CREATE TABLE [dbo].[DeptAssignmentStatus]
	(
		[ID] [uniqueidentifier] NOT NULL,
		[StatusID] [int] NOT NULL,
		[DeptID] [uniqueidentifier] NOT NULL,
		CONSTRAINT [PK_DeptAssignmentStatus] PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	)

	ALTER TABLE [dbo].[DeptAssignmentStatus]  WITH CHECK ADD  CONSTRAINT [FK_DeptAssignmentStatus_OrderAssignmentStatus]
		FOREIGN KEY([StatusID])
		REFERENCES [metadata].[OrderAssignmentStatus] ([ID])

	ALTER TABLE [dbo].[DeptAssignmentStatus]  WITH CHECK ADD  CONSTRAINT [FK_DeptAssignmentStatus_Department]
		FOREIGN KEY([DeptID])
		REFERENCES [dbo].[Department] ([ID])

	ALTER TABLE [metadata].[OrderAssignmentStatus]  ADD [NotifySupervisor] bit NOT NULL
		CONSTRAINT [DF_OrderAssignmentStatus_NotifySupervisor]  DEFAULT ((0))

	ALTER TABLE [metadata].[OrderAssignmentStatus]  ADD [NotifyOrderingParty] bit NOT NULL
		CONSTRAINT [DF_OrderAssignmentStatus_NotifyOrderingParty]  DEFAULT ((0))

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('3B22E0B3-7511-4017-8746-7C708468DFEE','New order assignment notification',
'Dear {SPName},

We are writing this email to notify you that the order [OrderID] has been assigned to you. See the description below:
	Service Requirement:
	Applicant Address:
	Applicant Schedule:
	
Please arrange your time to schedule for the assignment.
Thank you very much for your co-operation.

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
','2009/5/1','2009/5/1',NULL)

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('C85B72E3-6A02-4366-9386-0D18A1D6337A','New Credentialing Request',
'Dear {SPName},

We are writing this email to thank for your joining with us the mobile medic exam service.
To complete the paperwork for your order assignment {AssignmentName}, could you please provide us the following documents:
{ListCredential}

We are looking forward to get these documents from you soon.
Thank you very much for your co-operation.

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
','2009/5/1','2009/5/1',NULL)

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('B2C80170-C8A0-4B69-88BE-D3DBAB99AE0F','Credentialing Expire notification',
'Dear {SPName},

We are writing this email to notify you that the some of your credentialing have been expired. See the details elow:
	Credential Name			Expired Date
{ListCredential}

Could you please provide us the new ones
Thank you very much for your co-operation

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
','2009/5/1','2009/5/1',NULL)

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('B532738E-60D8-44A2-A785-2C68C1360544','Shipping kit notification',
'Dear {SPName},

We are writing this email to notify you that the kits with below details have just been shipped to your address:
	1. Shipping address
	2. The list of medical items of the order with below columns as below:
		- Item Name {ItemName}
		- Quantity {Quality}
		- Unit Price {UnitPrice}
		Total Price {TotalPrice}

When receiving kits, please click on below link to go to the confirmation page
{URL}
Thank you very much for your co-operation.

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
','2009/5/1','2009/5/1',NULL)

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('EA09C932-CF7F-43F4-A9B9-D7159C264ADC','Rating result notification',
'Dear {PersonName},

We are writing this email to notify you of new Rating Result. See the details below:
	Point {Point}
	Comment {Comment}
	Rated By {RatedBy}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
','2009/5/1','2009/5/1',NULL)

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('BB4ECC42-3FD9-4C8D-B98A-46BEB54FF995','Order assignment status notification',
'Dear {PersonName},

We are writing this email to notify you that the order [OrderID] has been posted new assignment status. See the description below:
	New assignment status: {AssignmentStatus}
	Posted By: {PostedBy}

Click on below link to view the assignment status.
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
','2009/5/1','2009/5/1',NULL)

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('BEA6FB17-3C4A-4486-A375-3D504CCEEC57','Order paperwork status notification',
'Dear {PersonName},

We are writing this email to notify you that the order [OrderID] has been posted new paperwork status. See the description below:

	New paperwork status: {PaperworkStatus}
	Posted Date: {PostedDate}
	Posted By: {PostedBy}

Click on below link to view the assignment status.
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
','2009/5/1','2009/5/1',NULL)

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('F205DB95-98EB-4C2B-88F8-FA487D2E3E7E','New office note notification',
'Dear {PersonName},

We are writing this email to notify you that the new office note has been posted. See the description below:
	Office Note: {OfficeNote}
	Category: {Category}
	Posted Date: {PostedDate}
	Posted By: {PostedBy}

Click on below link to view the office note.
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
','2009/5/1','2009/5/1',NULL)


	Insert into #ChangeScript057_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript057_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript057_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 057, 'Design database for Notififcation module'

		print '**************************************************'
		print '*  db.01.00.057: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.057: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript057_stat%')
Begin
	drop table #ChangeScript057_stat
End
go
 
 
/*
 db.01.00.058:
 Does the following:
	add new ID field into orderRequirement table, add unique constaint to OrderID and RequirementID

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 058

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript058_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript058_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 058)
begin
	print '**************************************************'
	print '*  db.01.00.058: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript058_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript058_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add new ID field into orderRequirement table, add unique constaint to OrderID and RequirementID                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.OrderRequirement
		DROP CONSTRAINT FK_OrderRequirement_Requirement


	ALTER TABLE dbo.OrderRequirement
		DROP CONSTRAINT FK_OrderRequirement_Order
		
	ALTER TABLE dbo.OrderRequirement
		DROP CONSTRAINT PK_OrderRequirement

	ALTER TABLE dbo.OrderRequirement ADD  ID [uniqueidentifier] NOT NULL ROWGUIDCOL CONSTRAINT DF_OrderRequirement_ID DEFAULT NEWID()
	 

	ALTER TABLE dbo.OrderRequirement ADD CONSTRAINT
		PK_OrderRequirement PRIMARY KEY CLUSTERED 
		(
		ID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]


	ALTER TABLE dbo.OrderRequirement ADD CONSTRAINT
		IX_OrderRequirement UNIQUE NONCLUSTERED 
		(
		OrderID,
		RequirementID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

	ALTER TABLE dbo.OrderRequirement ADD CONSTRAINT
		FK_OrderRequirement_Order FOREIGN KEY
		(
		OrderID
		) REFERENCES dbo.[Order]
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 

	ALTER TABLE dbo.OrderRequirement ADD CONSTRAINT
		FK_OrderRequirement_Requirement FOREIGN KEY
		(
		RequirementID
		) REFERENCES dbo.Requirement
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 

	Insert into #ChangeScript058_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript058_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript058_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 058, 'add new ID field into orderRequirement table, add unique constaint to OrderID and RequirementID'

		print '**************************************************'
		print '*  db.01.00.058: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.058: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript058_stat%')
Begin
	drop table #ChangeScript058_stat
End
go
 
 
/*
 db.01.00.059:
 Does the following:
    add ID primary key into OrderingPartyInsurance table 

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 059

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript059_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript059_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 059)
begin
	print '**************************************************'
	print '*  db.01.00.059: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript059_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript059_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

  print '***********************************************************************'
  print '* add ID primary key into OrderingPartyInsurance table *'
  print '* alter primary key OrderingPartyInsurance table *'
  print '***********************************************************************'

  DECLARE @PKNAME VARCHAR(500)
  SELECT @PKNAME=[NAME] FROM SYSOBJECTS PKTABLE WHERE XTYPE='PK'
  AND PARENT_OBJ IN
  (SELECT ID FROM SYSOBJECTS T WHERE NAME='OrderingPartyInsurance')

  DECLARE @STRINGSQL NVARCHAR(4000)
  SET @STRINGSQL=N'ALTER TABLE [dbo].[OrderingPartyInsurance] DROP CONSTRAINT ['+ @PKNAME+N']';
  EXEC SP_EXECUTESQL @STRINGSQL

  ALTER TABLE [dbo].[OrderingPartyInsurance]
  ADD ID [uniqueidentifier] ROWGUIDCOL NOT NULL CONSTRAINT DF_OrderingPartyInsurance_ID DEFAULT NEWID()

  SET @STRINGSQL=N'ALTER TABLE [dbo].[OrderingPartyInsurance]  ADD CONSTRAINT ['+@PKNAME +N'] PRIMARY KEY (ID);'
  EXEC SP_EXECUTESQL  @STRINGSQL

  Insert into #ChangeScript059_stat (PatchStatus) Values (1)

  COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript059_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript059_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 059, 'add ID primary key into OrderingPartyInsurance table'

		print '**************************************************'
		print '*  db.01.00.059: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.059: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript059_stat%')
Begin
	drop table #ChangeScript059_stat
End
go
 
 
/*
 db.01.00.061:
 Does the following:
	Add PartnerUser Table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 061

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript061_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript061_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 061)
begin
	print '**************************************************'
	print '*  db.01.00.061: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript061_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript061_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	
		
	IF dbo.SMM_CheckExists(1, 'PartnerUser', '') = -1
	BEGIN
		/*Add PartnerUser*/
		CREATE TABLE [dbo].[PartnerUser](
		[ID] [uniqueidentifier] NOT NULL ROWGUIDCOL CONSTRAINT DF_PartnerUser_ID DEFAULT NEWID(),
		[PartnerID] [uniqueidentifier] NOT NULL,
		[PersonID] [uniqueidentifier] NOT NULL,
		[IsMaster] [bit] NOT NULL,
		 CONSTRAINT [PK_PartnerUser] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[PartnerUser]  WITH CHECK ADD  CONSTRAINT [FK_PartnerUser_Partner] FOREIGN KEY([PartnerID])
		REFERENCES [dbo].[Partner] ([ID])
		
		ALTER TABLE [dbo].[PartnerUser]  WITH CHECK ADD  CONSTRAINT [FK_PartnerUser_Person] FOREIGN KEY([PersonID])
		REFERENCES [dbo].[Person] ([ID])
	END
	ELSE
		PRINT 'INFO: db.01.00.061 Table PartnerUser already exists'
		
	Insert into #ChangeScript061_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript061_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript061_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 061, 'PartnerUser Table'

		print '**************************************************'
		print '*  db.01.00.061: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.061: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript061_stat%')
Begin
	drop table #ChangeScript061_stat
End
go

 
 
/*
 db.01.00.062:
 Does the following:
	task #387 porting, insert ID field into OrderRelative table. remove unique key in orderID and orderRelativeID group by unique constrain unique

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 062

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript062_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript062_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 062)
begin
	print '**************************************************'
	print '*  db.01.00.062: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript062_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript062_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* task #387 porting, insert ID field into OrderRelative table. remove unique key in orderID and orderRelativeID group by unique constrain unique                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.OrderRelative DROP CONSTRAINT FK_OrderRelative_Order
	ALTER TABLE dbo.OrderRelative DROP CONSTRAINT FK_OrderRelative_Order1
	ALTER TABLE dbo.OrderRelative DROP CONSTRAINT FK_OrderRelative_Order2
	ALTER TABLE dbo.OrderRelative DROP CONSTRAINT PK_OrderRelative

	ALTER TABLE dbo.OrderRelative ADD ID[uniqueidentifier] NOT NULL ROWGUIDCOL CONSTRAINT DF_OrderRelative_ID DEFAULT NEWID()
	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT PK_OrderRelative PRIMARY KEY CLUSTERED
			(
				ID
			)
			WITH (	STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT IX_OrderRelative UNIQUE NONCLUSTERED
		(
			OrderID,
			OrderRelativeID
		)
		WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT FK_OrderRelative_Order FOREIGN KEY
		(
			OrderID
		) 
		REFERENCES dbo.[Order]
		(
			ID
		)
		ON UPDATE NO ACTION
		ON DELETE NO ACTION
		
	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT FK_OrderRelative_Order1 FOREIGN KEY
		(
			OrderRelativeID
		) 
		REFERENCES dbo.[Order]
		(
			ID
		)
		ON UPDATE NO ACTION
		ON DELETE NO ACTION

        Insert into #ChangeScript062_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript062_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript062_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 062, 'task #387 porting, insert ID field into OrderRelative table. remove unique key in orderID and orderRelativeID group by unique constrain unique'

		print '**************************************************'
		print '*  db.01.00.062: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.062: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript062_stat%')
Begin
	drop table #ChangeScript062_stat
End
go
 
 
/*
 db.01.00.063:
 Does the following:
	create relation between Requirement and RequirementType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 063

*/

set nocount on
IF dbo.SMM_CheckExists(3, '#ChangeScript063_stat', '') = -1
-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript063_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 063)
begin
	print '**************************************************'
	print '*  db.01.00.063: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript063_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript063_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '  create relation between Requirement and RequirementType           '
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(2, 'FK_Requirement_RequirementType', 'Requirement') = -1
		ALTER TABLE dbo.Requirement ADD CONSTRAINT
		FK_Requirement_RequirementType FOREIGN KEY
		(
		RequirementTypeID
		) REFERENCES dbo.RequirementType
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 

        Insert into #ChangeScript063_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript063_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript063_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)

		select 1.0, 063, 'create relation between Requirement and RequirementType'

		print '**************************************************'
		print '*  db.01.00.063: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.063: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript063_stat%')
Begin
	drop table #ChangeScript063_stat
End
go
 
 
/*
 db.01.00.000:
 Does the following:
	Add ID column to Ordering party Agent Table 

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 000

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript064_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript064_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 064)
begin
	print '**************************************************'
	print '*  db.01.00.064: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript064_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript064_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add ID column to Ordering party Agent Table                  *'
	print '***********************************************************************'


  DECLARE @PKNAME VARCHAR(500)
  SELECT @PKNAME=[NAME] FROM SYSOBJECTS PKTABLE WHERE XTYPE='PK'
  AND PARENT_OBJ IN
  (SELECT ID FROM SYSOBJECTS T WHERE NAME='OrderingPartyAgent')

  DECLARE @STRINGSQL NVARCHAR(4000)
  SET @STRINGSQL=N'ALTER TABLE [dbo].[OrderingPartyAgent] DROP CONSTRAINT ['+ @PKNAME+N']';
  EXEC SP_EXECUTESQL @STRINGSQL

  ALTER TABLE [dbo].[OrderingPartyAgent]
  ADD ID [uniqueidentifier] ROWGUIDCOL NOT NULL CONSTRAINT DF_OrderingPartyAgent_ID DEFAULT NEWID()

  SET @STRINGSQL=N'ALTER TABLE [dbo].[OrderingPartyAgent]  ADD CONSTRAINT ['+@PKNAME +N'] PRIMARY KEY (ID);'
  EXEC SP_EXECUTESQL  @STRINGSQL

  Insert into #ChangeScript064_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript064_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript064_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 064, 'Add ID column to Ordering party Agent Table'

		print '**************************************************'
		print '*  db.01.00.064: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.064: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript064_stat%')
Begin
	drop table #ChangeScript064_stat
End
go
 
 
/*
 db.01.00.065:
 Does the following:
	Add ID column to Ordering party Agency Table 

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 065

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript065_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript065_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 065)
begin
	print '**************************************************'
	print '*  db.01.00.065: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript065_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript065_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add ID column to Ordering party Agency Table                  *'
	print '***********************************************************************'


  DECLARE @PKNAME VARCHAR(500)
  SELECT @PKNAME=[NAME] FROM SYSOBJECTS PKTABLE WHERE XTYPE='PK'
  AND PARENT_OBJ IN
  (SELECT ID FROM SYSOBJECTS T WHERE NAME='OrderingPartyAgency')

  DECLARE @STRINGSQL NVARCHAR(4000)
  SET @STRINGSQL=N'ALTER TABLE [dbo].[OrderingPartyAgency] DROP CONSTRAINT ['+ @PKNAME+N']';
  EXEC SP_EXECUTESQL @STRINGSQL

  ALTER TABLE [dbo].[OrderingPartyAgency]
  ADD ID [uniqueidentifier] ROWGUIDCOL NOT NULL CONSTRAINT DF_OrderingPartyAgency_ID DEFAULT NEWID()

  SET @STRINGSQL=N'ALTER TABLE [dbo].[OrderingPartyAgency]  ADD CONSTRAINT ['+@PKNAME +N'] PRIMARY KEY (ID);'
  EXEC SP_EXECUTESQL  @STRINGSQL

  Insert into #ChangeScript065_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript065_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript065_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 065, 'Add ID column to Ordering party Agency Table '

		print '**************************************************'
		print '*  db.01.00.065: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.065: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript065_stat%')
Begin
	drop table #ChangeScript065_stat
End
go
 
 
/*
 db.01.00.066:
 Does the following:
	Add constrain between Applicant and ApplciantPhone

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 066

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript066_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript066_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 066)
begin
	print '**************************************************'
	print '*  db.01.00.066: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript066_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript066_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add constrain between Applicant and ApplciantPhone                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.ApplicantPhone ADD CONSTRAINT FK_ApplicantPhone_Applicant FOREIGN KEY
		(
			ApplicantID
		)
		REFERENCES dbo.Applicant
		(
			ID
		)
		ON UPDATE NO ACTION
		ON DELETE NO ACTION

        Insert into #ChangeScript066_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript066_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript066_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 066, 'Add constrain between Applicant and ApplciantPhone'

		print '**************************************************'
		print '*  db.01.00.066: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.066: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript066_stat%')
Begin
	drop table #ChangeScript066_stat
End
go
 
 
/*
 db.01.00.067:
 Does the following:
	Add ID column into Incomplete Order Requirement Table, insert Unique constrain to IncompleteORderID and RequirementID fields

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 067

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript067_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript067_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 067)
begin
	print '**************************************************'
	print '*  db.01.00.067: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript067_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript067_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add ID column into Incomplete Order Requirement Table, insert Unique constrain to IncompleteORderID and RequirementID fields                            *'
	print '***********************************************************************'

	
	ALTER TABLE dbo.IncompleteOrderRequirement
		DROP CONSTRAINT PK_IncompleteOrderRequirement_1

	ALTER TABLE dbo.IncompleteOrderRequirement ADD  ID [uniqueidentifier] NOT NULL ROWGUIDCOL CONSTRAINT DF_IncompleteOrderRequirement_ID DEFAULT NEWID()

	ALTER TABLE dbo.IncompleteOrderRequirement ADD CONSTRAINT
		PK_IncompleteOrderRequirement PRIMARY KEY CLUSTERED 
		(
		ID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]


	ALTER TABLE dbo.IncompleteOrderRequirement ADD CONSTRAINT
		IX_IncompeleteOrderRequirement UNIQUE NONCLUSTERED 
		(
		IncompleteOrderID,
		RequirementID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]



        Insert into #ChangeScript067_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript067_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript067_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 067, 'Add ID column into Incomplete Order Requirement Table, insert Unique constrain to IncompleteORderID and RequirementID fields'

		print '**************************************************'
		print '*  db.01.00.067: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.067: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript067_stat%')
Begin
	drop table #ChangeScript067_stat
End
go
 
 
/*
 db.01.00.068:
 Does the following:
	Add Reminder ,AssignedReminder,ReminderType,Priority Table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 068

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript068_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript068_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 068)
begin
	print '**************************************************'
	print '*  db.01.00.068: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript068_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript068_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* Reminder ,AssignedReminder,ReminderType,Priority Table *'							
	print '**********************************************************************'
	IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[metadata].[ReminderType]') AND type in (N'U'))
	BEGIN
		/*Add ReminderType*/
		CREATE TABLE [metadata].[ReminderType](
		[ID] [int] NOT NULL,
		[Name] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
		CONSTRAINT [PK_ReminderType] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
	END
	ELSE
		PRINT 'INFO: db.01.00.068 Table ReminderType already exists'
		
	IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[metadata].[Priority]') AND type in (N'U'))
	BEGIN
		/*Add Priority*/
		CREATE TABLE [metadata].[Priority](
		[ID] [int] NOT NULL,
		[Name] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
		 CONSTRAINT [PK_Priority] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
	END
	ELSE
		PRINT 'INFO: db.01.00.068 Table Priority already exists'

		
	IF dbo.SMM_CheckExists(1, 'Reminder', '') = -1
	BEGIN
		/*Add Reminder*/
		CREATE TABLE [dbo].[Reminder](
		[ID] [uniqueidentifier] NOT NULL ROWGUIDCOL CONSTRAINT DF_Reminder_ID DEFAULT NEWID(),
		[ReminderTypeID] [int] NOT NULL,
		[Reason] [nvarchar](2000) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
		[PriorityID] [int] NOT NULL,
		[Completed] [bit] NOT NULL,
		[CreatedBy] [uniqueidentifier] NOT NULL,
		[CreatedDate] [datetime] NOT NULL,
		[ModifiedDate] [datetime] NOT NULL,
		[DeletedDate] [datetime] NULL,
		[FollowUp] [datetime] NOT NULL,
		[RelatedTo] [uniqueidentifier] NOT NULL,
		CONSTRAINT [PK_Reminder] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[Reminder]  WITH CHECK ADD  CONSTRAINT [FK_Reminder_OrderPriority] FOREIGN KEY([PriorityID])
		REFERENCES [metadata].[OrderPriority] ([ID])
		
		ALTER TABLE [dbo].[Reminder]  WITH CHECK ADD  CONSTRAINT [FK_Reminder_Person] FOREIGN KEY([CreatedBy])
		REFERENCES [dbo].[Person] ([ID])
		
		ALTER TABLE [dbo].[Reminder]  WITH CHECK ADD  CONSTRAINT [FK_Reminder_ReminderType] FOREIGN KEY([ReminderTypeID])
		REFERENCES [metadata].[ReminderType] ([ID])
	END
	ELSE
		PRINT 'INFO: db.01.00.068 Table Reminder already exists'
		
	IF dbo.SMM_CheckExists(1, 'AssignedReminder', '') = -1
	BEGIN
		/*Add AssignedReminder*/
		CREATE TABLE [dbo].[AssignedReminder](
		[ID] [uniqueidentifier] NOT NULL ROWGUIDCOL CONSTRAINT DF_AssignedReminder_ID DEFAULT NEWID(),
		[ReminderID] [uniqueidentifier] NOT NULL,
		[AssignedTo] [uniqueidentifier] NOT NULL,
		
		 CONSTRAINT [PK_AssignedReminder] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[AssignedReminder]  WITH CHECK ADD  CONSTRAINT [FK_AssignedReminder_Person] FOREIGN KEY([AssignedTo])
		REFERENCES [dbo].[Person] ([ID])
		
		ALTER TABLE [dbo].[AssignedReminder]  WITH CHECK ADD  CONSTRAINT [FK_AssignedReminder_Reminder] FOREIGN KEY([ReminderID])
		REFERENCES [dbo].[Reminder] ([ID])
	END
	ELSE
		PRINT 'INFO: db.01.00.068 Table AssignedReminder already exists'
		
	Insert into #ChangeScript068_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript068_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript068_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 068, 'Reminder ,AssignedReminder,ReminderType,Priority Table'

		print '**************************************************'
		print '*  db.01.00.068: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.068: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript068_stat%')
Begin
	drop table #ChangeScript068_stat
End
go

 
 
/*
 db.01.00.069:
 Does the following:
	Insert Data to ReminderType,Priority Table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 069

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript069_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript069_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 069)
begin
	print '**************************************************'
	print '*  db.01.00.069: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript069_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript069_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* Insert Data to ReminderType,Priority Table *'							
	print '**********************************************************************'
	
	insert into [metadata].[ReminderType]([ID], [Name]) values(1, 'Order')
	insert into [metadata].[ReminderType]([ID], [Name]) values(2, 'Credentialing')
	
	insert into [metadata].[Priority]([ID], [Name]) values(1, 'Low')
	insert into [metadata].[Priority]([ID], [Name]) values(2, 'Medium')
	insert into [metadata].[Priority]([ID], [Name]) values(3, 'High')
	insert into [metadata].[Priority]([ID], [Name]) values(4, 'Rush')
	
	
	Insert into #ChangeScript069_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript069_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript069_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 069, 'Insert Data to ReminderType,Priority Table'

		print '**************************************************'
		print '*  db.01.00.069: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.069: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript069_stat%')
Begin
	drop table #ChangeScript069_stat
End
go

 
 
/*
 db.01.00.070:
 Does the following:
	add constraint between order and insurance table>

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 070

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript070_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript070_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 070)
begin
	print '**************************************************'
	print '*  db.01.00.070: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript070_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript070_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add constraint between order and insurance table                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.[Order] ADD CONSTRAINT
		FK_Order_Insurance FOREIGN KEY
		(	
			InsuranceID
		)
		REFERENCES dbo.Insurance
		(
			ID
		)
		ON UPDATE NO ACTION
		ON DELETE NO ACTION

        Insert into #ChangeScript070_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript070_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript070_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 070, 'TODO: add constraint between order and insurance table'

		print '**************************************************'
		print '*  db.01.00.070: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.070: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript070_stat%')
Begin
	drop table #ChangeScript070_stat
End
go
 
 
/*
 db.01.00.071:
 Does the following:
	Add CompletedDate into Order table 
	Change column name "IsPayed" from OrderAssignment table to "IsPaid"
	Add new column "ApGenerated" field into OrderAssignment table
	Add OrderAssignmentFeeType metadata table (Bonus, Referral Fee...)
	Drop OrderID from InvoicePayment and add new primary key ID into Invoice Payment table
	Add new table InvoicePaymentDetail (ID, InvoicePayment ID, OrderID, AmountPaid)
	Add BilledAmount to Invoice table to store total amount of the invoice
	Add CreatedBy (Employee) field into Payment table to store the employee who enters the payment
	Add AvailableBalance in Payment table
	Add PaymentCode metadata table (Balanced, Need to Research, UnderPayment, OverPayment, Deduction)
	Add PaymentCodeID into InvoicePaymentOrder table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 071

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript071_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript071_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 071)
begin
	print '**************************************************'
	print '*  db.01.00.071: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript071_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript071_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* Add CompletedDate into Order table									*'
	print '* Change column "IsPayed" in OrderAssignment to "IsPaid"				*'
	print '* Add new column "ApGenerated" field into OrderAssignment table		*'
	print '* Add OrderAssignmentFeeType metadata table (Bonus, Referral Fee...)	*'
	print '* Drop OrderID and add new primary key ID into Invoice Payment table	*'
	print '* Add new table InvoicePaymentDetail									*'
	print '* Add BilledAmount to Invoice table									*'
	print '* Add CreatedBy (Employee) field into Payment table					*'
	print '* Add AvailableBalance in Payment table								*'
	print '* Add PaymentCode metadata table										*'
	print '* Add PaymentCode metadata table										*'
	print '* Add PaymentCodeID into InvoicePaymentOrder table					*'
	print '**********************************************************************'

		IF dbo.SMM_CheckExists(2, 'FK_Payment_BillingCompany', 'Payment') = 0
			ALTER TABLE Payment
			DROP FK_Payment_BillingCompany		

		IF dbo.SMM_CheckExists(6, 'PaidBy', 'Payment') = 0
			ALTER TABLE Payment
			DROP COLUMN PaidBy					

		IF dbo.SMM_CheckExists(1, 'Department', '') = -1
			CREATE TABLE [dbo].[Department]
			(
				[ID] [uniqueidentifier] NOT NULL,
				[Name][nvarchar](100),
				CONSTRAINT [PK_Department] PRIMARY KEY(ID)
			)

		IF dbo.SMM_CheckExists(1, 'metadata.[PaymentType]', '') = -1
		BEGIN
			CREATE TABLE metadata.[PaymentType]
			(
				[ID] int not null,
				[Name] nvarchar(50) not null,
				CONSTRAINT [PK_PaymentType] PRIMARY KEY ([ID])
			)
			INSERT INTO metadata.PaymentType ([ID],[Name]) VALUES(1,'Check')
			INSERT INTO metadata.PaymentType ([ID],[Name]) VALUES(2,'Credit Card')
			INSERT INTO metadata.PaymentType ([ID],[Name]) VALUES(3,'Cash')
			INSERT INTO metadata.PaymentType ([ID],[Name]) VALUES(4,'Direct Deposite')
		END

		IF dbo.SMM_CheckExists(2, 'FK_Payment_PaymentType', 'Payment') = -1
			ALTER TABLE Payment
			ADD CONSTRAINT FK_Payment_PaymentType FOREIGN KEY(PaymentTypeID)
			REFERENCES metadata.PaymentType([ID])
		
		IF dbo.SMM_CheckExists(6, 'PaidDate', 'Payment') = -1
			ALTER TABLE Payment
			ADD PaidDate DATETIME NOT NULL
		
		IF dbo.SMM_CheckExists(6, 'ExpiredDate', 'Payment') = -1
			ALTER TABLE Payment
			ADD ExpiredDate DATETIME

		IF dbo.SMM_CheckExists(6, 'AccountNumber', 'Payment') = -1
			ALTER TABLE Payment
			ADD AccountNumber nvarchar(50) NOT NULL

		IF dbo.SMM_CheckExists(6, 'RoutingNumber', 'Payment') = -1
			ALTER TABLE Payment
			ADD RoutingNumber nvarchar(50) NOT NULL

		IF dbo.SMM_CheckExists(6, 'ReferenceNumber', 'Payment') = -1
			ALTER TABLE Payment
			ADD ReferenceNumber nvarchar(50) NOT NULL

		IF dbo.SMM_CheckExists(6, 'CreditCardNumber', 'Payment') = -1
			ALTER TABLE Payment
			ADD CreditCardNumber nvarchar(50) NOT NULL

		IF dbo.SMM_CheckExists(6, 'CreatedBy', 'Payment') = -1
			ALTER TABLE Payment
			ADD CreatedBy [uniqueidentifier] NOT NULL

		IF dbo.SMM_CheckExists(6, 'AvailableBalance', 'Payment') = -1
			ALTER TABLE Payment
			ADD AvailableBalance money NOT NULL

		IF dbo.SMM_CheckExists(2, 'FK_Payment_Employee', 'Payment') = -1
			ALTER TABLE Payment
			ADD CONSTRAINT FK_Payment_Employee FOREIGN KEY(CreatedBy) REFERENCES Employee([ID])

		IF dbo.SMM_CheckExists(6, 'CompletedDate', 'Order') = -1
			ALTER TABLE [Order]
			ADD CompletedDate DateTime NULL
		
		IF dbo.SMM_CheckExists(6, 'IsPayed', 'OrderAssignment') = 0
			EXECUTE sp_rename N'dbo.OrderAssignment.IsPayed', N'IsPaid', 'COLUMN' 

		IF dbo.SMM_CheckExists(6, 'ApGenerated', 'OrderAssignment') = -1
			ALTER TABLE OrderAssignment
			ADD ApGenerated bit NOT NULL
			
		IF dbo.SMM_CheckExists(1, 'metadata.[OrderAssignmentFeeType]', '') = -1
		BEGIN	
		CREATE TABLE metadata.[OrderAssignmentFeeType]
			(
				[ID] int not null,
				[Name] nvarchar(50) not null,
				CONSTRAINT [PK_OrderAssignmentFeeType] PRIMARY KEY ([ID])
			)

			INSERT INTO metadata.OrderAssignmentFeeType ([ID],[Name]) VALUES(1,'Bonus')
			INSERT INTO metadata.OrderAssignmentFeeType ([ID],[Name]) VALUES(2,'Referral')
		END

		IF dbo.SMM_CheckExists(2, 'PK_InvoicePayment', 'InvoicePayment') = 0
			ALTER TABLE InvoicePayment
			DROP PK_InvoicePayment 

		IF dbo.SMM_CheckExists(2, 'FK_InvoicePayment_InvoiceDetails', 'InvoicePayment') = 0
			ALTER TABLE InvoicePayment
			DROP FK_InvoicePayment_InvoiceDetails
		
		IF dbo.SMM_CheckExists(6, 'OrderID', 'InvoicePayment') = 0
			ALTER TABLE InvoicePayment
			DROP COLUMN OrderID

		IF dbo.SMM_CheckExists(6, 'ID', 'InvoicePayment') = -1
			ALTER TABLE InvoicePayment
			ADD ID [uniqueidentifier] NOT NULL

		IF dbo.SMM_CheckExists(2, 'PK_InvoicePayment', 'InvoicePayment') = -1
			ALTER TABLE InvoicePayment
			ADD CONSTRAINT PK_InvoicePayment PRIMARY KEY([ID])
		
		IF dbo.SMM_CheckExists(1, 'InvoicePaymentDetail', '') = -1
			CREATE TABLE InvoicePaymentDetail
			(
				[ID] int not null,
				[InvoicePaymentID] [uniqueidentifier] not null,
				[OrderID] int not null,
				CONSTRAINT [PK_InvoicePaymentDetail] PRIMARY KEY ([ID])
			)
		
		IF dbo.SMM_CheckExists(2, 'FK_InvoicePaymentDetail_InvoicePayment', 'InvoicePaymentDetail') = -1
			ALTER TABLE InvoicePaymentDetail
			ADD CONSTRAINT FK_InvoicePaymentDetail_InvoicePayment FOREIGN KEY([InvoicePaymentID]) REFERENCES InvoicePayment([ID])
		
		IF dbo.SMM_CheckExists(2, 'FK_InvoicePaymentDetail_Order', 'InvoicePaymentDetail') = -1
			ALTER TABLE InvoicePaymentDetail
			ADD CONSTRAINT FK_InvoicePaymentDetail_Order FOREIGN KEY([OrderID]) REFERENCES [Order]([ID])

		IF dbo.SMM_CheckExists(6, 'AmountBilled', 'Invoice') = -1
			ALTER TABLE Invoice
			ADD AmountBilled money NOT NULL

		IF dbo.SMM_CheckExists(1, 'metadata.PaymentCode', '') = -1 
		BEGIN
			CREATE TABLE metadata.PaymentCode
			(
				[ID] int not null,
				[Name] nvarchar(100) not null,
				CONSTRAINT [PK_PaymentCode] PRIMARY KEY ([ID])
			)

		INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(1,'Missing Paperwork')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(2,'Missing Personal Info  DOB, SSN, etc')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(3,'Will not allow reimbursement for this case')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(4,'Unapproved requirement')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(5,'Missing requirement')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(6,'Late Submission')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(7,'Unapproved Fee')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(8,'Examiner unapproved to bill')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(9,'Unauthorized Examiner')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(10,'Male examiner performed EKG on Female')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(11,'Missing Agency/agent code')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(12,'Incorrect/Invalid Insurance #')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(13,'APS not ordered')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(14,'Service not approved by home office')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(15,'Missing support documentation')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(16,'Client cannot ID/No Application')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(17,'Missing MD name')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(18,'Stamped incorrectly')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(19,'Missing Stamp')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(20,'Incorrect forms used/outdated')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(21,'Incomplete yes answers')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(22,'Mailing used needle kits to labs')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(23,'Incorrect lab used')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(24,'Incorrect fee')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(25,'Report Quality Below Standard-illegible, missing signatures')      
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(26,'Duplicate charges')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(27,'Incorrect service code')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(28,'Incorrect Fees used, Deduction')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(29,'Incorrect Fees used, Bonus')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(30,'Wrong forms used')
INSERT INTO metadata.PaymentCode([ID],[Name])VALUES(31,'Duplicate Order')	
                                                                
		END
		
		IF dbo.SMM_CheckExists(6, 'PaymentCodeID', 'InvoicePaymentDetail') = -1
			ALTER TABLE InvoicePaymentDetail
			ADD PaymentCodeID int not null

		IF dbo.SMM_CheckExists(2, 'FK_InvoicePaymentDetail_PaymentCode', 'InvoicePaymentDetail') = -1
			ALTER TABLE InvoicePaymentDetail
			ADD CONSTRAINT FK_InvoicePaymentDetail_PaymentCode FOREIGN KEY(PaymentCodeID) REFERENCES metadata.PaymentCode([ID])
		
	Insert into #ChangeScript071_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript071_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript071_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 071, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.071: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.071: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript071_stat%')
Begin
	drop table #ChangeScript071_stat
End
go
 
 
/*
 db.01.00.072:
 Does the following:
	Add AmountPaid, Balance into Invoice table
	Drop BillingCompanyID from Invoice table
	Add BillingInformationID into Invoice table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 072

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript072_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript072_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 072)
begin
	print '**************************************************'
	print '*  db.01.00.072: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript072_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript072_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* Add AmountPaid, Balance into Invoice table							*'
	print '* Drop BillingCompanyID from Invoice table							*'
	print '* Add BillingInformationID into Invoice table						*'
	print '**********************************************************************'
	
	IF dbo.SMM_CheckExists(6, 'AmountPaid', 'Invoice') = -1
		ALTER TABLE Invoice
		ADD AmountPaid money NOT NULL

	IF dbo.SMM_CheckExists(6, 'Balance', 'Invoice') = -1
		ALTER TABLE Invoice
		ADD Balance money NOT NULL	
	
	IF dbo.SMM_CheckExists(2, 'FK_Invoice_BillingCompany', 'Invoice') = 0
		ALTER TABLE Invoice
		DROP FK_Invoice_BillingCompany
	
	IF dbo.SMM_CheckExists(6, 'BillingCompanyID', 'Invoice') = 0
		ALTER TABLE Invoice
		DROP COLUMN BillingCompanyID

	IF dbo.SMM_CheckExists(6, 'BillingInformationID', 'Invoice') = -1
		ALTER TABLE Invoice
		ADD BillingInformationID [uniqueidentifier] NOT NULL

	IF dbo.SMM_CheckExists(2, 'FK_Invoice_BillingInformation', 'Invoice') = -1
		ALTER TABLE Invoice
		ADD CONSTRAINT FK_Invoice_BillingInformation FOREIGN KEY(BillingInformationID)
		REFERENCES BillingInformation([ID])

	IF dbo.SMM_CheckExists(6, 'CreatedBy', 'Invoice') = -1
		ALTER TABLE Invoice
		ADD CreatedBy [uniqueidentifier] NOT NULL

	IF dbo.SMM_CheckExists(2, 'FK_Invoice_Employee', 'Invoice') = -1
		ALTER TABLE Invoice
		ADD CONSTRAINT FK_Invoice_Employee FOREIGN KEY(CreatedBy) REFERENCES Employee([ID])

	Insert into #ChangeScript072_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript072_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript072_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 072, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.072: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.072: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript072_stat%')
Begin
	drop table #ChangeScript072_stat
End
go
 
 
/*
 db.01.00.073:
 Does the following:
	Change column name "CreateDate" to "CreatedDate"
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 073

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript073_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript073_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 073)
begin
	print '**************************************************'
	print '*  db.01.00.073: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript073_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript073_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* Modify column "CreateDate" in Agency table to "CreatedDate"		*'
	print '**********************************************************************'

		IF dbo.SMM_CheckExists(6, 'CreateDate', 'Agency') = 0
		EXECUTE sp_rename N'dbo.Agency.CreateDate', N'CreatedDate', 'COLUMN' 
		
		IF dbo.SMM_CheckExists(6, 'CreateDate', 'PartyAddress') = 0
		EXECUTE sp_rename N'dbo.PartyAddress.CreateDate', N'CreatedDate', 'COLUMN' 
		
	Insert into #ChangeScript073_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript073_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript073_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 073, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.073: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.073: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript073_stat%')
Begin
	drop table #ChangeScript073_stat
End
go
 
 
/*
 db.01.00.074:
 Does the following:
	Add Identity attribute for primary key of Invoice and Payment
	CREATE Invoice, Payment, InvoicePayment, InvoiceDetail, InvoicePaymentDetail tables
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 074

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript074_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript074_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 074)
begin
	print '**************************************************'
	print '*  db.01.00.074: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript074_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript074_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* CREATE Invoice, Payment, InvoicePayment, InvoiceDetail, InvoicePaymentDetail tables		*'
	print '**********************************************************************'
		IF dbo.SMM_CheckExists(1, 'InvoicePaymentDetail', '') = 0
			DROP TABLE InvoicePaymentDetail
		IF dbo.SMM_CheckExists(1, 'InvoicePayment', '') = 0
			DROP TABLE InvoicePayment
		IF dbo.SMM_CheckExists(1, 'InvoiceDetails', '') = 0
			DROP TABLE InvoiceDetails
		IF dbo.SMM_CheckExists(1, 'Invoice', '') = 0
			DROP TABLE Invoice
		IF dbo.SMM_CheckExists(1, 'Payment', '') = 0
			DROP TABLE Payment
		
		IF dbo.SMM_CheckExists(1, 'Payment', '') = -1
			CREATE TABLE Payment
			(
				[ID] [int] IDENTITY(1,1) NOT NULL,
				[AmountPaid] [money] NOT NULL,
				[AvailableBalance] [money] NOT NULL,	
				[PaymentTypeID] [int] NOT NULL,
				[ReceivedDate] [datetime] NOT NULL,
				[CreatedBy] [uniqueidentifier] NOT NULL,
				[AccountNumber] [nvarchar](50) NOT NULL,
				[RoutingNumber] [nvarchar](50) NOT NULL,
				[ReferenceNumber] [nvarchar](50) NOT NULL,
				[CreditCardNumber] [nvarchar](50) NOT NULL,
				[CreatedDate] [datetime] NOT NULL,
				[ModifiedDate] [datetime] NOT NULL,
				[DeletedDate] [datetime] NULL,
				[PaidDate] [datetime] NOT NULL,
				[ExpiredDate] [datetime] NULL,
				CONSTRAINT PK_Payment PRIMARY KEY([ID])
			)
		IF dbo.SMM_CheckExists(2, 'FK_Payment_PaymentType', 'Payment') = -1
			ALTER TABLE Payment 
			ADD CONSTRAINT FK_Payment_PaymentType FOREIGN KEY ([PaymentTypeID]) REFERENCES metadata.PaymentType([ID])

		IF dbo.SMM_CheckExists(2, 'FK_Payment_Employee', 'Payment') = -1
			ALTER TABLE Payment 
			ADD CONSTRAINT FK_Payment_Employee FOREIGN KEY ([CreatedBy]) REFERENCES Employee([ID])
		
		IF dbo.SMM_CheckExists(1, 'Invoice', '') = -1
			CREATE TABLE [dbo].[Invoice](
				[ID] [int] IDENTITY(1,1) NOT NULL,
				[AmountBilled] [money] NOT NULL,
				[AmountPaid] [money] NOT NULL,
				[Balance] [money] NOT NULL,
				[BillingInformationID] [uniqueidentifier] NOT NULL,
				[CreatedBy] [uniqueidentifier] NOT NULL,
				[CreatedDate] [datetime] NOT NULL,
				[ModifiedDate] [datetime] NOT NULL,
				[DeletedDate] [datetime] NULL,
				CONSTRAINT PK_Invoice PRIMARY KEY([ID])
			) 

		IF dbo.SMM_CheckExists(2, 'FK_Invoice_BillingInformation', 'Invoice') = -1
			ALTER TABLE Invoice 
			ADD CONSTRAINT FK_Invoice_BillingInformation FOREIGN KEY ([BillingInformationID]) REFERENCES BillingInformation([ID])
			
		IF dbo.SMM_CheckExists(2, 'FK_Invoice_Employee', 'Invoice') = -1
			ALTER TABLE Invoice 
			ADD CONSTRAINT FK_Invoice_Employee FOREIGN KEY ([CreatedBy]) REFERENCES Employee([ID])

		IF dbo.SMM_CheckExists(1, '[InvoiceDetail]', '') = -1
			CREATE TABLE [dbo].[InvoiceDetail](
				[InvoiceID] [int] NOT NULL,
				[OrderID] [int] NOT NULL,
				CONSTRAINT [PK_InvoiceDetails] PRIMARY KEY ([InvoiceID] ,[OrderID] )
			)
		
		IF dbo.SMM_CheckExists(2, 'FK_InvoiceDetail_Invoice', 'InvoiceDetail') = -1
			ALTER TABLE InvoiceDetail
			ADD CONSTRAINT FK_InvoiceDetail_Invoice FOREIGN KEY ([InvoiceID]) REFERENCES Invoice([ID])
		
		IF dbo.SMM_CheckExists(2, 'FK_InvoiceDetail_Order', 'InvoiceDetail') = -1
			ALTER TABLE InvoiceDetail
			ADD CONSTRAINT FK_InvoiceDetail_Order FOREIGN KEY ([OrderID]) REFERENCES [Order]([ID])

		IF dbo.SMM_CheckExists(1, 'InvoicePayment', '') = -1
			CREATE TABLE [dbo].[InvoicePayment](
				[ID] [uniqueidentifier] NOT NULL,
				[InvoiceID] [int] NOT NULL,
				[PaymentID] [int] NOT NULL,
				[AmountPaid] [money] NOT NULL,
				CONSTRAINT [PK_InvoicePayment] PRIMARY KEY ([ID])
			)

		IF dbo.SMM_CheckExists(2, 'FK_InvoicePayment_Invoice', '[InvoicePayment]') = -1
			ALTER TABLE [InvoicePayment] 
			ADD CONSTRAINT FK_InvoicePayment_Invoice FOREIGN KEY ([InvoiceID]) REFERENCES Invoice([ID])
		
		IF dbo.SMM_CheckExists(2, 'FK_InvoicePayment_Payment', '[InvoicePayment]') = -1
			ALTER TABLE [InvoicePayment] 
			ADD CONSTRAINT FK_InvoicePayment_Payment FOREIGN KEY ([PaymentID]) REFERENCES Payment([ID])
			
		IF dbo.SMM_CheckExists(1, '[InvoicePaymentDetail]', '') = -1
			CREATE TABLE [dbo].[InvoicePaymentDetail](
				[ID] [uniqueidentifier] NOT NULL,
				[InvoicePaymentID] [uniqueidentifier] NOT NULL,
				[OrderID] [int] NOT NULL,
				[PaymentCodeID] [int] NOT NULL,
				CONSTRAINT [PK_InvoicePaymentDetail] PRIMARY KEY ([ID])
			)
		
		IF dbo.SMM_CheckExists(2, 'FK_InvoicePaymentDetail_InvoicePayment', 'InvoicePaymentDetail') = -1
			ALTER TABLE InvoicePaymentDetail
			ADD CONSTRAINT FK_InvoicePaymentDetail_InvoicePayment FOREIGN KEY ([InvoicePaymentID]) REFERENCES InvoicePayment([ID])
		
		IF dbo.SMM_CheckExists(2, 'FK_InvoicePaymentDetail_Order', 'InvoicePaymentDetail') = -1
			ALTER TABLE InvoicePaymentDetail
			ADD CONSTRAINT FK_InvoicePaymentDetail_Order FOREIGN KEY ([OrderID]) REFERENCES [Order]([ID])
		
		IF dbo.SMM_CheckExists(2, 'FK_InvoicePaymentDetail_PaymentCode', 'InvoicePaymentDetail') = -1		
			ALTER TABLE InvoicePaymentDetail
			ADD CONSTRAINT FK_InvoicePaymentDetail_PaymentCode FOREIGN KEY ([PaymentCodeID]) REFERENCES metadata.PaymentCode([ID])

		IF dbo.SMM_CheckExists(6, 'ReceivedDate', 'Payment') = 0
			ALTER TABLE Payment
			DROP COLUMN ReceivedDate

	Insert into #ChangeScript074_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript074_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript074_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 074, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.074: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.074: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript074_stat%')
Begin
	drop table #ChangeScript074_stat
End
go
 
 
/*
 db.01.00.075:
 Does the following:
	Add OrderRelativeTo column, specified new order that it will connect to when completed
	Add OrderRelativeDescription column

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 075

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript075_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript075_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 075)
begin
	print '**************************************************'
	print '*  db.01.00.075: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript075_stat (PatchStatus) Values (-1)
end

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript075_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add OrderRelativeTo column, specified new order that it will connect to when completed. Add OrderRelativeDescription column*'
	print '***********************************************************************'

	ALTER TABLE dbo.IncompleteOrder ADD OrderRelativeToID int null
	ALTER TABLE dbo.IncompleteOrder ADD OrderRelativeDesc nvarchar(250) null

	ALTER TABLE dbo.IncompleteOrder ADD CONSTRAINT FK_IncompleteOrder_Order FOREIGN KEY
	(
		OrderRelativeToID
	)
	REFERENCES dbo.[Order]
	(	
		ID
	)
	ON UPDATE NO ACTION 
	ON DELETE NO ACTION

        Insert into #ChangeScript075_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript075_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript075_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 075, 'Add OrderRelativeTo column, specified new order that it will connect to when completed. Add OrderRelativeDescription column'

		print '**************************************************'
		print '*  db.01.00.075: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.075: NOT completed successfully      *'
		print '**************************************************'
	end
End

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript075_stat%')
Begin
	drop table #ChangeScript075_stat
End
 
 
/*
 db.01.00.076:
 Does the following:
	Add column preset into OrderSchedule table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 076

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript076_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript076_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 076)
begin
	print '**************************************************'
	print '*  db.01.00.076: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript076_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript076_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add column preset into OrderSchedule table*'
	print '***********************************************************************'

	ALTER TABLE dbo.OrderSchedule ADD Preset bit not null CONSTRAINT DF_OrderSchedule_Preset DEFAULT 0

        Insert into #ChangeScript076_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript076_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript076_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 076, 'Add column preset into OrderSchedule table'

		print '**************************************************'
		print '*  db.01.00.076: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.076: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript076_stat%')
Begin
	drop table #ChangeScript076_stat
End
go
 
 
/*
 db.01.00.077:
 Does the following:
	add CreateBy field into IncompleteOrder table
    add CreateBy field into Order table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 077

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript077_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript077_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 077)
begin
	print '**************************************************'
	print '*  db.01.00.077: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript077_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript077_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add CreateBy field into IncompleteOrder table *'
    print '* add CreateBy field into Order table *'
	print '***********************************************************************'

	ALTER TABLE [dbo].[Order] ADD CreatedBy uniqueidentifier NOT NULL
    ALTER TABLE [dbo].[Order] ADD CONSTRAINT FK_Order_Person FOREIGN KEY 
	(CreatedBy) REFERENCES dbo.Person(ID)
    
    ALTER TABLE [dbo].[IncompleteOrder] ADD CreatedBy uniqueidentifier NOT NULL
    ALTER TABLE [dbo].[IncompleteOrder] ADD CONSTRAINT FK_IncompleteOrder_Person FOREIGN KEY 
	(CreatedBy) REFERENCES dbo.Person(ID)

    Insert into #ChangeScript077_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript077_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript077_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 077, 'add CreateDate and CreateBy field into OfficeNote table, add UID column into Order table, create new metadata table ObjectType '

		print '**************************************************'
		print '*  db.01.00.077: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.077: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript077_stat%')
Begin
	drop table #ChangeScript077_stat
End
go
 
 
/*
 db.01.00.079:
 Does the following:
	Change FK from Person to Party

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 079

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript079_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript079_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 079)
begin
	print '**************************************************'
	print '*  db.01.00.079: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript079_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript079_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Change FK from Person to Party                                      *'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(2, 'FK_EmailQueue_Person', 'EmailQueue') = 0
		ALTER TABLE EmailQueue DROP FK_EmailQueue_Person

	ALTER TABLE [dbo].[EmailQueue]  WITH CHECK ADD  CONSTRAINT [FK_EmailQueue_Party]
		FOREIGN KEY([EmailToID])
		REFERENCES [dbo].[Party] ([ID])

	EXECUTE sp_rename N'dbo.UserPermission.PemissionTypeID', N'PermissionTypeID', 'COLUMN'

	Insert into #ChangeScript079_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript079_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript079_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 079, 'Change FK from Person to Party'

		print '**************************************************'
		print '*  db.01.00.079: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.079: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript079_stat%')
Begin
	drop table #ChangeScript079_stat
End
go
 
 
/*
 db.01.00.080:
 Does the following:
	Create SPMedicalItem table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 080

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript080_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript080_stat

if exists (select * from metadata.Version where Release = 1.0 and Build = 080)
begin
	print '**************************************************'
	print '*  db.01.00.080: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript080_stat (PatchStatus) Values (-1)
end

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript080_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Create SPMedicalItem table *'    
	print '***********************************************************************'

	CREATE TABLE dbo.SPMedicalItem
	(
	ID uniqueidentifier NOT NULL,
	MedicalItemID uniqueidentifier NOT NULL,
	ServiceProviderID uniqueidentifier NOT NULL,
	QuantityInStock int NOT NULL,
	QuantityReorder int NOT NULL,
	QuantityInDemand int NOT NULL
	)  ON [PRIMARY]

ALTER TABLE dbo.SPMedicalItem ADD CONSTRAINT
	PK_SPMedicalItem PRIMARY KEY CLUSTERED 
	(
	ID
	) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

ALTER TABLE dbo.SPMedicalItem ADD CONSTRAINT
	FK_SPMedicalItem_MedicalItem FOREIGN KEY
	(
	MedicalItemID
	) REFERENCES dbo.MedicalItem
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION

ALTER TABLE dbo.SPMedicalItem ADD CONSTRAINT
	FK_SPMedicalItem_ServiceProvider FOREIGN KEY
	(
	ServiceProviderID
	) REFERENCES dbo.ServiceProvider
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 

    Insert into #ChangeScript080_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End

/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript080_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript080_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 080, 'Create SPMedicalItem table'

		print '**************************************************'
		print '*  db.01.00.080: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.080: NOT completed successfully      *'
		print '**************************************************'
	end
End


If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript080_stat%')
Begin
	drop table #ChangeScript080_stat
End

 
 
/*
 db.01.00.081:
 Does the following:
	add ID primary key into 'ServiceProviderApproval' table 
    add ID primary key into 'ServiceProviderBlacklist' table 

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 081

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript081_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript081_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 081)
begin
	print '**************************************************'
	print '*  db.01.00.081: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript081_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript081_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
  print '* add ID primary key into ServiceProviderApproval table *'
  print '* add ID primary key into ServiceProviderBlacklist table *'
  print '* alter primary key ServiceProviderApproval table *'
  print '* alter primary key ServiceProviderBlacklist table *'
	print '***********************************************************************'

  DECLARE @PKNAME VARCHAR(500)
  SELECT @PKNAME=[NAME] FROM SYSOBJECTS PKTABLE WHERE XTYPE='PK'
  AND PARENT_OBJ IN
  (SELECT ID FROM SYSOBJECTS T WHERE NAME='ServiceProviderApproval')

  /*ServiceProviderApproval*/
  DECLARE @STRINGSQL NVARCHAR(4000)
  SET @STRINGSQL=N'ALTER TABLE [dbo].[ServiceProviderApproval] DROP CONSTRAINT ['+ @PKNAME+N']';
  EXEC SP_EXECUTESQL @STRINGSQL
  
  ALTER TABLE [dbo].[ServiceProviderApproval]
  ADD ID [uniqueidentifier] ROWGUIDCOL NOT NULL CONSTRAINT DF_ServiceProviderApproval_ID DEFAULT NEWID()

  SET @STRINGSQL=N'ALTER TABLE [dbo].[ServiceProviderApproval]  ADD CONSTRAINT ['+@PKNAME +N'] PRIMARY KEY (ID);'
  EXEC SP_EXECUTESQL  @STRINGSQL

  /*ServiceProviderBlacklist*/
  SELECT @PKNAME=[NAME] FROM SYSOBJECTS PKTABLE WHERE XTYPE='PK'
  AND PARENT_OBJ IN
  (SELECT ID FROM SYSOBJECTS T WHERE NAME='ServiceProviderBlacklist')
  
  SET @STRINGSQL=N'ALTER TABLE [dbo].[ServiceProviderBlacklist] DROP CONSTRAINT ['+ @PKNAME+N']';
  EXEC SP_EXECUTESQL @STRINGSQL
  
  ALTER TABLE [dbo].[ServiceProviderBlacklist]
  ADD ID [uniqueidentifier] ROWGUIDCOL NOT NULL CONSTRAINT DF_ServiceProviderBlacklist_ID DEFAULT NEWID()

  SET @STRINGSQL=N'ALTER TABLE [dbo].[ServiceProviderBlacklist]  ADD CONSTRAINT ['+@PKNAME +N'] PRIMARY KEY (ID);'
  EXEC SP_EXECUTESQL  @STRINGSQL

  Insert into #ChangeScript081_stat (PatchStatus) Values (1)

  COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript081_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript081_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 081, '	add ID primary key into ServiceProviderApproval table and add ID primary key into ServiceProviderBlacklist table '

		print '**************************************************'
		print '*  db.01.00.081: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.081: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript081_stat%')
Begin
	drop table #ChangeScript081_stat
End
go 
 
/*
 db.01.00.082:
 Does the following:
	Design database for Manage Level Fee module

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 082

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript082_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript082_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 082)
begin
	print '**************************************************'
	print '*  db.01.00.082: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript082_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript082_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Design database for Manage Level Fee module                         *'
	print '***********************************************************************'

	ALTER TABLE [dbo].[FeeLevel]  ADD [CreatedDate] datetime NOT NULL
		CONSTRAINT [DF_FeeLevel_CreatedDate]  DEFAULT (('2009/1/1')) 
	ALTER TABLE [dbo].[FeeLevel]  ADD [ModifiedDate] datetime NOT NULL
		CONSTRAINT [DF_FeeLevel_ModifiedDate]  DEFAULT (('2009/1/1')) 
	ALTER TABLE [dbo].[FeeLevel]  ADD [DeletedDate] datetime NULL

	ALTER TABLE [dbo].[FeeLevelItem]  ADD [CreatedDate] datetime NOT NULL
		CONSTRAINT [DF_FeeLevelItem_CreatedDate]  DEFAULT (('2009/1/1')) 
	ALTER TABLE [dbo].[FeeLevelItem]  ADD [ModifiedDate] datetime NOT NULL
		CONSTRAINT [DF_FeeLevelItem_ModifiedDate]  DEFAULT (('2009/1/1')) 
	ALTER TABLE [dbo].[FeeLevelItem]  ADD [DeletedDate] datetime NULL

	Insert into #ChangeScript082_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript082_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript082_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 082, 'Design database for Manage Level Fee module'

		print '**************************************************'
		print '*  db.01.00.082: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.082: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript082_stat%')
Begin
	drop table #ChangeScript082_stat
End
go
 
 
/*
 db.01.00.083:
 Does the following:
	TODO: Add primary key

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 083

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript083_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript083_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 083)
begin
	print '**************************************************'
	print '*  db.01.00.083: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript083_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript083_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Add primary key                      *'
	print '***********************************************************************'

	/***************************************************************************
	*                                                                          *
	* TODO: Add SQL script here - you should remove all GO commands            *
	*                                                                          *
	***************************************************************************/

	ALTER TABLE dbo.PriceChartItemReq ADD
		ID uniqueidentifier NOT NULL CONSTRAINT DF_PriceChartItemReq_ID DEFAULT (newid())

	ALTER TABLE dbo.PriceChartItemReq
		DROP CONSTRAINT PK_PriceChartItemReq

	ALTER TABLE dbo.PriceChartItemReq ADD CONSTRAINT
		PK_PriceChartItemReq PRIMARY KEY CLUSTERED 
		(
			ID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]




        Insert into #ChangeScript083_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript083_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript083_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 083, 'TODO: Add primary key'

		print '**************************************************'
		print '*  db.01.00.083: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.083: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript083_stat%')
Begin
	drop table #ChangeScript083_stat
End
go
 
 
/*
 db.01.00.084:
 Does the following:
	DROP AccountPayable, AccountPayableDetails tables
	CREATE AccountPayable, AccountPayableDetail, AccountPayableDetailFee tables
	DROP KitFee, DiscountAmount, DiscountPercent from OrderAssignment table
	RENAME "ReqFee" to "ServiceFee" in OrderAssignmant table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 084

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript084_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript084_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 084)
begin
	print '**************************************************'
	print '*  db.01.00.084: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript084_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript084_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************************'
	print '* DROP AccountPayable, AccountPayableDetails tables								*'
	print '* CREATE AccountPayable, AccountPayableDetail, AccountPayableDetailFee tables	*'
	print '* DROP KitFee, DiscountAmount, DiscountPercent from OrderAssignment table		*'
	print '* RENAME "ReqFee" to "ServiceFee" in OrderAssignmant table						*'
	print '*																				*'
	print '**********************************************************************************'
		IF dbo.SMM_CheckExists(1, 'AccountPayableDetails', '') = 0
			DROP TABLE AccountPayableDetails
		IF dbo.SMM_CheckExists(1, 'AccountPayable', '') = 0
			DROP TABLE AccountPayable

		IF dbo.SMM_CheckExists(1, 'AccountPayable', '') = -1
			CREATE TABLE [dbo].[AccountPayable](
				[ID] [int] IDENTITY(1,1) NOT NULL,
				[CheckNumber] [nvarchar](10) NULL,
				[CheckDate] [datetime] NULL,
				[CreatedDate] [datetime] NOT NULL,
				[ModifiedDate] [datetime] NOT NULL,
				[DeletedDate] [datetime] NULL,
				[ServiceProviderID] [uniqueidentifier] NOT NULL,
				[CreatedBy] [uniqueidentifier] NOT NULL,
				CONSTRAINT [PK_AccountPayable] PRIMARY KEY ([ID] )
			)
		IF dbo.SMM_CheckExists(2, '[FK_AccountPayable_ServiceProvider]', '[AccountPayable]') = -1
			ALTER TABLE [dbo].[AccountPayable]  
			ADD  CONSTRAINT [FK_AccountPayable_ServiceProvider] FOREIGN KEY([ServiceProviderID]) REFERENCES [dbo].[ServiceProvider] ([ID])

		IF dbo.SMM_CheckExists(2, '[FK_AccountPayable_Employee]', '[AccountPayable]') = -1
			ALTER TABLE [dbo].[AccountPayable]  
			ADD  CONSTRAINT [FK_AccountPayable_Employee] FOREIGN KEY(CreatedBy) REFERENCES [dbo].[Employee] ([ID])
		
		IF dbo.SMM_CheckExists(1, '[AccountPayableDetail]', '') = -1
			CREATE TABLE [dbo].[AccountPayableDetail](
				[ID] [uniqueidentifier] NOT NULL,
				[AccountPayableID] [int] NOT NULL,
				[OrderAssignmentID] [uniqueidentifier] NOT NULL,
				[AmountPaid] [money] NOT NULL,
				CONSTRAINT [PK_AccountPayableDetail] PRIMARY KEY ([ID])
			)
		IF dbo.SMM_CheckExists(2, '[FK_AccountPayableDetail_AccountPayable]', '[AccountPayableDetail]') = -1
			ALTER TABLE [dbo].[AccountPayableDetail]  
			ADD  CONSTRAINT [FK_AccountPayableDetail_AccountPayable] FOREIGN KEY([AccountPayableID]) REFERENCES [dbo].[AccountPayable] ([ID])
		IF dbo.SMM_CheckExists(2, '[FK_AccountPayableDetail_OrderAssignment]', '[AccountPayableDetail]') = -1
			ALTER TABLE [dbo].[AccountPayableDetail]  
			ADD  CONSTRAINT [FK_AccountPayableDetail_OrderAssignment] FOREIGN KEY([OrderAssignmentID]) REFERENCES [dbo].[OrderAssignment] ([ID])
		
		IF dbo.SMM_CheckExists(1, '[AccountPayableDetailFee]', '') = -1
			CREATE TABLE [dbo].[AccountPayableDetailFee](
				[ID] [uniqueidentifier] NOT NULL,
				[AccountPayableDetailID] [uniqueidentifier] NOT NULL,
				[OrderAssignmentFeeTypeID] [int] NOT NULL,
				[Amount] [money] NOT NULL,
				[Reason] [nvarchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
				CONSTRAINT [PK_AccountPayableDetailFee] PRIMARY KEY ([ID])
			)
		IF dbo.SMM_CheckExists(2, '[FK_AccountPayableDetailFee_AccountPayableDetail]', '[AccountPayableDetailFee]') = -1
			ALTER TABLE [dbo].[AccountPayableDetailFee]  WITH CHECK ADD  CONSTRAINT [FK_AccountPayableDetailFee_AccountPayableDetail] FOREIGN KEY([AccountPayableDetailID])
			REFERENCES [dbo].[AccountPayableDetail] ([ID])

		IF dbo.SMM_CheckExists(2, '[FK_AccountPayableDetailFee_AccountPayableDetailFee]', '[AccountPayableDetailFee]') = -1
			ALTER TABLE [dbo].[AccountPayableDetailFee]  WITH CHECK ADD  CONSTRAINT [FK_AccountPayableDetailFee_AccountPayableDetailFee] FOREIGN KEY([ID])
			REFERENCES [dbo].[AccountPayableDetailFee] ([ID])

		IF dbo.SMM_CheckExists(2, '[FK_AccountPayableDetailFee_OrderAssignmentFeeType]', '[AccountPayableDetailFee]') = -1
			ALTER TABLE [dbo].[AccountPayableDetailFee]  WITH CHECK ADD  CONSTRAINT [FK_AccountPayableDetailFee_OrderAssignmentFeeType] FOREIGN KEY([OrderAssignmentFeeTypeID])
			REFERENCES [metadata].[OrderAssignmentFeeType] ([ID])

		INSERT INTO metadata.OrderAssignmentFeeType(ID, [Name]) VALUES(3, 'Admin')
		INSERT INTO metadata.OrderAssignmentFeeType(ID, [Name]) VALUES(4, 'Extra Fee')
		INSERT INTO metadata.OrderAssignmentFeeType(ID, [Name]) VALUES(5, 'Kit Fee')
		INSERT INTO metadata.OrderAssignmentFeeType(ID, [Name]) VALUES(6, 'Deduction')

		IF dbo.SMM_CheckExists(6, 'KitFee', 'OrderAssignment') = 0
			ALTER TABLE OrderAssignment
			DROP COLUMN KitFee

		IF dbo.SMM_CheckExists(6, 'DiscountAmount', 'OrderAssignment') = 0
			ALTER TABLE OrderAssignment
			DROP COLUMN DiscountAmount

		IF dbo.SMM_CheckExists(6, 'DiscountPercent', 'OrderAssignment') = 0
			ALTER TABLE OrderAssignment
			DROP COLUMN DiscountPercent

		IF dbo.SMM_CheckExists(6, 'ReqFee', 'OrderAssignment') = 0
			EXECUTE sp_rename N'dbo.OrderAssignment.ReqFee', N'ServiceFee', 'COLUMN' 

	Insert into #ChangeScript084_stat (PatchStatus) Values (1)


    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript084_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript084_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 084, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.084: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.084: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript084_stat%')
Begin
	drop table #ChangeScript084_stat
End
go
 
 
/*
 db.01.00.085:
 Does the following:
	Create ReminderTime Table
	Insert Data to ReminderTime Table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 085

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript085_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript085_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 085)
begin
	print '**************************************************'
	print '*  db.01.00.085: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript085_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript085_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION
	print '**********************************************************************'
	print '* Create ReminderTime Table *'							
	print '**********************************************************************'
	IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[metadata].[ReminderTime]') AND type in (N'U'))
	BEGIN
		/*Add ReminderType*/
		CREATE TABLE [metadata].[ReminderTime](
		[ID] [int] NOT NULL,
		[Capability] [int] NOT NULL,
		CONSTRAINT [PK_ReminderTime] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
	END
	ELSE
		PRINT 'INFO: db.01.00.085 Table ReminderType already exists'
	print '**********************************************************************'
	print '* Insert Data to ReminderTime Table *'							
	print '**********************************************************************'
	
	
	
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(1, 5)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(2, 10)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(3, 15)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(4, 20)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(5, 25)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(6, 30)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(7, 35)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(8, 40)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(9, 45)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(10, 50)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(11, 55)
	insert into [metadata].[ReminderTime]([ID], [Capability]) values(12, 60)
	
	Insert into #ChangeScript085_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript085_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript085_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 085, 'Create ReminderTime table,Insert Data to ReminderTime Table'

		print '**************************************************'
		print '*  db.01.00.085: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.085: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript085_stat%')
Begin
	drop table #ChangeScript085_stat
End
go

 
 
/*
 db.01.00.086:
 Does the following:
	DROP InvoiceDetail table
	ADD InvoiceID into Order table
	ADD AdminAmount, SurchargeAmount and Discount into Invoice table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 086

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript086_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript086_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 086)
begin
	print '**************************************************'
	print '*  db.01.00.086: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript086_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript086_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************************'
	print '* DROP InvoiceDetail table														*'
	print '* ADD InvoiceID into Order table													*'
	print '* ADD AdminAmount, SurchargeAmount and Discount into Invoice table				*'
	print '* 																				*'
	print '**********************************************************************************'
		IF dbo.SMM_CheckExists(1, 'InvoiceDetail', '') = 0
			DROP TABLE InvoiceDetail

		IF dbo.SMM_CheckExists(6, 'InvoiceID', 'Order') = -1
			ALTER TABLE [Order]
			ADD InvoiceID int NULL
		
		IF dbo.SMM_CheckExists(2, '[FK_Order_Invoice]', '[Order]') = -1
			ALTER TABLE [Order]
			ADD CONSTRAINT [FK_Order_Invoice] FOREIGN KEY (InvoiceID) REFERENCES Invoice([ID])

		IF dbo.SMM_CheckExists(6, 'Discount', 'Invoice') = -1
			ALTER TABLE Invoice
			ADD Discount money NOT NULL

		IF dbo.SMM_CheckExists(6, 'AdminAmount', 'Invoice') = -1
			ALTER TABLE Invoice
			ADD AdminAmount money NOT NULL

		IF dbo.SMM_CheckExists(6, 'SuchargeAmount', 'Invoice') = -1
			ALTER TABLE Invoice
			ADD SuchargeAmount money NOT NULL
		
	Insert into #ChangeScript086_stat (PatchStatus) Values (1)


    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript086_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript086_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 086, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.086: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.086: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript086_stat%')
Begin
	drop table #ChangeScript086_stat
End
go
 
 
/*
 db.01.00.087:
 Does the following:
	ADD BillingInformationID into Payment table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 087

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript087_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript087_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 087)
begin
	print '**************************************************'
	print '*  db.01.00.087: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript087_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript087_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************************'
	print '* ADD BillingInformationID into Payment table									*'
	print '* 																				*'
	print '**********************************************************************************'
		IF dbo.SMM_CheckExists(6, 'BillingInformationID', 'Payment') = -1
			ALTER TABLE Payment
			ADD BillingInformationID [uniqueidentifier]
		
		IF dbo.SMM_CheckExists(2, '[FK_Payment_BillingInformation]', 'Payment') = -1
			ALTER TABLE Payment
			ADD CONSTRAINT [FK_Payment_BillingInformation] FOREIGN KEY (BillingInformationID) REFERENCES BillingInformation([ID])
		
	Insert into #ChangeScript087_stat (PatchStatus) Values (1)


    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript087_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript087_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 087, 'Drop OrderApplicantID in ApplicantAddress'

		print '**************************************************'
		print '*  db.01.00.087: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.087: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript087_stat%')
Begin
	drop table #ChangeScript087_stat
End
go
 
 
/*
 db.01.00.088:
 Does the following:
	Add CreatedDate, ModifiedDate and CreatedDate for Service Provider table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 088

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript088_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript088_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 088)
begin
	print '**************************************************'
	print '*  db.01.00.088: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript088_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript088_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add CreatedDate, ModifiedDate and CreatedDate for Service Provider table*'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'CreatedDate', 'ServiceProvider') = -1
		ALTER TABLE dbo.ServiceProvider ADD
		CreatedDate datetime NOT NULL CONSTRAINT [DF_ServiceProvider_CreatedDate]  DEFAULT (getdate())
	IF dbo.SMM_CheckExists(6, 'ModifiedDate', 'ServiceProvider') = -1
		ALTER TABLE dbo.ServiceProvider ADD
		ModifiedDate datetime NOT NULL CONSTRAINT [DF_ServiceProvider_ModifiedDate]  DEFAULT (getdate())
	IF dbo.SMM_CheckExists(6, 'DeletedDate', 'ServiceProvider') = -1
		ALTER TABLE dbo.ServiceProvider ADD
		DeletedDate datetime NULL

        Insert into #ChangeScript088_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript088_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript088_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 088, 'Add CreatedDate, ModifiedDate and CreatedDate for Service Provider table'

		print '**************************************************'
		print '*  db.01.00.088: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.088: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript088_stat%')
Begin
	drop table #ChangeScript088_stat
End
go
 
 
/*
 db.01.00.089:
 Does the following:
	Add CreatedDate, ModifiedDate and CreatedDate for Ordering Party table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 089

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript089_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript089_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 089)
begin
	print '**************************************************'
	print '*  db.01.00.089: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript089_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript089_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add CreatedDate, ModifiedDate and CreatedDate for Ordering Party table*'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'CreatedDate', 'OrderingParty') = -1
		ALTER TABLE dbo.OrderingParty ADD
		CreatedDate datetime NOT NULL CONSTRAINT [DF_OrderingParty_CreatedDate]  DEFAULT (getdate())
	IF dbo.SMM_CheckExists(6, 'ModifiedDate', 'OrderingParty') = -1
		ALTER TABLE dbo.OrderingParty ADD
		ModifiedDate datetime NOT NULL CONSTRAINT [DF_OrderingParty_ModifiedDate]  DEFAULT (getdate())
	IF dbo.SMM_CheckExists(6, 'DeletedDate', 'OrderingParty') = -1
		ALTER TABLE dbo.OrderingParty ADD
		DeletedDate datetime NULL

        Insert into #ChangeScript089_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript089_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript089_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 089, 'Add CreatedDate, ModifiedDate and CreatedDate for Ordering Party table'

		print '**************************************************'
		print '*  db.01.00.089: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.089: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript089_stat%')
Begin
	drop table #ChangeScript089_stat
End
go
 
 
/*
 db.01.00.090:
 Does the following:
	Add CreatedDate, ModifiedDate and CreatedDate for Service Provider Schdule table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 090

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript090_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript090_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 090)
begin
	print '**************************************************'
	print '*  db.01.00.090: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript090_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript090_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add CreatedDate, ModifiedDate and CreatedDate for Service Provider Schedule table*'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'CreatedDate', 'ServiceProviderSchedule') = -1
		ALTER TABLE dbo.ServiceProviderSchedule ADD
		CreatedDate datetime NOT NULL CONSTRAINT [DF_ServiceProviderSchedule_CreatedDate]  DEFAULT (getdate())
	IF dbo.SMM_CheckExists(6, 'ModifiedDate', 'ServiceProviderSchedule') = -1
		ALTER TABLE dbo.ServiceProviderSchedule ADD
		ModifiedDate datetime NOT NULL CONSTRAINT [DF_ServiceProviderSchedule_ModifiedDate]  DEFAULT (getdate())
	IF dbo.SMM_CheckExists(6, 'DeletedDate', 'ServiceProviderSchedule') = -1
		ALTER TABLE dbo.ServiceProviderSchedule ADD
		DeletedDate datetime NULL

        Insert into #ChangeScript090_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript090_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript090_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 090, 'Add CreatedDate, ModifiedDate and CreatedDate for Service Provider Schedule table'

		print '**************************************************'
		print '*  db.01.00.090: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.090: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript090_stat%')
Begin
	drop table #ChangeScript090_stat
End
go
 
 
/*
 db.01.00.091:
 Does the following tasks:
 - Table Item: Add column BatchID, CreatedDate, ModifiedDate , DeletedDate 
 - Table ItemBatch: Replace ItemID by BatchCode
 - Table PurchaseOrder: Add column IsDropShip (bit) & SaleOrderID; Add relationship to SaleOder Table 

Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 091
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript091_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript091_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 091)
begin
	print '**************************************************'
	print '*  db.01.00.091: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript091_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript091_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**************************************************************************************************************'
	print '* Table Item: Add CreatedDate, ModifiedDate, CreatedDate, BatchID columns and relationship to ItemBatch table*'
	print '**************************************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'BatchID', 'Item') = -1
		ALTER TABLE [dbo].[Item]
		ADD BatchID [uniqueidentifier] NOT NULL
		
	IF dbo.SMM_CheckExists(6, 'CreatedDate', 'Item') = -1
		ALTER TABLE [dbo].[Item] 
		ADD CreatedDate datetime NOT NULL 
		CONSTRAINT [DF_Item_CreatedDate]  DEFAULT (getdate())

	IF dbo.SMM_CheckExists(6, 'ModifiedDate', 'Item') = -1
		ALTER TABLE [dbo].[Item] 
		ADD ModifiedDate datetime NOT NULL 
		CONSTRAINT [DF_Item_ModifiedDate]  DEFAULT (getdate())

	IF dbo.SMM_CheckExists(6, 'DeletedDate', 'Item') = -1
		ALTER TABLE [dbo].[Item]
		ADD DeletedDate datetime NULL
	
	IF dbo.SMM_CheckExists(2, 'FK_Item_ItemBatch', 'Item') = -1
		ALTER TABLE [dbo].[Item]  
		WITH CHECK ADD CONSTRAINT [FK_Item_ItemBatch] 
		FOREIGN KEY([BatchID])
		REFERENCES [dbo].[ItemBatch] ([ID])		

	print '**********************************************************************'
	print '* Table ItemBatch: Drop ItemID and add BatchCode columns				*'
	print '**********************************************************************'

	IF dbo.SMM_CheckExists(2, 'FK_ItemBatch_Item', 'ItemBatch') = 0
		ALTER TABLE [dbo].[ItemBatch]  
		DROP CONSTRAINT [FK_ItemBatch_Item]

	IF dbo.SMM_CheckExists(6, 'ItemID', 'ItemBatch') = 0
		ALTER TABLE [dbo].[ItemBatch]
		DROP COLUMN ItemID
	
	IF dbo.SMM_CheckExists(6, 'BatchCode', 'ItemBatch') = -1
		ALTER TABLE [dbo].[ItemBatch]
		ADD BatchCode int IDENTITY(1,1) NOT NULL
	        
	print '**********************************************************************************************'
	print '* Table PurchaseOrder: Add column IsDropShip & SaleOrderID and relationship to SaleOder Table*'
	print '**********************************************************************************************'
    
	IF dbo.SMM_CheckExists(6, 'IsDropShip', 'PurchaseOrder') = -1
		ALTER TABLE [dbo].[PurchaseOrder]
		ADD [IsDropShip] [bit] NULL 
		CONSTRAINT [DF_PurchaseOrder_IsDropShip]  DEFAULT ((0))	
	
	IF dbo.SMM_CheckExists(6, 'SaleOrderID', 'PurchaseOrder') = -1
		ALTER TABLE [dbo].[PurchaseOrder]
		ADD [SaleOrderID] [uniqueidentifier] NULL

	IF dbo.SMM_CheckExists(2, 'FK_PurchaseOrder_SaleOrder', 'PurchaseOrder') = -1
		ALTER TABLE [dbo].[PurchaseOrder]  
		WITH CHECK ADD CONSTRAINT [FK_PurchaseOrder_SaleOrder] 
		FOREIGN KEY([SaleOrderID])
		REFERENCES [dbo].[SaleOrder] ([ID])		
		
	Insert into #ChangeScript091_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript091_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript091_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 091, 'Add CreatedDate, ModifiedDate and CreatedDate for Service Provider table'

		print '**************************************************'
		print '*  db.01.00.091: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.091: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript091_stat%')
Begin
	drop table #ChangeScript091_stat
End
go
 
 
/*
 db.01.00.092:
 Does the following tasks:
 - Table OfficeNoteCategory: Delete this table
 - Table OfficeNoteGroupNotified: Add Primary Key

Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 092
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript092_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript092_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 092)
begin
	print '**************************************************'
	print '*  db.01.00.092: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript092_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript092_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**************************************************************************************************************'
	print '*Delete table OfficeNoteCategory - Add Primary Key into OfficeNoteGroupNotified table  *'
	print '**************************************************************************************************************'

	ALTER TABLE [dbo].[OfficeNote] DROP CONSTRAINT FK_OfficeNote_OfficeNoteCategory
    ALTER TABLE [dbo].[OfficeNote] DROP COLUMN [OfficeNoteCategoryID]
    DROP TABLE [dbo].[OfficeNoteCategory]

    ALTER TABLE dbo.OfficeNoteGroupNotified ADD ID [uniqueidentifier] NOT NULL
    ALTER TABLE dbo.OfficeNoteGroupNotified ADD CONSTRAINT
        PK_OfficeNoteGroupNotified PRIMARY KEY CLUSTERED 
        (
        ID
        ) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]


    ALTER TABLE dbo.OfficeNoteGroupNotified ADD CONSTRAINT
        FK_OfficeNoteGroupNotified_OfficeNote FOREIGN KEY
        (
        OfficeNoteID
        ) REFERENCES dbo.OfficeNote
        (
        ID
        ) ON UPDATE  NO ACTION 
         ON DELETE  NO ACTION 

    ALTER TABLE dbo.OfficeNoteGroupNotified ADD CONSTRAINT
        FK_OfficeNoteGroupNotified_Department FOREIGN KEY
        (
        EmployeeGroupID
        ) REFERENCES dbo.Department
        (
        ID
        ) ON UPDATE  NO ACTION 
         ON DELETE  NO ACTION 

		
	Insert into #ChangeScript092_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript092_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript092_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 092, 'Add CreatedDate, ModifiedDate and CreatedDate for Service Provider table'

		print '**************************************************'
		print '*  db.01.00.092: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.092: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript092_stat%')
Begin
	drop table #ChangeScript092_stat
End
go
 
 
/*
 db.01.00.093:
 Does the following tasks:
 - Insert data into metadata table ObjectType


Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 093
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript093_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript093_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 093)
begin
	print '**************************************************'
	print '*  db.01.00.093: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript093_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript093_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**************************************************************************************************************'
	print '* Insert data into metadata table ObjectType  *'
	print '**************************************************************************************************************'

	insert into [metadata].[ObjectType]([ID], [Name]) values(0, 'Unknown')	
	insert into [metadata].[ObjectType]([ID], [Name]) values(1, 'Insurance')
	insert into [metadata].[ObjectType]([ID], [Name]) values(2, 'ServiceProvider')
	insert into [metadata].[ObjectType]([ID], [Name]) values(3, 'OrderingParty')
	insert into [metadata].[ObjectType]([ID], [Name]) values(4, 'Order')
	insert into [metadata].[ObjectType]([ID], [Name]) values(5, 'BillingCompany')
	insert into [metadata].[ObjectType]([ID], [Name]) values(6, 'Employee')
	insert into [metadata].[ObjectType]([ID], [Name]) values(7, 'Partner')
	insert into [metadata].[ObjectType]([ID], [Name]) values(8, 'Payment')
		
	Insert into #ChangeScript093_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript093_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript093_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 093, 'Insert data into metadata table ObjectType'

		print '**************************************************'
		print '*  db.01.00.093: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.093: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript093_stat%')
Begin
	drop table #ChangeScript093_stat
End
go
 
 
/****** Object:  View [dbo].[RandomUniqueidentifierID]    Script Date: 05/21/2009 09:49:38 ******/
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_RandomUniqueIdentifierID]'))
DROP VIEW [dbo].[vw_RandomUniqueIdentifierID]

GO
/****** Object:  View [dbo].[vw_RandomUniqueIdentifierID]    Script Date: 05/21/2009 09:49:53 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE VIEW [dbo].[vw_RandomUniqueIdentifierID]
AS
SELECT NEWID() As ID

GO
 
 
/*
 db.01.00.094:
 Does the following tasks:
 - Insert ID field in table GeoSurcharge


Note: This script is required to run on blank database or at least GeoSurcharge Table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 094
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript094_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript094_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 094)
begin
	print '**************************************************'
	print '*  db.01.00.094: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript094_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript094_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**************************************************************************************************************'
	print '* Insert ID field in table GeoSurcharge  *'
	print '**************************************************************************************************************'

	CREATE TABLE dbo.Tmp_GeoSurcharge
	(
	ID uniqueidentifier NOT NULL DEFAULT newid(),
	BillingInfoID uniqueidentifier NOT NULL,
	StateID int NOT NULL,
	Price money NOT NULL,
	CreatedDate datetime NOT NULL,
	ModifiedDate datetime NOT NULL,
	DeletedDate datetime NULL
	)  ON [PRIMARY]

	ALTER TABLE dbo.GeoSurcharge
		DROP CONSTRAINT FK_GeoSurcharge_GeoSurcharge

	DROP TABLE dbo.GeoSurcharge

	EXECUTE sp_rename N'dbo.Tmp_GeoSurcharge', N'GeoSurcharge', 'OBJECT' 

	ALTER TABLE dbo.GeoSurcharge ADD CONSTRAINT
	PK_GeoSurcharge PRIMARY KEY CLUSTERED 
	(
	ID
	) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]


	ALTER TABLE dbo.GeoSurcharge ADD CONSTRAINT
	FK_GeoSurcharge_BillingInformation FOREIGN KEY
	(
	BillingInfoID
	) REFERENCES dbo.BillingInformation
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	

	ALTER TABLE dbo.GeoSurcharge ADD CONSTRAINT
	FK_GeoSurcharge_State FOREIGN KEY
	(
	StateID
	) REFERENCES metadata.State
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
		
	Insert into #ChangeScript094_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript094_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript094_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 094, 'Insert ID field in table GeoSurcharge'

		print '**************************************************'
		print '*  db.01.00.094: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.094: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript094_stat%')
Begin
	drop table #ChangeScript094_stat
End
go
 
 
/****** Object:  UserDefinedFunction [dbo].[GetAgencyByCreatedAndOPUser]    Script Date: 05/22/2009 09:14:28 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetAgencyByCreatedAndOPUser]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
DROP FUNCTION [dbo].[GetAgencyByCreatedAndOPUser]

GO
/****** Object:  UserDefinedFunction [dbo].[GetAgencyByCreatedAndOPUser]    Script Date: 05/22/2009 20:11:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create function [dbo].[GetAgencyByCreatedAndOPUser]
(
 @InsuranceID uniqueidentifier,
 @OPUserID uniqueidentifier,
 @fullName nvarchar(250),
 @includeInactive bit
)
returns table
as
return
(
	SELECT ISNULL(ai.ID, (SELECT ID FROM [vw_RandomUniqueIdentifierID])) as ID, 
	al.AgencyID, ai.InsuranceID, ISNULL(ai.AgencyCode,'') as AgencyCode, 
	ai.AllowMailingOverwrite  
	FROM agencyfavouritelist al
	JOIN agency a
	ON al.agencyid=a.id
	LEFT JOIN Agencyinsurance ai
	ON al.agencyid=ai.agencyid
	AND ai.insuranceid=@InsuranceID
	WHERE al.orderingpartyuserid=@OPUserID
	AND a.fullname LIKE '%'+@fullName+'%'
	AND (1=@includeInactive or a.Inactive=0)
)

GO
 
 
/****** Object:  UserDefinedFunction [dbo].[GetAgentByCreatedAndOPUser]    Script Date: 05/22/2009 09:15:17 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetAgentByCreatedAndOPUser]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
DROP FUNCTION [dbo].[GetAgentByCreatedAndOPUser]

GO
/****** Object:  UserDefinedFunction [dbo].[GetAgentByCreatedAndOPUser]    Script Date: 05/22/2009 20:09:19 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE function [dbo].[GetAgentByCreatedAndOPUser]
(
 @InsuranceID uniqueidentifier,
 @OPUserID uniqueidentifier,
 @fullName nvarchar(250),
 @includeInactive bit
)
returns table
as
return
(
	SELECT ISNULL(ai.ID, (SELECT ID FROM [vw_RandomUniqueIdentifierID])) as ID, 
	al.AgentID, ai.InsuranceID, ISNULL(ai.AgentCode,'') as AgentCode 
	FROM Agentfavouritelist al
	JOIN Agent a
	ON al.Agentid=a.id
	LEFT JOIN Agentinsurance ai
	ON al.Agentid=ai.Agentid
	AND ai.insuranceid=@InsuranceID
	WHERE al.orderingpartyuserid=@OPUserID
	AND a.fullname LIKE '%'+@fullName+'%'
	AND (1=@includeInactive OR a.Inactive=0)
)

GO

GO 
 
/*
 db.01.00.096:
 Does the following tasks:
 - Insert Insert data for table Lab


Note: This script is required to run on blank database or at least GeoSurcharge Table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 096
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript096_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript096_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 096)
begin
	print '**************************************************'
	print '*  db.01.00.096: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript096_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript096_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '****************************************************************************************************'
	print '* Insert Insert data for table Lab  *'
	print '****************************************************************************************************'

	INSERT [dbo].[lab] ([ID],[Name])VALUES('7876919E-7A24-4622-B029-800312F7999D','LabOne')
	INSERT [dbo].[lab] ([ID],[Name])VALUES('A8769B0F-8F27-4192-8CB4-B88D77661C4C','CRL')
	INSERT [dbo].[lab] ([ID],[Name])VALUES('2A433667-FACE-44DD-B317-EA68493185F2','Heritage')

		
	Insert into #ChangeScript096_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript096_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript096_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 096, 'Insert Insert data for table Lab'

		print '**************************************************'
		print '*  db.01.00.096: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.096: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript096_stat%')
Begin
	drop table #ChangeScript096_stat
End
go
 
 
/*
 db.01.00.098:
 Does the following:
 - Create ErrorLogID in PartyRating Table 

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript098_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript098_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 098)
begin
	print '**************************************************'
	print '*  db.01.00.098: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript098_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript098_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Create ErrorLogID in PartyRating Table *'
	print '***********************************************************************'

		ALTER TABLE dbo.PartyRating ADD ErrorLogID [uniqueidentifier] NULL  
		ALTER TABLE dbo.PartyRating ADD CONSTRAINT FK_PartyRating_ErrorLog FOREIGN KEY 
			(ErrorLogID) REFERENCES dbo.ErrorLog(ID)

        Insert into #ChangeScript098_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript098_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript098_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 098, '- Update allow Null for AccountNumber,RoutingNumber,ReferenceNumber,CreditCardNumber in Payment'

		print '**************************************************'
		print '*  db.01.00.098: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.098: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript098_stat%')
Begin
	drop table #ChangeScript098_stat
End
go
 
 
/*
 db.01.00.099:
 Does the following tasks:
 - Table Item: Add ExpiredDate column, Replace change column ItemType fro Guid to int (including the update for its constrain) 
 - Table MedicalItemType: Add CreatedDate, ModifiedDate & DeletedDate columns
 - Table ItemBatch: Drop ExpiredDate & ReceivedDate columns
 - Table ItemType: Drop dbo.ItemType table and create metadata.ItemType table 
 - Table SaleOrder: change SupplyOrderID to allow null

Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 099
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript099_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript099_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 099)
begin
	print '**************************************************'
	print '*  db.01.00.099: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript099_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript099_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************************************************'
	print '* Table Item: Add ExpiredDate column, Replace change column ItemType fro Guid to int (including the update for its constrain)*'
	print '******************************************************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'ExpiredDate', 'Item') = -1
		ALTER TABLE [dbo].[Item]
		ADD ExpiredDate datetime NULL 
		CONSTRAINT [DF_Item_ExpiredDate]  DEFAULT (getdate())

	IF dbo.SMM_CheckExists(2, 'FK_Item_ItemType', 'Item') = 0
		ALTER TABLE [dbo].[Item]  
		DROP CONSTRAINT [FK_Item_ItemType]	

	IF dbo.SMM_CheckExists(6, 'ItemTypeID', 'Item') = 0
		ALTER TABLE [dbo].[Item]
		DROP COLUMN ItemTypeID

	IF dbo.SMM_CheckExists(6, 'ItemTypeID', 'Item') = -1
		ALTER TABLE [dbo].[Item]
		ADD ItemTypeID int NULL	


	print '*****************************************************************************'
	print '* Table MedicalItemType: Add CreatedDate, ModifiedDate & DeletedDate columns*'
	print '*****************************************************************************'

	IF dbo.SMM_CheckExists(6, 'CreatedDate', 'MedicalItemType') = -1
		ALTER TABLE [dbo].[MedicalItemType] 
		ADD CreatedDate datetime NOT NULL 
		CONSTRAINT [DF_MedicalItemType_CreatedDate]  DEFAULT (getdate())

	IF dbo.SMM_CheckExists(6, 'ModifiedDate', 'MedicalItemType') = -1
		ALTER TABLE [dbo].[MedicalItemType] 
		ADD ModifiedDate datetime NOT NULL 
		CONSTRAINT [DF_MedicalItemType_ModifiedDate]  DEFAULT (getdate())

	IF dbo.SMM_CheckExists(6, 'DeletedDate', 'MedicalItemType') = -1
		ALTER TABLE [dbo].[MedicalItemType]
		ADD DeletedDate datetime NULL
	
	print '***********************************************************'
	print '* Table ItemBatch: Drop ExpiredDate & ReceivedDate columns*'
	print '***********************************************************'

	IF dbo.SMM_CheckExists(6, 'ExpiredDate', 'ItemBatch') = 0
		ALTER TABLE [dbo].[ItemBatch]
		DROP COLUMN ExpiredDate

	IF dbo.SMM_CheckExists(6, 'ReceivedDate', 'ItemBatch') = 0
		ALTER TABLE [dbo].[ItemBatch]
		DROP COLUMN ReceivedDate
	
	print '***********************************************************'
	print '* Table SaleOrder: change SupplyOrderID to allow null     *'
	print '***********************************************************'
	
	IF dbo.SMM_CheckExists(6, 'SupplyOrderID', 'SaleOrder') = 0
		ALTER TABLE [dbo].[SaleOrder]
		ALTER COLUMN SupplyOrderID uniqueidentifier NULL
        
	print '*****************************************************************************'
	print '* Table ItemType: Drop dbo.ItemType table and create metadata.ItemType table*'
	print '*****************************************************************************'
	
	IF dbo.SMM_CheckExists(1, 'ItemType', '') = 0
	DROP TABLE ItemType

	IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[metadata].[ItemType]') AND type in (N'U'))
	BEGIN
		CREATE TABLE [metadata].[ItemType]
		(
			[ID] [int] NOT NULL,
			[Name] [nvarchar](50) NOT NULL,
			CONSTRAINT [PK_ItemType] 
			PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			)
			WITH 
			(
				PAD_INDEX  = OFF, 
				IGNORE_DUP_KEY = OFF
			) ON [PRIMARY]
		) ON [PRIMARY]
	  END

	INSERT INTO [metadata].[ItemType] ([ID],[Name])VALUES(1,'Medical-Item')
	INSERT INTO [metadata].[ItemType] ([ID],[Name])VALUES(2,'Others')			
	
	print '*********************************'
	print '* Table Item: Add the constrain *'
	print '*********************************'

	IF dbo.SMM_CheckExists(2, 'FK_Item_ItemType', 'Item') = -1
		ALTER TABLE [dbo].[Item]  
		WITH CHECK ADD CONSTRAINT [FK_Item_ItemType] 
		FOREIGN KEY([ItemTypeID])
		REFERENCES [metadata].[ItemType] ([ID])	

	Insert into #ChangeScript099_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript099_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript099_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 099, 'Item (Add ExpiredDate, Replace ItemType from Guid to int), ItemBatch(Drop ExpiredDate & ReceivedDate),ItemType: change to metadata'

		print '**************************************************'
		print '*  db.01.00.099: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.099: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript099_stat%')
Begin
	drop table #ChangeScript099_stat
End
go
 
 
/*
 db.01.00.100:
 Does the following:
	- Add AmountPaid into InvoicePaymentDetail table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 100

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript100_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript100_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 100)
begin
	print '**************************************************'
	print '*  db.01.00.100: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript100_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript100_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	ALTER TABLE InvoicePaymentDetail ADD AmountPaid money not null


        Insert into #ChangeScript100_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript100_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript100_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 100, '- Add AmountPaid into InvoicePaymentDetail table'

		print '**************************************************'
		print '*  db.01.00.100: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.100: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript100_stat%')
Begin
	drop table #ChangeScript100_stat
End
go
 
 
/*
 db.01.00.101:
 Does the following:
	Create PartyQuestionAnswer table
	Create QuestionAnswerThread table
*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript101_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript101_stat

if exists (select * from metadata.Version where Release = 1.0 and Build = 101)
begin
	print '**************************************************'
	print '*  db.01.00.101: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript101_stat (PatchStatus) Values (-1)
end

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript101_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Create PartyQuestionAnswer table *'    
	print '***********************************************************************'

	CREATE TABLE dbo.PartyQuestionAnswer
	(
	ID uniqueidentifier NOT NULL,
	PartyID uniqueidentifier NOT NULL,
	OrderID int NOT NULL,
	CreatedDate datetime NOT NULL,
	CreatedBy  uniqueidentifier NOT NULL
	)  ON [PRIMARY]

	ALTER TABLE dbo.PartyQuestionAnswer ADD CONSTRAINT
	PK_PartyQuestionAnswer PRIMARY KEY CLUSTERED 
	(
	ID
	) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

	ALTER TABLE dbo.PartyQuestionAnswer ADD CONSTRAINT
	FK_PartyQuestionAnswer_Party FOREIGN KEY
	(
	PartyID
	) REFERENCES dbo.Party
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION

	ALTER TABLE dbo.PartyQuestionAnswer ADD CONSTRAINT
	FK_PartyQuestionAnswer_Order FOREIGN KEY
	(
	OrderID
	) REFERENCES dbo.[Order]
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	 
	print '***********************************************************************'
	print '* Create QuestionAnswerThread table *'    
	print '***********************************************************************'
	
	CREATE TABLE dbo.QuestionAnswerThread
	(
	ID uniqueidentifier NOT NULL,
	PartyQuestionAnswerID uniqueidentifier NOT NULL,
	MainContentQA nvarchar(500) NOT NULL,
	CreatedDate datetime NOT NULL,
	CreatedBy  uniqueidentifier NOT NULL
	)  ON [PRIMARY]

	ALTER TABLE dbo.QuestionAnswerThread ADD CONSTRAINT
	PK_QuestionAnswerThread PRIMARY KEY CLUSTERED 
	(
	ID
	) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

	ALTER TABLE dbo.QuestionAnswerThread ADD CONSTRAINT
	FK_QuestionAnswerThread_PartyQuestionAnswer FOREIGN KEY
	(
	PartyQuestionAnswerID
	) REFERENCES dbo.PartyQuestionAnswer
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION

    Insert into #ChangeScript101_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End

/*  End of the script  */

/*  No more scripts allowed */

If not exists (select 'x' from #ChangeScript101_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript101_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 101, 'Create PartyQuestionAnswer table'

		print '**************************************************'
		print '*  db.01.00.101: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.101: NOT completed successfully      *'
		print '**************************************************'
	end
End


If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript101_stat%')
Begin
	drop table #ChangeScript101_stat
End

 
 
/*
 db.01.00.102:
 Does the following:
	add field InsuranceLocationID

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 102

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript102_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript102_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 102)
begin
	print '**************************************************'
	print '*  db.01.00.102: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript102_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript102_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add field InsuranceLocationID                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.[Order] ADD
		InsuranceLocationID uniqueidentifier NULL
	
	ALTER TABLE dbo.[Order] ADD CONSTRAINT
		FK_Order_InsuranceLocation FOREIGN KEY
		(
			InsuranceLocationID
		) REFERENCES dbo.InsuranceLocation
		(
			ID
		) ON UPDATE  NO ACTION 
		ON DELETE  SET NULL 

        Insert into #ChangeScript102_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript102_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript102_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 102, 'add field InsuranceLocationID'

		print '**************************************************'
		print '*  db.01.00.102: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.102: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript102_stat%')
Begin
	drop table #ChangeScript102_stat
End
go
 
 
/*
 db.01.00.103:
 Does the following:
    add NotifiedToSupervisor column into OfficeNote table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 103

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript103_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript103_stat

if exists (select * from metadata.Version where Release = 1.0 and Build = 103)
begin
	print '**************************************************'
	print '*  db.01.00.103: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript103_stat (PatchStatus) Values (-1)
end

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript103_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add NotifiedToSupervisor column into OfficeNote table *'
	print '***********************************************************************'
	
	UPDATE dbo.OfficeNote SET CreatedDate = getDate() WHERE CreatedDate is NULL
	ALTER TABLE dbo.OfficeNote ALTER COLUMN CreatedDate datetime NOT NULL    
	ALTER TABLE dbo.OfficeNote ADD CONSTRAINT [DF_OfficeNote_CreatedDate]  DEFAULT (getdate()) FOR CreatedDate 
	ALTER TABLE dbo.OfficeNote ADD	NotifiedToSupervisor bit NOT NULL default 'false'

    Insert into #ChangeScript103_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript103_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript103_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 103, 'add NotifiedToSupervisor column into OfficeNote table'

		print '**************************************************'
		print '*  db.01.00.103: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.103: NOT completed successfully      *'
		print '**************************************************'
	end
End

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript103_stat%')
Begin
	drop table #ChangeScript103_stat
End
 
 
/*
 db.01.00.104:
 Does the following:
	create metadata.OrderRelationship

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 104

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript104_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript104_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 104)
begin
	print '**************************************************'
	print '*  db.01.00.104: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript104_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript104_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* create metadata.OrderRelationship                            *'
	print '***********************************************************************'

	CREATE TABLE [metadata].[OrderRelationship](
		[ID] [int] NOT NULL,
		[Name] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	 CONSTRAINT [PK_OrderRelationship] PRIMARY KEY CLUSTERED 
	(
		[ID] ASC
	) WITH (PAD_INDEX  = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	) ON [PRIMARY]

        Insert into #ChangeScript104_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript104_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript104_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 104, 'create metadata.OrderRelationship'

		print '**************************************************'
		print '*  db.01.00.104: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.104: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript104_stat%')
Begin
	drop table #ChangeScript104_stat
End
go
 
 
/*
 db.01.00.105:
 Does the following:
	insert matadata for orderRelationship

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 105

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript105_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript105_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 105)
begin
	print '**************************************************'
	print '*  db.01.00.105: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript105_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript105_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* insert matadata for orderRelationship                            *'
	print '***********************************************************************'

INSERT [metadata].[OrderRelationship] ([ID],[Name])VALUES(1,'Other')
INSERT [metadata].[OrderRelationship] ([ID],[Name])VALUES(2,'Husband and wife')
INSERT [metadata].[OrderRelationship] ([ID],[Name])VALUES(3,'Family member')
INSERT [metadata].[OrderRelationship] ([ID],[Name])VALUES(4,'Multiple policy')

        Insert into #ChangeScript105_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript105_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript105_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 105, 'insert matadata for orderRelationship'

		print '**************************************************'
		print '*  db.01.00.105: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.105: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript105_stat%')
Begin
	drop table #ChangeScript105_stat
End
go
 
 
/*
 db.01.00.106:
 Does the following:
	add orderRelationship to incompleteorder

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 106

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript106_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript106_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 106)
begin
	print '**************************************************'
	print '*  db.01.00.106: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript106_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript106_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add orderRelationship to incompleteorder                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.IncompleteOrder ADD
		OrderRelationshipID int NULL,
		OrderRelationshipOther nvarchar(50) NULL

	ALTER TABLE dbo.IncompleteOrder ADD CONSTRAINT
		FK_IncompleteOrder_OrderRelationship FOREIGN KEY
		(
		OrderRelationshipID
		) REFERENCES metadata.OrderRelationship
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  SET NULL 

        Insert into #ChangeScript106_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript106_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript106_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 106, 'add orderRelationship to incompleteorder'

		print '**************************************************'
		print '*  db.01.00.106: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.106: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript106_stat%')
Begin
	drop table #ChangeScript106_stat
End
go
 
 
/*
 db.01.00.107:
 Does the following tasks:
 - Table PurchaseOrder: Drop column IsDropShip
 - Table SaleOrder: Add column IsDropShip

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 107
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript107_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript107_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 107)
begin
	print '**************************************************'
	print '*  db.01.00.107: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript107_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript107_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************'
	print '* Table PurchaseOrder: Drop column IsDropShip*'
	print '* Table SaleOrder: Add column IsDropShip		*'
	print '**********************************************'

	IF dbo.SMM_CheckExists(4, 'DF_PurchaseOrder_IsDropShip', 'PurchaseOrder') = 0
		ALTER TABLE [dbo].[PurchaseOrder]  
		DROP CONSTRAINT [DF_PurchaseOrder_IsDropShip]	

	IF dbo.SMM_CheckExists(6, 'IsDropShip', 'PurchaseOrder') = 0
		ALTER TABLE [dbo].[PurchaseOrder]  
		DROP COLUMN IsDropShip	

	IF dbo.SMM_CheckExists(6, 'IsDropShip', 'SaleOrder') = -1
		ALTER TABLE [dbo].[SaleOrder]
		ADD IsDropShip bit NOT NULL
		CONSTRAINT [DF_SaleOrder_IsDropShip] DEFAULT 0

	Insert into #ChangeScript107_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript107_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript107_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 107, 'PurchaseOrder (Drop column IsDropShip), SaleOrder (Add column IsDropShip)'

		print '**************************************************'
		print '*  db.01.00.107: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.107: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript107_stat%')
Begin
	drop table #ChangeScript107_stat
End
go
 
 
/*
 db.01.00.108:
 Does the following:
	add OrderRelationshipID to OrderRelative

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 108

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript108_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript108_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 108)
begin
	print '**************************************************'
	print '*  db.01.00.108: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript108_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript108_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add OrderRelationshipID to OrderRelative                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.OrderRelative
		DROP CONSTRAINT FK_OrderRelative_Order

	ALTER TABLE dbo.OrderRelative
		DROP CONSTRAINT FK_OrderRelative_Order1

	ALTER TABLE dbo.OrderRelative
		DROP CONSTRAINT DF_OrderRelative_ID

	CREATE TABLE dbo.Tmp_OrderRelative
		(
		OrderID int NOT NULL,
		OrderRelativeID int NOT NULL,
		RelationType nvarchar(50) NULL,
		Notes nvarchar(250) NULL,
		ID uniqueidentifier NOT NULL ROWGUIDCOL,
		OrderRelationshipID int NOT NULL
		)  ON [PRIMARY]

	ALTER TABLE dbo.Tmp_OrderRelative ADD CONSTRAINT
		DF_OrderRelative_ID DEFAULT (newid()) FOR ID

	IF EXISTS(SELECT * FROM dbo.OrderRelative)
		 EXEC('INSERT INTO dbo.Tmp_OrderRelative (OrderID, OrderRelativeID, RelationType, Notes, ID)
			SELECT OrderID, OrderRelativeID, RelationType, Notes, ID FROM dbo.OrderRelative WITH (HOLDLOCK TABLOCKX)')
	DROP TABLE dbo.OrderRelative

	EXECUTE sp_rename N'dbo.Tmp_OrderRelative', N'OrderRelative', 'OBJECT' 

	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT
		PK_OrderRelative PRIMARY KEY CLUSTERED 
		(
		ID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]


	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT
		IX_OrderRelative UNIQUE NONCLUSTERED 
		(
		OrderID,
		OrderRelativeID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]


	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT
		FK_OrderRelative_Order FOREIGN KEY
		(
		OrderID
		) REFERENCES dbo.[Order]
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
		

	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT
		FK_OrderRelative_Order1 FOREIGN KEY
		(
		OrderRelativeID
		) REFERENCES dbo.[Order]
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
		

	ALTER TABLE dbo.OrderRelative ADD CONSTRAINT
		FK_OrderRelative_OrderRelationship FOREIGN KEY
		(
		OrderRelationshipID
		) REFERENCES metadata.OrderRelationship
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  CASCADE 

        Insert into #ChangeScript108_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript108_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript108_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 108, 'add OrderRelationshipID to OrderRelative'

		print '**************************************************'
		print '*  db.01.00.108: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.108: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript108_stat%')
Begin
	drop table #ChangeScript108_stat
End
go
 
 
/*
 db.01.00.109:
 Does the following:
	+ Rename table PartyQuestionAnswer to DiscussionThread
	+ Rename table QuestionAnswerThread to DiscussionPost
	+ Rename column PartyQuestionAnswerID to DiscussionThreadID in DiscussionPost table
	
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 109

*/

set nocount on

-- create temporary status table
select PatchStatus = convert(int,0)
 into #ChangeScript109_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 109)
begin
	print '**************************************************'
	print '*  db.01.00.109: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript109_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript109_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************'
	print 'Rename table PartyQuestionAnswer to DiscussionThread'
	print 'Rename table QuestionAnswerThread to DiscussionPost'
	print '******************************************************'

	exec sp_rename 'PartyQuestionAnswer','DiscussionThread','OBJECT'
	exec sp_rename 'QuestionAnswerThread','DiscussionPost','OBJECT'
	
	print '*********************************************************************************'
	print 'Rename column PartyQuestionAnswerID to DiscussionThreadID in DiscussionPost table' 
	print '*********************************************************************************'
	
	EXECUTE sp_rename N'dbo.[DiscussionPost].PartyQuestionAnswerID', N'DiscussionThreadID', 'COLUMN' 

    Insert into #ChangeScript109_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

	
End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript109_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript109_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 109, 'table PartyQuestionAnswer to DiscussionThread, QuestionAnswerThread to DiscussionPost,
						column PartyQuestionAnswerID to DiscussionThreadID in DiscussionPost table'

		print '**************************************************'
		print '*  db.01.00.109: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.109: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript109_stat%')
Begin
	drop table #ChangeScript109_stat
End
go
 
 
/*
 db.01.00.110:
 Does the following:
	Add PostedDate for Payment

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 110

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript110_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript110_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 110)
begin
	print '**************************************************'
	print '*  db.01.00.110: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript110_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript110_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add PostedDate for Payment                           *'
	print '***********************************************************************'

		ALTER TABLE Payment ADD PostedDate datetime null

        Insert into #ChangeScript110_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript110_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript110_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 110, 'Add PostedDate for Payment'

		print '**************************************************'
		print '*  db.01.00.110: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.110: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript110_stat%')
Begin
	drop table #ChangeScript110_stat
End
go
 
 
/*
 db.01.00.111:
 Does the following tasks:
 - Add Default Organization
 - Add Address,Phone,Email for Default Organization

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 111
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript111_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript111_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 111)
begin
	print '**************************************************'
	print '*  db.01.00.111: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript111_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript111_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************'
	print '* Add Default Organization*'
	print '*  Add Address,Phone,Email for Default Organization*'
	print '**********************************************'

	IF dbo.SMM_CheckExists(1, 'Organization', '') = 0
	BEGIN
		insert into Party 
		(	
			ID,
			FullName,
			PartyTypeID,
			GovID,
			GovIDTypeID,
			PartnerAdminSystem,
			ServiceSinceDate,
			Inactive,
			ResidenceZip,
			CreatedDate,
			ModifiedDate,
			DeletedDate
		)values
		(
			'3E0F8350-C6F0-46E5-8469-9B372AACC91E',
			'SUPERIOR MOBILE MEDICS',
			2,
			null,
			null,
			null,
			null,
			0,
			null,
			(getdate()),
			(getdate()),
			null
		)
		insert into Organization 
		(
			ID,
			AbbrName,
			DBA,
			VendorCode,
			Branch,
			BusinessDesc
		) values
		(
			'3E0F8350-C6F0-46E5-8469-9B372AACC91E',
			'SMM',
			null,
			null,
			null,
			null
		)
		insert into PartyAddress
		(
			ID,
			PartyID,
			AddressTypeID,
			Line1,
			Line2,
			IsPreferred,
			IsValidated,
			PreventOverride,
			Inactive,
			CreatedDate,
			ModifiedDate
		)values
		(
			'43E3373B-48C5-4A34-8118-8DB0B834EA9B',
			'3E0F8350-C6F0-46E5-8469-9B372AACC91E',
			2,
			'3838 Camino Del Rio N., Suite 250',
			'San Diego, CA 92108',
			1,
			0,
			0,
			0,
			getdate(),
			getdate()
		)

		insert into PartyAddress
		(
			ID,
			PartyID,
			AddressTypeID,
			Line1,
			Line2,
			IsPreferred,
			IsValidated,
			PreventOverride,
			Inactive,
			CreatedDate,
			ModifiedDate
		)values
		(
			'1DE0D66A-EAD6-47E5-865F-81E87F6581A8',
			'3E0F8350-C6F0-46E5-8469-9B372AACC91E',
			17,
			'P.O. Box 639014',
			'San Diego, CA 92163-9014',
			0,
			0,
			0,
			0,
			getdate(),
			getdate()
		)
		insert into PartyPhone 
		(
			ID,
			PartyID,
			PhoneTypeID,
			AreaCode,
			DialNumber,
			IsPreferred,
			IsValidated,
			PreventOverride,
			Inactive,
			CreatedDate,
			ModifiedDate
		)values
		(
			'40701FBF-CB69-4B29-89DA-506E5F45FAC4',
			'3E0F8350-C6F0-46E5-8469-9B372AACC91E',
			17,
			'800',
			'8983926',
			1,
			0,
			0,
			0,
			getdate(),
			getdate()
		)
		insert into PartyPhone 
		(
			ID,
			PartyID,
			PhoneTypeID,
			AreaCode,
			DialNumber,
			IsPreferred,
			IsValidated,
			PreventOverride,
			Inactive,
			CreatedDate,
			ModifiedDate
		)values
		(
			'9283FD2A-5EC4-4BE7-9E9B-5B145232A1D7',
			'3E0F8350-C6F0-46E5-8469-9B372AACC91E',
			4,
			'888',
			'5483926',
			0,
			0,
			0,
			0,
			getdate(),
			getdate()
		)
		insert into PartyPhone 
		(
			ID,
			PartyID,
			PhoneTypeID,
			AreaCode,
			DialNumber,
			IsPreferred,
			IsValidated,
			PreventOverride,
			Inactive,
			CreatedDate,
			ModifiedDate
		)values
		(
			'51D20649-5F37-4C27-A90B-F137BAE27FD7',
			'3E0F8350-C6F0-46E5-8469-9B372AACC91E',
			4,
			'619',
			'2993926',
			0,
			0,
			0,
			0,
			getdate(),
			getdate()
		)
		insert into PartyPhone 
		(
			ID,
			PartyID,
			PhoneTypeID,
			AreaCode,
			DialNumber,
			IsPreferred,
			IsValidated,
			PreventOverride,
			Inactive,
			CreatedDate,
			ModifiedDate
		)values
		(
			'CAFA3033-99E5-47FE-B0CE-8482CA1E3E43',
			'3E0F8350-C6F0-46E5-8469-9B372AACC91E',
			4,
			'619',
			'2991901',
			0,
			0,
			0,
			0,
			getdate(),
			getdate()
		)
		insert PartyEmailAddress
		(
			ID,
			PartyID,
			EmailTypeID,
			AddrLine,
			IsPreferred,
			CatchAll,
			NoAttachment,
			NoJunkMail,
			EmailFormatID,
			Inactive,
			CreatedDate,
			ModifiedDate
		)values
		(
			'281E8E10-D7A9-4513-B93F-5C861C14B193',
			'3E0F8350-C6F0-46E5-8469-9B372AACC91E',
			1,
			'cs@superiormobilemedics.com',
			1,
			0,
			0,
			0,
			1,
			0,
			getdate(),
			getdate()

		)
	END

	Insert into #ChangeScript111_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript111_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript111_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 111, 'Add Default Organization, Add Address,Phone,Email for Default Organization'

		print '**************************************************'
		print '*  db.01.00.111: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.111: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript111_stat%')
Begin
	drop table #ChangeScript111_stat
End
go
 
 
/*
 db.01.00.112:
 Does the following:
	- Add UniID into Payment that use for OfficeNote

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 112

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript112_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript112_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 112)
begin
	print '**************************************************'
	print '*  db.01.00.112: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript112_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript112_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add UniID into Payment that use for OfficeNote                *'
	print '***********************************************************************'

		ALTER TABLE Payment ADD UniqueID uniqueidentifier not null DEFAULT (newid())

        Insert into #ChangeScript112_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript112_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript112_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 112, '- Add UniID into Payment that use for OfficeNote'

		print '**************************************************'
		print '*  db.01.00.112: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.112: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript112_stat%')
Begin
	drop table #ChangeScript112_stat
End
go
 
 
/*
 db.01.00.113:
 Does the following:
	Add Billing Through Column for Order Table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 113

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript113_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript113_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 113)
begin
	print '**************************************************'
	print '*  db.01.00.113: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript113_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript113_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add Billing Through Column for Order Table                           *'
	print '***********************************************************************'

  IF dbo.SMM_CheckExists(6, 'BillingCompanyID', 'Order') = -1
  Begin
		ALTER TABLE [dbo].[Order] ADD BillingInformationID uniqueidentifier NULL
    ALTER TABLE [dbo].[Order]  WITH CHECK ADD  CONSTRAINT [FK_Order_BillingInformation] FOREIGN KEY([BillingInformationID])
REFERENCES [dbo].[BillingInformation] ([ID])
    ALTER TABLE [dbo].[Order] CHECK CONSTRAINT [FK_Order_BillingInformation]
  END

    Insert into #ChangeScript113_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript113_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript113_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 113, 'Add Billing Through Column for Order Table'

		print '**************************************************'
		print '*  db.01.00.113: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.113: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript113_stat%')
Begin
	drop table #ChangeScript113_stat
End
go
 
 
/*
 db.01.00.114:
 Does the following:
	- Add PaymentStatus table, add PaymentStatusID into Payment

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 114

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript114_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript114_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 114)
begin
	print '**************************************************'
	print '*  db.01.00.114: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript114_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript114_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add PaymentStatus table, add PaymentStatusID into Payment                        *'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'PaymentStatusID', 'Payment') = -1
			ALTER TABLE Payment
			ADD PaymentStatusID int NULL

	IF dbo.SMM_CheckExists(1, 'metadata.PaymentStatus', '') = -1 BEGIN
		CREATE TABLE metadata.PaymentStatus
		(
			[ID] int not null,
			[Name] nvarchar(100) not null,
			CONSTRAINT [PK_PaymentStatus] PRIMARY KEY ([ID])
		)
		INSERT INTO metadata.PaymentStatus ([ID],[Name]) VALUES(1,'New')				
		INSERT INTO metadata.PaymentStatus ([ID],[Name]) VALUES(5,'Posted')
		
	END
		
	IF dbo.SMM_CheckExists(2, 'FK_Payment_PaymentStatus', 'Payment') = -1
			ALTER TABLE Payment
			ADD CONSTRAINT FK_Payment_PaymentStatus FOREIGN KEY(PaymentStatusID) REFERENCES metadata.PaymentStatus([ID])
        
	Insert into #ChangeScript114_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript114_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript114_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 114, '- Add PaymentStatus table, add PaymentStatusID into Payment'

		print '**************************************************'
		print '*  db.01.00.114: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.114: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript114_stat%')
Begin
	drop table #ChangeScript114_stat
End
go
 
 
/*
 db.01.00.115:
 Does the following tasks:
 - Table SaleOrder: Add ServiceProviderID

Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 115
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript115_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript115_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 115)
begin
	print '**************************************************'
	print '*  db.01.00.115: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript115_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript115_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION
	
	
	print '***********************************************************'
	print '* Table SaleOrder: Add ServiceProviderID      *'
	print '***********************************************************'	
	
        
	IF dbo.SMM_CheckExists(6, 'ServiceProviderID', 'SaleOrder') = -1
		ALTER TABLE [dbo].[SaleOrder]
		ADD [ServiceProviderID] [uniqueidentifier] NULL

	IF dbo.SMM_CheckExists(2, 'FK_SaleOrder_ServiceProvider', 'SaleOrder') = -1
		ALTER TABLE [dbo].[SaleOrder]  
		WITH CHECK ADD CONSTRAINT [FK_SaleOrder_ServiceProvider] 
		FOREIGN KEY([ServiceProviderID])
		REFERENCES [dbo].[ServiceProvider] ([ID])	

	
	Insert into #ChangeScript115_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript115_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript115_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 115, 'SaleOrder (Add column ServiceProviderID), SaleOrder (Add column ServiceProviderID)'

		print '**************************************************'
		print '*  db.01.00.115: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.115: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript115_stat%')
Begin
	drop table #ChangeScript115_stat
End
go
 
 
/*
 db.01.00.116:
 Does the following tasks:
 - Table DiscussionThread: Drop column PartyID

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 116
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript116_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript116_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 116)
begin
	print '**************************************************'
	print '*  db.01.00.116: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript116_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript116_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************'
	print '* Table DiscussionThread: Drop column PartyID*'
	print '**********************************************'

	IF dbo.SMM_CheckExists(4, 'FK_PartyQuestionAnswer_Party', 'DiscussionThread') = 0
		ALTER TABLE [dbo].[DiscussionThread]  
		DROP CONSTRAINT [FK_PartyQuestionAnswer_Party]	

	IF dbo.SMM_CheckExists(6, 'PartyID', 'DiscussionThread') = 0
		ALTER TABLE [dbo].[DiscussionThread]  
		DROP COLUMN PartyID	
	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript116_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript116_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript116_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 116, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.116: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.116: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript116_stat%')
Begin
	drop table #ChangeScript116_stat
End
go
 
 
/*
 db.01.00.117:
 Does the following:
	TODO: Update SMM Mailling 

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 117

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript117_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript117_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 117)
begin
	print '**************************************************'
	print '*  db.01.00.117: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript117_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript117_stat where PatchStatus = -1)
Begin

  BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Update SMM Mailling                                           *'
	print '***********************************************************************'

  update Configuration
  set [value]='Superior Mobile Medics - San Diego P.O. Box 639014 San Diego, CA 92163-9014'
  where Name='SmmMailToInstruction'


  update Configuration
  set [value]='Fax to Superior Mobile Medics within 24 hrs of completion (866) 761-1143.'
  where Name='SmmFaxToInstruction'
  
  Insert into #ChangeScript117_stat (PatchStatus) Values (1)

  COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript117_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript117_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 117, 'TODO: Update SMM Mailling'

		print '**************************************************'
		print '*  db.01.00.117: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.117: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript117_stat%')
Begin
	drop table #ChangeScript117_stat
End
go
 
 
/*
 db.01.00.118:
 Does the following:
	TODO: Add CreatedDate, ModifiedDate, DeletedDate to OrderAssignment

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 118

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript118_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript118_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 118)
begin
	print '**************************************************'
	print '*  db.01.00.118: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript118_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript118_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Add CreatedDate, ModifiedDate, DeletedDate to OrderAssignment  *'
	print '***********************************************************************'

  IF dbo.SMM_CheckExists(6, 'CreatedDate', 'OrderAssignment') = -1
  BEGIN
    ALTER TABLE [dbo].[OrderAssignment]  ADD [CreatedDate] datetime NOT NULL
      CONSTRAINT [DF_OrderAssignment_CreatedDate]  DEFAULT (getdate()) 
  END
  IF dbo.SMM_CheckExists(6, 'ModifiedDate', 'OrderAssignment') = -1
  BEGIN
    ALTER TABLE [dbo].[OrderAssignment]  ADD [ModifiedDate] datetime NOT NULL
      CONSTRAINT [DF_OrderAssignment_ModifiedDate]  DEFAULT (getdate())
  END
  IF dbo.SMM_CheckExists(6, 'DeletedDate', 'OrderAssignment') = -1
  BEGIN
    ALTER TABLE [dbo].[OrderAssignment]  ADD [DeletedDate] datetime NULL
  END

  Insert into #ChangeScript118_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript118_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript118_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 118, 'TODO: Add CreatedDate, ModifiedDate, DeletedDate to OrderAssignment'

		print '**************************************************'
		print '*  db.01.00.118: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.118: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript118_stat%')
Begin
	drop table #ChangeScript118_stat
End
go
 
 
/*
 db.01.00.119:
 Does the following:
	TODO: In OrderStatusHistory table:
	Change type of PostedBy from nvarchar to uniqueidentifier
	Add constrain PostedBy with Person table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 119

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript119_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript119_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 119)
begin
	print '**************************************************'
	print '*  db.01.00.119: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript119_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript119_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* IN OrderStatusHistory table: Change type of PostedBy from nvarchar to uniqueidentifier  *'
	print '* Add constrain PostedBy with Person table  *'
	print '***********************************************************************'
	
	ALTER TABLE dbo.OrderStatusHistory ALTER COLUMN PostedBy uniqueidentifier not null		
    ALTER TABLE dbo.OrderStatusHistory ADD CONSTRAINT
	 FK_OrderStatusHistory_Person FOREIGN KEY
	 (
	 PostedBy
	 ) REFERENCES dbo.Person
	 (
	 ID
	 ) ON UPDATE  NO ACTION 
	  ON DELETE  NO ACTION 
	
  

  Insert into #ChangeScript119_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript119_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript119_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 119, 'TODO: In OrderStatusHistory table:
			Change type of PostedBy from nvarchar to uniqueidentifier
			Add constrain PostedBy with Person table'

		print '**************************************************'
		print '*  db.01.00.119: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.119: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript119_stat%')
Begin
	drop table #ChangeScript119_stat
End
go
 
 
/*
 db.01.00.120:
 Does the following:
	TODO: In OrderStatusHistory table:
			Add new column HoldTill
			Delete HoldTill in dbo.Order table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 120

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript120_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript120_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 120)
begin
	print '**************************************************'
	print '*  db.01.00.120: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript120_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript120_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***************************************************'
	print '* Add new column HoldTill into OrderStatusHistory *'
	print '* Delete HoldTill in dbo.Order table  *'
	print '***************************************************'
	
	
	ALTER TABLE dbo.OrderStatusHistory ADD HoldTill datetime NULL
    IF dbo.SMM_CheckExists(6, 'HoldTill', 'Order') = 0
		ALTER TABLE dbo.[Order] DROP COLUMN HoldTill 
	
  
  Insert into #ChangeScript120_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript120_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript120_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 120, 'TODO: Add new column HoldTill, 
                     Delete HoldTill in dbo.Order table'

		print '**************************************************'
		print '*  db.01.00.120: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.120: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript120_stat%')
Begin
	drop table #ChangeScript120_stat
End
go
 
 
/*
 db.01.00.121:
 Does the following tasks:
	- Add new table IncompleteOrderRelation
	- Add new field ScheduleDate into IncompleteOrder that is used for Direct Order only

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 121
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript121_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript121_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 121)
begin
	print '**************************************************'
	print '*  db.01.00.121: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript121_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript121_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* Add new table IncompleteOrderRelation													*'
	print '* Add new field ScheduleDate into IncompleteOrder that is used for Direct Order only		*'	
	print '******************************************************************************************'

	IF dbo.SMM_CheckExists(1, 'IncompleteOrderRelative', '') = -1
		CREATE TABLE [dbo].[IncompleteOrderRelative](
		[ID] [uniqueidentifier] NOT NULL, 
		[OrderID] [int] NOT NULL,
		[OrderRelativeID] [int] NOT NULL,
		[RelationType] [nvarchar](50) NULL,
		[Notes] [nvarchar](250) NULL,
		[OrderRelationshipID] [int] NOT NULL,
		CONSTRAINT PK_IncompleteOrderRelative PRIMARY KEY (ID),
		CONSTRAINT [IX_IncompleteOrderRelative] UNIQUE ([OrderID],[OrderRelativeID] )
	)
	
	IF dbo.SMM_CheckExists(2, 'FK_IncompleteOrderRelative_Order', 'Order') = -1	
		ALTER TABLE [IncompleteOrderRelative]
		ADD CONSTRAINT FK_IncompleteOrderRelative_Order FOREIGN KEY (OrderID) 
		REFERENCES [IncompleteOrder](ID)

	IF dbo.SMM_CheckExists(2, 'FK_IncompleteOrderRelative_OrderRelative', 'Order') = -1	
		ALTER TABLE [IncompleteOrderRelative]
		ADD CONSTRAINT FK_IncompleteOrderRelative_OrderRelative FOREIGN KEY (OrderRelativeID) 
		REFERENCES [IncompleteOrder](ID)

	IF dbo.SMM_CheckExists(2, 'FK_IncompleteOrderRelative_OrderRelationShip', 'Order') = -1	
		ALTER TABLE [IncompleteOrderRelative]
		ADD CONSTRAINT FK_IncompleteOrderRelative_OrderRelationShip FOREIGN KEY (OrderRelationshipID) 
		REFERENCES metadata.OrderRelationship(ID)

	IF dbo.SMM_CheckExists(6, 'ScheduleDate', 'IncompleteOrder') = -1
		ALTER TABLE dbo.IncompleteOrder
		ADD ScheduleDate DateTime

	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript121_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript121_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript121_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 121, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.121: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.121: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript121_stat%')
Begin
	drop table #ChangeScript121_stat
End
go
 
 
/*
 db.01.00.122:
 Does the following:
	TODO:  Alter column Order Assignment Status from not null to Null

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 122

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript122_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript122_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 122)
begin
	print '**************************************************'
	print '*  db.01.00.122: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript122_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript122_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Alter column Order Assignment Status from not null to Null     *'
	print '***********************************************************************'

  ALTER TABLE OrderAssignment
  ALTER COLUMN OrderAssignmentStatusID int null

  Insert into #ChangeScript122_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript122_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript122_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 122, 'TODO: Alter column Order Assignment Status from not null to Null'

		print '**************************************************'
		print '*  db.01.00.122: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.122: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript122_stat%')
Begin
	drop table #ChangeScript122_stat
End
go
 
 
/*
 db.01.00.123:
 Does the following:
	TODO:  Alter column Order Assignment Status from not null to Null

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 123

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript123_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript123_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 123)
begin
	print '**************************************************'
	print '*  db.01.00.123: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript123_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript123_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Create  OrderAssignmentMedicalItems table    *'
	print '***********************************************************************'

  IF dbo.SMM_CheckExists(1, 'OrderAssignmentMedicalItems', '') = -1
	CREATE TABLE [dbo].[OrderAssignmentMedicalItems](
		[OrderAssignmentID] [uniqueidentifier] NOT NULL,
		[MedicalItemID] [uniqueidentifier] NOT NULL,
		CONSTRAINT [PK_OrderAssignmentMedicalItems_1] PRIMARY KEY CLUSTERED 
		(
			[OrderAssignmentID] ASC,
			[MedicalItemID] ASC
		)
		)
		
		
		IF dbo.SMM_CheckExists(2, 'FK_OrderAssignmentMedicalItems_MedicalItem', 'MedicalItem') = -1				
		ALTER TABLE [dbo].[OrderAssignmentMedicalItems]  
		ADD  CONSTRAINT [FK_OrderAssignmentMedicalItems_MedicalItem] FOREIGN KEY([MedicalItemID])
		REFERENCES [dbo].[MedicalItem] ([ID])
				
		IF dbo.SMM_CheckExists(2, 'FK_OrderAssignmentMedicalItems_OrderAssignment', 'OrderAssignment') = -1				
		ALTER TABLE [dbo].[OrderAssignmentMedicalItems]  
		ADD  CONSTRAINT [FK_OrderAssignmentMedicalItems_OrderAssignment] FOREIGN KEY([OrderAssignmentID])
		REFERENCES [dbo].[OrderAssignment] ([ID])
		


  Insert into #ChangeScript123_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript123_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript123_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 123, 'TODO: Create OrderAssignmentMedicalItems table'

		print '**************************************************'
		print '*  db.01.00.123: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.123: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript123_stat%')
Begin
	drop table #ChangeScript123_stat
End
go
 
 
/****** Object:  UserDefinedFunction [dbo].[ufn_OrderRequirementAssigment]    Script Date: 06/09/2009 17:58:33 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ufn_OrderRequirementAssigment]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
DROP FUNCTION [dbo].[ufn_OrderRequirementAssigment]

GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[ufn_OrderRequirementAssigment]
(
	@orderID int,
	@guidEmpty uniqueidentifier
)
RETURNS @OrderRequirementAssignment TABLE
(
	OrderAssignmentID UNIQUEIDENTIFIER NOT NULL,
	RequirementID UNIQUEIDENTIFIER NOT NULL
)
AS
BEGIN
	DECLARE @requirementID UNIQUEIDENTIFIER
	DECLARE @orderAssignmentID UNIQUEIDENTIFIER
	DECLARE curOrderReq CURSOR FOR
	SELECT requirementid FROM orderrequirement WHERE OrderID=@orderID
	OPEN curOrderReq


	FETCH NEXT FROM curOrderReq
	into @requirementID
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SET @orderAssignmentID=@guidEmpty
		SELECT TOP 1 @orderAssignmentID=OrderAssignmentID FROM OrderAssignmentReq 
		JOIN OrderAssignment
		ON OrderAssignmentReq.OrderAssignmentID=OrderAssignment.ID
		WHERE requirementid = @requirementID and OrderAssignment.OrderID = @orderID
		ORDER BY CreatedDate DESC
		
		INSERT @OrderRequirementAssignment VALUES(@orderAssignmentID,@requirementID )
		
		FETCH NEXT FROM curOrderReq INTO @requirementID
	END 
	CLOSE curOrderReq
    DEALLOCATE curOrderReq
   RETURN
END

GO

 
 
/*
 db.01.00.124:
 Does the following:
	add column ChangeRequirementNote

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 124

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript124_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript124_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 124)
begin
	print '**************************************************'
	print '*  db.01.00.124: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript124_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript124_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add column ChangeRequirementNote                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.[Order] ADD	ChangeRequirementNote nvarchar(255) NULL

        Insert into #ChangeScript124_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript124_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript124_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 124, 'add column ChangeRequirementNote'

		print '**************************************************'
		print '*  db.01.00.124: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.124: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript124_stat%')
Begin
	drop table #ChangeScript124_stat
End
go
 
 
/*
 db.01.00.125:
 Does the following tasks:
	- Add new tables PaperworkDocument, PaperworkStatusHistory
	- Rename table OrderPaperworkStatus to PaperworkStatus
	- Remove RelationType from IncompleteOrderRelative due to being replaced by OrderRelationshipID

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 125
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript125_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript125_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 125)
begin
	print '**************************************************'
	print '*  db.01.00.125: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript125_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript125_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* Add new tables PaperworkDocument, PaperworkStatusHistory								*'
	print '* Rename table OrderPaperworkStatus to PaperworkStatus									*'	
	print '* Remove RelationType from IncompleteOrderRelative										*'	
	print '******************************************************************************************'

	IF dbo.SMM_CheckExists(1, 'PaperworkDocument', '') = -1
		CREATE TABLE PaperworkDocument(
			OrderAssignmentID [uniqueidentifier] NOT NULL,
			DocumentID [uniqueidentifier] NOT NULL,
			CONSTRAINT PK_PaperworkDocument PRIMARY KEY(OrderAssignmentID, DocumentID)
		)
	
	IF dbo.SMM_CheckExists(2, 'FK_PaperworkDocument_OrderAssignment', 'PaperworkDocument') = -1	
		ALTER TABLE PaperworkDocument
		ADD CONSTRAINT FK_PaperworkDocument_OrderAssignment FOREIGN KEY(OrderAssignmentID) REFERENCES OrderAssignment(ID)

	IF dbo.SMM_CheckExists(2, 'FK_PaperworkDocument_Document', 'PaperworkDocument') = -1	
		ALTER TABLE PaperworkDocument
		ADD CONSTRAINT FK_PaperworkDocument_Document FOREIGN KEY(DocumentID) REFERENCES [Document](ID)
		
	IF dbo.SMM_CheckExists(1, '[metadata].OrderPaperworkStatus', '') = 0
		EXECUTE sp_rename N'[metadata].OrderPaperworkStatus', N'PaperworkStatus', 'OBJECT'
	
	IF dbo.SMM_CheckExists(1, 'PaperworkStatusHistory', '') = -1
		CREATE TABLE PaperworkStatusHistory
		(
			ID [uniqueidentifier] NOT NULL,
			OrderAssignmentID [uniqueidentifier] NOT NULL,
			StatusDate DATETIME NOT NULL,
			CreatedDate DATETIME NOT NULL,
			PaperworkStatusID int NOT NULL,
			StatusNote nvarchar(255),
			PostedBy [uniqueidentifier] NOT NULL,
			CONSTRAINT PK_PaperworkStatusHistory PRIMARY KEY (ID)
		)

	IF dbo.SMM_CheckExists(2, 'FK_PaperworkStatusHistory_PaperworkStatus', 'PaperworkStatusHistory') = -1	
		ALTER TABLE PaperworkStatusHistory
		ADD CONSTRAINT FK_PaperworkStatusHistory_PaperworkStatus FOREIGN KEY (PaperworkStatusID) REFERENCES metadata.PaperworkStatus(ID)

	IF dbo.SMM_CheckExists(2, 'FK_PaperworkStatusHistory_OrderAssignment', 'PaperworkStatusHistory') = -1	
		ALTER TABLE PaperworkStatusHistory
		ADD CONSTRAINT FK_PaperworkStatusHistory_OrderAssignment FOREIGN KEY (OrderAssignmentID) REFERENCES OrderAssignment(ID)

	IF dbo.SMM_CheckExists(2, 'FK_PaperworkStatusHistory_Person', 'PaperworkStatusHistory') = -1	
		ALTER TABLE PaperworkStatusHistory
		ADD CONSTRAINT FK_PaperworkStatusHistory_Person FOREIGN KEY (PostedBy) REFERENCES Person(ID)

	IF dbo.SMM_CheckExists(6, 'RelationType', 'IncompleteOrderRelative') = 0	
		ALTER TABLE IncompleteOrderRelative
		DROP COLUMN RelationType

	IF dbo.SMM_CheckExists(6, 'RelationType', 'OrderRelative') = 0	
		ALTER TABLE OrderRelative
		DROP COLUMN RelationType
	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript125_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript125_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript125_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 125, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.125: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.125: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript125_stat%')
Begin
	drop table #ChangeScript125_stat
End
go
 
 

/*
 db.01.00.127:
 Does the following:
	Add CreatedDate, ModifiedDate, DeletedDate to Lab Table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 127

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript127_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript127_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 127)
begin
	print '**************************************************'
	print '*  db.01.00.127: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript127_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript127_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add CreatedDate                                                     *'
	print '***********************************************************************'

		IF dbo.SMM_CheckExists(6, 'CreatedDate', 'Lab') = -1
			ALTER TABLE dbo.Lab ADD  CreatedDate datetime NOT NULL default getdate();
    
    print '***********************************************************************'
	print '* Add ModifiedDate                                                    *'
	print '***********************************************************************'
		IF dbo.SMM_CheckExists(6, 'ModifiedDate', 'Lab') = -1
			ALTER TABLE dbo.Lab ADD  ModifiedDate datetime NOT NULL default getdate();
	
	print '***********************************************************************'
	print '* Add DeletedDate                                                    *'
	print '***********************************************************************'
			IF dbo.SMM_CheckExists(6, 'DeletedDate', 'Lab') = -1
			ALTER TABLE dbo.Lab ADD  DeletedDate datetime  NULL;
	
	Insert into #ChangeScript127_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript127_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript127_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 127, 'Add CreatedDate, ModifiedDate, DeletedDate to Lab Table'

		print '**************************************************'
		print '*  db.01.00.127: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.127: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript127_stat%')
Begin
	drop table #ChangeScript127_stat
End
go

 
 
/*
 db.01.00.128:
 Does the following:
	TODO: Change foreign key CreatedBy from Person to Party

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 128

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript128_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript128_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 128)
begin
	print '**************************************************'
	print '*  db.01.00.128: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript128_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript128_stat where PatchStatus = -1)
Begin

  BEGIN TRANSACTION

  print '***********************************************************************'
  print '* TODO: Change foreign key CreatedBy from Person to Party              *'
  print '***********************************************************************'

  IF  EXISTS (SELECT * FROM sys.foreign_keys  WHERE parent_object_id = OBJECT_ID(N'[dbo].Order') AND name = N'FK_Order_Person')
  BEGIN
    ALTER TABLE dbo.[Order] DROP CONSTRAINT FK_Order_Person
        
    ALTER TABLE [dbo].[Order]  WITH CHECK ADD  CONSTRAINT [FK_Order_Party] FOREIGN KEY([CreatedBy])
    REFERENCES [dbo].[Party] ([ID])
  END
  
  Insert into #ChangeScript128_stat (PatchStatus) Values (1)

  COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript128_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript128_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 128, 'TODO: Change foreign key CreatedBy from Person to Party'

		print '**************************************************'
		print '*  db.01.00.128: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.128: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript128_stat%')
Begin
	drop table #ChangeScript128_stat
End
go








 
 
/*
 db.01.00.129:
 Does the following:
	Resize Value for EmailValue table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 129

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript129_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript129_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 129)
begin
	print '**************************************************'
	print '*  db.01.00.129: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript129_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript129_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Resize Value for EmailValue table			                          *'
	print '***********************************************************************'

	ALTER TABLE EmailValue
	ALTER COLUMN [Value] NVARCHAR(MAX)

    Insert into #ChangeScript129_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript129_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript129_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 129, 'Resize Value for EmailValue table'

		print '**************************************************'
		print '*  db.01.00.129: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.129: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript129_stat%')
Begin
	drop table #ChangeScript129_stat
End
go
 
 
/*
 db.01.00.130:
 Does the following:
	-Add table: metadata.RequestStatus, PaymentRefund,OrderWriteOffCredit,OrderAdjustment,OrderAdjustmentDetail,OrderReimbursement
	-Update table: InvoicePaymentDetail

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 130

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript130_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript130_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 130)
begin
	print '**************************************************'
	print '*  db.01.00.130: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript130_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript130_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* -Add table: metadata.RequestStatus, PaymentRefund,OrderWriteOffCredit,OrderAdjustmentDetail,OrderAdjustment,OrderReimbursement *'
	print '***********************************************************************'
		--1.Add RequestStatus table
		CREATE TABLE [metadata].[RequestStatus](
			[ID] [int] NOT NULL,
			[Name] [nvarchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
		 CONSTRAINT [PK_RequestStatus] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		INSERT [metadata].[RequestStatus] ([ID],[Name])VALUES(1,'Pending')
		INSERT [metadata].[RequestStatus] ([ID],[Name])VALUES(2,'Approved')
		INSERT [metadata].[RequestStatus] ([ID],[Name])VALUES(3,'Disapproved')
		
		--2.Add PaymentRefund table
		CREATE TABLE [dbo].[PaymentRefund](
			[ID] [uniqueidentifier] NOT NULL,
			[PaymentID] [int] NOT NULL,
			[CreatedBy] [uniqueidentifier] NULL,
			[AmountRefund] [money] NOT NULL,
			[PaymentRefundNote] [nvarchar](1000) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[CreatedDate] [datetime] NOT NULL,
			[ModifiedDate] [datetime] NOT NULL,
			[DeletedDate] [datetime] NULL,
		 CONSTRAINT [PK_PaymentRefund] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]
		
		ALTER TABLE [dbo].[PaymentRefund]  WITH CHECK ADD  CONSTRAINT [FK_PaymentRefund_Payment] FOREIGN KEY([PaymentID])
		REFERENCES [dbo].[Payment] ([ID])
		
		--3.Add OrderWriteOffCredit table
		CREATE TABLE [dbo].[OrderWriteOffCredit](
			[ID] [uniqueidentifier] NOT NULL,
			[AmountCredit] [money] NOT NULL,
			[Reason] [nvarchar](1000) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[CreatedBy] [uniqueidentifier] NULL,
			[CreatedDate] [datetime] NOT NULL,
			[ModifiedDate] [datetime] NOT NULL,
			[DeletedDate] [datetime] NULL,
			[RequestStatusID] [int] NOT NULL,
			[OrderID] [int] NOT NULL,
		 CONSTRAINT [PK_OrderWriteOff] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[OrderWriteOffCredit]  WITH CHECK ADD  CONSTRAINT [FK_OrderWriteOffCredit_Order] FOREIGN KEY([OrderID])
		REFERENCES [dbo].[Order] ([ID])
		
		ALTER TABLE [dbo].[OrderWriteOffCredit]  WITH CHECK ADD  CONSTRAINT [FK_OrderWriteOffCredit_RequestStatus] FOREIGN KEY([RequestStatusID])
		REFERENCES [metadata].[RequestStatus] ([ID])
		
		
		--4.Add OrderAdjustment table		
		CREATE TABLE [dbo].[OrderAdjustment](
			[ID] [uniqueidentifier] NOT NULL,
			[OrderID] [int] NOT NULL,			
			[RequestStatusID] [int] NOT NULL,
			[Reason] [varchar](1000) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		 CONSTRAINT [PK_OrderAdjustment] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[OrderAdjustment]  WITH CHECK ADD  CONSTRAINT [FK_OrderAdjustment_Order] FOREIGN KEY([OrderID])
		REFERENCES [dbo].[Order] ([ID])

		ALTER TABLE [dbo].[OrderAdjustment]  WITH CHECK ADD  CONSTRAINT [FK_OrderAdjustment_RequestStatus] FOREIGN KEY([RequestStatusID])
		REFERENCES [metadata].[RequestStatus] ([ID])

		--5.Add OrderAdjustmentDetail table		
		CREATE TABLE [dbo].[OrderAdjustmentDetail](
			[ID] [uniqueidentifier] NOT NULL,
			[OrderSurchargeID] [uniqueidentifier] NOT NULL,
			[CreatedBy] [uniqueidentifier] NULL,
			[OldPrice] [money] NOT NULL,
			[NewPrice] [money] NOT NULL,
			[CreatedDate] [datetime] NOT NULL,
			[ModifiedDate] [datetime] NOT NULL,
			[DeletedDate] [datetime] NULL,
			[SurchargeTypeID] [int] NOT NULL,
			[OrderAdjustmentID] [uniqueidentifier] NOT NULL,
		 CONSTRAINT [PK_OrderAdjustmentDetail] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]


		ALTER TABLE [dbo].[OrderAdjustmentDetail]  WITH CHECK ADD  CONSTRAINT [FK_OrderAdjustment_SurchargeType] FOREIGN KEY([SurchargeTypeID])
		REFERENCES [metadata].[SurchargeType] ([ID])

		ALTER TABLE [dbo].[OrderAdjustmentDetail]  WITH CHECK ADD  CONSTRAINT [FK_OrderAdjustmentDetail_OrderAdjustment] FOREIGN KEY([OrderAdjustmentID])
		REFERENCES [dbo].[OrderAdjustment] ([ID])

		ALTER TABLE [dbo].[OrderAdjustmentDetail]  WITH CHECK ADD  CONSTRAINT [FK_OrderAdjustmentDetail_OrderSurcharges] FOREIGN KEY([OrderSurchargeID])
		REFERENCES [dbo].[OrderSurcharges] ([ID])
		
		--6.Add OrderReimbursement		
		CREATE TABLE [dbo].[OrderReimbursement](
			[ID] [uniqueidentifier] NOT NULL,
			[CreatedBy] [uniqueidentifier] NULL,
			[DueDate] [datetime] NOT NULL,
			[CorrectionType] [nvarchar](1000) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[AmountReimbursement] [money] NOT NULL,
			[ReimbursementNote] [nvarchar](1000) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			[ReimbursementCount] [int] NOT NULL,
			[CreatedDate] [datetime] NOT NULL,
			[ModifiedDate] [datetime] NOT NULL,
			[DeletedDate] [datetime] NULL,
			[RequestStatusID] [int] NOT NULL,
			[InvoicePaymentDetailID] [uniqueidentifier] NOT NULL,
		 CONSTRAINT [PK_OrderReimbursement] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[OrderReimbursement]  WITH CHECK ADD  CONSTRAINT [FK_OrderReimbursement_InvoicePaymentDetail] FOREIGN KEY([InvoicePaymentDetailID])
		REFERENCES [dbo].[InvoicePaymentDetail] ([ID])

		ALTER TABLE [dbo].[OrderReimbursement]  WITH CHECK ADD  CONSTRAINT [FK_OrderReimbursement_RequestStatus] FOREIGN KEY([RequestStatusID])
		REFERENCES [metadata].[RequestStatus] ([ID])
		
		--7.Update InvoicePaymentDetail
		ALTER TABLE [dbo].[InvoicePaymentDetail] ADD [OrderWriteOffCreditID] [uniqueidentifier] NULL

		ALTER TABLE [dbo].[InvoicePaymentDetail]  WITH CHECK ADD  CONSTRAINT [FK_InvoicePaymentDetail_OrderWriteOffCredit] FOREIGN KEY([OrderWriteOffCreditID])
		REFERENCES [dbo].[OrderWriteOffCredit] ([ID])
		
        Insert into #ChangeScript130_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript130_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript130_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 130, '-Add table: metadata.RequestStatus, PaymentRefund,OrderWriteOffCredit,OrderAdjustmentDetail,OrderAdjustment,OrderReimbursement'

		print '**************************************************'
		print '*  db.01.00.130: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.130: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript130_stat%')
Begin
	drop table #ChangeScript130_stat
End
go
 
 
/*
 db.01.00.131:
 Does the following:
	Insert into OrderDocument table new fields: ReceiveDate, RevisionDate, ExpiredDate, VersionReference, DownloadDisabled, ArchivedReference, Inactive, ModifiedDate, CreatedBy 

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 131

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript131_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript131_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 131)
begin
	print '**************************************************'
	print '*  db.01.00.131: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript131_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript131_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Insert into OrderDocument table new fields: ReceiveDate, RevisionDate, ExpiredDate, VersionReference, DownloadDisabled, ArchivedReference, Inactive, ModifiedDate and CreatedBy  *'
	print '***********************************************************************'

	ALTER TABLE dbo.OrderDocument ADD
		ModifiedDate datetime NOT NULL DEFAULT getdate(),
		ReceivedDate datetime NULL,
		RevisionDate datetime NULL,
		ExpiredDate datetime NULL,
		VersionReference nchar(15) NULL,
		DownloadDisabled bit NOT NULL,
		ArchivedReference nchar(36) NULL,
		Inactive bit NOT NULL,
		CreatedBy uniqueidentifier NOT NULL

    ALTER TABLE dbo.OrderDocument ADD CONSTRAINT
		FK_OrderDocument_Person FOREIGN KEY
		(
		CreatedBy
		) REFERENCES dbo.Person
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
	

		
        Insert into #ChangeScript131_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript131_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript131_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 131, 'Insert into OrderDocument table new fields: ReceiveDate, RevisionDate, ExpiredDate, VersionReference, DownloadDisabled, ArchivedReference, Inactive, ModifiedDate, CreatedBy '

		print '**************************************************'
		print '*  db.01.00.131: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.131: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript131_stat%')
Begin
	drop table #ChangeScript131_stat
End
go
 
 
/*
 db.01.00.132:
 Does the following:
	Change metadata.State

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 132

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript132_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript132_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 132)
begin
	print '**************************************************'
	print '*  db.01.00.132: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript132_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript132_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Change metadata.State                            *'
	print '***********************************************************************'

	update [metadata].[State] set Abbr = 'N/A' where id = 0

        Insert into #ChangeScript132_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript132_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript132_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 132, 'Change metadata.State'

		print '**************************************************'
		print '*  db.01.00.132: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.132: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript132_stat%')
Begin
	drop table #ChangeScript132_stat
End
go
 
 
/*
 db.01.00.133:
 Does the following tasks:
 - Table DiscussionPost: Modify column MainContentQA

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 133
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript133_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript133_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 133)
begin
	print '**************************************************'
	print '*  db.01.00.133: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript133_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript133_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = 0
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL 
		
	Insert into #ChangeScript133_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */
/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript133_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript133_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 133, 'DiscussionThread (Modify MainContentQA)'

		print '**************************************************'
		print '*  db.01.00.133: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.133: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript133_stat%')
Begin
	drop table #ChangeScript133_stat
End
go
 
 
/*
 db.01.00.134:
 Does the following:
	change CreatedBy (datetime) to CreatedBy (guid)
	change DeletedBy (datetime) to DeletedBy (guid)
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 134

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript134_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript134_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 134)
begin
	print '**************************************************'
	print '*  db.01.00.134: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript134_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript134_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* change CreatedBy (datetime) to CreatedBy (guid)                        *'
	print '* change DeletedBy (datetime) to DeletedBy (guid)                        *'
	print '***********************************************************************'

	 /* change CreatedBy (datetime) to CreatedBy (guid) */
	 /* change DeletedBy (datetime) to DeletedBy (guid) */
	IF dbo.SMM_CheckExists(6, 'CreatedBy', 'ErrorLog') = 0
	BEGIN
		ALTER TABLE dbo.ErrorLog DROP COLUMN  CreatedBy
		ALTER TABLE dbo.ErrorLog ADD CreatedBy uniqueidentifier NOT NULL
	END
	IF dbo.SMM_CheckExists(6, 'DeletedBy', 'ErrorLog') = 0
    BEGIN 
        ALTER TABLE dbo.ErrorLog DROP COLUMN  DeletedBy
		ALTER TABLE dbo.ErrorLog ADD DeletedBy uniqueidentifier NULL
    END
	Insert into #ChangeScript134_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript134_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript134_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 134, 'Modify Order'

		print '**************************************************'
		print '*  db.01.00.134: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.134: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript134_stat%')
Begin
	drop table #ChangeScript134_stat
End
go
 
 
/*
 db.01.00.135:
 Does the following:
	Add OrderAssignmentStatusPageSize Configure

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 135

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript135_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript135_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 135)
begin
	print '**************************************************'
	print '*  db.01.00.135: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript135_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript135_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add OrderAssignmentStatusPageSize Configure                          *'
	print '***********************************************************************'

  insert into dbo.Configuration
  values (5, 'OrderAssignmentStatusPageSize', 3, 'Default Page Size Order Assignment Status')

  Insert into #ChangeScript135_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript135_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript135_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 135, 'Add OrderAssignmentStatusPageSize Configure'

		print '**************************************************'
		print '*  db.01.00.135: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.135: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript135_stat%')
Begin
	drop table #ChangeScript135_stat
End
go
 
 
/*
 db.01.00.136:
 Does the following:
	- Update InvoicePaymentDetail table with PaymentCodeID is null

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 136

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript136_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript136_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 136)
begin
	print '**************************************************'
	print '*  db.01.00.136: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript136_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript136_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Update InvoicePaymentDetail table with PaymentCodeID is null            *'
	print '***********************************************************************'

		--Change scripts
		ALTER TABLE InvoicePaymentDetail
		ALTER COLUMN PaymentCodeID int NULL

        Insert into #ChangeScript136_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript136_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript136_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 136, '- Update InvoicePaymentDetail table with PaymentCodeID is null'

		print '**************************************************'
		print '*  db.01.00.136: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.136: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript136_stat%')
Begin
	drop table #ChangeScript136_stat
End
go
 
 
/*
 db.01.00.137:
 Does the following:
	Add ScheduleRequired for OrderAssignmentStatus

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 137

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript137_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript137_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 137)
begin
	print '**************************************************'
	print '*  db.01.00.137: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript137_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript137_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add ScheduleRequired for OrderAssignmentStatus                       *'
	print '***********************************************************************'

  ALTER TABLE metadata.OrderAssignmentStatus
  ADD ScheduleRequired  bit not null CONSTRAINT DF_OrderAssignmentStatus_ID DEFAULT (0)

        Insert into #ChangeScript137_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript137_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript137_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 137, 'Add ScheduleRequired for OrderAssignmentStatus'

		print '**************************************************'
		print '*  db.01.00.137: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.137: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript137_stat%')
Begin
	drop table #ChangeScript137_stat
End
go
 
 
/*
 db.01.00.138:
 Does the following:
	Change BarCode from nchar to nvarchar

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 138

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript138_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript138_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 138)
begin
	print '**************************************************'
	print '*  db.01.00.138: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript138_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript138_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Change BarCode from nchar to nvarchar                            *'
	print '***********************************************************************'

	alter table OrderAssignment
	alter column BarCode nvarchar(50)

        Insert into #ChangeScript138_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript138_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript138_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 138, 'Change BarCode from nchar to nvarchar'

		print '**************************************************'
		print '*  db.01.00.138: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.138: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript138_stat%')
Begin
	drop table #ChangeScript138_stat
End
go
 
 
/*
 db.01.00.139:
 Does the following:
	Add OrderStatusPageSize Configure
	add OrderAssignmentPageSize Configure

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 139

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript139_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript139_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 139)
begin
	print '**************************************************'
	print '*  db.01.00.139: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript139_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript139_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add OrderStatusPageSize Configure,
			 add OrderAssignmentPageSize Configure *'
	print '***********************************************************************'

  insert into dbo.Configuration
  values (6, 'OrderStatusPageSize', 3, 'Default Page Size Order Status')

  insert into dbo.Configuration
  values (7, 'OrderAssignmentPageSize', 5, 'Default Page Size Order assignments')

  Insert into #ChangeScript139_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript139_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript139_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 139, 'Add OrderStatusPageSize Configure, add OrderAssignmentPageSize Configure'

		print '**************************************************'
		print '*  db.01.00.139: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.139: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript139_stat%')
Begin
	drop table #ChangeScript139_stat
End
go
 
 
/*
 db.01.00.140:
 Does the following:
	add column: CreatedDate, ModifiedDate

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 140

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript140_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript140_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 140)
begin
	print '**************************************************'
	print '*  db.01.00.140: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript140_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript140_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add column: CreatedDate, ModifiedDate                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.InsuranceProductType ADD
		CreatedDate datetime NOT NULL default (getdate()),
		ModifiedDate datetime NOT NULL default (getdate())

        Insert into #ChangeScript140_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript140_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript140_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 140, 'add column: CreatedDate, ModifiedDate'

		print '**************************************************'
		print '*  db.01.00.140: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.140: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript140_stat%')
Begin
	drop table #ChangeScript140_stat
End
go
 
 
/*
 db.01.00.141:
 Does the following tasks:
	- Add PartyID into Invoice table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 141
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript141_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript141_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 141)
begin
	print '**************************************************'
	print '*  db.01.00.141: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript141_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript141_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* Add PartyID into Invoice table															*'
	print '******************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'PartyID', 'Invoice') = -1
		ALTER TABLE dbo.Invoice
		ADD PartyID uniqueidentifier

	IF dbo.SMM_CheckExists(2, 'FK_Invoice_Party', 'Invoice') = -1
		ALTER TABLE Invoice
		ADD CONSTRAINT FK_Invoice_Party FOREIGN KEY(PartyID)
		REFERENCES Party(ID)
	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript141_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript141_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript141_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 141, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.141: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.141: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript141_stat%')
Begin
	drop table #ChangeScript141_stat
End
go
 
 
/*
 db.01.00.000:
 Does the following:
	Remove NotifyCSR, NotifyNoShow from table OrderAssignmentStatusHistory

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 000

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript000_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript000_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 000)
begin
	print '**************************************************'
	print '*  db.01.00.000: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript000_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript000_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Remove NotifyCSR, NotifyNoShow from table OrderAssignmentStatusHistory    *'
	print '***********************************************************************'

  alter table OrderAssignmentStatusHistory
  drop column NotifyCSR
  
  alter table OrderAssignmentStatusHistory
  drop column NotifyNoShow

        Insert into #ChangeScript000_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript000_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript000_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 000, 'Remove NotifyCSR, NotifyNoShow from table OrderAssignmentStatusHistory'

		print '**************************************************'
		print '*  db.01.00.000: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.000: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript000_stat%')
Begin
	drop table #ChangeScript000_stat
End
go
 
 
/*
 db.01.00.143:
 Does the following:
	Add OrderStatusHistoryPageSize Configure

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 143

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript143_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript143_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 143)
begin
	print '**************************************************'
	print '*  db.01.00.143: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript143_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript143_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add OrderStatusHistoryPageSize Configure*'
	print '***********************************************************************'

  insert into dbo.Configuration
  values (8, 'OrderStatusHistoryPageSize', 5, 'Default Page Size Order History Status')

  

  Insert into #ChangeScript143_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript143_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript143_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 143, 'Add OrderStatusHistoryPageSize Configure'

		print '**************************************************'
		print '*  db.01.00.143: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.143: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript143_stat%')
Begin
	drop table #ChangeScript143_stat
End
go
 
 
/*
 db.01.00.144:
 Does the following: Change dbo.BillingInformation table
	add column: GasSurchargeUnit, AdminFeeUnit, DocumentFeeUnit
	add references those columns to dbo.metadata.PricingUnit
	edit BillingCompanyID null to not null 

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 144

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript144_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript144_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 144)
begin
	print '**************************************************'
	print '*  db.01.00.144: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript144_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript144_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Does the following: Change dbo.BillingInformation table
				add column: GasSurchargeUnit, AdminFeeUnit, DocumentFeeUnit
				add references those columns to dbo.metadata.PricingUnit
				edit BillingCompanyID null to not null                            *'
	print '***********************************************************************'

	alter table BillingInformation
		add GasSurchargeUnit int NULL

	alter table BillingInformation
		add AdminFeeUnit int NULL

	alter table BillingInformation
		add DocumentFeeUnit int NULL

	alter table BillingInformation
		alter column BillingCompanyID uniqueidentifier NOT NULL

	ALTER TABLE dbo.BillingInformation ADD CONSTRAINT
		FK_GasSurcharge_PricingUnit FOREIGN KEY
		(
		GasSurchargeUnit
		) REFERENCES metadata.PricingUnit
		(
		ID
		) ON UPDATE  NO ACTION 
		ON DELETE  NO ACTION 
	
	ALTER TABLE dbo.BillingInformation ADD CONSTRAINT
		FK_AdminFee_PricingUnit FOREIGN KEY
		(
		AdminFeeUnit
		) REFERENCES metadata.PricingUnit
		(
		ID
		) ON UPDATE  NO ACTION 
		ON DELETE  NO ACTION 
	
	ALTER TABLE dbo.BillingInformation ADD CONSTRAINT
		FK_DocumentFee_PricingUnit FOREIGN KEY
		(
		DocumentFeeUnit
		) REFERENCES metadata.PricingUnit
		(
		ID
		) ON UPDATE  NO ACTION 
		ON DELETE  NO ACTION 

    Insert into #ChangeScript144_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript144_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript144_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 144, 'Does the following: Change dbo.BillingInformation table
							add column: GasSurchargeUnit, AdminFeeUnit, DocumentFeeUnit
							add references those columns to dbo.metadata.PricingUnit
							edit BillingCompanyID null to not null'

		print '**************************************************'
		print '*  db.01.00.144: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.144: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript144_stat%')
Begin
	drop table #ChangeScript144_stat
End
go
 
 
/*
 db.01.00.145:
 Does the following: Add BillingCompanyType table
					 Rename column dbo.BillingCompany.SPApprovalIncluded to NeedSPApproval
					 Add references from BillingCompany to BillingCompanyType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 145

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript145_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript145_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 145)
begin
	print '**************************************************'
	print '*  db.01.00.145: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript145_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript145_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Does the following: Add BillingCompanyType table
					 Rename column dbo.BillingCompany.SPApprovalIncluded to NeedSPApproval
					 Add references from BillingCompany to BillingCompanyType *'
	print '***********************************************************************'

	CREATE TABLE dbo.BillingCompanyType
	(
	ID uniqueidentifier NOT NULL,
	Name nvarchar(50) NOT NULL
	)  ON [PRIMARY]

	ALTER TABLE dbo.BillingCompanyType ADD CONSTRAINT
	PK_Table_1 PRIMARY KEY CLUSTERED 
	(
	ID
	) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

	Insert into dbo.BillingCompanyType([ID], [Name]) Values ('9792C615-E273-4530-87D4-98BB80C705A0','Direct Bill')
	Insert into dbo.BillingCompanyType([ID], [Name]) Values ('FE729CB4-06EB-4734-A06D-A85EF4277FD3','3rd Party Bill')
	Insert into dbo.BillingCompanyType([ID], [Name]) Values ('1AD97136-6B42-4E2A-B5BC-7B32C53B22A9','Periodically Bill')

	alter table dbo.BillingCompany
	add [Type] uniqueidentifier NOT NULL default '9792C615-E273-4530-87D4-98BB80C705A0'

	EXECUTE sp_rename N'dbo.BillingCompany.SPApprovalIncluded', N'NeedSPApproval', 'COLUMN' 

	ALTER TABLE dbo.BillingCompany ADD CONSTRAINT
	FK_BillingCompany_BillingCompanyType FOREIGN KEY
	(
	Type
	) REFERENCES dbo.BillingCompanyType
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 

    Insert into #ChangeScript145_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript145_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript145_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 145, 'Does the following: Add BillingCompanyType table
					 Rename column dbo.BillingCompany.SPApprovalIncluded to NeedSPApproval
					 Add references from BillingCompany to BillingCompanyType'

		print '**************************************************'
		print '*  db.01.00.145: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.145: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript145_stat%')
Begin
	drop table #ChangeScript145_stat
End
go
 
 
/****** Object:  UserDefinedFunction [dbo].[ufn_ServiceProviderApproval]    Script Date: 05/21/2009 09:51:54 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ufn_ServiceProviderApproval]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
DROP FUNCTION [dbo].[ufn_ServiceProviderApproval]

go
/****** Object:  UserDefinedFunction [dbo].[ufn_ServiceProviderApproval]    Script Date: 05/21/2009 09:51:59 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[ufn_ServiceProviderApproval]
(
	@ServiceProviderID uniqueidentifier,
	@UseBillingID bit,
	@BillingCompanyID uniqueidentifier,
	@UseApprovalStatusID bit,
	@ApprovalStatusID int 
)
RETURNS TABLE 
AS
RETURN 
(
	SELECT * FROM 
	(
		select ISNULL(s.ServiceProviderID,@ServiceProviderID) as ServiceProviderID, b.ID as BillingCompanyID,
		ISNULL(ReferenceCode,'') AS ReferenceCode, ISNULL(ApprovalStatusID,0) as ApprovalStatusID, 
		ISNULL(s.ID,(select ID from [vw_RandomUniqueIdentifierID])) as ID
		FROM  BillingCompany b	
		LEFT JOIN ServiceProviderApproval s
		ON b.ID=BillingCompanyID and s.ServiceProviderID=@ServiceProviderID 
		LEFT JOIN [metadata].ApprovalStatus  a
		ON a.id=s.approvalstatusid
		LEFT JOIN Party p
		ON b.OrgID = p.ID
		WHERE b.NeedSPApproval = 1
		AND p.DeletedDate is NULL
		AND coalesce(p.Inactive, 0)=0
	) As ServiceProviderApproval
	WHERE (0=@UseBillingID or BillingCompanyID = @BillingCompanyID)	
	AND (0=@UseApprovalStatusID or ApprovalStatusID = @ApprovalStatusID)
)

GO
 
 
/*
 db.01.00.146:
 Does the following:
	Add Employee role for user Admin

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 146

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript146_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript146_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 146)
begin
	print '**************************************************'
	print '*  db.01.00.146: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript146_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript146_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add Employee role for user Admin                                    *'
	print '***********************************************************************'

	IF NOT EXISTS(SELECT * FROM dbo.Employee WHERE ID = '558AC7AF-3760-4B48-BA41-B2EC114E6E35')
	BEGIN
		INSERT INTO [dbo].[Employee]([ID], [PersonID], [IsSupervisor], [SupervisorID], [DepartmentID],[EmployeeStatusID], [EmployeeTitleID])
		   VALUES ('558AC7AF-3760-4B48-BA41-B2EC114E6E35', 'B0A630FC-3F64-4FF8-B195-167F7A14DCA1', 0, NULL, NULL, 1, 1)
	END
	
	Insert into #ChangeScript146_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript146_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript146_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 146, 'Add Employee role for user Admin'

		print '**************************************************'
		print '*  db.01.00.146: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.146: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript146_stat%')
Begin
	drop table #ChangeScript146_stat
End
go
 
 
/*
 db.01.00.147:
 Does the following tasks:
 - Update Address with field ZipCode,City ,State  for Default Organization

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 147
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript147_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript147_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 147)
begin
	print '**************************************************'
	print '*  db.01.00.147: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript147_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript147_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************'
	print '*Update Address with field ZipCode,City ,State  for Default Organization*'
	print '**********************************************'

	IF dbo.SMM_CheckExists(1, 'PartyAddress', '') = 0
	BEGIN
		update PartyAddress set 
		StateID=6,
		Zip = '92108',
		City = 'San Diego'
		where ID='43E3373B-48C5-4A34-8118-8DB0B834EA9B'
		
		update PartyAddress set 
		StateID=6,
		Zip = '92163',
		City = 'San Diego'
		where ID='1DE0D66A-EAD6-47E5-865F-81E87F6581A8'
		
		
	END
	IF dbo.SMM_CheckExists(1, 'PartyPhone', '') = 0
	BEGIN
		update PartyPhone set 
		PhoneTypeID = 2
		where ID='51D20649-5F37-4C27-A90B-F137BAE27FD7'
	END

	Insert into #ChangeScript147_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript147_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript147_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 147, 'Update Address with field ZipCode,City ,State  for Default Organization'

		print '**************************************************'
		print '*  db.01.00.147: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.147: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript147_stat%')
Begin
	drop table #ChangeScript147_stat
End
go
 
 
/*
 db.01.00.148:
 Does the following:
	Add show for Service provider Field

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 148

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript148_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript148_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 148)
begin
	print '**************************************************'
	print '*  db.01.00.148: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript148_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript148_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add show for Service provider Field                                 *'
	print '***********************************************************************'

  ALTER TABLE metadata.OrderAssignmentStatus
  ADD ServiceProviderCanInput [bit] NOT NULL CONSTRAINT [DF_OrderAssignmentStatus_ServiceProviderCanInput]  DEFAULT ((0))
  
  Insert into #ChangeScript148_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript148_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript148_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 148, 'Add show for Service provider Field'

		print '**************************************************'
		print '*  db.01.00.148: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.148: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript148_stat%')
Begin
	drop table #ChangeScript148_stat
End
go
 
 
/*
 db.01.00.149:
 Does the following:
	- Add InvoicePaymentDetailID in OrderAdjustment

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 149

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript149_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript149_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 149)
begin
	print '**************************************************'
	print '*  db.01.00.149: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript149_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript149_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add InvoicePaymentDetailID in OrderAdjustment                          *'
	print '***********************************************************************'

		ALTER TABLE [dbo].[OrderAdjustment] 
		ADD [InvoicePaymentDetailID] [uniqueidentifier] NULL

		ALTER TABLE [dbo].[OrderAdjustment]  WITH CHECK ADD  CONSTRAINT [FK_OrderAdjustment_InvoicePaymentDetail] FOREIGN KEY([InvoicePaymentDetailID])
		REFERENCES [dbo].[InvoicePaymentDetail] ([ID])

        Insert into #ChangeScript149_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript149_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript149_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 149, '- Add InvoicePaymentDetailID in OrderAdjustment'

		print '**************************************************'
		print '*  db.01.00.149: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.149: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript149_stat%')
Begin
	drop table #ChangeScript149_stat
End
go
 
 
/*
 db.01.00.150:
 Does the following:
	Update metadata for OrderAssignmentStatus Table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 150

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript150_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript150_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 150)
begin
	print '**************************************************'
	print '*  db.01.00.150: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript150_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript150_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update metadata for OrderAssignmentStatus Table                            *'
	print '***********************************************************************'
  print 'set Reset Value'
  update metadata.orderassignmentstatus
  set ServiceProviderCanInput = 0,
  NoteRequired = 0,
  ScheduleRequired = 0
  
  print 'set ServiceProviderCanInput'
  update metadata.orderassignmentstatus
  set ServiceProviderCanInput = 1
  where [id] in (1, 2, 3, 4, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 26, 28, 29, 31, 54, 55, 56, 57, 60, 62, 90, 103, 104, 185, 220, 222)

  print 'set NoteRequired'
  update metadata.orderassignmentstatus
  set NoteRequired = 1
  where [id] in (1, 3, 7, 9, 11, 13, 26, 62, 63, 64, 74, 76, 89, 90, 91, 99, 100, 102, 103, 104, 184, 205, 220, 222, 231, 235, 236)
  
  print 'set NoteRequired'
  update metadata.orderassignmentstatus
  set ScheduleRequired = 1
  where [id] in (10, 46, 69, 89, 90, 91)
  
        Insert into #ChangeScript150_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript150_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript150_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 150, 'Update metadata for OrderAssignmentStatus Table'

		print '**************************************************'
		print '*  db.01.00.150: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.150: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript150_stat%')
Begin
	drop table #ChangeScript150_stat
End
go
 
 
/*
 db.01.00.151:
 Does the following:
	- Add CardHolder into Payment

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 151

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript151_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript151_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 151)
begin
	print '**************************************************'
	print '*  db.01.00.151: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript151_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript151_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add CardHolder into Payment                        *'
	print '***********************************************************************'

		ALTER TABLE Payment
		ADD CardHolder nvarchar(75) NOT NULL CONSTRAINT [DF_Payment_CardHolder]  DEFAULT ('')

        Insert into #ChangeScript151_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript151_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript151_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 151, '- Add CardHolder into Payment'

		print '**************************************************'
		print '*  db.01.00.151: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.151: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript151_stat%')
Begin
	drop table #ChangeScript151_stat
End
go
 
 
/*
 db.01.00.152:
 Does the following tasks:
	- Drop InvoiceID from Order table
	- Add InvoiceOrder, InvoiceOrderFee table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 152
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript152_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript152_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 152)
begin
	print '**************************************************'
	print '*  db.01.00.152: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript152_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript152_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* DROP InvoiceID from Order table														*'
	print '* ADD InvoiceOrder table																	*'
	print '* ADD InvoiceOrderFee table																*'
	print '******************************************************************************************'
	
	IF dbo.SMM_CheckExists(2, 'FK_Order_Invoice', 'Order') = 0
		ALTER TABLE [Order]
		DROP FK_Order_Invoice

	IF dbo.SMM_CheckExists(6, 'InvoiceID', 'Order') = 0
		ALTER TABLE dbo.[Order]
		DROP COLUMN InvoiceID

	CREATE TABLE InvoiceOrder(
		ID uniqueidentifier NOT NULL,
		OrderID	int NOT NULL,
		InvoiceID int,
		IsRebill bit
		CONSTRAINT PK_InvoiceOrder PRIMARY KEY(ID)
	)		
	
	ALTER TABLE InvoiceOrder
	ADD CONSTRAINT FK_InvoiceOrder_Order FOREIGN KEY (OrderID) REFERENCES [Order](ID)

	ALTER TABLE InvoiceOrder
	ADD CONSTRAINT FK_InvoiceOrder_Invoice FOREIGN KEY (InvoiceID) REFERENCES [Invoice](ID)

	ALTER TABLE InvoiceOrder
	ADD ServiceFee money
	
	ALTER TABLE InvoiceOrder
	ADD KitFee money

	ALTER TABLE InvoiceOrder
	ADD Discount money
	
	CREATE TABLE InvoiceOrderFee(
		ID uniqueidentifier NOT NULL,
		InvoiceOrderID uniqueidentifier NOT NULL,
		SurchargeTypeID int NOT NULL,
		Amount money NOT NULL,
		CONSTRAINT PK_InvoiceOrderFee PRIMARY KEY(ID)
	)	

	ALTER TABLE InvoiceOrderFee
	ADD CONSTRAINT FK_InvoiceOrderFee_InvoiceOrder FOREIGN KEY(InvoiceOrderID) REFERENCES InvoiceOrder(ID)

	ALTER TABLE InvoiceOrderFee
	ADD CONSTRAINT FK_InvoiceOrderFee_SurchargeType FOREIGN KEY(SurchargeTypeID) REFERENCES [metadata].SurchargeType(ID)
	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript152_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript152_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript152_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 152, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.152: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.152: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript152_stat%')
Begin
	drop table #ChangeScript152_stat
End
go
 
 
/*
 db.01.00.153:
 Does the following:
	- Change Db for Accounting AR

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 153

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript153_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript153_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 153)
begin
	print '**************************************************'
	print '*  db.01.00.153: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript153_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript153_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Change Db for Accounting AR                      *'
	print '***********************************************************************'

--BEGIN
--Update Invoice
ALTER TABLE Invoice
	ADD Other nvarchar(75) NULL

--Update InvoiceOrder
ALTER TABLE InvoiceOrder
	ADD AmountAdjustment money NULL,
		AmountWriteOff money NULL

--Update OrderAdjustment
ALTER TABLE OrderAdjustment
	DROP FK_OrderAdjustment_Order,
		 FK_OrderAdjustment_InvoicePaymentDetail

ALTER TABLE OrderAdjustment
	DROP COLUMN OrderID,Reason

ALTER TABLE OrderAdjustment
	ADD AdjustmentReason nvarchar(1000) NULL,
		DisapprovedReason nvarchar(1000) NULL,
		CreatedBy uniqueidentifier NULL,
		CreatedDate datetime NOT NULL DEFAULT (getdate()),
		ModifiedDate datetime NOT NULL DEFAULT (getdate()),
		DeletedDate datetime NULL,
		AmountAdjustment money NOT NULL DEFAULT (0),
		InvoiceOrderID uniqueidentifier NOT NULL DEFAULT (newid())

ALTER TABLE OrderAdjustment  WITH CHECK ADD  CONSTRAINT FK_OrderAdjustment_InvoiceOrder FOREIGN KEY([InvoiceOrderID])
REFERENCES InvoiceOrder ([ID])

ALTER TABLE OrderAdjustment  WITH CHECK ADD  CONSTRAINT FK_OrderAdjustment_Employee FOREIGN KEY([CreatedBy])
REFERENCES Employee ([ID])

--Update OrderAdjustmentDetail
ALTER TABLE OrderAdjustmentDetail
	DROP FK_OrderAdjustment_SurchargeType,
		 FK_OrderAdjustmentDetail_OrderAdjustment,
		 FK_OrderAdjustmentDetail_OrderSurcharges

DROP TABLE OrderAdjustmentDetail

--Update InvoicePaymentDetail

ALTER TABLE InvoicePaymentDetail
	DROP FK_InvoicePaymentDetail_Order,
		 FK_InvoicePaymentDetail_OrderWriteOffCredit

ALTER TABLE InvoicePaymentDetail
	DROP COLUMN OrderID,OrderWriteOffCreditID

ALTER TABLE InvoicePaymentDetail 
	ADD InvoiceOrderID uniqueidentifier NOT NULL DEFAULT (newid()),
		OrderWriteOffID uniqueidentifier NULL

ALTER TABLE InvoicePaymentDetail  WITH CHECK ADD  CONSTRAINT FK_InvoicePaymentDetail_InvoiceOrder FOREIGN KEY([InvoiceOrderID])
REFERENCES InvoiceOrder ([ID])

--NOTE: FK_InvoicePaymentDetail_OrderWriteOff moved on below
--Update OrderWriteOffCredit
EXEC sp_rename 'OrderWriteOffCredit', 'OrderWriteOff'

ALTER TABLE OrderWriteOff 
	DROP FK_OrderWriteOffCredit_Order,
		 FK_OrderWriteOffCredit_RequestStatus

ALTER TABLE OrderWriteOff 
	DROP COLUMN OrderID

ALTER TABLE OrderWriteOff 
	ADD InvoiceOrderID uniqueidentifier NOT NULL DEFAULT (newid()),
		AmountWriteOff money NOT NULL

ALTER TABLE OrderWriteOff 
	ALTER COLUMN AmountCredit money NULL

ALTER TABLE OrderWriteOff  WITH CHECK ADD  CONSTRAINT FK_OrderWriteOff_InvoiceOrder FOREIGN KEY([InvoiceOrderID])
REFERENCES InvoiceOrder ([ID])

ALTER TABLE OrderWriteOff  WITH CHECK ADD  CONSTRAINT FK_OrderWriteOff_RequestStatus FOREIGN KEY([RequestStatusID])
REFERENCES metadata.RequestStatus ([ID])

ALTER TABLE InvoicePaymentDetail  WITH CHECK ADD  CONSTRAINT FK_InvoicePaymentDetail_OrderWriteOff FOREIGN KEY([OrderWriteOffID])
REFERENCES OrderWriteOff ([ID])
--Update OrderReimbursement

ALTER TABLE OrderReimbursement
	DROP FK_OrderReimbursement_InvoicePaymentDetail

ALTER TABLE OrderReimbursement 
	ADD InvoiceOrderID uniqueidentifier NOT NULL DEFAULT (newid())

ALTER TABLE OrderReimbursement  WITH CHECK ADD  CONSTRAINT FK_OrderReimbursement_InvoiceOrder FOREIGN KEY([InvoiceOrderID])
REFERENCES InvoiceOrder ([ID])


--Update Payment
ALTER TABLE Payment
	DROP FK_Payment_BillingInformation

ALTER TABLE Payment
	DROP COLUMN BillingInformationID

ALTER TABLE Payment
	ADD PartyID uniqueidentifier NULL

ALTER TABLE Payment  WITH CHECK ADD  CONSTRAINT FK_Payment_Party FOREIGN KEY(PartyID)
REFERENCES Party ([ID])

--END

        Insert into #ChangeScript153_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript153_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript153_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 153, '- Change Db for Accounting AR'

		print '**************************************************'
		print '*  db.01.00.153: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.153: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript153_stat%')
Begin
	drop table #ChangeScript153_stat
End
go
 
 
/*
 db.01.00.154:
 Does the following tasks:
	- Add IsInvoiceExcluded into Order table (nullable)
	- Add IsAPExcluded into OrderAssignment table (nullable)

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 154
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript154_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript154_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 154)
begin
	print '**************************************************'
	print '*  db.01.00.154: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript154_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript154_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* Add IsInvoiceExcluded into Order table (nullable)										*'
	print '* Add IsAPExcluded into OrderAssignment table (nullable)									*'
	print '******************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'IsInvoiceExcluded', 'Order') = -1
		ALTER TABLE dbo.[Order]
		ADD IsInvoiceExcluded bit CONSTRAINT DF_Order_IsInvoiceExcluded DEFAULT (0)

	IF dbo.SMM_CheckExists(6, 'IsAPExcluded', 'OrderAssignment') = -1
		ALTER TABLE dbo.OrderAssignment
		ADD IsAPExcluded bit CONSTRAINT DF_OrderAssignment_IsAPExcluded DEFAULT (0)
	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript154_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript154_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript154_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 154, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.154: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.154: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript154_stat%')
Begin
	drop table #ChangeScript154_stat
End
go
 
 
/*
 db.01.00.155:
 Does the following:
	add column last step to IncompleteOrder table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 155

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript155_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript155_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 155)
begin
	print '**************************************************'
	print '*  db.01.00.155: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript155_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript155_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add column last step to IncompleteOrder table                            *'
	print '***********************************************************************'

	alter table dbo.IncompleteOrder add LastStep int default 1

        Insert into #ChangeScript155_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript155_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript155_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 155, 'add column last step to IncompleteOrder table'

		print '**************************************************'
		print '*  db.01.00.155: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.155: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript155_stat%')
Begin
	drop table #ChangeScript155_stat
End
go
 
 
/*
 db.01.00.156:
 Does the following tasks:
	- Add AmountBilled, AmountPaid and Balance into InvoiceOrder table
	- DiscountPercent into InvoiceOrder table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 156
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript156_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript156_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 156)
begin
	print '**************************************************'
	print '*  db.01.00.156: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript156_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript156_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* Add AmountBilled, AmountPaid and Balance into InvoiceOrder table						*'
	print '******************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'AmountBilled', 'InvoiceOrder') = -1
		ALTER TABLE dbo.InvoiceOrder
		ADD AmountBilled money NOT NULL DEFAULT (0)

	IF dbo.SMM_CheckExists(6, 'AmountPaid', 'InvoiceOrder') = -1
		ALTER TABLE dbo.InvoiceOrder
		ADD AmountPaid money NOT NULL DEFAULT (0)

	IF dbo.SMM_CheckExists(6, 'Balance', 'InvoiceOrder') = -1
		ALTER TABLE dbo.InvoiceOrder
		ADD Balance money NOT NULL DEFAULT (0)

	IF dbo.SMM_CheckExists(6, 'AmountRebill', 'InvoiceOrder') = -1
		ALTER TABLE dbo.InvoiceOrder
		ADD AmountRebill money NOT NULL DEFAULT (0)

	IF dbo.SMM_CheckExists(6, 'DiscountPercent', 'InvoiceOrder') = -1
		ALTER TABLE dbo.InvoiceOrder
		ADD DiscountPercent float NOT NULL DEFAULT (0)
		
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript156_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript156_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript156_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 156, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.156: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.156: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript156_stat%')
Begin
	drop table #ChangeScript156_stat
End
go
 
 
/*
 db.01.00.157:
 Does the following:
	Update field IsInvoiceExcluded of Order table to not null

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 157

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript157_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript157_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 157)
begin
	print '**************************************************'
	print '*  db.01.00.157: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript157_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript157_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update field IsInvoiceExcluded of Order table to not null           *'
	print '***********************************************************************'

	UPDATE dbo.[Order] SET [IsInvoiceExcluded] = 0 WHERE [IsInvoiceExcluded] IS NULL
	ALTER TABLE dbo.[Order] ALTER COLUMN [IsInvoiceExcluded] bit NOT NULL 

	ALTER TABLE dbo.[Invoice] ADD [DueDate] datetime NOT NULL CONSTRAINT [DF_Invoice_DueDate]  DEFAULT (getDate()) 

	Insert into #ChangeScript157_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript157_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript157_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 157, 'Update field IsInvoiceExcluded of Order table to not null'

		print '**************************************************'
		print '*  db.01.00.157: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.157: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript157_stat%')
Begin
	drop table #ChangeScript157_stat
End
go
 
 
/*
 db.01.00.158:
 Does the following tasks:
	- Add BillTo3rdParty into BillingCompanyType table
	- Add ServiceFee, Kit Fee into AccountPayableDetail table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 158
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript158_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript158_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 158)
begin
	print '**************************************************'
	print '*  db.01.00.158: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript158_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript158_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* 										*'
	print '******************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'BillTo3rdParty', 'BillingCompanyType') = -1
	BEGIN
		ALTER TABLE dbo.BillingCompanyType
		ADD BillTo3rdParty bit CONSTRAINT DF_BillTo3rdParty DEFAULT (0)
	END


	IF dbo.SMM_CheckExists(6, 'ServiceFee', 'AccountPayableDetail') = -1
		ALTER TABLE dbo.AccountPayableDetail
		ADD ServiceFee money NOT NULL

	IF dbo.SMM_CheckExists(6, 'KitFee', 'AccountPayableDetail') = -1
		ALTER TABLE dbo.AccountPayableDetail
		ADD KitFee money NOT NULL

	IF dbo.SMM_CheckExists(6, 'AmountPaid', 'AccountPayableDetail') = 0
		ALTER TABLE dbo.AccountPayableDetail
		DROP COLUMN AmountPaid

	IF dbo.SMM_CheckExists(6, 'InvalidForAP', 'OrderAssignment') = -1
		ALTER TABLE dbo.OrderAssignment
		ADD InvalidForAP bit CONSTRAINT DF_OrderAssignment_InvalidForAP DEFAULT(0)
	
	IF dbo.SMM_CheckExists(6, 'InvalidReasonForAP', 'OrderAssignment') = -1
		ALTER TABLE dbo.OrderAssignment
		ADD InvalidReasonForAP nvarchar(255)
	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript158_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript158_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript158_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 158, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.158: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.158: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript158_stat%')
Begin
	drop table #ChangeScript158_stat
End
go
 
 
/*
 db.01.00.159:
 Does the following tasks:
	- Add IsVoid column into Invoice table
	- Add IsCredit column into InvoiceOrder table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 159
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript159_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript159_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 159)
begin
	print '**************************************************'
	print '*  db.01.00.159: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript159_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript159_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* 										*'
	print '******************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'IsVoid', 'Invoice') = -1
		ALTER TABLE dbo.Invoice
		ADD IsVoid bit NOT NULL CONSTRAINT DF_Invoice_IsVoid DEFAULT(0)

	IF dbo.SMM_CheckExists(6, 'IsCredit', 'InvoiceOrder') = -1
		ALTER TABLE dbo.InvoiceOrder
		ADD IsCredit bit NOT NULL CONSTRAINT DF_InvoiceOrder_IsCredit DEFAULT(0)
	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript159_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript159_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript159_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 159, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.159: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.159: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript159_stat%')
Begin
	drop table #ChangeScript159_stat
End
go
 
 
/*
 db.01.00.160:
 Does the following tasks:
	- Update BillTo3rdParty value from BillingCompanyType for current records

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 160
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript160_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript160_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 160)
begin
	print '**************************************************'
	print '*  db.01.00.160: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript160_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript160_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* Update BillTo3rdParty value from BillingCompanyType for current records 				*'
	print '******************************************************************************************'

	UPDATE BillingCompanyType SET BillTo3rdParty=0 WHERE ID='1ad97136-6b42-4e2a-b5bc-7b32c53b22a9'
	UPDATE BillingCompanyType SET BillTo3rdParty=0 WHERE ID='9792c615-e273-4530-87d4-98bb80c705a0'
	UPDATE BillingCompanyType SET BillTo3rdParty=1 WHERE ID='fe729cb4-06eb-4734-a06d-a85ef4277fd3'
	
	print '**********************************************'
	print '*Table DiscussionPost: Change MaincontentQA*'
	print '**********************************************'
	
	IF dbo.SMM_CheckExists(6, 'MainContentQA', 'DiscussionPost') = -1
		ALTER TABLE dbo.DiscussionPost ALTER COLUMN MainContentQA nvarchar(4000) NOT NULL
		
	Insert into #ChangeScript160_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript160_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript160_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 160, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.160: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.160: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript160_stat%')
Begin
	drop table #ChangeScript160_stat
End
go
 
 
/*
 db.01.00.161:
 Does the following:
	Add default value for all Amount column in InvoiceOrder, OrderWriteOff

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 161

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript161_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript161_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 161)
begin
	print '**************************************************'
	print '*  db.01.00.161: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript161_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript161_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add default value for all Amount column in InvoiceOrder, OrderWriteOff*'
	print '***********************************************************************'

  IF not EXISTS (select * from sys.default_constraints where [name] = 'DF_InvoiceOrder_ServiceFee')
  begin
    ALTER TABLE InvoiceOrder
    ADD CONSTRAINT DF_InvoiceOrder_ServiceFee DEFAULT 0 FOR ServiceFee 
  end
  
  ALTER TABLE InvoiceOrder
  ALTER COLUMN ServiceFee money not null

  IF not EXISTS (select * from sys.default_constraints where [name] = 'DF_InvoiceOrder_KitFee')
  begin
    ALTER TABLE InvoiceOrder
    ADD CONSTRAINT DF_InvoiceOrder_KitFee DEFAULT 0 FOR KitFee 
  end
  
  ALTER TABLE InvoiceOrder
  ALTER COLUMN KitFee money not null

  IF not EXISTS (select * from sys.default_constraints where [name] = 'DF_InvoiceOrder_Discount')
  begin
    ALTER TABLE InvoiceOrder
    ADD CONSTRAINT DF_InvoiceOrder_Discount DEFAULT 0 FOR Discount 
  end
  
  ALTER TABLE InvoiceOrder
  ALTER COLUMN Discount money not null
  
  IF not EXISTS (select * from sys.default_constraints where [name] = 'DF_InvoiceOrder_AmountAdjustment')
  begin
    ALTER TABLE InvoiceOrder
    ADD CONSTRAINT DF_InvoiceOrder_AmountAdjustment DEFAULT 0 FOR AmountAdjustment 
  end
  
  ALTER TABLE InvoiceOrder
  ALTER COLUMN AmountAdjustment money not null
  
  
  IF not EXISTS (select * from sys.default_constraints where [name] = 'DF_InvoiceOrder_AmountWriteOff')
  begin
    ALTER TABLE InvoiceOrder
    ADD CONSTRAINT DF_InvoiceOrder_AmountWriteOff DEFAULT 0 FOR AmountWriteOff 
  end
  ALTER TABLE InvoiceOrder
  ALTER COLUMN AmountWriteOff money not null


  IF not EXISTS (select * from sys.default_constraints where [name] = 'DF_OrderWriteOff_AmountWriteOff')
  begin
    ALTER TABLE OrderWriteOff
    ADD CONSTRAINT DF_OrderWriteOff_AmountWriteOff DEFAULT 0 FOR AmountWriteOff 
  end
    
  IF not EXISTS (select * from sys.default_constraints where [name] = 'DF_OrderWriteOff_AmountCredit')
  begin
    ALTER TABLE OrderWriteOff
    ADD CONSTRAINT DF_OrderWriteOff_AmountCredit DEFAULT 0 FOR AmountCredit 
  end
  
  ALTER TABLE OrderWriteOff
  ALTER COLUMN AmountCredit money not null
  
  Insert into #ChangeScript161_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript161_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript161_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 161, 'Add default value for all Amount column in InvoiceOrder, OrderWriteOff'

		print '**************************************************'
		print '*  db.01.00.161: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.161: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript161_stat%')
Begin
	drop table #ChangeScript161_stat
End
go
 
 
/*
 db.01.00.162:
 Does the following:
	Update CreatedBy from Employee to Person

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 162

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript162_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript162_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 162)
begin
	print '**************************************************'
	print '*  db.01.00.162: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript162_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript162_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update CreatedBy from Employee to Person                            *'
	print '***********************************************************************'

ALTER TABLE [dbo].[Invoice] drop CONSTRAINT [FK_Invoice_Employee]

Update [dbo].[Invoice]
set CreatedBy = Person.ID
from Invoice
join Employee on Invoice.CreatedBy=Employee.ID
join Person on Employee.PersonID=Person.ID

ALTER TABLE [dbo].[Invoice]  WITH CHECK ADD  CONSTRAINT [FK_Invoice_Person] FOREIGN KEY([CreatedBy])
REFERENCES [dbo].[Person] ([ID])

        Insert into #ChangeScript162_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript162_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript162_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 162, 'Update CreatedBy from Employee to Person'

		print '**************************************************'
		print '*  db.01.00.162: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.162: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript162_stat%')
Begin
	drop table #ChangeScript162_stat
End
go
 
 
/*
 db.01.00.163:
 Does the following:
	Add column InvalidForInvoice and InvalidReasonForInvoice

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 163

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript163_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript163_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 163)
begin
	print '**************************************************'
	print '*  db.01.00.163: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript163_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript163_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add column InvalidForInvoice and InvalidReasonForInvoice            *'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'InvalidForInvoice', 'Order') = -1
		ALTER TABLE dbo.[Order]
		ADD InvalidForInvoice bit NOT NULL CONSTRAINT DF_Order_InvalidForInvoice DEFAULT((0))
	
	IF dbo.SMM_CheckExists(6, 'InvalidReasonForInvoice', 'Order') = -1
		ALTER TABLE dbo.[Order]
		ADD InvalidReasonForInvoice nvarchar(255)

	Insert into #ChangeScript163_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript163_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript163_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 163, 'Add column InvalidForInvoice and InvalidReasonForInvoice'

		print '**************************************************'
		print '*  db.01.00.163: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.163: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript163_stat%')
Begin
	drop table #ChangeScript163_stat
End
go
 
 
/*
 db.01.00.164:
 Does the following:
	Rename the employee title

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 164

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript164_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript164_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 164)
begin
	print '**************************************************'
	print '*  db.01.00.164: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript164_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript164_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Rename the employee title                                           *'
	print '***********************************************************************'

		UPDATE [metadata].[EmployeeTitle] SET [Name] = 'Manager'
		WHERE ID = 3

        Insert into #ChangeScript164_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript164_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript164_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 164, 'Rename the employee title'

		print '**************************************************'
		print '*  db.01.00.164: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.164: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript164_stat%')
Begin
	drop table #ChangeScript164_stat
End
go
 
 
/*
 db.01.00.165:
 Does the following:
	Add InvoiceOrderBalance to OrderWriteOff

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 165

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript165_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript165_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 165)
begin
	print '**************************************************'
	print '*  db.01.00.165: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript165_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript165_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add InvoiceOrderBalance to OrderWriteOff                                   *'
	print '***********************************************************************'

  ALTER TABLE OrderWriteOff
  ADD InvoiceOrderBalance MONEY NOT NULL DEFAULT(0)
  
        Insert into #ChangeScript165_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript165_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript165_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 165, 'Add OrderBalance to OrderWriteOff'

		print '**************************************************'
		print '*  db.01.00.165: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.165: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript165_stat%')
Begin
	drop table #ChangeScript165_stat
End
go
 
 
/*
 db.01.00.166:
 Does the following:
	Add OrderingPartyUserID to IncompleteOrder and Order

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 166

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript166_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript166_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 166)
begin
	print '**************************************************'
	print '*  db.01.00.166: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript166_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript166_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add OrderingPartyUserID to IncompleteOrder and Order                            *'
	print '***********************************************************************'

	ALTER TABLE dbo.IncompleteOrder ADD
	OrderingPartyUserID uniqueidentifier NULL

	ALTER TABLE dbo.IncompleteOrder ADD CONSTRAINT
		FK_IncompleteOrder_OrderingPartyUser FOREIGN KEY
		(
		OrderingPartyUserID
		) REFERENCES dbo.OrderingPartyUser
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  CASCADE 
	 
	ALTER TABLE dbo.[Order] ADD
		OrderingPartyUserID uniqueidentifier NULL

	ALTER TABLE dbo.[Order] ADD CONSTRAINT
		FK_Order_OrderingPartyUser FOREIGN KEY
		(
		OrderingPartyUserID
		) REFERENCES dbo.OrderingPartyUser
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  CASCADE 

        Insert into #ChangeScript166_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript166_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript166_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 166, 'Add OrderingPartyUserID to IncompleteOrder and Order'

		print '**************************************************'
		print '*  db.01.00.166: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.166: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript166_stat%')
Begin
	drop table #ChangeScript166_stat
End
go
 
 
/*
 db.01.00.167:
 Does the following:
	- Delete InvoicePaymentDetailID in OrderReimbersement

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 167

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript167_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript167_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 167)
begin
	print '**************************************************'
	print '*  db.01.00.167: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript167_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript167_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Delete InvoicePaymentDetailID in OrderReimbersement                      *'
	print '***********************************************************************'

ALTER TABLE OrderReimbursement
DROP COLUMN InvoicePaymentDetailID

        Insert into #ChangeScript167_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript167_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript167_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 167, '- Delete InvoicePaymentDetailID in OrderReimbersement'

		print '**************************************************'
		print '*  db.01.00.167: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.167: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript167_stat%')
Begin
	drop table #ChangeScript167_stat
End
go
 
 
/*
 db.01.00.168:
 Does the following:
	- Add a column CustomizedSubject and CustomizedBody into EmailQueue

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 168

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript168_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript168_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 168)
begin
	print '**************************************************'
	print '*  db.01.00.168: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript168_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript168_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add a column CustomizedSubject and CustomizedBody into EmailQueue                      *'
	print '***********************************************************************'
	IF dbo.SMM_CheckExists(6, 'CustomizedSubject', 'EmailQueue') = -1
		ALTER TABLE dbo.[EmailQueue]
		ADD CustomizedSubject nvarchar(200) 
	IF dbo.SMM_CheckExists(6, 'CustomizedBody', 'EmailQueue') = -1
		ALTER TABLE dbo.[EmailQueue]
		ADD CustomizedBody nvarchar(MAX) 
	Insert into #ChangeScript168_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION
End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript168_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript168_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 168, '- Add a column CustomizedSubject and CustomizedBody into EmailQueue'

		print '**************************************************'
		print '*  db.01.00.168: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.168: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript168_stat%')
Begin
	drop table #ChangeScript168_stat
End
go
 
 
/*
 db.01.00.169:
 Does the following:
	- Remove NOT NULL attribute for AccountPayableID from AccountPayableDetail table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 169

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript169_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript169_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 169)
begin
	print '**************************************************'
	print '*  db.01.00.169: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript169_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript169_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************************************************'
	print '* Remove NOT NULL attribute for AccountPayableID from AccountPayableDetail table    *'
	print '*************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'AccountPayableID', 'AccountPayableDetail') = 0
		ALTER TABLE AccountPayableDetail
		ALTER COLUMN AccountPayableID int NULL		

        Insert into #ChangeScript169_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript169_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript169_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 169, '- Delete InvoicePaymentDetailID in OrderReimbersement'

		print '**************************************************'
		print '*  db.01.00.169: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.169: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript169_stat%')
Begin
	drop table #ChangeScript169_stat
End
go
 
 
/*
 db.01.00.170:
 Does the following:
	Update CreatedBy from Employee to Person

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 170

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript170_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript170_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 170)
begin
	print '**************************************************'
	print '*  db.01.00.170: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript170_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript170_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update CreatedBy from Employee to Person                            *'
	print '***********************************************************************'

ALTER TABLE [dbo].[OrderAdjustment] drop CONSTRAINT [FK_OrderAdjustment_Employee]

Update [dbo].[OrderAdjustment]
set CreatedBy = Person.ID
from OrderAdjustment
join Employee on OrderAdjustment.CreatedBy=Employee.ID
join Person on Employee.PersonID=Person.ID

ALTER TABLE [dbo].[OrderAdjustment]  WITH CHECK ADD  CONSTRAINT [FK_OrderAdjustment_Person] FOREIGN KEY([CreatedBy])
REFERENCES [dbo].[Person] ([ID])

        Insert into #ChangeScript170_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript170_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript170_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 170, 'Update CreatedBy from Employee to Person'

		print '**************************************************'
		print '*  db.01.00.170: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.170: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript170_stat%')
Begin
	drop table #ChangeScript170_stat
End
go
 
 
/*
 db.01.00.171:
 Does the following:
	- Add a field, which is OwnerID, to Group table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 171

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript171_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript171_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 171)
begin
	print '**************************************************'
	print '*  db.01.00.171: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript171_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript171_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************************************************'
	print '* Add a field, which is OwnerID, to Group table    *'
	print '*************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'OwnerID', 'Group') = -1
		ALTER TABLE [dbo].[Group]
		ADD OwnerID uniqueidentifier NULL		

		ALTER TABLE [dbo].[Group]
		ADD CONSTRAINT
        FK_Party_Group FOREIGN KEY
        (
        OwnerID
        ) REFERENCES [dbo].[Party]
        (
        ID
        ) ON UPDATE  NO ACTION
		ON DELETE  NO ACTION 
        Insert into #ChangeScript171_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript171_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript171_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 171, '- Add OwnerID to Group'

		print '**************************************************'
		print '*  db.01.00.171: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.171: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript171_stat%')
Begin
	drop table #ChangeScript171_stat
End
go
 
 
/*
 db.01.00.172:
 Does the following:
	- Add a field CanViewGroupOrders to OrderingPartyUser table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 172

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript172_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript172_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 172)
begin
	print '**************************************************'
	print '*  db.01.00.172: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript172_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript172_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************************************************'
	print '* Add a field CanViewGroupOrders to OrderingPartyUser table    *'
	print '*************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'CanViewGroupOrders', 'OrderingPartyUser') = -1
		ALTER TABLE [dbo].[OrderingPartyUser]
		ADD CanViewGroupOrders bit NOT NULL  DEFAULT (0)				
        Insert into #ChangeScript172_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript172_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript172_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 172, '- Add CanViewGroupOrders to OrderingPartyUser'

		print '**************************************************'
		print '*  db.01.00.172: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.172: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript172_stat%')
Begin
	drop table #ChangeScript172_stat
End
go
 
 
/*
 db.01.00.173:
 Does the following:
	Alter OrderAjustment CreatedBy not null

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 173

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript173_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript173_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 173)
begin
	print '**************************************************'
	print '*  db.01.00.173: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript173_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript173_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Alter OrderAjustment CreatedBy not null                            *'
	print '***********************************************************************'

  update OrderAdjustment
  set CreatedBy=[user].PersonID
  from [User]
  where [User].UserName='admin'
  and CreatedBy is null
  
  ALTER TABLE OrderAdjustment
  ALTER COLUMN CreatedBy uniqueidentifier not null
  
  Insert into #ChangeScript173_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript173_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript173_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 173, 'Alter OrderAjustment CreatedBy not null'

		print '**************************************************'
		print '*  db.01.00.173: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.173: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript173_stat%')
Begin
	drop table #ChangeScript173_stat
End
go
 
 
/*
 db.01.00.174:
 Does the following:
	Update CreatedBy from Employee to Person

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 174

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript174_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript174_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 174)
begin
	print '**************************************************'
	print '*  db.01.00.174: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript174_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript174_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update CreatedBy from Employee to Person                            *'
	print '***********************************************************************'

ALTER TABLE [dbo].[Payment] drop CONSTRAINT [FK_Payment_Employee]

Update [dbo].[Payment]
set CreatedBy = Person.ID
from Payment
join Employee on Payment.CreatedBy=Employee.ID
join Person on Employee.PersonID=Person.ID

ALTER TABLE [dbo].[Payment]  WITH CHECK ADD  CONSTRAINT [FK_Payment_Person] FOREIGN KEY([CreatedBy])
REFERENCES [dbo].[Person] ([ID])

        Insert into #ChangeScript174_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript174_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript174_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 174, 'Update CreatedBy from Employee to Person'

		print '**************************************************'
		print '*  db.01.00.174: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.174: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript174_stat%')
Begin
	drop table #ChangeScript174_stat
End
go
 
 
/*
 db.01.00.175:
 Does the following:
	Add ApprovedDate to OrderWriteOff

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 175

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript175_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript175_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 175)
begin
	print '**************************************************'
	print '*  db.01.00.175: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript175_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript175_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add ApprovedDate to OrderWriteOff                                   *'
	print '***********************************************************************'

  ALTER TABLE OrderWriteOff
  ADD ApprovedDate datetime null
  
        Insert into #ChangeScript175_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript175_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript175_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 175, 'Add ApprovedDate to OrderWriteOff'

		print '**************************************************'
		print '*  db.01.00.175: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.175: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript175_stat%')
Begin
	drop table #ChangeScript175_stat
End
go
 
 
/*
 db.01.00.176:
 Does the following:
	Add ApprovedBy to OrderWriteOff

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 176

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript176_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript176_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 176)
begin
	print '**************************************************'
	print '*  db.01.00.176: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript176_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript176_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add ApprovedBy to OrderWriteOff                                   *'
	print '***********************************************************************'

  ALTER TABLE OrderWriteOff
  ADD ApprovedBy uniqueidentifier null
  
  ALTER TABLE [dbo].[OrderWriteOff]  WITH CHECK ADD  CONSTRAINT [FK_OrderWriteOff_ApprovedBy] FOREIGN KEY([ApprovedBy])
  REFERENCES [dbo].[Person] ([ID])

        Insert into #ChangeScript176_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript176_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript176_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 176, 'Add ApprovedBy to OrderWriteOff'

		print '**************************************************'
		print '*  db.01.00.176: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.176: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript176_stat%')
Begin
	drop table #ChangeScript176_stat
End
go
 
 
/*
 db.01.00.177:
 Does the following:
	Add ApprovedBy, ApprovedDate to OrderAdjustment

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 177

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript177_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript177_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 177)
begin
	print '**************************************************'
	print '*  db.01.00.177: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript177_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript177_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add ApprovedBy, ApprovedDate to OrderAdjustment                     *'
	print '***********************************************************************'

  ALTER TABLE [OrderAdjustment]
  ADD ApprovedBy uniqueidentifier null
  
  ALTER TABLE [dbo].[OrderAdjustment]  WITH CHECK ADD  CONSTRAINT [FK_OrderAdjustment_ApprovedBy] FOREIGN KEY([ApprovedBy])
  REFERENCES [dbo].[Person] ([ID])
  
  ALTER TABLE OrderAdjustment
  ADD ApprovedDate datetime null

        Insert into #ChangeScript177_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript177_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript177_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 177, 'Add ApprovedBy, ApprovedDate to OrderAdjustment'

		print '**************************************************'
		print '*  db.01.00.177: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.177: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript177_stat%')
Begin
	drop table #ChangeScript177_stat
End
go
 
 
/*
 db.01.00.178:
 Does the following:
	Add AlertDateBeforeCredentialingExpiration Configure
	Update Body in EmailTemplate for Credentialing Expire notification
	Update Body in EmailTemplate for New Credentialing Request

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 178

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript178_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript178_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 178)
begin
	print '**************************************************'
	print '*  db.01.00.178: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript178_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript178_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add AlertDateBeforeCredentialingExpiration Configure                     *'
	print '* Update Body in EmailTemplate for Credentialing Expire notification *'
	print '* Update Body in EmailTemplate for New Credentialing Request *'
	print '***********************************************************************'
	insert into dbo.Configuration
	values (9, 'AlertDateBeforeCredentialingExpiration', 3, 'When will we send the expiration notification?')
	
	Update [dbo].[EmailTemplate]
	set Body = 'Dear {SPName},

We are writing this email to notify you that the some of your credentialings are going to be expired. See the details elow:
	Credential Name			Expired Date
{ListCredential}

Could you please provide us the new ones
Thank you very much for your co-operation

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com'
	where ID='b2c80170-c8a0-4b69-88be-d3dbab99ae0f'
	
	Update [dbo].[EmailTemplate]
	set Body = 'Dear {SPName},

We are writing this email to thank for your joining with us the mobile medic exam service.
Could you please provide us the following documents:
{ListCredential}

We are looking forward to get these documents from you soon.
Thank you very much for your co-operation.

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com'
	where ID='C85B72E3-6A02-4366-9386-0D18A1D6337A'
	
	Insert into #ChangeScript178_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript178_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript178_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 178, 'Add AlertDateBeforeCredentialingExpiration Configure,Update Body in EmailTemplate for Credentialing Expire notification,Update Body in EmailTemplate for New Credentialing Request'

		print '**************************************************'
		print '*  db.01.00.178: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.178: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript178_stat%')
Begin
	drop table #ChangeScript178_stat
End
go
 
 
/*
 db.01.00.179:
 Does the following:
	Remove BillingInformationID column from Invoice table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 179

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript179_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript179_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 179)
begin
	print '**************************************************'
	print '*  db.01.00.179: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript179_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript179_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Remove BillingInformationID column from Invoice table               *'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(2, 'FK_Invoice_BillingInformation', 'Invoice') = 0
		ALTER TABLE dbo.Invoice
		DROP FK_Invoice_BillingInformation
		
	IF dbo.SMM_CheckExists(6, 'BillingInformationID', 'Invoice') = 0
		ALTER TABLE dbo.Invoice
		DROP COLUMN BillingInformationID
	
	Insert into #ChangeScript179_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript179_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript179_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 179, 'Add AlertDateBeforeCredentialingExpiration Configure,Update Body in EmailTemplate for Credentialing Expire notification,Update Body in EmailTemplate for New Credentialing Request'

		print '**************************************************'
		print '*  db.01.00.179: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.179: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript179_stat%')
Begin
	drop table #ChangeScript179_stat
End
go
 
 
/*
 db.01.00.180:
 Does the following:
    add CanPlaceOrder column into [dbo].[ServiceProvider] table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 180

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript180_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript180_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 180)
begin
	print '**************************************************'
	print '*  db.01.00.180: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript180_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript180_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add CanPlaceOrder column into [dbo].[ServiceProvider] table *'
	print '***********************************************************************'

	ALTER TABLE dbo.ServiceProvider ADD
	CanPlaceOrder bit NOT NULL default 0

        Insert into #ChangeScript180_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript180_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript180_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 180, 'add CanPlaceOrder column into [dbo].[ServiceProvider] table '

		print '**************************************************'
		print '*  db.01.00.180: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.180: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript180_stat%')
Begin
	drop table #ChangeScript180_stat
End
go
 
 
/*
 db.01.00.181:
 Does the following:
	- Update Body in EmailTemplate for New office note notification

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 181

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript181_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript181_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 181)
begin
	print '**************************************************'
	print '*  db.01.00.181: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript181_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript181_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Update Body in EmailTemplate for New office note notification                      *'
	print '***********************************************************************'
	Update [dbo].[EmailTemplate]
	set Body = 'Dear {PersonName},

We are writing this email to notify you that the new office note has been posted. See the description below:
	Office Note: {OfficeNote}
	Posted Date: {PostedDate}
	Posted By: {PostedBy}

Click on below link to view the office note.
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com'
	where ID='f205db95-98eb-4c2b-88f8-fa487d2e3e7e'
	Insert into #ChangeScript181_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION
End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript181_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript181_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 181, '- Update Body in EmailTemplate for New office note notification'

		print '**************************************************'
		print '*  db.01.00.181: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.181: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript181_stat%')
Begin
	drop table #ChangeScript181_stat
End
go
 
 
/*
 db.01.00.182:
 Does the following:
	Add Number of Expired Date for Invoice into Configuration table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 182

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript182_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript182_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 182)
begin
	print '**************************************************'
	print '*  db.01.00.182: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript182_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript182_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add Number of Expired Date for Invoice into Configuration table     *'
	print '***********************************************************************'
	
	INSERT INTO Configuration(ID, [Name], [Value], Description)
	VALUES(10,'ExpiredDaysForInvoice','14','Number of expired days for Invoice from generated date ')
	
	Insert into #ChangeScript182_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript182_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript182_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 182, 'Add AlertDateBeforeCredentialingExpiration Configure,Update Body in EmailTemplate for Credentialing Expire notification,Update Body in EmailTemplate for New Credentialing Request'

		print '**************************************************'
		print '*  db.01.00.182: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.182: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript182_stat%')
Begin
	drop table #ChangeScript182_stat
End
go
 
 
/*
 db.01.00.183:
 Does the following:
	Add MissingType into Order table to classify missing orders

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 183

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript183_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript183_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 183)
begin
	print '**************************************************'
	print '*  db.01.00.183: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript183_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript183_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add MissingType into Order table to classify missing orders		 *'
	print '***********************************************************************'
	
	IF dbo.SMM_CheckExists(6, 'MissingType', '[Order]') = -1
		ALTER TABLE [Order]
		ADD MissingType int
	
	Insert into #ChangeScript183_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript183_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript183_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 183, 'Add AlertDateBeforeCredentialingExpiration Configure,Update Body in EmailTemplate for Credentialing Expire notification,Update Body in EmailTemplate for New Credentialing Request'

		print '**************************************************'
		print '*  db.01.00.183: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.183: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript183_stat%')
Begin
	drop table #ChangeScript183_stat
End
go
 
 
/*
 db.01.00.186:
 Does the following:
	Add InvoiceOrderBalance to OrderAdjustment

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 186

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript186_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript186_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 186)
begin
	print '**************************************************'
	print '*  db.01.00.186: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript186_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript186_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add InvoiceOrderBalance to OrderAdjustment                                   *'
	print '***********************************************************************'

  ALTER TABLE OrderAdjustment
  ADD InvoiceOrderBalance MONEY NOT NULL DEFAULT(0)
  
        Insert into #ChangeScript186_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript186_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript186_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 186, 'Add OrderBalance to OrderAdjustment'

		print '**************************************************'
		print '*  db.01.00.186: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.186: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript186_stat%')
Begin
	drop table #ChangeScript186_stat
End
go
 
 
/*
 db.01.00.187:
 Does the following:
	change PermissionType.Name length, add metadata for PermissionType & UserRolePermission

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 187

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript187_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript187_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 187)
begin
	print '**************************************************'
	print '*  db.01.00.187: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript187_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript187_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* change PermissionType.Name length, add metadata for PermissionType                          *'
	print '***********************************************************************'
	
	alter table metadata.permissiontype alter column [Name] nvarchar(70)
	
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(5,'Post-OrderStatus-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(6,'Post-OrderStatus-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(7,'Post-OrderStatus-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(8,'Post-OrderStatus-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(9,'Post-OrderStatus-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(10,'Post-OrderStatus-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(11,'Post-OrderStatus-OrderStatus(Canceled)',NULL)
	
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(12,'View-OrderStatus',NULL)
	
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(19,'Update-OrderInfo-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(20,'Update-OrderInfo-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(21,'Update-OrderInfo(Paramed)-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(22,'Update-OrderInfo(Direct)-OrderStatus(Completed)', NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(23,'Update-OrderInfo-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(24,'Update-OrderInfo-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(25,'Update-OrderInfo-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(26,'Update-OrderInfo-OrderStatus(Canceled)',NULL)
	
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(27,'View-OrderInformation',NULL)
	

	/* Permission for Related Order */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(28,'Add-RelatedOrder-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(29,'Add-RelatedOrder-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(30,'Add-RelatedOrder-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(31,'Add-RelatedOrder-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(32,'Add-RelatedOrder-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(33,'Add-RelatedOrder-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(34,'Add-RelatedOrder-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(35,'View-RelatedOrder',NULL)
	
	/* Permission for Ordering Party */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(36,'Update-OP-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(37,'Update-OP-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(38,'Update-OP-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(39,'Update-OP-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(40,'Update-OP-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(41,'Update-OP-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(42,'Update-OP-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(43,'View-OrderingParty',NULL)
	
	/* Permission for Ordering Party Mailing Instruction */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(44,'Update-OPMailInstruct-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(45,'Update-OPMailInstruct-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(46,'Update-OPMailInstruct-OrderStatus(Completed',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(47,'Update-OPMailInstruct-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(48,'Update-OPMailInstruct-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(49,'Update-OPMailInstruct-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(50,'Update-OPMailInstruct-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(51,'View-OPMailInstruct',NULL)
	
	/* Permission for Agent / Agentcy Information */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(52,'Update-AgentAgencyInfo-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(53,'Update-AgentAgencyInfo-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(54,'Update-AgentAgencyInfo-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(55,'Update-AgentAgencyInfo-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(56,'Update-AgentAgencyInfo-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(57,'Update-AgentAgencyInfo-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(58,'Update-AgentAgencyInfo-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(59,'View-AgentAgencyInfo',NULL)
	
	/* Permission for Partner Information */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(60,'View-PartnerInfo',NULL)
	
	/* Permission for Insurance Information */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(61,'Update-InsuranceInfo-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(62,'Update-InsuranceInfo-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(63,'Update-InsuranceInfo-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(64,'Update-InsuranceInfo-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(65,'Update-InsuranceInfo-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(66,'Update-InsuranceInfo-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(67,'Update-InsuranceInfo-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(68,'View-InsuranceInfo',NULL)
	
	/* Permission for SMM Mailing */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(69,'Update-SMMMailing-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(70,'Update-SMMMailing-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(71,'Update-SMMMailing-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(72,'Update-SMMMailing-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(73,'Update-SMMMailing-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(74,'Update-SMMMailing-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(75,'Update-SMMMailing-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(76,'View-SMMMailing',NULL)
	
	/* Permission for Ordering Lab */
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(77,'OrderLab_Update_IfNew',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(78,'OrderLab_Update_IfProcessing',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(79,'OrderLab_Update_IfCompleted',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(80,'OrderLab_Update_IfVerified',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(81,'OrderLab_Update_IfClosed',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(82,'OrderLab_Update_IfOnHold',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(83,'OrderLab_Update_IfCanceled',NULL)*/

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(84,'View-OrderLab',NULL)
	
	/* Permission for Reminder - TBD */

	
	/* Permission for Applicant Profile */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(85,'Update-ApplicantProfile-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(86,'Update-ApplicantProfile-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(87,'Update-ApplicantProfile-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(88,'Update-ApplicantProfile-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(89,'Update-ApplicantProfile-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(90,'Update-ApplicantProfile-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(91,'Update-ApplicantProfile-OrderStatus(Canceled)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(92,'Update-ApplicantProfile-SSN&DOB',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(93,'ApplicantProfile_View',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(94,'ApplicantProfile_View_SSNAndDOB',NULL)
	
	/* Permission for Applicant Contact Information */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(95,'Update-AppContactInfo-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(96,'Update-AppContactInfo-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(97,'Update-AppContactInfo-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(98,'Update-AppContactInfo-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(99,'Update-AppContactInfo-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(100,'Update-AppContactInfo-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(101,'Update-AppContactInfo-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(102,'View-ApplicantContactInfo',NULL)
	
	/* Permission for Applicant Schedule */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(103,'Update-AppSchedule-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(104,'Update-AppSchedule-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(105,'Update-AppSchedule-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(106,'Update-AppSchedule-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(107,'Update-AppSchedule-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(108,'Update-AppSchedule-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(109,'Update-AppSchedule-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(110,'ApplicantSchedule_View',NULL)
	
	/* Permission for Order Assignment Status */
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(111,'OrderAssignmentStatus_Update_IfNew',NULL)*/
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(112,'Update-AssignmentStatus-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(113,'Update-AssignmentStatus-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(114,'Update-AssignmentStatus-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(115,'Update-AssignmentStatus-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(116,'Update-AssignmentStatus-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(117,'Update-AssignmentStatus-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(118,'View-AssignmentStatus',NULL)
	
	/* Permission for Order Assignment Fee */
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(119,'OrderAssignmentFee_Update_IfNew',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(120,'OrderAssignmentFee_Update_IfProcessing',NULL)*/
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(121,'Update-AssignmentFee-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(122,'Update-AssignmentFee-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(123,'Update-AssignmentFee-OrderStatus(Closed)',NULL)
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(124,'OrderAssignmentFee_Update_IfOnHold',NULL)*/
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(125,'Update-AssignmentFee-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(126,'View-AssignmentFee',NULL)
	
	/* Permission for Order Assignment Kit */
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(127,'OrderAssignmentKit_Update_IfNew',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(128,'OrderAssignmentKit_Update_IfProcessing',NULL)*/
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(129,'Update-Kit-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(130,'Update-Kit-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(131,'Update-Kit-OrderStatus(Closed)',NULL)
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(132,'OrderAssignmentKit_Update_IfOnHold',NULL)*/
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(133,'Update-Kit-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(134,'View-AssignmentKit',NULL)
	
	/* Permission for Order Document */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(135,'Update-Document-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(136,'Update-Document-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(137,'Update-Document-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(138,'Update-Document-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(139,'Update-Document-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(140,'Update-Document-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(141,'Update-Document-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(142,'View-OrderDocument',NULL)
	
	/* Permission for Order Rating */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(143,'Update-Rating-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(144,'Update-Rating-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(145,'Update-Rating-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(146,'Update-Rating-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(147,'Update-Rating-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(148,'Update-Rating-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(149,'Update-Rating-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(150,'View-Rating',NULL)
	
	/* Permission for Even Log */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(151,'View-EventLog',NULL)
	
	/* Permission for Order Requirement */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(152,'Update-Requirement-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(153,'Update-Requirement-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(154,'Update-Requirement-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(155,'Update-Requirement-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(156,'Update-Requirement-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(157,'Update-Requirement-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(158,'Update-Requirement-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(159,'OrderRequirement_View',NULL)
	
	/* Permission for Order Billing */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(160,'Update-Billing-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(161,'Update-Billing-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(162,'Update-Billing-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(163,'Update-Billing-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(164,'Update-Billing-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(165,'Update-Billing-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(166,'Update-Billing-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(167,'View-BillingInfo',NULL)
	
	/* Permission for Order Finance */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(168,'OrderFinance_View',NULL)
	
	/* Permission for Order Office Note */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(169,'Post-OfficeNote-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(170,'Post-OfficeNote-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(171,'Post-OfficeNote-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(172,'Post-OfficeNote-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(173,'Post-OfficeNote-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(174,'Post-OfficeNote-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(175,'Post-OfficeNote-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(176,'OrderOfficeNote_View',NULL)
	
	/* Permission for Order Question and Answer */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(177,'Post-Q&A-OrderStatus(New)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(178,'Post-Q&A-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(179,'Post-Q&A-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(180,'Post-Q&A-OrderStatus(Verified',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(181,'Post-Q&A-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(182,'Post-Q&A-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(183,'Post-Q&A-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(184,'View-OrderQuestion&Answer',NULL)
	
	/* Permission for Order Assignment Instruction */
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(185,'View-OrderAssignmentInstruction',NULL)
	
	/* Permission for Ordering Assignment Paperwork Information */
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(186,'OrderAssignmentPaperworkInformation_Update_IfNew',NULL)*/
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(187,'Update-PaperworkInfo-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(188,'Update-PaperworkInfo-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(189,'Update-PaperworkInfo-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(190,'Update-PaperworkInfo-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(191,'Update-PaperworkInfo-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(192,'Update-PaperworkInfo-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(193,'View-PaperworkInfo',NULL)
	
	/* Permission for Ordering Assignment Paperwork */
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(194,'OrderAssignmentPaperwork_Create_IfNew',NULL)*/
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(195,'Upload-Paperwork-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(196,'Upload-Paperwork-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(197,'Upload-Paperwork-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(198,'Upload-Paperwork-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(199,'Upload-Paperwork-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(200,'UPaperwork_Create_IfCanceled',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(201,'View-Paperwork',NULL)
	
	/* Permission for Ordering Assignment Paperwork Status */
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(202,'OrderAssignmentPaperworkStatus_Create_IfNew',NULL)*/
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(203,'Post-PaperworkStatus-OrderStatus(Processing)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(204,'Post-PaperworkStatus-OrderStatus(Completed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(205,'Post-PaperworkStatus-OrderStatus(Verified)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(206,'Post-PaperworkStatus-OrderStatus(Closed)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(207,'Post-PaperworkStatus-OrderStatus(OnHold)',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(208,'Post-PaperworkStatus-OrderStatus(Canceled)',NULL)

	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(209,'View-PaperworkStatus',NULL)
	
	/* Permission for Order Detail */
	/*INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(210,'Order_View_OrderingParty',NULL)
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(211,'Order_View_ServiceProvider',NULL)*/
	INSERT [metadata].[PermissionType] ([ID],[Name],[Description])VALUES(212,'View-Order',NULL)
	
        Insert into #ChangeScript187_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript187_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript187_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 187, 'change PermissionType.Name length, add metadata for PermissionType & UserRolePermission'

		print '**************************************************'
		print '*  db.01.00.187: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.187: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript187_stat%')
Begin
	drop table #ChangeScript187_stat
End
go
 
 
/*
 db.01.00.188:
 Does the following:
	Add PaymentAvailable to InvoicePaymentDetail

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 188

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript188_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript188_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 188)
begin
	print '**************************************************'
	print '*  db.01.00.188: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript188_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript188_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add PaymentAvailable to InvoicePaymentDetail                               *'
	print '***********************************************************************'

  ALTER TABLE InvoicePaymentDetail
  ADD PaymentAvailable MONEY NOT NULL DEFAULT(0)
  
        Insert into #ChangeScript188_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript188_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript188_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 188, 'Add PaymentAvailable to InvoicePaymentDetail'

		print '**************************************************'
		print '*  db.01.00.188: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.188: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript188_stat%')
Begin
	drop table #ChangeScript188_stat
End
go
 
 
/*
 db.01.00.189:
 Does the following:
	Add column Add ExpiredDateRequired column to [metadata].[documenttype]

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 189

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript189_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript189_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 189)
begin
	print '**************************************************'
	print '*  db.01.00.189: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript189_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript189_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add column ExpiredDateRequired to [metadata].[documenttype]                                     *'
	print '***********************************************************************'

	IF dbo.SMM_CheckExists(6, 'ExpiredDateRequired', 'DocumentType') = -1
		ALTER TABLE [metadata].[documenttype]
		ADD ExpiredDateRequired bit NOT NULL  CONSTRAINT DF_DocumentType_ExpiredDateRequired DEFAULT ((0))
	
	Insert into #ChangeScript189_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript189_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript189_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 189, 'Add column ExpiredDateRequired'

		print '**************************************************'
		print '*  db.01.00.189: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.189: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript189_stat%')
Begin
	drop table #ChangeScript189_stat
End
go
 
 
/*
 db.01.00.190:
 Does the following:
    add IsCanceled column into [dbo].[OrderAssignment] table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 190

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript190_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript190_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 190)
begin
	print '**************************************************'
	print '*  db.01.00.190: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript190_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript190_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add IsCanceled column into [dbo].[OrderAssignment] table *'
	print '***********************************************************************'

	ALTER TABLE dbo.OrderAssignment ADD
	IsCanceled bit NOT NULL default 0

        Insert into #ChangeScript190_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript190_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript190_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 190, 'add IsCanceled column into [dbo].[OrderAssignment] table '

		print '**************************************************'
		print '*  db.01.00.190: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.190: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript190_stat%')
Begin
	drop table #ChangeScript190_stat
End
go
 
 
/*
 db.01.00.191:
 Does the following:
	Update data to [metadata].[documenttype]

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 191

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript191_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript191_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 191)
begin
	print '**************************************************'
	print '*  db.01.00.191: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript191_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript191_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION
	
	print '***********************************************************************'
	print '* Update data to [metadata].[documenttype]  table                     *'
	print '***********************************************************************'
	
	UPDATE [metadata].[DocumentType] SET [Name] = N'Application' WHERE ID = 7
	UPDATE [metadata].[DocumentType] SET [ExpiredDateRequired] = 1 WHERE ID = 8
	UPDATE [metadata].[DocumentType] SET [ExpiredDateRequired] = 1 WHERE ID = 11
	UPDATE [metadata].[DocumentType] SET [Name] = N'Privacy Agreement (EMSI)' WHERE ID = 13

	print '***********************************************************************'
	print '* Insert data to [metadata].[documenttype]  table                     *'
	print '***********************************************************************'
	
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (20,N'Liability Insurance', 2, 1)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (21,N'Reference Form', 2, 0) 
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (22, N'Experience Form', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (23, N'EMSI Examiner Code', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (24, N'MD Form', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (25, N'Medical License', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (26, N'Areas Document', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (27, N'Error Reports', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (28, N'Criminal History', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (29, N'MME Reference (CA)', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (30, N'CPT-1 (CA)', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (31, N'Addendum (EMSI)', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (32, N'CCR Authorization (EMSI)', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (33, N'Ethics Form (EMSI)', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (34, N'CCR Authorization (PORTA)', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (35, N'Billing Document', 2, 0)
	INSERT INTO [metadata].[DocumentType] ([ID], [Name], [DocumentClassifierID],[ExpiredDateRequired] ) VALUES (36, N'Other', 2, 0)
	

	Insert into #ChangeScript191_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript191_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript191_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 191, 'Update data to [metadata].[documenttype]'

		print '**************************************************'
		print '*  db.01.00.191: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.191: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript191_stat%')
Begin
	drop table #ChangeScript191_stat
End
go
 
 
/*
 db.01.00.193:
 Does the following:
	Add 3 columns InvoiceOtherPartyNote,Chargeback and RelatedInvoiceOrderID to table InvoiceOrder

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 193

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript193_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript193_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 193)
begin
	print '**************************************************'
	print '*  db.01.00.193: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript193_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript193_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add 3 column InvoiceOtherPartyNote,Chargeback and RelatedInvoiceOrderID to table InvoiceOrder*'
	print '***********************************************************************'

	ALTER TABLE dbo.[InvoiceOrder]
		ADD Chargeback money NULL

	ALTER TABLE dbo.[InvoiceOrder]
		ADD RelatedInvoiceOrderID uniqueidentifier NULL

	ALTER TABLE dbo.[InvoiceOrder]
		ADD InvoiceOtherPartyNote nvarchar(1000) NULL

        Insert into #ChangeScript193_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript193_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript193_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 193, 'Add 2 column InvoiceOtherPartyNote,Chargeback and RelatedInvoiceOrderID to table InvoiceOrder'

		print '**************************************************'
		print '*  db.01.00.193: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.193: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript193_stat%')
Begin
	drop table #ChangeScript193_stat
End
go
 
 
/*
 db.01.00.194:
 Does the following:
	- Insert Supply Department row into Table dbo.Configuration

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 194

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript194_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript194_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 194)
begin
	print '**************************************************'
	print '*  db.01.00.194: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript194_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript194_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Insert Supply Department row into Table dbo.Configuration           *'
	print '***********************************************************************'
		
		INSERT INTO dbo.Configuration(ID, [Name], [Value], Description) 
			VALUES(11, 'SupplyDeparment', '', 'ID of Supply Department')

		INSERT INTO dbo.EmailTemplate(ID, Subject, Body, CreatedDate, ModifiedDate)
			VALUES(newid(),
'New Supply Order notification', 
'Dear {PersonName},    

We are writing this email to notify that a new supply order has been placed. See the details below:   
	Supply order number {SO_Num}   
	Place by {ServiceProviderName}   on {PlaceDate}       

Sincerely,  
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108  
P.O. Box 639014  
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)  
Fax (888) 548-3926  
Email: cs@superiormobilemedics.com', GetDate(), GetDate())

        Insert into #ChangeScript194_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript194_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript194_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 194, 'Insert Supply Department row into Table dbo.Configuration'

		print '**************************************************'
		print '*  db.01.00.194: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.194: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript194_stat%')
Begin
	drop table #ChangeScript194_stat
End
go
 
 
/*
 db.01.00.195:
 Does the following:
	- Add Receive coloumn into dbo.SaleOrderDetail

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 195

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript195_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript195_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 195)
begin
	print '**************************************************'
	print '*  db.01.00.195: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript195_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript195_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add Receive coloumn into dbo.SaleOrderDetail						 *'
	print '***********************************************************************'
		
		ALTER TABLE dbo.SaleOrderDetail ADD
			[Receive] int NULL
		ALTER TABLE dbo.RequirementType ADD
			DeletedDate datetime NULL
		ALTER TABLE dbo.RequirementType ADD
			CreatedDate datetime NOT NULL DEFAULT GetDate()
		ALTER TABLE dbo.RequirementType ADD
			ModifiedDate datetime NOT NULL DEFAULT GetDate()

        Insert into #ChangeScript195_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript195_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript195_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 195, 'Add Receive coloumn into dbo.SaleOrderDetail'

		print '**************************************************'
		print '*  db.01.00.195: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.195: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript195_stat%')
Begin
	drop table #ChangeScript195_stat
End
go
 
 
/*
 db.01.00.196:
 Does the following:
	Add column CorrectionType to table InvoiceOrder

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 196

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript196_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript196_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 196)
begin
	print '**************************************************'
	print '*  db.01.00.196: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript196_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript196_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add column CorrectionType to table InvoiceOrder                     *'
	print '***********************************************************************'

	ALTER TABLE dbo.[InvoiceOrder]
		ADD CorrectionType nvarchar(1000) NULL

        Insert into #ChangeScript196_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript196_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript196_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 196, 'Add column CorrectionType to table InvoiceOrder'

		print '**************************************************'
		print '*  db.01.00.196: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.196: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript196_stat%')
Begin
	drop table #ChangeScript196_stat
End
go
 
 
/*
 db.01.00.200:
 Does the following:
	Delete data in metadata GovIDType table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 200

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript200_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript200_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 200)
begin
	print '**************************************************'
	print '*  db.01.00.200: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript200_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript200_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Delete data in metadata GovIDType table                             *'
	print '***********************************************************************'

  UPDATE Party SET GovIDTypeID = 1 WHERE GovIDTypeID > 2 AND GovIDTypeID < 19
  DELETE FROM [metadata].[GovIDType] WHERE ID not in (0,1,2,2147483647)
  
  UPDATE [metadata].[GovIDType] SET AbbrName = 'Other' WHERE ID = 2147483647
        Insert into #ChangeScript200_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript200_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript200_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 200, 'Delete data in metadata GovIDType table'

		print '**************************************************'
		print '*  db.01.00.200: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.200: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript200_stat%')
Begin
	drop table #ChangeScript200_stat
End
go
 
 
/*
 db.01.00.201:
 Does the following tasks:
 - Table Table SaleOrder: Add Note column
 - Table PurchaseOrder: Add Note column, Modify Tracking Code to allow null
Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 201
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript201_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript201_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 201)
begin
	print '**************************************************'
	print '*  db.01.00.201: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript201_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript201_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION
	
	
	print '***********************************************************'
	print '* Table SaleOrder: Add Note column      *'
	print '* Table PurchaseOrder: Add Note column, Modify Tracking Code to allow null*'
	print '***********************************************************'	
		
	IF dbo.SMM_CheckExists(6, 'AdditionalNote', 'SaleOrder') = -1
		ALTER TABLE [dbo].[SaleOrder]
		ADD [AdditionalNote] [nvarchar](200) NULL
	
	IF dbo.SMM_CheckExists(6, 'AdditionalNote', 'PurchaseOrder') = -1
		ALTER TABLE [dbo].[PurchaseOrder]
		ADD [AdditionalNote] [nvarchar](200) NULL
		
	IF dbo.SMM_CheckExists(6, 'TrackingCode', 'PurchaseOrder') = 0
		ALTER TABLE [dbo].[PurchaseOrder]
		ALTER COLUMN TrackingCode [nvarchar](50) NULL
		
	Insert into #ChangeScript201_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript201_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript201_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 201, 'SaleOrder (Add column Note), PurchaseOrder (Add column Note)'

		print '**************************************************'
		print '*  db.01.00.201: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.201: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript201_stat%')
Begin
	drop table #ChangeScript201_stat
End
go
 
 
/*
 db.01.00.202:
 Does the following tasks:
 - Table Credentialing: Add IsMailed column
Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 202
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript202_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript202_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 202)
begin
	print '**************************************************'
	print '*  db.01.00.202: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript202_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript202_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION
	
	
	print '***********************************************************'
	print '* Table Credentialing: Add IsMailed column      *'
	print '***********************************************************'	
		
	IF dbo.SMM_CheckExists(6, 'IsMailed', '[Credentialing]') = -1
		ALTER TABLE [dbo].[Credentialing]
		ADD [IsMailed] [bit]  NOT NULL CONSTRAINT [DF_Credentialing_IsMailed]  DEFAULT ((0))
	
	Insert into #ChangeScript202_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript202_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript202_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 202, 'Table Credentialing: Add IsMailed column'

		print '**************************************************'
		print '*  db.01.00.202: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.202: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript202_stat%')
Begin
	drop table #ChangeScript202_stat
End
go
 
 
/*
 db.01.00.204:
 Does the following task:
 - Table PurchaseOrderDetail: Add Received column

Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 204
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript204_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript204_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 204)
begin
	print '**************************************************'
	print '*  db.01.00.204: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript204_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript204_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************'
	print '* Table PurchaseOrderDetail: Add Received column*'
	print '*************************************************'

	IF dbo.SMM_CheckExists(6, 'Received', 'PurchaseOrderDetail') = -1
		ALTER TABLE [dbo].[PurchaseOrderDetail]
		ADD Received int NULL
		CONSTRAINT [DF_PurchaseOrderDetail_Received]  DEFAULT (0)

	Insert into #ChangeScript204_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript204_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript204_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 204, 'PurchaseOrderDetail(Add Received column)'

		print '**************************************************'
		print '*  db.01.00.204: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.204: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript204_stat%')
Begin
	drop table #ChangeScript204_stat
End
go
 
 
/*
 db.01.00.205:
 Does the following task:
 - Add column QuantityApproved into dbo.SupplyOrderDetail

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 205
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript205_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript205_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 205)
begin
	print '**************************************************'
	print '*  db.01.00.205: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript205_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript205_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************'
	print '* - Add column QuantityApproved into dbo.SupplyOrderDetail*'
	print '*************************************************'	
		ALTER TABLE dbo.SupplyOrderDetail ADD
			QuantityApproved int NULL
		ALTER TABLE dbo.SaleOrderDetail ADD
			SPNote nvarchar(150) NULL
	Insert into #ChangeScript205_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript205_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript205_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 205, '- Add column QuantityApproved into dbo.SupplyOrderDetail'

		print '**************************************************'
		print '*  db.01.00.205: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.205: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript205_stat%')
Begin
	drop table #ChangeScript205_stat
End
go
 
 
/*
 db.01.00.206:
 Does the following task:
 - Table Item: Add QuantityOnPO & MedicalItemTypeName columns

Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 206
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript206_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript206_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 206)
begin
	print '**************************************************'
	print '*  db.01.00.206: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript206_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript206_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************************'
	print '* Table Item: Add QuantityOnPO & MedicalItemTypeName columns*'
	print '*************************************************************'

	IF dbo.SMM_CheckExists(6, 'QuantityOnPO', 'Item') = -1
		ALTER TABLE [dbo].[Item]
		ADD QuantityOnPO int NULL
		CONSTRAINT [DF_Item_QuantityOnPO]  DEFAULT (0)
	
	IF dbo.SMM_CheckExists(6, 'MedicalItemTypeName', 'Item') = -1
		ALTER TABLE [dbo].[Item]
		ADD MedicalItemTypeName NVARCHAR(50) NULL

	Insert into #ChangeScript206_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript206_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript206_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 206, 'Table Item(Add QuantityOnPO & MedicalItemTypeName columns)'

		print '**************************************************'
		print '*  db.01.00.206: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.206: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript206_stat%')
Begin
	drop table #ChangeScript206_stat
End
go
 
 
/*
 db.01.00.207:
 Does the following:
	Add field ApprovedBySMM to table Agent

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 207

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript207_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript207_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 207)
begin
	print '**************************************************'
	print '*  db.01.00.207: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript207_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript207_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add field ApprovedBySMM to table Agent                             *'
	print '***********************************************************************'

	ALTER TABLE dbo.[Agent] ADD [ApprovedBySMM] bit NOT NULL CONSTRAINT [DF_Agent_ApprovedBySMM]  DEFAULT ((0))

        Insert into #ChangeScript207_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript207_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript207_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 207, 'Add field ApprovedBySMM to table Agent'

		print '**************************************************'
		print '*  db.01.00.207: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.207: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript207_stat%')
Begin
	drop table #ChangeScript207_stat
End
go
 
 
/*
 db.01.00.208:
 Does the following:
	Add field KitPay  to table ServiceProvider

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 208

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript208_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript208_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 208)
begin
	print '**************************************************'
	print '*  db.01.00.208: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript208_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript208_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add field KitPay  to table ServiceProvider                             *'
	print '***********************************************************************'
	IF dbo.SMM_CheckExists(6, 'KitPay', 'ServiceProvider') = -1
		ALTER TABLE dbo.[ServiceProvider]
		ADD KitPay bit not null DEFAULT(0)
	Insert into #ChangeScript208_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript208_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript208_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 208, 'Add field KitPay  to table ServiceProvider'

		print '**************************************************'
		print '*  db.01.00.208: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.208: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript208_stat%')
Begin
	drop table #ChangeScript208_stat
End
go
 
 
/*
 db.01.00.209:
 Does the following:
	Modify Body column in EmailTemplate Table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 209

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript209_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript209_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 209)
begin
	print '**************************************************'
	print '*  db.01.00.209: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript209_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript209_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Modify Body column in EmailTemplate Table                          *'
	print '***********************************************************************'
	
	UPDATE [dbo].[EmailTemplate] SET [Body] = 
  'Dear {PersonName},
  
We are writing this email to notify you of new Rating Result. See the details below:
	Point: {Point}
	Comment: {Comment}
	Rated By: {RatedBy}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com '
    WHERE ID = 'EA09C932-CF7F-43F4-A9B9-D7159C264ADC'
		
	Insert into #ChangeScript209_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript209_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript209_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 209, 'Design database for Notififcation module'

		print '**************************************************'
		print '*  db.01.00.209: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.209: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript209_stat%')
Begin
	drop table #ChangeScript209_stat
End
go
 
 
/*
 db.01.00.210:
 Does the following:
	- Add a field, which is ReferralFeeForSP, to OrderingParty table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 210

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript210_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript210_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 210)
begin
	print '**************************************************'
	print '*  db.01.00.210: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript210_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript210_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************************************************'
	print '* Add a field, which is ReferralFeeForSP, to OrderingParty table    *'
	print '*************************************************************************************'

	IF dbo.SMM_CheckExists(6, 'ReferralFeeForSP', 'OrderingParty') = -1
		ALTER TABLE [dbo].[OrderingParty]
		ADD ReferralFeeForSP  money NULL		
		 
        Insert into #ChangeScript210_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript210_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript210_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 210, '- Add ReferralFeeForSP to OrderingParty'

		print '**************************************************'
		print '*  db.01.00.210: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.210: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript210_stat%')
Begin
	drop table #ChangeScript210_stat
End
go
 
 
/*
 db.01.00.211:
 Does the following:
	- Add a field, which is Notes, to ServiceProviderBlacklist table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 211

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript211_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript211_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 211)
begin
	print '**************************************************'
	print '*  db.01.00.211: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript211_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript211_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************************************************'
	print '* Add a field, which is Notes, to ServiceProviderBlacklist table    *'
	print '*************************************************************************************'

	ALTER TABLE [dbo].[ServiceProviderBlacklist]
    ALTER COLUMN Notes  varchar(500) NULL		
		 
    Insert into #ChangeScript211_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript211_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript211_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 211, '- Add Notes to ServiceProviderBlacklist'

		print '**************************************************'
		print '*  db.01.00.211: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.211: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript211_stat%')
Begin
	drop table #ChangeScript211_stat
End
go
 
 
/*
 db.01.00.210:
 Does the following:
	- Update RelatedInvoiceOrderID to NULL

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 210

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript210_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript210_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 210)
begin
	print '**************************************************'
	print '*  db.01.00.210: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript210_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript210_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************************************************'
	print '* Update RelatedInvoiceOrderID to NULL											   *'
	print '*************************************************************************************'

	UPDATE invoiceorder SET RelatedInvoiceOrderID=null WHERE RelatedInvoiceOrderID='00000000-0000-0000-0000-000000000000'
		 
        Insert into #ChangeScript210_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript210_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript210_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 210, '- Add ReferralFeeForSP to OrderingParty'

		print '**************************************************'
		print '*  db.01.00.210: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.210: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript210_stat%')
Begin
	drop table #ChangeScript210_stat
End
go
 
 
/*
 db.01.00.213:
 Does the following:
	add column UseForApplicant to GovIDType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 213

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript213_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript213_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 213)
begin
	print '**************************************************'
	print '*  db.01.00.213: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript213_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript213_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add column UseForApplicant to GovIDType                            *'
	print '***********************************************************************'

	alter table metadata.GovIDType add UseForApplicant bit not null default 0
		
        Insert into #ChangeScript213_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript213_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript213_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 213, 'add column UseForApplicant to GovIDType'

		print '**************************************************'
		print '*  db.01.00.213: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.213: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript213_stat%')
Begin
	drop table #ChangeScript213_stat
End
go
 
 
/*
 db.01.00.214:
 Does the following:
	Add RatingPageSize Configure
	Add QAPageSize Configure

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 214

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript214_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript214_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 214)
begin
	print '**************************************************'
	print '*  db.01.00.214: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript214_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript214_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add RatingPageSize Configure*'
	print '***********************************************************************'

  insert into dbo.Configuration
  values (12, 'RatingPageSize', 5, 'Default Page Size Rating')

    print '***********************************************************************'
	print '* Add QASize Configure*'
	print '***********************************************************************'
	
 insert into dbo.Configuration
 values (13, 'QAPageSize', 5, 'Default Page Size Question and Answer')
	
  Insert into #ChangeScript214_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript214_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript214_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 214, 'Add RatingPageSize and QAPageSize Configure'

		print '**************************************************'
		print '*  db.01.00.214: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.214: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript214_stat%')
Begin
	drop table #ChangeScript214_stat
End
go
 
 
/*
 db.01.00.215:
 Does the following:
	Add column PricingUnitID into db.GeoSurcharge

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 215

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript215_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript215_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 215)
begin
	print '**************************************************'
	print '*  db.01.00.215: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript215_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript215_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add column PricingUnitID into db.GeoSurcharge                       *'
	print '***********************************************************************'

	alter table GeoSurcharge
		add PricingUnitID int default 1
	
	ALTER TABLE dbo.GeoSurcharge ADD CONSTRAINT
		FK_GeoSurcharge_PricingUnit FOREIGN KEY
		(
		PricingUnitID
		) REFERENCES metadata.PricingUnit
		(
		ID
		) ON UPDATE  NO ACTION 
		ON DELETE  NO ACTION 
	
        Insert into #ChangeScript215_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript215_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript215_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 215, 'Add column PricingUnitID into db.GeoSurcharge'

		print '**************************************************'
		print '*  db.01.00.215: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.215: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript215_stat%')
Begin
	drop table #ChangeScript215_stat
End
go
 
 
/*
 db.01.00.216:
 Does the following:
	- Change a field, which is Note, in ServiceProviderCoverArea table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 216

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript216_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript216_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 216)
begin
	print '**************************************************'
	print '*  db.01.00.216: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript216_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript216_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '*************************************************************************************'
	print '* Change a field, which is Note, in ServiceProviderCoverArea table    *'
	print '*************************************************************************************'

	ALTER TABLE [dbo].[ServiceProviderCoverArea]
    ALTER COLUMN Note  varchar(500) NULL		
		 
    Insert into #ChangeScript216_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript216_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript216_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 216, '- Change Note in ServiceProviderCoverArea'

		print '**************************************************'
		print '*  db.01.00.216: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.216: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript216_stat%')
Begin
	drop table #ChangeScript216_stat
End
go
 
 
/*
 db.01.00.217:
 Does the following:
	update data for GovIDType.UserForApplicant

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 217

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript217_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript217_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 217)
begin
	print '**************************************************'
	print '*  db.01.00.217: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript217_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript217_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* update data for GovIDType.UserForApplicant                            *'
	print '***********************************************************************'

	update metadata.GovIDType set UseForApplicant = 1 where id = 1 OR id = 2147483647
	
        Insert into #ChangeScript217_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript217_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript217_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 217, 'update data for GovIDType.UserForApplicant'

		print '**************************************************'
		print '*  db.01.00.217: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.217: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript217_stat%')
Begin
	drop table #ChangeScript217_stat
End
go
 
 
/*
 db.01.00.218:
 Does the following:
	change prolicynumber from int to string

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 218

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript218_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript218_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 218)
begin
	print '**************************************************'
	print '*  db.01.00.218: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript218_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript218_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* change prolicynumber from int to string                            *'
	print '***********************************************************************'

	alter table incompleteorder alter column PolicyNumber nvarchar(255) null
	alter table [order] alter column PolicyNumber nvarchar(255) null

        Insert into #ChangeScript218_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript218_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript218_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 218, 'change prolicynumber from int to string'

		print '**************************************************'
		print '*  db.01.00.218: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.218: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript218_stat%')
Begin
	drop table #ChangeScript218_stat
End
go
 
 
/*
 db.01.00.219:
 Does the following tasks:
 - Table OrderAssignment: Add IsUpdatedMedicalItem column 
Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 219
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript219_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript219_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 219)
begin
	print '**************************************************'
	print '*  db.01.00.219: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript219_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript219_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION
	
	
	print '***********************************************************'
	print '* Table OrderAssignment: Add IsUpdatedMedicalItem column      *'	
	print '***********************************************************'	
		
	IF dbo.SMM_CheckExists(6, 'IsUpdatedMedicalItem', 'OrderAssignment') = -1
		ALTER TABLE [dbo].[OrderAssignment]
		ADD [IsUpdatedMedicalItem] [bit] NULL
		CONSTRAINT [DF_IsUpdatedMedicalItem] DEFAULT (0)
		
	Insert into #ChangeScript219_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript219_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript219_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 219, 'OrderAssignment (Add column IsUpdatedMedicalItem)'

		print '**************************************************'
		print '*  db.01.00.219: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.219: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript219_stat%')
Begin
	drop table #ChangeScript219_stat
End
go
 
 
/*
 db.01.00.220:
 Does the following:
	Create table PermissionTypeGroup

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 220

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript220_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript220_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 220)
begin
	print '**************************************************'
	print '*  db.01.00.220: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript220_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript220_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Create table PermissionTypeGroup                          *'
	print '***********************************************************************'

	CREATE TABLE [metadata].[PermissionTypeGroup](
		[ID] [int] NOT NULL,
		[Name] [nvarchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
		 CONSTRAINT [PK_PermissionTypeGroup] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)
	)

        Insert into #ChangeScript220_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript220_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript220_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 220, 'Create table PermissionTypeGroup'

		print '**************************************************'
		print '*  db.01.00.220: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.220: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript220_stat%')
Begin
	drop table #ChangeScript220_stat
End
go
 
 
/*
 db.01.00.221:
 Does the following:
	TODO: <summary of what this patch does?>

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 221

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript221_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript221_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 221)
begin
	print '**************************************************'
	print '*  db.01.00.221: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript221_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript221_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: <summary of what this patch does?>                            *'
	print '***********************************************************************'

	ALTER TABLE metadata.PermissionType ADD
		PermissionTypeGroupID int NULL,
		OrderStatusID int NULL,
		OrderTypeID int NULL,
		ActionName nvarchar(255) NULL

	ALTER TABLE metadata.PermissionType ADD CONSTRAINT
		FK_PermissionType_PermissionTypeGroup FOREIGN KEY
		(
		PermissionTypeGroupID
		) REFERENCES metadata.PermissionTypeGroup
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 

	ALTER TABLE metadata.PermissionType ADD CONSTRAINT
		FK_PermissionType_OrderStatus FOREIGN KEY
		(
		OrderStatusID
		) REFERENCES metadata.OrderStatus
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 

	ALTER TABLE metadata.PermissionType ADD CONSTRAINT
		FK_PermissionType_OrderType FOREIGN KEY
		(
		OrderTypeID
		) REFERENCES metadata.OrderType
		(
		ID
		) ON UPDATE  NO ACTION 
		 ON DELETE  NO ACTION 
	

        Insert into #ChangeScript221_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript221_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript221_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 221, 'TODO: <summary of what this patch does?>'

		print '**************************************************'
		print '*  db.01.00.221: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.221: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript221_stat%')
Begin
	drop table #ChangeScript221_stat
End
go
 
 
/*
 db.01.00.222:
 Does the following:
	add metadata for PermissionTypeGroup

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 222

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript222_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript222_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 222)
begin
	print '**************************************************'
	print '*  db.01.00.222: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript222_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript222_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* add metadata for PermissionTypeGroup                            *'
	print '***********************************************************************'

	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(1, 'Order Status')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(2, 'Order Information')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(3, 'Related Order')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(4, 'Ordering Party')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(5, 'Ordering Party Mailing Instruction')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(6, 'Agent / Agency Information')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(7, 'Partner Information')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(8, 'Insurance Information')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(9, 'SMM Mailing')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(10, 'Order Lab')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(11, 'Applicant Profile')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(12, 'Applicant Contact Information')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(13, 'Applicant Schedule')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(14, 'Order Assignment Status')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(15, 'Order Assignment Fee')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(16, 'Order Assignment Kit')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(17, 'Order Document')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(18, 'Order Rating')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(19, 'Even Log')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(20, 'Order Requirement')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(21, 'Order Billing')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(22, 'Order Finance')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(23, 'Order Office Note')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(24, 'Order QuestionAndAnswer')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(25, 'OrderAssignment Instruction')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(26, 'OrderAssignment Paperwork Information')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(27, 'OrderAssignment Paperwork')
	INSERT INTO metadata.PermissionTypeGroup([ID], [Name]) values(28, 'OrderAssignment Paperwork Status')


        Insert into #ChangeScript222_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript222_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript222_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 222, 'add metadata for PermissionTypeGroup'

		print '**************************************************'
		print '*  db.01.00.222: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.222: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript222_stat%')
Begin
	drop table #ChangeScript222_stat
End
go
 
 
/*
 db.01.00.223:
 Does the following:
	remove old permission type and add new permission type

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 223

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript223_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript223_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 223)
begin
	print '**************************************************'
	print '*  db.01.00.223: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript223_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript223_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* remove old permission type and add new permission type                            *'
	print '***********************************************************************'

	delete from dbo.userrolepermission
	
	delete from dbo.userpermission
	
	delete from metadata.permissiontype
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(1,'Order_PlaceOrder',NULL,NULL,NULL,NULL,'Place Order')
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(5,'OrderStatus_Create_IfNew',NULL,1,1,NULL,'Post')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(6,'OrderStatus_Create_IfProcessing',NULL,1,2,NULL,'Post')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(7,'OrderStatus_Create_IfCompleted',NULL,1,4,NULL,'Post')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(8,'OrderStatus_Create_IfVerified',NULL,1,6,NULL,'Post')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(9,'OrderStatus_Create_IfClosed',NULL,1,7,NULL,'Post')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(10,'OrderStatus_Create_IfOnHold',NULL,1,3,NULL,'Post')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(11,'OrderStatus_Create_IfCanceled',NULL,1,5,NULL,'Post')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(12,'OrderStatus_View',NULL,1,NULL,NULL,'View')
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(19,'OrderInformation_Update_IfNew',NULL,2,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(20,'OrderInformation_Update_IfProcessing',NULL,2,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(21,'OrderInformation_Update_IfCompleted_Paramed',NULL,2,4,1,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(22,'OrderInformation_Update_IfCompleted_Direct',NULL,2,4,2,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(23,'OrderInformation_Update_IfVerified',NULL,2,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(24,'OrderInformation_Update_IfClosed',NULL,2,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(25,'OrderInformation_Update_IfOnHold',NULL,2,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(26,'OrderInformation_Update_IfCanceled',NULL,2,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(27,'OrderInformation_View',NULL,2,NULL,NULL,'View')
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(28,'RelatedOrder_Create_IfNew',NULL,3,1,NULL,'Add')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(29,'RelatedOrder_Create_IfProcessing',NULL,3,2,NULL,'Add')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(30,'RelatedOrder_Create_IfCompleted',NULL,3,4,NULL,'Add')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(31,'RelatedOrder_Create_IfVerified',NULL,3,6,NULL,'Add')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(32,'RelatedOrder_Create_IfClosed',NULL,3,7,NULL,'Add')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(33,'RelatedOrder_Create_IfOnHold',NULL,3,3,NULL,'Add')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(34,'RelatedOrder_Create_IfCanceled',NULL,3,5,NULL,'Add')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(35,'RelatedOrder_View',NULL,3,NULL,NULL,'View')
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(36,'OrderingParty_Update_IfNew',NULL,4,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(37,'OrderingParty_Update_IfProcessing',NULL,4,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(38,'OrderingParty_Update_IfCompleted',NULL,4,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(39,'OrderingParty_Update_IfVerified',NULL,4,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(40,'OrderingParty_Update_IfClosed',NULL,4,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(41,'OrderingParty_Update_IfOnHold',NULL,4,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(42,'OrderingParty_Update_IfCanceled',NULL,4,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(43,'OrderingParty_View',NULL,4,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(44,'OrderingPartyMailingInstruction_Update_IfNew',NULL,5,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(45,'OrderingPartyMailingInstruction_Update_IfProcessing',NULL,5,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(46,'OrderingPartyMailingInstruction_Update_IfCompleted',NULL,5,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(47,'OrderingPartyMailingInstruction_Update_IfVerified',NULL,5,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(48,'OrderingPartyMailingInstruction_Update_IfClosed',NULL,5,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(49,'OrderingPartyMailingInstruction_Update_IfOnHold',NULL,5,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(50,'OrderingPartyMailingInstruction_Update_IfCanceled',NULL,5,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(51,'OrderingPartyMailingInstruction_View',NULL,5,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(52,'AgentAgencyInformation_Update_IfNew',NULL,6,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(53,'AgentAgencyInformation_Update_IfProcessing',NULL,6,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(54,'AgentAgencyInformation_Update_IfCompleted',NULL,6,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(55,'AgentAgencyInformation_Update_IfVerified',NULL,6,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(56,'AgentAgencyInformation_Update_IfClosed',NULL,6,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(57,'AgentAgencyInformation_Update_IfOnHold',NULL,6,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(58,'AgentAgencyInformation_Update_IfCanceled',NULL,6,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(59,'AgentAgencyInformation_View',NULL,6,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(60,'PartnerInformation_View',NULL,7,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(61,'InsuranceInformation_Update_IfNew',NULL,8,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(62,'InsuranceInformation_Update_IfProcessing',NULL,8,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(63,'InsuranceInformation_Update_IfCompleted',NULL,8,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(64,'InsuranceInformation_Update_IfVerified',NULL,8,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(65,'InsuranceInformation_Update_IfClosed',NULL,8,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(66,'InsuranceInformation_Update_IfOnHold',NULL,8,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(67,'InsuranceInformation_Update_IfCanceled',NULL,8,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(68,'InsuranceInformation_View',NULL,8,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(69,'SMMMailing_Update_IfNew',NULL,9,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(70,'SMMMailing_Update_IfProcessing',NULL,9,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(71,'SMMMailing_Update_IfCompleted',NULL,9,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(72,'SMMMailing_Update_IfVerified',NULL,9,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(73,'SMMMailing_Update_IfClosed',NULL,9,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(74,'SMMMailing_Update_IfOnHold',NULL,9,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(75,'SMMMailing_Update_IfCanceled',NULL,9,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(76,'SMMMailing_View',NULL,9,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(84,'OrderLab_View',NULL,10,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(85,'ApplicantProfile_Update_IfNew',NULL,11,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(86,'ApplicantProfile_Update_IfProcessing',NULL,11,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(87,'ApplicantProfile_Update_IfCompleted',NULL,11,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(88,'ApplicantProfile_Update_IfVerified',NULL,11,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(89,'ApplicantProfile_Update_IfClosed',NULL,11,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(90,'ApplicantProfile_Update_IfOnHold',NULL,11,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(91,'ApplicantProfile_Update_IfCanceled',NULL,11,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(92,'ApplicantProfile_Update_SSNAndDOB',NULL,11,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(93,'ApplicantProfile_View',NULL,11,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(94,'ApplicantProfile_View_SSNAndDOB',NULL,11,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(95,'ApplicantContactInformation_Update_IfNew',NULL,12,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(96,'ApplicantContactInformation_Update_IfProcessing',NULL,12,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(97,'ApplicantContactInformation_Update_IfCompleted',NULL,12,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(98,'ApplicantContactInformation_Update_IfVerified',NULL,12,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(99,'ApplicantContactInformation_Update_IfClosed',NULL,12,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(100,'ApplicantContactInformation_Update_IfOnHold',NULL,12,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(101,'ApplicantContactInformation_Update_IfCanceled',NULL,12,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(102,'ApplicantContactInformation_View',NULL,12,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(103,'ApplicantSchedule_Update_IfNew',NULL,13,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(104,'ApplicantSchedule_Update_IfProcessing',NULL,13,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(105,'ApplicantSchedule_Update_IfCompleted',NULL,13,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(106,'ApplicantSchedule_Update_IfVerified',NULL,13,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(107,'ApplicantSchedule_Update_IfClosed',NULL,13,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(108,'ApplicantSchedule_Update_IfOnHold',NULL,13,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(109,'ApplicantSchedule_Update_IfCanceled',NULL,13,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(110,'ApplicantSchedule_View',NULL,13,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(112,'OrderAssignmentStatus_Update_IfProcessing',NULL,14,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(113,'OrderAssignmentStatus_Update_IfCompleted',NULL,14,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(114,'OrderAssignmentStatus_Update_IfVerified',NULL,14,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(115,'OrderAssignmentStatus_Update_IfClosed',NULL,14,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(116,'OrderAssignmentStatus_Update_IfOnHold',NULL,14,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(117,'OrderAssignmentStatus_Update_IfCanceled',NULL,14,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(118,'OrderAssignmentStatus_View',NULL,14,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(121,'OrderAssignmentFee_Update_IfCompleted',NULL,15,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(122,'OrderAssignmentFee_Update_IfVerified',NULL,15,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(123,'OrderAssignmentFee_Update_IfClosed',NULL,15,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(125,'OrderAssignmentFee_Update_IfCanceled',NULL,15,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(126,'OrderAssignmentFee_View',NULL,15,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(129,'OrderAssignmentKit_Update_IfCompleted',NULL,16,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(130,'OrderAssignmentKit_Update_IfVerified',NULL,16,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(131,'OrderAssignmentKit_Update_IfClosed',NULL,16,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(133,'OrderAssignmentKit_Update_IfCanceled',NULL,16,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(134,'OrderAssignmentKit_View',NULL,16,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(135,'OrderDocument_Update_IfNew',NULL,17,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(136,'OrderDocument_Update_IfProcessing',NULL,17,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(137,'OrderDocument_Update_IfCompleted',NULL,17,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(138,'OrderDocument_Update_IfVerified',NULL,17,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(139,'OrderDocument_Update_IfClosed',NULL,17,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(140,'OrderDocument_Update_IfOnHold',NULL,17,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(141,'OrderDocument_Update_IfCanceled',NULL,17,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(142,'OrderDocument_View',NULL,17,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(143,'OrderRating_Update_IfNew',NULL,18,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(144,'OrderRating_Update_IfProcessing',NULL,18,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(145,'OrderRating_Update_IfCompleted',NULL,18,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(146,'OrderRating_Update_IfVerified',NULL,18,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(147,'OrderRating_Update_IfClosed',NULL,18,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(148,'OrderRating_Update_IfOnHold',NULL,18,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(149,'OrderRating_Update_IfCanceled',NULL,18,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(150,'OrderRating_View',NULL,18,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(151,'EvenLog_View',NULL,19,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(152,'OrderRequirement_Update_IfNew',NULL,20,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(153,'OrderRequirement_Update_IfProcessing',NULL,20,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(154,'OrderRequirement_Update_IfCompleted',NULL,20,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(155,'OrderRequirement_Update_IfVerified',NULL,20,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(156,'OrderRequirement_Update_IfClosed',NULL,20,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(157,'OrderRequirement_Update_IfOnHold',NULL,20,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(158,'OrderRequirement_Update_IfCanceled',NULL,20,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(159,'OrderRequirement_View',NULL,20,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(160,'OrderBilling_Update_IfNew',NULL,21,1,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(161,'OrderBilling_Update_IfProcessing',NULL,21,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(162,'OrderBilling_Update_IfCompleted',NULL,21,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(163,'OrderBilling_Update_IfVerified',NULL,21,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(164,'OrderBilling_Update_IfClosed',NULL,21,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(165,'OrderBilling_Update_IfOnHold',NULL,21,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(166,'OrderBilling_Update_IfCanceled',NULL,21,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(167,'OrderBilling_View',NULL,21,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(168,'OrderFinance_View',NULL,22,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(169,'OrderOfficeNote_Create_IfNew',NULL,23,1,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(170,'OrderOfficeNote_Create_IfProcessing',NULL,23,2,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(171,'OrderOfficeNote_Create_IfCompleted',NULL,23,4,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(172,'OrderOfficeNote_Create_IfVerified',NULL,23,6,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(173,'OrderOfficeNote_Create_IfClosed',NULL,23,7,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(174,'OrderOfficeNote_Create_IfOnHold',NULL,23,3,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(175,'OrderOfficeNote_Create_IfCanceled',NULL,23,5,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(176,'OrderOfficeNote_View',NULL,23,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(177,'OrderQuestionAndAnswer_Create_IfNew',NULL,24,1,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(178,'OrderQuestionAndAnswer_Create_IfProcessing',NULL,24,2,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(179,'OrderQuestionAndAnswer_Create_IfCompleted',NULL,24,4,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(180,'OrderQuestionAndAnswer_Create_IfVerified',NULL,24,6,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(181,'OrderQuestionAndAnswer_Create_IfClosed',NULL,24,7,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(182,'OrderQuestionAndAnswer_Create_IfOnHold',NULL,24,3,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(183,'OrderQuestionAndAnswer_Create_IfCanceled',NULL,24,5,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(184,'OrderQuestionAndAnswer_View',NULL,24,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(185,'OrderAssignmentInstruction_View',NULL,25,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(187,'OrderAssignmentPaperworkInformation_Update_IfProcessing',NULL,27,2,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(188,'OrderAssignmentPaperworkInformation_Update_IfCompleted',NULL,27,4,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(189,'OrderAssignmentPaperworkInformation_Update_IfVerified',NULL,27,6,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(190,'OrderAssignmentPaperworkInformation_Update_IfClosed',NULL,27,7,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(191,'OrderAssignmentPaperworkInformation_Update_IfOnHold',NULL,27,3,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(192,'OrderAssignmentPaperworkInformation_Update_IfCanceled',NULL,27,5,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(193,'OrderAssignmentPaperworkInformation_View',NULL,27,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(195,'OrderAssignmentPaperwork_Create_IfProcessing',NULL,27,2,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(196,'OrderAssignmentPaperwork_Create_IfCompleted',NULL,27,4,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(197,'OrderAssignmentPaperwork_Create_IfVerified',NULL,27,6,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(198,'OrderAssignmentPaperwork_Create_IfClosed',NULL,27,7,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(199,'OrderAssignmentPaperwork_Create_IfOnHold',NULL,27,3,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(200,'OrderAssignmentPaperwork_Create_IfCanceled',NULL,27,5,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(201,'OrderAssignmentPaperwork_View',NULL,27,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(203,'OrderAssignmentPaperworkStatus_Create_IfProcessing',NULL,28,2,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(204,'OrderAssignmentPaperworkStatus_Create_IfCompleted',NULL,28,4,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(205,'OrderAssignmentPaperworkStatus_Create_IfVerified',NULL,28,6,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(206,'OrderAssignmentPaperworkStatus_Create_IfClosed',NULL,28,7,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(207,'OrderAssignmentPaperworkStatus_Create_IfOnHold',NULL,28,3,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(208,'OrderAssignmentPaperworkStatus_Create_IfCanceled',NULL,28,5,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(209,'OrderAssignmentPaperworkStatus_View',NULL,28,NULL,NULL,'View')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(212,'Order_View',NULL,NULL,NULL,NULL,'View')

        Insert into #ChangeScript223_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript223_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript223_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 223, 'remove old permission type and add new permission type'

		print '**************************************************'
		print '*  db.01.00.223: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.223: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript223_stat%')
Begin
	drop table #ChangeScript223_stat
End
go
 
 
/*
 db.01.00.224:
 Does the following:
	Add table DeptOrderStatus and 2 field NotifySupervisor and NotifyOrderingParty to OrderStatus

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 224

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript224_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript224_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 224)
begin
	print '**************************************************'
	print '*  db.01.00.224: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript224_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript224_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add table DeptOrderStatus and 2 field NotifySupervisor and NotifyOrderingParty to OrderStatus *'
	print '***********************************************************************'

	CREATE TABLE [dbo].[DeptOrderStatus]
	(
		[ID] [uniqueidentifier] NOT NULL,
		[StatusID] [int] NOT NULL,
		[DeptID] [uniqueidentifier] NOT NULL,
		CONSTRAINT [PK_DeptOrderStatus] PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	)

	ALTER TABLE [dbo].[DeptOrderStatus]  WITH CHECK ADD  CONSTRAINT [FK_DeptOrderStatus_OrderStatus]
		FOREIGN KEY([StatusID])
		REFERENCES [metadata].[OrderStatus] ([ID])

	ALTER TABLE [dbo].[DeptOrderStatus]  WITH CHECK ADD  CONSTRAINT [FK_DeptOrderStatus_Department]
		FOREIGN KEY([DeptID])
		REFERENCES [dbo].[Department] ([ID])

	ALTER TABLE [metadata].[OrderStatus]  ADD [NotifySupervisor] bit NOT NULL
		CONSTRAINT [DF_OrderStatus_NotifySupervisor]  DEFAULT ((0))

	ALTER TABLE [metadata].[OrderStatus]  ADD [NotifyOrderingParty] bit NOT NULL
		CONSTRAINT [DF_OrderStatus_NotifyOrderingParty]  DEFAULT ((0))

        Insert into #ChangeScript224_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript224_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript224_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 224, 'Add table DeptOrderStatus and 2 field NotifySupervisor and NotifyOrderingParty to OrderStatus'

		print '**************************************************'
		print '*  db.01.00.224: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.224: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript224_stat%')
Begin
	drop table #ChangeScript224_stat
End
go
 
 
/*
 db.01.00.225:
 Does the following:
	Modify column TrackingCode from not-null to null

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 225

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript225_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript225_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 225)
begin
	print '**************************************************'
	print '*  db.01.00.225: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript225_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript225_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Modify column TrackingCode from not-null to null *'
	print '***********************************************************************'

		ALTER TABLE supplyorder ALTER COLUMN TrackingCode NVARCHAR(20) NULL

        Insert into #ChangeScript225_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript225_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript225_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 225, 'Modify column TrackingCode from not-null to null
'

		print '**************************************************'
		print '*  db.01.00.225: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.225: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript225_stat%')
Begin
	drop table #ChangeScript225_stat
End
go
 
 
/*
 db.01.00.226:
 Does the following:
	Add table DeptOrderPaperworkStatus and 2 field NotifySupervisor and NotifyOrderingParty to PaperworkStatus

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 226

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript226_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript226_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 226)
begin
	print '**************************************************'
	print '*  db.01.00.226: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript226_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript226_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add table DeptOrderPaperworkStatus and 2 field NotifySupervisor and NotifyOrderingParty to PaperworkStatus *'
	print '***********************************************************************'

	CREATE TABLE [dbo].[DeptOrderPaperworkStatus]
	(
		[ID] [uniqueidentifier] NOT NULL,
		[StatusID] [int] NOT NULL,
		[DeptID] [uniqueidentifier] NOT NULL,
		CONSTRAINT [PK_DeptOrderPaperworkStatus] PRIMARY KEY CLUSTERED 
			(
				[ID] ASC
			)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
	)

	ALTER TABLE [dbo].[DeptOrderPaperworkStatus]  WITH CHECK ADD  CONSTRAINT [FK_DeptOrderPaperworkStatus_PaperworkStatus]
		FOREIGN KEY([StatusID])
		REFERENCES [metadata].[PaperworkStatus] ([ID])

	ALTER TABLE [dbo].[DeptOrderPaperworkStatus]  WITH CHECK ADD  CONSTRAINT [FK_DeptOrderPaperworkStatus_Department]
		FOREIGN KEY([DeptID])
		REFERENCES [dbo].[Department] ([ID])

	ALTER TABLE [metadata].[PaperworkStatus]  ADD [NotifySupervisor] bit NOT NULL
		CONSTRAINT [DF_PaperworkStatus_NotifySupervisor]  DEFAULT ((0))

	ALTER TABLE [metadata].[PaperworkStatus]  ADD [NotifyOrderingParty] bit NOT NULL
		CONSTRAINT [DF_PaperworkStatus_NotifyOrderingParty]  DEFAULT ((0))


	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
	VALUES('D5622CDC-7118-4004-9195-00199E770F23','Order status notify','	Dear {Person name},

We are writing this email to notify you that the status of the order [orderID] has been changed by {Posted By} from {Old Status} to {New Status}.

Status note:{Status note}

Click on below link to view the order:
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
',getdate(),getdate(),NULL)


	UPDATE [dbo].[EmailTemplate]
	SET [Body] = '	Dear {Person name},

We are writing this email to notify you that the paperwork status of the order [orderID] has been changed by {Posted By} from {Old Status} to {New Status}.

Status note:{Status note}

Click on below link to view the order:
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
' WHERE ID='BEA6FB17-3C4A-4486-A375-3D504CCEEC57'

        Insert into #ChangeScript226_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript226_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript226_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 226, 'Add table DeptOrderPaperworkStatus and 2 field NotifySupervisor and NotifyOrderingParty to PaperworkStatus'

		print '**************************************************'
		print '*  db.01.00.226: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.226: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript226_stat%')
Begin
	drop table #ChangeScript226_stat
End
go
 
 
/*
 db.01.00.227:
 Does the following tasks:
 - Insert data into metadata table ObjectType


Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 227
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript227_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript227_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 227)
begin
	print '**************************************************'
	print '*  db.01.00.227: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript227_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript227_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**************************************************************************************************************'
	print '* Insert data into metadata table ObjectType  *'
	print '**************************************************************************************************************'

	insert into [metadata].[ObjectType]([ID], [Name]) values(9, 'Supplier')	
	insert into [metadata].[ObjectType]([ID], [Name]) values(10, 'MedicalItem')
	insert into [metadata].[ObjectType]([ID], [Name]) values(11, 'SupplyOrder')
	insert into [metadata].[ObjectType]([ID], [Name]) values(12, 'SaleOrder')
	insert into [metadata].[ObjectType]([ID], [Name]) values(13, 'PurchaseOrder')
	insert into [metadata].[ObjectType]([ID], [Name]) values(14, 'Agency')

	Insert into #ChangeScript227_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript227_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript227_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 227, 'Insert data into metadata table ObjectType'

		print '**************************************************'
		print '*  db.01.00.227: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.227: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript227_stat%')
Begin
	drop table #ChangeScript227_stat
End
go
 
 
/*
 db.01.00.228:
 Does the following tasks:
 - Add new column IsPrinted into Invoice
 - Add new column CreatedDate into InvoiceOrder
 - Add new column PricingUnitID into InvoiceOrderFee

Note: This script is required to run on blank database or at least the Item table is empty

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 228
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript228_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript228_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 228)
begin
	print '**************************************************'
	print '*  db.01.00.228: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript228_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript228_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***************************************************************'
	print '* Add new column IsPrinted into Invoice						 *'
	print '***************************************************************'

	IF dbo.SMM_CheckExists(6, 'IsPrinted', 'Invoice') = -1
		ALTER TABLE dbo.Invoice
		ADD IsPrinted bit NOT NULL CONSTRAINT DF_Invoice_IsPrinted DEFAULT (0)

	IF dbo.SMM_CheckExists(6, 'CreatedDate', 'InvoiceOrder') = -1
		ALTER TABLE dbo.InvoiceOrder
		ADD CreatedDate datetime NOT NULL CONSTRAINT DF_InvoiceOrder_CreatedDate DEFAULT (getdate())

	IF dbo.SMM_CheckExists(6, 'PricingUnitID', 'InvoiceOrderFee') = -1
		ALTER TABLE dbo.InvoiceOrderFee
		ADD PricingUnitID int

	IF dbo.SMM_CheckExists(2, 'FK_InvoiceOrderFee_PricingUnit', 'InvoiceOrderFee') = -1
		ALTER TABLE InvoiceOrderFee
		ADD CONSTRAINT FK_InvoiceOrderFee_PricingUnit FOREIGN KEY(PricingUnitID) REFERENCES metadata.PricingUnit(ID)

	INSERT INTO metadata.SurchargeType(ID,[Name]) Values(6,'Discount')

	Insert into #ChangeScript228_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript228_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript228_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 228, 'Insert data into metadata table ObjectType'

		print '**************************************************'
		print '*  db.01.00.228: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.228: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript228_stat%')
Begin
	drop table #ChangeScript228_stat
End
go
 
 
/*
 db.01.00.229:
 Does the following:
	Update PermissionTypeGroupID for PermissionType table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 229

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript229_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript229_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 229)
begin
	print '**************************************************'
	print '*  db.01.00.229: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript229_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript229_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update PermissionTypeGroupID for PermissionType table                            *'
	print '***********************************************************************'

	update metadata.permissiontype set permissiontypegroupid = 26 where [name] like 'OrderAssignmentPaperworkInformation_%'

        Insert into #ChangeScript229_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript229_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript229_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 229, 'Update PermissionTypeGroupID for PermissionType table'

		print '**************************************************'
		print '*  db.01.00.229: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.229: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript229_stat%')
Begin
	drop table #ChangeScript229_stat
End
go
 
 
/*
 db.01.00.230:
 Does the following:
	Add PermissionType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 230

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript230_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript230_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 230)
begin
	print '**************************************************'
	print '*  db.01.00.230: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript230_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript230_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add PermissionType                            *'
	print '***********************************************************************'

	INSERT metadata.PermissionTypeGroup([ID],[Name]) VALUES(29, 'Order Assignment')
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(214,'OrderAssignment_Assign_IfNew',NULL,29,1,NULL,'Assign')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(215,'OrderAssignment_Assign_IfProcessing',NULL,29,2,NULL,'Assign')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(216,'OrderAssignment_Assign_IfCompleted',NULL,29,4,NULL,'Assign')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(217,'OrderAssignment_Assign_IfVerified',NULL,29,6,NULL,'Assign')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(218,'OrderAssignment_Assign_IfClosed',NULL,29,7,NULL,'Assign')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(219,'OrderAssignment_Assign_IfOnHold',NULL,29,3,NULL,'Assign')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(220,'OrderAssignment_Assign_IfCanceled',NULL,29,5,NULL,'Assign')

        Insert into #ChangeScript230_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript230_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript230_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 230, 'Add PermissionType'

		print '**************************************************'
		print '*  db.01.00.230: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.230: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript230_stat%')
Begin
	drop table #ChangeScript230_stat
End
go
 
 
/*
 db.01.00.231:
 Does the following:
	Add table DeptOrderPaperworkStatus and 2 field NotifySupervisor and NotifyOrderingParty to PaperworkStatus

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 231

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript231_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript231_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 231)
begin
	print '**************************************************'
	print '*  db.01.00.231: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript231_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript231_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add table DeptOrderPaperworkStatus and 2 field NotifySupervisor and NotifyOrderingParty to PaperworkStatus *'
	print '***********************************************************************'

	UPDATE [dbo].[EmailTemplate]
	SET [Body] = '	Dear {Person name},

We are writing this email to notify you that the status of the order {OrderID} has been changed by {PostedBy} to {NewStatus}.

Status note:
{Status note}

Click on below link to view the order:
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
' WHERE ID='D5622CDC-7118-4004-9195-00199E770F23'


	UPDATE [dbo].[EmailTemplate]
	SET [Body] = '	Dear {Person name},

We are writing this email to notify you that the paperwork status of the order {OrderID} has been changed by {PostedBy} to {NewStatus}.

Status note:
{Status note}

Click on below link to view the order:
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
' WHERE ID='BEA6FB17-3C4A-4486-A375-3D504CCEEC57'

        Insert into #ChangeScript231_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript231_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript231_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 231, 'Add table DeptOrderPaperworkStatus and 2 field NotifySupervisor and NotifyOrderingParty to PaperworkStatus'

		print '**************************************************'
		print '*  db.01.00.231: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.231: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript231_stat%')
Begin
	drop table #ChangeScript231_stat
End
go
 
 
/*
 db.01.00.232:
 Does the following:
	Add ReminderDefaultPageSize Configure

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 232

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript232_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript232_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 232)
begin
	print '**************************************************'
	print '*  db.01.00.232: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript232_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript232_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add ReminderDefaultPageSize Configure*'
	print '***********************************************************************'

  insert into dbo.Configuration
  values (14, 'ReminderDefaultPageSize', 5, 'Default Page Size Reminder')

  

  Insert into #ChangeScript232_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript232_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript232_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 232, 'Add ReminderDefaultPageSize Configure'

		print '**************************************************'
		print '*  db.01.00.232: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.232: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript232_stat%')
Begin
	drop table #ChangeScript232_stat
End
go
 
 
/*
 db.01.00.233:
 Does the following:
	Add column IsCompleted to table metadata.OrderAssignmentStatus

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 233

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript233_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript233_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 233)
begin
	print '**************************************************'
	print '*  db.01.00.233: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript233_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript233_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add column IsCompleted to table metadata.OrderAssignmentStatus                            *'
	print '***********************************************************************'

	alter table metadata.OrderAssignmentStatus add IsCompleted bit not null default 0

        Insert into #ChangeScript233_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript233_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript233_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 233, 'Add column IsCompleted to table metadata.OrderAssignmentStatus'

		print '**************************************************'
		print '*  db.01.00.233: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.233: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript233_stat%')
Begin
	drop table #ChangeScript233_stat
End
go
 
 
/*
 db.01.00.234:
 Does the following:
	Update value of metadata.OrderAssignmentStatus.IsCompleted

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 234

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript234_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript234_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 234)
begin
	print '**************************************************'
	print '*  db.01.00.234: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript234_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript234_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update value of metadata.OrderAssignmentStatus.IsCompleted                            *'
	print '***********************************************************************'

	update metadata.OrderAssignmentStatus set IsCompleted = 1 where [name] like '%complete%'

        Insert into #ChangeScript234_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript234_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript234_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 234, 'Update value of metadata.OrderAssignmentStatus.IsCompleted'

		print '**************************************************'
		print '*  db.01.00.234: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.234: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript234_stat%')
Begin
	drop table #ChangeScript234_stat
End
go
 
 
/*
 db.01.00.235:
 Does the following:
	- Add AmountCreadit into Payment

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 235

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript235_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript235_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 235)
begin
	print '**************************************************'
	print '*  db.01.00.235: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript235_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript235_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add AmountCreadit into Payment                        *'
	print '***********************************************************************'

	ALTER TABLE Payment
	Add AmountCredit money NOT NULL CONSTRAINT DF_Payment_AmountCredit DEFAULT(0) 
		
        Insert into #ChangeScript235_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript235_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript235_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 235, '- Add AmountCreadit into Payment'

		print '**************************************************'
		print '*  db.01.00.235: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.235: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript235_stat%')
Begin
	drop table #ChangeScript235_stat
End
go
 
 
/*
 db.01.00.236:
 Does the following:
	Update variable for email template

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 236

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript236_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript236_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 236)
begin
	print '**************************************************'
	print '*  db.01.00.236: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript236_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript236_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update variable for email template                            *'
	print '***********************************************************************'

  UPDATE emailtemplate
  SET Body = REPLACE(body,'{Person name}','{PersonName}')
  WHERE Body LIKE '%{Person name}%'

  UPDATE emailtemplate
  SET Body = REPLACE(body,'{Status note}','{StatusNote}')
  WHERE Body LIKE '%{Status note}%'

        Insert into #ChangeScript236_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript236_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript236_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 236, 'Update variable for email template'

		print '**************************************************'
		print '*  db.01.00.236: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.236: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript236_stat%')
Begin
	drop table #ChangeScript236_stat
End
go
 
 
/*
 db.01.00.236:
 Does the following:
	Update variable for email template

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 236

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript236_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript236_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 236)
begin
	print '**************************************************'
	print '*  db.01.00.236: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript236_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript236_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update variable for email template                            *'
	print '***********************************************************************'

  UPDATE emailtemplate
  SET Body = REPLACE(body,'{Person name}','{PersonName}')
  WHERE Body LIKE '%{Person name}%'

  UPDATE emailtemplate
  SET Body = REPLACE(body,'{Status note}','{StatusNote}')
  WHERE Body LIKE '%{Status note}%'

        Insert into #ChangeScript236_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript236_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript236_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 236, 'Update variable for email template'

		print '**************************************************'
		print '*  db.01.00.236: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.236: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript236_stat%')
Begin
	drop table #ChangeScript236_stat
End
go
 
 
/*
 db.01.00.237:
 Does the following:
	Insert more  Data to ReminderType,Configuration  Table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 237

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript237_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript237_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 237)
begin
	print '**************************************************'
	print '*  db.01.00.237: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript237_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript237_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* Insert more  Data to ReminderType,Configuration  Table*'			
	print '**********************************************************************'
	
	insert into [metadata].[ReminderType]([ID], [Name]) values(3, 'Account Receivable')
	
	insert into dbo.Configuration
	values (15, 'DayBeforeReimbursementExpired', 3, 'Number of days before reimbursement to be expired')
	
	
	Insert into #ChangeScript237_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript237_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript237_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 237, 'Insert more  Data to ReminderType,Configuration Table'

		print '**************************************************'
		print '*  db.01.00.237: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.237: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript237_stat%')
Begin
	drop table #ChangeScript237_stat
End
go

 
 
/*
 db.01.00.238:
 Does the following:
	Change Pending to Processing in metadata.SupplyOrderStatus

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 238

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript238_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript238_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 238)
begin
	print '**************************************************'
	print '*  db.01.00.238: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript238_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript238_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Change Pending to Processing in metadata.SupplyOrderStatus                            *'
	print '***********************************************************************'

/***************************************************************************
*                                                                          *
* TODO: Add SQL script here - you should remove all GO commands            *
*                                                                          *
***************************************************************************/

		UPDATE metadata.SupplyOrderStatus
		SET [Name] = 'Processing'
		WHERE [Name] = 'Pending'

        Insert into #ChangeScript238_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript238_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript238_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 238, 'Change Pending to Processing in metadata.SupplyOrderStatus'

		print '**************************************************'
		print '*  db.01.00.238: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.238: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript238_stat%')
Begin
	drop table #ChangeScript238_stat
End
go
 
 
/*
 db.01.00.239:
 Does the following:
	- Remove APGenerated field from OrderAssignment
	- Remove IsPaid field from OrderAssignment
	- Add CreatedDate into AccountPayableDetail
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 239

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript239_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript239_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 239)
begin
	print '**************************************************'
	print '*  db.01.00.239: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript239_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript239_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '**********************************************************************'
	print '* Remove APGenerated field from OrderAssignment						*'			
	print '* Add CreatedDate into AccountPayableDetail							*'			
	print '**********************************************************************'
	
	IF dbo.SMM_CheckExists(6, 'APGenerated', 'OrderAssignment') = 0
		ALTER TABLE dbo.OrderAssignment
		DROP COLUMN APGenerated

	IF dbo.SMM_CheckExists(6, 'IsPaid', 'OrderAssignment') = 0
		ALTER TABLE dbo.OrderAssignment
		DROP COLUMN IsPaid
			
	IF dbo.SMM_CheckExists(6, 'CreatedDate', 'AccountPayableDetail') = -1
		ALTER TABLE dbo.AccountPayableDetail
		ADD CreatedDate DATETIME NOT NULL CONSTRAINT DF_AccountPayableDetail_CreatedDate DEFAULT(getdate())
	
	Insert into #ChangeScript239_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript239_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript239_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 239, 'Insert more  Data to ReminderType,Configuration Table'

		print '**************************************************'
		print '*  db.01.00.239: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.239: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript239_stat%')
Begin
	drop table #ChangeScript239_stat
End
go

 
 
/*
 db.01.00.240:
 Does the following:
	Create table Module

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 240

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript240_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript240_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 240)
begin
	print '**************************************************'
	print '*  db.01.00.240: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript240_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript240_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Create table Module                            *'
	print '***********************************************************************'
	
	CREATE TABLE [metadata].[Module](
		[ID] [int] NOT NULL,
		[Name] [nvarchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
		 CONSTRAINT [PK_Module] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)
	)
	
	ALTER TABLE metadata.PermissionTypeGroup ADD
	ModuleID int NULL
	
	alter table metadata.PermissionType add PartyType int null
	
	alter table metadata.PermissionType add SectionPermission int null
	
	/*alter table metadata.ObjectType add IsPartyType int not null default 0 */
	
	/* update metadata.ObjectType set IsPartyType = 1 where id in (1,2,3,5,6) */

        Insert into #ChangeScript240_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript240_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript240_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 240, 'Create table Module'

		print '**************************************************'
		print '*  db.01.00.240: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.240: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript240_stat%')
Begin
	drop table #ChangeScript240_stat
End
go
 
 
/*
 db.01.00.241:
 Does the following:
	Update ModuleID for PermissionTypeGroup

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 241

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript241_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript241_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 241)
begin
	print '**************************************************'
	print '*  db.01.00.241: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript241_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript241_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update ModuleID for PermissionTypeGroup                            *'
	print '***********************************************************************'
	 	
	insert into metadata.Module VALUES(1, 'Order Management')
	insert into metadata.Module VALUES(2, 'Service Provider Management')
	insert into metadata.Module VALUES(3, 'Insurance Management')
	insert into metadata.Module VALUES(4, 'Billing Company Management')
	insert into metadata.Module VALUES(5, 'Ordering Party Management')
	insert into metadata.Module VALUES(6, 'Employee Management')
	insert into metadata.Module VALUES(7, 'Inventory Management')
	insert into metadata.Module VALUES(8, 'Accounting Management')
	insert into metadata.Module VALUES(9, 'Partner Management')
	insert into metadata.Module VALUES(10, 'General')
	
	ALTER TABLE metadata.PermissionTypeGroup ADD CONSTRAINT
	FK_PermissionTypeGroup_Module FOREIGN KEY
	(
	ModuleID
	) REFERENCES metadata.Module
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	 
	UPDATE metadata.PermissionTypeGroup SET ModuleID = 1
	
	/* Ordering Party / Party Profile */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(400, 'Party Profile',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(400,'OrderingParty_PartyProfile_Create',NULL,400,NULL,NULL,'Create',4,1003)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(401,'OrderingParty_PartyProfile_Update',NULL,400,NULL,NULL,'Update',4,1004)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(402,'OrderingParty_PartyProfile_View',NULL,400,NULL,NULL,'View',4,1005)

	/* Ordering Party / Party Contact Information */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(401, 'Party Contact Information',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(403,'OrderingParty_PartyContactInformation_Create',NULL,401,NULL,NULL,'Create',4,1006)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(404,'OrderingParty_PartyContactInformation_Update',NULL,401,NULL,NULL,'Update',4,1007)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(405,'OrderingParty_PartyContactInformation_View',NULL,401,NULL,NULL,'View',4,1008)

	/* Ordering Party / Agent Contact */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(402, 'Agent Contact',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[SectionPermission])VALUES(406,'OrderingParty_AgentContact_Create',NULL,402,NULL,NULL,'Create',406)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[SectionPermission])VALUES(407,'OrderingParty_AgentContact_Update',NULL,402,NULL,NULL,'Update',407)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[SectionPermission])VALUES(408,'OrderingParty_AgentContact_View',NULL,402,NULL,NULL,'View',408)

	/* Ordering Party / Agency Management */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(403, 'Agency Management',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[SectionPermission])VALUES(409,'OrderingParty_AgencyManagement_Create',NULL,403,NULL,NULL,'Create',409)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[SectionPermission])VALUES(410,'OrderingParty_AgencyManagement_Update',NULL,403,NULL,NULL,'Delete',410)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[SectionPermission])VALUES(411,'OrderingParty_AgencyManagement_View',NULL,403,NULL,NULL,'View',411)

	/* Ordering Party / Mailing List */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(404, 'Mailing List',5)
	
	/*INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(412,'OrderingParty_MailingList_Create',NULL,404,NULL,NULL,'Create')*/
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(413,'OrderingParty_MailingList_Update',NULL,404,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(414,'OrderingParty_MailingList_View',NULL,404,NULL,NULL,'View')

	/* Ordering Party / Insurance List */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(405, 'Insurance List',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(415,'OrderingParty_InsuranceList_Create',NULL,405,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(416,'OrderingParty_InsuranceList_Update',NULL,405,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(417,'OrderingParty_InsuranceList_View',NULL,405,NULL,NULL,'View')

	/* Ordering Party / Order Management */
	/*INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(406, 'Order Management',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(418,'OrderingParty_OrderManagement_Create',NULL,406,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(419,'OrderingParty_OrderManagement_Update',NULL,406,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(420,'OrderingParty_OrderManagement_View',NULL,406,NULL,NULL,'View')*/

	/* Ordering Party / Question Answer */
	/*INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(407, 'Question Answer',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(421,'OrderingParty_QuestionAnswer_Create',NULL,407,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(422,'OrderingParty_QuestionAnswer_Update',NULL,407,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(423,'OrderingParty_QuestionAnswer_View',NULL,407,NULL,NULL,'View')*/

	/* Ordering Party / OP Member */
	/*INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(408, 'OP Member',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(424,'OrderingParty_OPMember_Create',NULL,408,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(425,'OrderingParty_OPMember_Update',NULL,408,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(426,'OrderingParty_OPMember_View',NULL,408,NULL,NULL,'View')*/

	/* Ordering Party / User Account */
	/*INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(409, 'User Account',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(427,'OrderingParty_UserAccount_Create',NULL,409,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(428,'OrderingParty_UserAccount_Update',NULL,409,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(429,'OrderingParty_UserAccount_View',NULL,409,NULL,NULL,'View')*/

	/* Ordering Party / Office Note */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(410, 'Office Note',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(430,'OrderingParty_OfficeNote_Create',NULL,410,NULL,NULL,'Create', 4, 1000)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(431,'OrderingParty_OfficeNote_Update',NULL,410,NULL,NULL,'Update', 4, 1001)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(432,'OrderingParty_OfficeNote_View',NULL,410,NULL,NULL,'View', 4, 1002)
	
	/* Ordering Party / General Info */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(411, 'General Information',5)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[SectionPermission])VALUES(433,'OrderingParty_GeneralInfo_Update',NULL,411,NULL,NULL,'Update',433)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[SectionPermission])VALUES(434,'OrderingParty_GeneralInfo_View',NULL,411,NULL,NULL,'View',434)

	/* Employee Management / Management */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(500, 'Management',6)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(500,'EmployeeManagement_Management_Create',NULL,500,NULL,NULL,'Create',5,1006)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(501,'EmployeeManagement_Management_Update',NULL,500,NULL,NULL,'Update',5,1007)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(502,'EmployeeManagement_Management_View',NULL,500,NULL,NULL,'View',5,1008)

	/* Employee Management / Permission */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(501, 'Permission',6)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(503,'EmployeeManagement_Permission_Create',NULL,501,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(504,'EmployeeManagement_Permission_Update',NULL,501,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(505,'EmployeeManagement_Permission_View',NULL,501,NULL,NULL,'View')	

	/* Employee Management / Office Note */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(503, 'Office Note',6)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(509,'EmployeeManagement_OfficeNote_Create',NULL,503,NULL,NULL,'Create',5,1000)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(510,'EmployeeManagement_OfficeNote_Update',NULL,503,NULL,NULL,'Update',5,1001)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(511,'EmployeeManagement_OfficeNote_View',NULL,503,NULL,NULL,'View',5,1002)

	/* Inventory / Item */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(600, 'Item',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(600,'Inventory_Item_Create',NULL,600,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(601,'Inventory_Item_Update',NULL,600,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(602,'Inventory_Item_View',NULL,600,NULL,NULL,'View')

	/* Inventory / Supply Order */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(601, 'Supply Order',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(603,'Inventory_SupplyOrder_Create',NULL,601,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(604,'Inventory_SupplyOrder_Update',NULL,601,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(605,'Inventory_SupplyOrder_View',NULL,601,NULL,NULL,'View')

	/* Inventory / Sales Order */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(602, 'Sales Order',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(606,'Inventory_SalesOrder_Create',NULL,602,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(607,'Inventory_SalesOrder_Update',NULL,602,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(608,'Inventory_SalesOrder_View',NULL,602,NULL,NULL,'View')

	/* Inventory / Purchase Order */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(603, 'Purchase Order',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(609,'Inventory_PurchaseOrder_Create',NULL,603,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(610,'Inventory_PurchaseOrder_Update',NULL,603,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(611,'Inventory_PurchaseOrder_View',NULL,603,NULL,NULL,'View')

	/* Inventory / Packing List */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(604, 'Packing List',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(612,'Inventory_PackingList_Create',NULL,604,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(613,'Inventory_PackingList_Update',NULL,604,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(614,'Inventory_PackingList_View',NULL,604,NULL,NULL,'View')

	/* Inventory / Receive */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(605, 'Receive',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(615,'Inventory_Receive_Create',NULL,605,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(616,'Inventory_Receive_Update',NULL,605,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(617,'Inventory_Receive_View',NULL,605,NULL,NULL,'View')

	/* Inventory / Shipping */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(606, 'Shipping',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(618,'Inventory_Shipping_Create',NULL,606,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(619,'Inventory_Shipping_Update',NULL,606,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(620,'Inventory_Shipping_View',NULL,606,NULL,NULL,'View')

	/* Inventory / Supplier */
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(607, 'Supplier',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(621,'Inventory_Supplier_Create',NULL,607,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(622,'Inventory_Supplier_Update',NULL,607,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(623,'Inventory_Supplier_View',NULL,607,NULL,NULL,'View')

	update metadata.permissiontype set sectionpermission = id where id = 94
	

        Insert into #ChangeScript241_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript241_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript241_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 241, 'Update ModuleID for PermissionTypeGroup'

		print '**************************************************'
		print '*  db.01.00.241: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.241: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript241_stat%')
Begin
	drop table #ChangeScript241_stat
End
go
 
 
/*
 db.01.00.242:
 Does the following:
	Add PermissionType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 242

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript242_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript242_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 242)
begin
	print '**************************************************'
	print '*  db.01.00.242: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript242_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript242_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add PermissionType                            *'
	print '***********************************************************************'

	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(30, 'Party Profile',2)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(221,'ServiceProvider_PartyProfile_Create',NULL,30,NULL,NULL,'Create',1,1003)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(222,'ServiceProvider_PartyProfile_Update',NULL,30,NULL,NULL,'Update',1,1004)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(223,'ServiceProvider_PartyProfile_View',NULL,30,NULL,NULL,'View',1,1005)	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(31, 'Profile',2)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(224,'ServiceProvider_Profile_Update',NULL,31,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(225,'ServiceProvider_PartyProfile_View',NULL,31,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(32, 'Fee',2)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(226,'ServiceProvider_FeeProfile_Create',NULL,32,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(227,'ServiceProvider_FeeProfile_Update',NULL,32,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(228,'ServiceProvider_FeeProfile_View',NULL,32,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(33, 'Schedule',2)
	
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(229,'ServiceProvider_ScheduleProfile_Create',NULL,33,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(230,'ServiceProvider_ScheduleProfile_Update',NULL,33,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(231,'ServiceProvider_ScheduleProfile_View',NULL,33,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(34, 'Area',2)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(232,'ServiceProvider_AreaProfile_Create',NULL,34,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(233,'ServiceProvider_AreaProfile_Update',NULL,34,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(234,'ServiceProvider_AreaProfile_View',NULL,34,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(35, 'Billing Approval',2)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(235,'ServiceProvider_BillingApprovalProfile_Create',NULL,35,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(236,'ServiceProvider_BillingApprovalProfile_Update',NULL,35,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(237,'ServiceProvider_BillingApprovalProfile_View',NULL,35,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(36, 'Black List',2)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(238,'ServiceProvider_BlackListProfile_Create',NULL,36,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(239,'ServiceProvider_BlackListProfile_Update',NULL,36,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(240,'ServiceProvider_BlackListProfile_View',NULL,36,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(37, 'User',2)	
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(241,'ServiceProvider_UserProfile_Create',NULL,37,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(242,'ServiceProvider_UserProfile_Update',NULL,37,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(243,'ServiceProvider_UserProfile_View',NULL,37,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(38, 'Credetialing',2)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(244,'ServiceProvider_CredetialingProfile_Create',NULL,38,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(245,'ServiceProvider_CredetialingProfile_Update',NULL,38,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(246,'ServiceProvider_CredetialingProfile_View',NULL,38,NULL,NULL,'View')		
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(39, 'Post Office Note',2)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(249,'ServiceProvider_PostOfficeNoteProfile_Create',NULL,39,NULL,NULL,'Create',1,1000)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(250,'ServiceProvider_PostOfficeNoteProfile_Update',NULL,39,NULL,NULL,'Update',1,1001)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(251,'ServiceProvider_PostOfficeNoteProfile_View',NULL,39,NULL,NULL,'View',1,1002)	

	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(40, 'Party Contact',2)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(252,'ServiceProvider_PartyContactNoteProfile_Create',NULL,40,NULL,NULL,'Create',1,1006)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(253,'ServiceProvider_PartyContactProfile_Update',NULL,40,NULL,NULL,'Update',1,1007)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(254,'ServiceProvider_PartyContactProfile_View',NULL,40,NULL,NULL,'View',1,1008)	
	
        Insert into #ChangeScript242_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript242_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript242_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 242, 'Add PermissionType'

		print '**************************************************'
		print '*  db.01.00.242: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.242: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript242_stat%')
Begin
	drop table #ChangeScript242_stat
End
go
 
 
/*
 db.01.00.243:
 Does the following:
	Add PermissionType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 243

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript243_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript243_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 243)
begin
	print '**************************************************'
	print '*  db.01.00.243: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript243_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript243_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add PermissionType                            *'
	print '***********************************************************************'

	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(300, 'Party Profile',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(300,'Insurance_PartyProfile_Create',NULL,300,NULL,NULL,'Create',2,1003)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(301,'Insurance_PartyProfile_Update',NULL,300,NULL,NULL,'Update',2,1004)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(302,'Insurance_PartyProfile_View',NULL,300,NULL,NULL,'View',2,1005)	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(301, 'Contact Information',3)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(303,'Insurance_PartyContactEmailAddressProfile_Create',NULL,301,NULL,NULL,'Create',2,1006)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(304,'Insurance_PartyContactEmailAddressProfile_Update',NULL,301,NULL,NULL,'Update',2,1007)	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(305,'Insurance_PartyContactEmailAddressProfile_View',NULL,301,NULL,NULL,'View',2,1008)	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(302, 'Profile',3)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(307,'Insurance_Profile_Update',NULL,302,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(308,'Insurance_Profile_View',NULL,302,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(303, 'Labs',3)
	
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(309,'Insurance_LabsProfile_Create',NULL,303,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(310,'Insurance_LabsProfile_Update',NULL,303,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(311,'Insurance_LabsProfile_View',NULL,303,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(304, 'Forms',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(312,'Insurance_FormsProfile_Create',NULL,304,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(313,'Insurance_FormsProfile_Update',NULL,304,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(314,'Insurance_FormsProfile_View',NULL,304,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(305, 'Requirement',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(315,'Insurance_RequirementProfile_Create',NULL,305,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(316,'Insurance_RequirementProfile_Update',NULL,305,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(317,'Insurance_RequirementProfile_View',NULL,305,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(306, 'Billing',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(318,'Insurance_BillingProfile_Create',NULL,306,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(319,'Insurance_BillingProfile_Update',NULL,306,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(320,'Insurance_BillingProfile_View',NULL,306,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(307, 'Product Type',3)	
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(321,'Insurance_ProductTypeProfile_Create',NULL,307,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(322,'Insurance_ProductTypeProfile_Update',NULL,307,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(323,'Insurance_ProductTypeProfile_View',NULL,307,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(308, 'Mailing',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(324,'Insurance_MailingProfile_Create',NULL,308,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(325,'Insurance_MailingProfile_Update',NULL,308,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(326,'Insurance_MailingProfile_View',NULL,308,NULL,NULL,'View')		
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(309, 'Locations',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(327,'Insurance_LocationsProfile_Create',NULL,309,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(328,'Insurance_LocationsProfile_Update',NULL,309,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(329,'Insurance_LocationsProfile_View',NULL,309,NULL,NULL,'View')	

	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(310, 'Post Office Note',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(330,'Insurance_PostOfficeNoteProfile_Create',NULL,310,NULL,NULL,'Create',2,1000)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(331,'Insurance_PostOfficeNoteProfile_Update',NULL,310,NULL,NULL,'Update',2,1001)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(332,'Insurance_PostOfficeNoteProfile_View',NULL,310,NULL,NULL,'View',2,1002)	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(311, 'Requirement Condition and Chart Generator',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(333,'Insurance_RequirementCondionChart_Create',NULL,311,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(334,'Insurance_RequirementCondionChart_Update',NULL,311,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(335,'Insurance_RequirementCondionChart_View',NULL,311,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(312, 'Requirement Code',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(336,'Insurance_RequirementCodeProfile_Create',NULL,312,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(337,'Insurance_RequirementCodeProfile_Update',NULL,312,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(338,'Insurance_RequirementCodeProfile_View',NULL,312,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(313, 'Profile',4)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(340,'BillingCompany_Profile_Update',NULL,313,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(341,'BillingCompany_Profile_View',NULL,313,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(314, 'Pricing Surcharges',3)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(342,'BillingCompany_PricingSurchargesProfile_Create',NULL,314,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(343,'BillingCompany_PricingSurchargesProfile_Update',NULL,314,NULL,NULL,'Update')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(344,'BillingCompany_PricingSurchargesProfile_View',NULL,314,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(315, 'Contact Email Address',4)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(345,'BillingCompany_PartyContactEmailAddressProfile_Create',NULL,315,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(346,'BillingCompany_PartyContactEmailAddressProfile_Update',NULL,315,NULL,NULL,'Update')	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(347,'BillingCompany_PartyContactEmailAddressProfile_View',NULL,315,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(316, 'Post Office Note',4)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(348,'BillingCompany_PostOfficeNoteProfile_Create',NULL,316,NULL,NULL,'Create',3,1000)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(349,'BillingCompany_PostOfficeNoteProfile_Update',NULL,316,NULL,NULL,'Update',3,1001)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(350,'BillingCompany_PostOfficeNoteProfile_View',NULL,316,NULL,NULL,'View',3,1002)	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(700, 'Invoice',8)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(700,'Accountant_Invoice_Create',NULL,700,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(701,'Accountant_Invoice_Update',NULL,700,NULL,NULL,'Update')	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(702,'Accountant_Invoice_View',NULL,700,NULL,NULL,'View')		
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(702, 'Data Transfer',8)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(706,'Accountant_DataTransfer_Create',NULL,702,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(707,'Accountant_DataTransfer_Update',NULL,702,NULL,NULL,'Update')	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(708,'Accountant_DataTransfer_View',NULL,702,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(703, 'Payable',8)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(709,'Accountant_Payable_Create',NULL,703,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(710,'Accountant_Payable_Update',NULL,703,NULL,NULL,'Update')	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(711,'Accountant_Payable_View',NULL,703,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(704, 'Payment',8)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(712,'Accountant_Payment_Create',NULL,704,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(713,'Accountant_Payment_Update',NULL,704,NULL,NULL,'Update')	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(714,'Accountant_Payment_View',NULL,704,NULL,NULL,'View')			
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(707, 'Approval Wrire off, Adjustment',8)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(721,'Accountant_ApprovalWriteAdjustment_Create',NULL,707,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(722,'Accountant_ApprovalWriteAdjustment_Update',NULL,707,NULL,NULL,'Update')	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(723,'Accountant_ApprovalWriteAdjustment_View',NULL,707,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(708, 'Adjustment',8)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(724,'Accountant_Adjustment_Create',NULL,708,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(725,'Accountant_Adjustment_Update',NULL,708,NULL,NULL,'Update')	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(726,'Accountant_Adjustment_View',NULL,708,NULL,NULL,'View')	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(800, 'Party Profile',9)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(800,'Partner_PartyProfile_Create',NULL,800,NULL,NULL,'Create',6,1003)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(801,'Partner_PartyProfile_Update',NULL,800,NULL,NULL,'Update',6,1004)	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(802,'Partner_PartyProfile_View',NULL,800,NULL,NULL,'View',6,1005)	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(801, 'Party Contact Information',9)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(803,'Partner_PartyContactProfile_Create',NULL,801,NULL,NULL,'Create',6,1006)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(804,'Partner_PartyContactProfile_Update',NULL,801,NULL,NULL,'Update',6,1007)	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(805,'Partner_PartyContactProfile_View',NULL,801,NULL,NULL,'View',6,1008)	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(802, 'Post Office Note',9)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(806,'Partner_PostOfficeNoteProfile_Create',NULL,802,NULL,NULL,'Create')
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(807,'Partner_PostOfficeNoteProfile_Update',NULL,802,NULL,NULL,'Update')	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(808,'Partner_PostOfficeNoteProfile_View',NULL,802,NULL,NULL,'View')	
	
	UPDATE [metadata].[permissiontype] SET [ActionName] = 'Update GOV&DOB' WHERE [ID] = 92
	UPDATE [metadata].[permissiontype] SET [ActionName] = 'View GOV&DOB' WHERE [ID] = 94
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(803, 'General',10)	
	
	UPDATE [metadata].[permissiontype] SET [ActionName] = 'Place Order' , [PermissionTypeGroupID] = 803 WHERE [ID] = 1
	
        Insert into #ChangeScript243_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript243_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript243_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 243, 'Add PermissionType'

		print '**************************************************'
		print '*  db.01.00.243: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.243: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript243_stat%')
Begin
	drop table #ChangeScript243_stat
End
go
 
 
/*
 db.01.00.244:
 Does the following:
	Add PermissionType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 244

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript244_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript244_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 244)
begin
	print '**************************************************'
	print '*  db.01.00.244: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript244_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript244_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add PermissionType                            *'
	print '***********************************************************************'

	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(608, 'Party Profile Supplier',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(624,'Inventory_PartyProfile_Create',NULL,608,NULL,NULL,'Create',7,1003)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(625,'Inventory_PartyProfile_Update',NULL,608,NULL,NULL,'Update',7,1004)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(626,'Inventory_PartyProfile_View',NULL,608,NULL,NULL,'View',7,1005)	

	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(609, 'Contact Email Address Supplier',7)
		
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(627,'Inventory_PartyContactEmailAddressSupplier_Create',NULL,609,NULL,NULL,'Create',7,1006)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(628,'Inventory_PartyContactEmailAddressSupplier_Update',NULL,609,NULL,NULL,'Update',7,1007)	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(629,'Inventory_PartyContactEmailAddressSupplier_View',NULL,609,NULL,NULL,'View',7,1008)	
	
	INSERT metadata.PermissionTypeGroup([ID],[Name],[ModuleID]) VALUES(610, 'Post Office Note Supplier',7)
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(630,'Inventory_PostOfficeNoteSupplier_Create',NULL,610,NULL,NULL,'Create',7,1000)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(631,'Inventory_PostOfficeNoteSupplier_Update',NULL,610,NULL,NULL,'Update',7,1001)
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName],[PartyType],[SectionPermission])VALUES(632,'Inventory_PostOfficeNoteSupplier_View',NULL,610,NULL,NULL,'View',7,1002)		
		
    Insert into #ChangeScript244_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript244_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript244_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 244, 'Add PermissionType'

		print '**************************************************'
		print '*  db.01.00.244: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.244: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript244_stat%')
Begin
	drop table #ChangeScript244_stat
End
go
 
 
/*
 db.01.00.245:
 Does the following:
	- Add IsRebillReferred into BillingCompany

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 245

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript245_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript245_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 245)
begin
	print '**************************************************'
	print '*  db.01.00.245: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript245_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript245_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add IsRebillReferred into BillingCompany                      *'
	print '***********************************************************************'

	ALTER TABLE BillingCompany
	ADD IsRebillReferred bit NULL

        Insert into #ChangeScript245_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript245_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript245_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 245, '- Add IsRebillReferred into BillingCompany'

		print '**************************************************'
		print '*  db.01.00.245: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.245: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript245_stat%')
Begin
	drop table #ChangeScript245_stat
End
go
 
 
/*
 db.01.00.246:
 Does the following:
	Change Pending to Shipping in metadata.SaleOrderStatus
	Change Pending to Processing in metadata.PurchaseStatus
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 246

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript246_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript246_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 246)
begin
	print '**************************************************'
	print '*  db.01.00.246: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript246_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript246_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: Change Pending to Shipping in metadata.SaleOrderStatus*'
	print '* Change Pending to Processing in metadata.PurchaseStatus       *'
	print '***********************************************************************'

/***************************************************************************
*                                                                          *
* TODO: Add SQL script here - you should remove all GO commands            *
*                                                                          *
***************************************************************************/
		
		/*  Create metadata for SaleOrderStatus */

		UPDATE [metadata].[SaleOrderStatus]
		SET [Name] = 'Shipping'
		WHERE ID = 2

		UPDATE [metadata].[SaleOrderStatus]
		SET [Name] = 'Completed'
		WHERE [ID] = 3

		UPDATE [metadata].[SaleOrderStatus]
		SET [Name] = 'Canceled'
		WHERE [ID] = 4

		UPDATE [SaleOrder]
		SET [StatusID] = 1
		WHERE [StatusID] = 5

		UPDATE [SaleOrder]
		SET [StatusID] = 1
		WHERE [StatusID] = 6

		DELETE FROM [metadata].[SaleOrderStatus] WHERE ID=5
		DELETE FROM [metadata].[SaleOrderStatus] WHERE ID=6


		UPDATE [metadata].[PurchaseOrderStatus]
		SET [Name] = 'Processing'
		WHERE [ID] = 2		

		UPDATE [metadata].[PurchaseOrderStatus]
		SET [Name] = 'Completed'
		WHERE [ID] = 3

		UPDATE [metadata].[PurchaseOrderStatus]
		SET [Name] = 'Canceled'
		WHERE [ID] = 4

		UPDATE [PurchaseOrder]
		SET [StatusID] = 1
		WHERE [StatusID] = 5

		DELETE FROM [metadata].[PurchaseOrderStatus] WHERE ID=5

        Insert into #ChangeScript246_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript246_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript246_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 246, 'Change Pending to Shipping in metadata.SaleOrderStatus'

		print '**************************************************'
		print '*  db.01.00.246: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.246: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript246_stat%')
Begin
	drop table #ChangeScript246_stat
End
go
 
 
/*
 db.01.00.247:
 Does the following:
	- Add data for metadata.SurchargeType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 247

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript247_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript247_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 247)
begin
	print '**************************************************'
	print '*  db.01.00.247: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript247_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript247_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add data for metadata.SurchargeType                         *'
	print '***********************************************************************'

	INSERT INTO metadata.SurchargeType(ID,[Name]) Values(7,'Service Chargeback')
	INSERT INTO metadata.SurchargeType(ID,[Name]) Values(8,'Service Credit')

        Insert into #ChangeScript247_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript247_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript247_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 247, '- Add data for metadata.SurchargeType'

		print '**************************************************'
		print '*  db.01.00.247: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.247: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript247_stat%')
Begin
	drop table #ChangeScript247_stat
End
go
 
 
/*
 db.01.00.248:
 Does the following:
	Add DisapproveReason into OrderWriteOff table
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 248

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript248_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript248_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 248)
begin
	print '**************************************************'
	print '*  db.01.00.248: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript248_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript248_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add DisapproveReason into OrderWriteOff table						 *'
	print '***********************************************************************'
		
		IF dbo.SMM_CheckExists(6, 'DisapproveReason', 'OrderWriteOff') = -1
			ALTER TABLE dbo.OrderWriteOff
			ADD DisapproveReason nvarchar(255) NULL					

        Insert into #ChangeScript248_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript248_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript248_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 248, 'Change Pending to Shipping in metadata.SaleOrderStatus'

		print '**************************************************'
		print '*  db.01.00.248: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.248: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript248_stat%')
Begin
	drop table #ChangeScript248_stat
End
go
 
 
/*
 db.01.00.249:
 Does the following:
	Update Body in table EmailTempalte

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 249

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript249_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript249_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 249)
begin
	print '**************************************************'
	print '*  db.01.00.249: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript249_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript249_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update Body in table EmailTempalte *'
	print '***********************************************************************'

	

	UPDATE [dbo].[EmailTemplate]
	SET [Body] = 'Dear {SPName},

We are writing this email to notify you that the order {OrderID} has been assigned to you. See the description below:
	Service Requirement:{SerReq}
	Applicant Address:{AppAddr}
	Applicant Schedule
		{AppSched}
		
	
Please arrange your time to schedule for the assignment.
Thank you very much for your co-operation.

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
' WHERE ID='3b22e0b3-7511-4017-8746-7c708468dfee'

        Insert into #ChangeScript249_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript249_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript249_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 249, 'Update Body in table EmailTempalte'

		print '**************************************************'
		print '*  db.01.00.249: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.249: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript249_stat%')
Begin
	drop table #ChangeScript249_stat
End
go
 
 
/*
 db.01.00.250:
 Does the following:
	Update Body in table EmailTempalte

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 250

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript250_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript250_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 250)
begin
	print '**************************************************'
	print '*  db.01.00.250: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript250_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript250_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update Body in table EmailTempalte *'
	print '***********************************************************************'

	

	UPDATE [dbo].[EmailTemplate]
	SET [Body] = 'Dear {PersonName},

We are writing this email to notify you that the order {OrderID} has been posted new assignment status. See the description below:
	New assignment status: {AssignmentStatus}
	Posted By: {PostedBy}

Click on below link to view the assignment status.
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
' WHERE ID='bb4ecc42-3fd9-4c8d-b98a-46beb54ff995'

        Insert into #ChangeScript250_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript250_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript250_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 250, 'Update Body in table EmailTempalte'

		print '**************************************************'
		print '*  db.01.00.250: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.250: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript250_stat%')
Begin
	drop table #ChangeScript250_stat
End
go
 
 
/*
 db.01.00.252:
 Does the following:
	Insert Data in table EmailTemplate

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 252

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript252_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript252_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 252)
begin
	print '**************************************************'
	print '*  db.01.00.252: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript252_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript252_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Insert Data in table EmailTemplate*'
	print '***********************************************************************'

	

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('B03F0826-903F-4187-A6F7-CE55A7CC89F3','New Order Placed Notification',
'Dear {PersonName},

We are writing this email to notify you that the new order {OrderID} has just been placed. See the description below:

OrderDate:{OrderDate}
OrderType:{OrderType}
Service Requirement:{ServiceRequirement}

Click on below link to view the order details.
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 252
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
',getdate(),getdate(),NULL)

        Insert into #ChangeScript252_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript252_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript252_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 252, 'Insert Data in table EmailTemplate'

		print '**************************************************'
		print '*  db.01.00.252: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.252: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript252_stat%')
Begin
	drop table #ChangeScript252_stat
End
go
 
 
/*
 db.01.00.253:
 Does the following:
	Add new table OrderWriteOffPayment
Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 253

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript253_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript253_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 253)
begin
	print '**************************************************'
	print '*  db.01.00.253: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript253_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript253_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add DisapproveReason into OrderWriteOff table						 *'
	print '***********************************************************************'
		
		CREATE TABLE OrderWriteOffPayment(
			ID [uniqueidentifier] NOT NULL,
			OrderWriteOffID [uniqueidentifier] NOT NULL,
			PaymentID int NOT NULL,
			Amount	money NOT NULL,
			CONSTRAINT PK_OrderWriteOffPayment PRIMARY KEY(ID)
		)

		ALTER TABLE OrderWriteOffPayment
		ADD CONSTRAINT FK_OrderWriteOffPayment_OrderWriteOff FOREIGN KEY(OrderWriteOffID) REFERENCES OrderWriteOff(ID)

		ALTER TABLE OrderWriteOffPayment
		ADD CONSTRAINT FK_OrderWriteOffPayment_Payment FOREIGN KEY(PaymentID) REFERENCES Payment(ID)

        Insert into #ChangeScript253_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript253_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript253_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 253, 'Change Pending to Shipping in metadata.SaleOrderStatus'

		print '**************************************************'
		print '*  db.01.00.253: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.253: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript253_stat%')
Begin
	drop table #ChangeScript253_stat
End
go
 
 
/*
 db.01.00.254:
 Does the following:
	Insert Data in table EmailTemplate

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 254

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript254_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript254_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 254)
begin
	print '**************************************************'
	print '*  db.01.00.254: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript254_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript254_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Insert Data in table EmailTemplate*'
	print '***********************************************************************'

	

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('9409E192-A1D4-4A3E-A2FD-063040FC42F8','Confirm receiving kits Notification',
'Dear {PersonName},

We are writing this email to notify you that the Service Provider {ServiceProviderName} has just confirmed the Sales Order {OrderNumber}. See the description below:

Medical items:
	{ListMedicalItems}
	
{SupplyOrderInfo}
Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
',getdate(),getdate(),NULL)

        Insert into #ChangeScript254_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript254_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript254_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 254, 'Insert Data in table EmailTemplate'

		print '**************************************************'
		print '*  db.01.00.254: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.254: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript254_stat%')
Begin
	drop table #ChangeScript254_stat
End
go
 
 
/*
 db.01.00.255:
 Does the following:
	- Add data for metadata.SurchargeType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 255

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript255_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript255_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 255)
begin
	print '**************************************************'
	print '*  db.01.00.255: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript255_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript255_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add data for metadata.SurchargeType                         *'
	print '***********************************************************************'

		INSERT INTO metadata.SurchargeType(ID,[Name]) Values(9,'Discount After Posted')

        Insert into #ChangeScript255_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript255_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript255_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 255, '- Add data for metadata.SurchargeType'

		print '**************************************************'
		print '*  db.01.00.255: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.255: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript255_stat%')
Begin
	drop table #ChangeScript255_stat
End
go
 
 
/*
 db.01.00.256:
 Does the following:
	- Insert Customer Service Representative row into Table dbo.Configuration

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 256

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript256_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript256_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 256)
begin
	print '**************************************************'
	print '*  db.01.00.256: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript256_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript256_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Insert Customer Service Representative row into Table dbo.Configuration           *'
	print '***********************************************************************'
		
		INSERT INTO dbo.Configuration(ID, [Name], [Value], Description) 
			VALUES(16, 'CustomerServiceRepresentative', '', 'ID of Customer Service Representative')

        Insert into #ChangeScript256_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript256_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript256_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 256, 'Insert Customer Service Representative row into Table dbo.Configuration'

		print '**************************************************'
		print '*  db.01.00.256: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.256: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript256_stat%')
Begin
	drop table #ChangeScript256_stat
End
go
 
 
/*
 db.01.00.257:
 Does the following:
	Update Data in table EmailTemplate

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 257

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript257_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript257_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 257)
begin
	print '**************************************************'
	print '*  db.01.00.257: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript257_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript257_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update Data in table EmailTemplate*'
	print '***********************************************************************'

		Update [dbo].[EmailTemplate] 
		set [Body] = 'Dear {SPName},

	We are writing this email to notify you that the kits with below details have just been shipped to your address:
	1. Shipping address
	2. The list of medical items of the order with below columns as below:
		Medical items:
		{ListMedicalItems}

	When receiving kits, please click on below link to go to the confirmation page
	{URL}
	Thank you very much for your co-operation.

	Sincerely,
	SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
	San Diego, CA 92108
	P.O. Box 639014
	San Diego, CA 92163-9014
	Toll Free Number Phone (800) 898-EXAM (3926)
	Fax (888) 548-3926
	Email: cs@superiormobilemedics.com
	'
		where id='b532738e-60d8-44a2-a785-2c68c1360544'
	
        Insert into #ChangeScript257_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript257_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript257_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 257, 'Update Data in table EmailTemplate'

		print '**************************************************'
		print '*  db.01.00.257: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.257: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript257_stat%')
Begin
	drop table #ChangeScript257_stat
End
go
 
 
/*
 db.01.00.258:
 Does the following:
	Insert Data in table EmailTemplate

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 258

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript258_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript258_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 258)
begin
	print '**************************************************'
	print '*  db.01.00.258: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript258_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript258_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Insert Data in table EmailTemplate*'
	print '***********************************************************************'

	

	INSERT INTO [dbo].[EmailTemplate]([ID],[Subject],[Body],[CreatedDate],[ModifiedDate],[DeletedDate])
		VALUES('A95A1024-1673-49C5-992A-FEBFDFF8EA2D','Approval Notification',
'Dear {SupervisorName},

Please give your approval for the {Type} below:

Requested Date:{RequestedDate}
Requested By:{RequestedBy}
Customer Name:{CustomerName}

Click on below link to view the request.
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
',getdate(),getdate(),NULL)

        Insert into #ChangeScript258_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript258_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript258_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 258, 'Insert Data in table EmailTemplate'

		print '**************************************************'
		print '*  db.01.00.258: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.258: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript258_stat%')
Begin
	drop table #ChangeScript258_stat
End
go
 
 
/****** Object:  UserDefinedFunction [dbo].[SuggestAgencyByCreatedAndOrderingParty]    Script Date: 07/22/2009 09:14:28 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SuggestAgencyByCreatedAndOrderingParty]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
	DROP FUNCTION [dbo].[SuggestAgencyByCreatedAndOrderingParty]

GO
/****** Object:  UserDefinedFunction [dbo].[GetAgencyByCreatedAndOPUser]    Script Date: 05/22/2009 20:11:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[SuggestAgencyByCreatedAndOrderingParty]
(	
	@InsuranceID uniqueidentifier,
	@CurrentUserID uniqueidentifier, 
	@OrderingPartyID uniqueidentifier,
	@Keyword varchar(255)
)
RETURNS TABLE 
AS
RETURN 
(
	-- Add the SELECT statement with parameter references here
	select * from agency a
	where a.id IN (
		select ai.AgencyID from AgencyInsurance ai
		where ai.InsuranceID = @InsuranceID and ai.AgencyID in 
			(
				select a1.ID FROM Agency a1
				WHERE a1.CreatedBy = @CurrentUserID
			)
		union
				select opa.AgencyID
				FROM OrderingPartyAgency opa
				INNER JOIN Agency a2 ON opa.AgencyID = a2.ID AND a2.DeletedDate IS NULL AND a2.IsShared = 1
				WHERE opa.OrderingPartyID = @OrderingPartyID
			
		
	) and a.DeletedDate is null and a.Inactive = 0 and a.FullName LIKE '%'+@Keyword+'%'
)

GO
 
 
/*
 db.01.00.259:
 Does the following:
	Update Data in table EmailTemplate

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 259

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript259_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript259_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 259)
begin
	print '**************************************************'
	print '*  db.01.00.259: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript259_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript259_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update Data in table EmailTemplate*'
	print '***********************************************************************'

	

	Update [dbo].[EmailTemplate]
	Set [Body] = 
'Dear {SupervisorName},

Please give your approval for the {Type} below:

Requested Date:{RequestedDate}
Requested By:{RequestedBy}
Customer Name:{CustomerName}

Click on below link to view the request.
{URL}

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com
'
where ID = 'A95A1024-1673-49C5-992A-FEBFDFF8EA2D'
        Insert into #ChangeScript259_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript259_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript259_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 259, 'Update Data in table EmailTemplate'

		print '**************************************************'
		print '*  db.01.00.259: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.259: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript259_stat%')
Begin
	drop table #ChangeScript259_stat
End
go
 
 
/*
 db.01.00.260:
 Does the following:
	Delete  Data in table Department

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 260

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript260_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript260_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 260)
begin
	print '**************************************************'
	print '*  db.01.00.260: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript260_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript260_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Delete  Data in table Department*'
	print '***********************************************************************'

	delete from Department where id='25DDA5B9-0417-4377-86C7-62F09D666C6A'
	delete from Department where id='25DDA5B9-0417-4377-86C7-62F09D666C6B'
	delete from Department where id='25DDA5B9-0417-4377-86C7-62F09D666C6C'
	delete from Department where id='25DDA5B9-0417-4377-86C7-62F09D666C6D'
	delete from Department where id='25DDA5B9-0417-4377-86C7-62F09D666C6E'

	
        Insert into #ChangeScript260_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript260_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript260_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 260, 'Delete  Data in table Department'

		print '**************************************************'
		print '*  db.01.00.260: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.260: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript260_stat%')
Begin
	drop table #ChangeScript260_stat
End
go
 
 
/*
 db.01.00.261:
 Does the following:
	Update  Data in table Reminder Type

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 261

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript261_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript261_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 261)
begin
	print '**************************************************'
	print '*  db.01.00.261: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript261_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript261_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update  Data in table Reminder Type*'
	print '***********************************************************************'
		update [Metadata].[ReminderType]
		set [Name] = 'Reimbursement'
		where [ID]='3'
	
        Insert into #ChangeScript261_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript261_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript261_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 261, 'Update  Data in table Reminder Type'

		print '**************************************************'
		print '*  db.01.00.261: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.261: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript261_stat%')
Begin
	drop table #ChangeScript261_stat
End
go
 
 
/*
 db.01.00.262:
 Does the following:
	- Update row into Table dbo.EmailTemplate

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 262

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript262_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript262_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 262)
begin
	print '**************************************************'
	print '*  db.01.00.262: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript262_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript262_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '*  Update row into Table dbo.EmailTemplate         *'
	print '***********************************************************************'
	
		DELETE FROM dbo.EmailTemplate 
		WHERE SUBJECT='New Supply Order notification'
		
		INSERT INTO dbo.EmailTemplate(ID, Subject, Body, CreatedDate, ModifiedDate)
			VALUES('8F8EF6A7-3207-4BBA-98A6-252C060F8775',
'New Supply Order notification', 
'Dear {PersonName},    

We are writing this email to notify that a new supply order has been placed. See the details below:   
	Supply order number {SO_Num}   
	Place by {ServiceProviderName}   on {PlaceDate}       

Sincerely,  
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108  
P.O. Box 639014  
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)  
Fax (888) 548-3926  
Email: cs@superiormobilemedics.com', GetDate(), GetDate())

        Insert into #ChangeScript262_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript262_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript262_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 262, ' Update into Table dbo.EmailTemplate'

		print '**************************************************'
		print '*  db.01.00.262: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.262: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript262_stat%')
Begin
	drop table #ChangeScript262_stat
End
go
 
 
/*
 db.01.00.263:
 Does the following:
	- Add Table dbo.[OrderingPartyReferral]

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 263

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript263_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript263_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 263)
begin
	print '**************************************************'
	print '*  db.01.00.263: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript263_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript263_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '*  Add Table dbo.[OrderingPartyReferral]         *'
	print '***********************************************************************'
	IF dbo.SMM_CheckExists(1, 'OrderingPartyReferral', '') = -1
	Begin
		CREATE TABLE [dbo].[OrderingPartyReferral](
		[ID] [uniqueidentifier] NOT NULL,
		[OrderingPartyID] [uniqueidentifier] NOT NULL,
		[ReferralAmount] [money] NULL,
		[ServiceProviderID] [uniqueidentifier] NOT NULL,
		 CONSTRAINT [PK_OrderingPartyReferral] PRIMARY KEY CLUSTERED 
		(
			[ID] ASC
		)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
		) ON [PRIMARY]

		ALTER TABLE [dbo].[OrderingPartyReferral]  WITH CHECK ADD  CONSTRAINT [FK_OrderingPartyReferral_OrderingParty] FOREIGN KEY([OrderingPartyID])
		REFERENCES [dbo].[OrderingParty] ([ID])
		
		ALTER TABLE [dbo].[OrderingPartyReferral]  WITH CHECK ADD  CONSTRAINT [FK_OrderingPartyReferral_ServiceProvider] FOREIGN KEY([ServiceProviderID])
		REFERENCES [dbo].[ServiceProvider] ([ID])
		
		Insert into #ChangeScript263_stat (PatchStatus) Values (1)
	End
	

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript263_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript263_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 263, ' Add Table dbo.[OrderingPartyReferral]'

		print '**************************************************'
		print '*  db.01.00.263: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.263: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript263_stat%')
Begin
	drop table #ChangeScript263_stat
End
go
 
 
/*
 db.01.00.264:
 Does the following:
	Add IsVoid field into AccountPayable table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 264

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript264_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript264_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 264)
begin
	print '**************************************************'
	print '*  db.01.00.264: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript264_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript264_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add IsVoid field into AccountPayable table							 *'
	print '***********************************************************************'
	
	IF dbo.SMM_CheckExists(6, 'IsVoid', 'AccountPayable') = -1
		ALTER TABLE AccountPayable
		ADD IsVoid bit NOT NULL CONSTRAINT DF_AccountPayable_IsVoid DEFAULT(0)
	
	Insert into #ChangeScript264_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript264_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript264_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 264, 'Add AlertDateBeforeCredentialingExpiration Configure,Update Body in EmailTemplate for Credentialing Expire notification,Update Body in EmailTemplate for New Credentialing Request'

		print '**************************************************'
		print '*  db.01.00.264: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.264: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript264_stat%')
Begin
	drop table #ChangeScript264_stat
End
go
 
 
/*
 db.01.00.265:
 Does the following:
	- Add WebServiceUrl,WebServiceMethodName into BillingCompany

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 265

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript265_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript265_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 265)
begin
	print '**************************************************'
	print '*  db.01.00.265: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript265_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript265_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add WebServiceUrl,WebServiceMethodName into BillingCompany                      *'
	print '***********************************************************************'

	ALTER TABLE BillingCompany
		ADD WebServiceUrl nvarchar(100) NULL,
			WebServiceMethodName nvarchar(100) NULL

    Insert into #ChangeScript265_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript265_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript265_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 265, '- Add WebServiceUrl,WebServiceMethodName into BillingCompany'

		print '**************************************************'
		print '*  db.01.00.265: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.265: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript265_stat%')
Begin
	drop table #ChangeScript265_stat
End
go
 
 
/*
 db.01.00.266:
 Does the following:
	- Add DeletedDate, ModifiedDate into OfficeNote

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 266

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript266_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript266_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 266)
begin
	print '**************************************************'
	print '*  db.01.00.266: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript266_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript266_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add DeletedDate, ModifiedDate into OfficeNote                   *'
	print '***********************************************************************'

ALTER TABLE OfficeNote
	ADD DeletedDate datetime NULL,
		ModifiedDate datetime NOT NULL DEFAULT(getdate())

        Insert into #ChangeScript266_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript266_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript266_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 266, '- Add DeletedDate, ModifiedDate into OfficeNote'

		print '**************************************************'
		print '*  db.01.00.266: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.266: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript266_stat%')
Begin
	drop table #ChangeScript266_stat
End
go
 
 
/*
 db.01.00.267:
 Does the following:	
	Add new table to store if the order is readed by current user

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 267

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript267_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript267_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 267)
begin
	print '**************************************************'
	print '*  db.01.00.267: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript267_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript267_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add IsRead field into Order table									 *'
	print '***********************************************************************'		
	
	IF dbo.SMM_CheckExists(2, '', 'ReadOrder') = -1
		CREATE TABLE ReadOrder(
			OrderID int NOT NULL,
			PersonID [uniqueidentifier] NOT NULL,
			CONSTRAINT PK_ReadOrder PRIMARY KEY(OrderID,PersonID)
		)
		ALTER TABLE ReadOrder
		ADD CONSTRAINT FK_ReadOrder_Order FOREIGN KEY(OrderID) REFERENCES [Order](ID)

		ALTER TABLE ReadOrder
		ADD CONSTRAINT FK_ReadOrder_Person FOREIGN KEY(PersonID) REFERENCES Person(ID)		
	
	Insert into #ChangeScript267_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript267_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript267_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 267, 'Add AlertDateBeforeCredentialingExpiration Configure,Update Body in EmailTemplate for Credentialing Expire notification,Update Body in EmailTemplate for New Credentialing Request'

		print '**************************************************'
		print '*  db.01.00.267: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.267: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript267_stat%')
Begin
	drop table #ChangeScript267_stat
End
go
 
 
/*
 db.01.00.268:
 Does the following:
	- Add Description into Department

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 268

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript268_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript268_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 268)
begin
	print '**************************************************'
	print '*  db.01.00.268: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript268_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript268_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Add Description into Department                   *'
	print '***********************************************************************'

ALTER TABLE Department
	ADD Description nvarchar(500) NULL
        Insert into #ChangeScript268_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript268_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript268_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 268, '- Add Description into Department'

		print '**************************************************'
		print '*  db.01.00.268: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.268: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript268_stat%')
Begin
	drop table #ChangeScript268_stat
End
go
 
 
/*
 db.01.00.269:
 Does the following:
	- Update data in EmailTemplate

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 269

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript269_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript269_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 269)
begin
	print '**************************************************'
	print '*  db.01.00.269: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript269_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript269_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Update data in EmailTemplate                   *'
	print '***********************************************************************'

	Update EmailTemplate 
	Set [Body] = 'Dear {SPName},

We are writing this email to notify you that the some of your credentialings are going to be expired. See the details below:
	Credential Name			Expired Date
{ListCredential}

Could you please provide us the new ones
Thank you very much for your co-operation

Sincerely,
SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
San Diego, CA 92108
P.O. Box 639014
San Diego, CA 92163-9014
Toll Free Number Phone (800) 898-EXAM (3926)
Fax (888) 548-3926
Email: cs@superiormobilemedics.com'
	Where [Id] = 'b2c80170-c8a0-4b69-88be-d3dbab99ae0f'
	Insert into #ChangeScript269_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript269_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript269_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 269, '- Update data in EmailTemplate'

		print '**************************************************'
		print '*  db.01.00.269: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.269: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript269_stat%')
Begin
	drop table #ChangeScript269_stat
End
go
 
 
/*
 db.01.00.270:
 Does the following:
	update permissiontype

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 270

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript270_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript270_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 270)
begin
	print '**************************************************'
	print '*  db.01.00.270: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript270_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript270_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* update permissiontype                            *'
	print '***********************************************************************'

	update metadata.permissiontype set permissiontypegroupid = 803 where id = 212

        Insert into #ChangeScript270_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript270_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript270_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 270, 'update permissiontype'

		print '**************************************************'
		print '*  db.01.00.270: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.270: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript270_stat%')
Begin
	drop table #ChangeScript270_stat
End
go
 
 
/*
 db.01.00.271:
 Does the following:
	TODO: <summary of what this patch does?>

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 271

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript271_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript271_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 271)
begin
	print '**************************************************'
	print '*  db.01.00.271: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript271_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript271_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: <summary of what this patch does?>                            *'
	print '***********************************************************************'

	update metadata.permissiontypegroup set [name] = 'Agency' where id = 403
	
        Insert into #ChangeScript271_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript271_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript271_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 271, 'TODO: <summary of what this patch does?>'

		print '**************************************************'
		print '*  db.01.00.271: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.271: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript271_stat%')
Begin
	drop table #ChangeScript271_stat
End
go
 
 
/*
 db.01.00.272:
 Does the following:
	- Update data for metadata.PermissionType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 272

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript272_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript272_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 272)
begin
	print '**************************************************'
	print '*  db.01.00.272: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript272_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript272_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Update data for metadata.PermissionType                      *'
	print '***********************************************************************'

		UPDATE metadata.PermissionType
		SET PartyType=6
		WHERE [Name] In ('Partner_PostOfficeNoteProfile_Create','Partner_PostOfficeNoteProfile_Update','Partner_PostOfficeNoteProfile_View')

		UPDATE metadata.PermissionType
		SET PartyType=1000
		WHERE [Name] ='Partner_PostOfficeNoteProfile_Create'

		UPDATE metadata.PermissionType
		SET PartyType=1001
		WHERE [Name] ='Partner_PostOfficeNoteProfile_Update'

		UPDATE metadata.PermissionType
		SET SectionPermission=1002
		WHERE [Name] ='Partner_PostOfficeNoteProfile_View'

        Insert into #ChangeScript272_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript272_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript272_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 272, '- Update data for metadata.PermissionType'

		print '**************************************************'
		print '*  db.01.00.272: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.272: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript272_stat%')
Begin
	drop table #ChangeScript272_stat
End
go
 
 
/*
 db.01.00.273:
 Does the following:
	- Update data for metadata.PermissionType

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 273

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript273_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript273_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 273)
begin
	print '**************************************************'
	print '*  db.01.00.273: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript273_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript273_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* - Update data for metadata.PermissionType                      *'
	print '***********************************************************************'

		UPDATE metadata.PermissionType
		SET PartyType=6, SectionPermission=1000
		WHERE [Name] ='Partner_PostOfficeNoteProfile_Create'

		UPDATE metadata.PermissionType
		SET PartyType=6, SectionPermission=1001
		WHERE [Name] ='Partner_PostOfficeNoteProfile_Update'

		UPDATE metadata.PermissionType
		SET partytype=6, SectionPermission=1002
		WHERE [Name] ='Partner_PostOfficeNoteProfile_View'

        Insert into #ChangeScript273_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript273_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript273_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 273, '- Update data for metadata.PermissionType'

		print '**************************************************'
		print '*  db.01.00.273: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.273: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript273_stat%')
Begin
	drop table #ChangeScript273_stat
End
go
 
 
/*
 db.01.00.274:
 Does the following:
	Delete "Approval Wrire off, Adjustment" for PermissionTypeGroup

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 274

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript274_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript274_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 274)
begin
	print '**************************************************'
	print '*  db.01.00.274: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript274_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript274_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Delete "Approval Wrire off, Adjustment" for PermissionTypeGroup     *'
	print '***********************************************************************'
	
	DELETE FROM userrolepermission WHERE PermissionTypeID in ('721', '722', '723')
	DELETE FROM metadata.PermissionType WHERE ID in ('721', '722', '723')
	DELETE FROM metadata.PermissionTypeGroup WHERE ID='707'
	
        Insert into #ChangeScript274_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript274_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript274_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 274, 'Delete -Approval Wrire off, Adjustment for PermissionTypeGroup'

		print '**************************************************'
		print '*  db.01.00.274: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.274: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript274_stat%')
Begin
	drop table #ChangeScript274_stat
End
go
 
 
/*
 db.01.00.275:
 Does the following:
	update permission type

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 275

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript275_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript275_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 275)
begin
	print '**************************************************'
	print '*  db.01.00.275: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript275_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript275_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* update permission type                            *'
	print '***********************************************************************'

	DELETE FROM userrolepermission WHERE PermissionTypeID in ('94')
	DELETE FROM metadata.PermissionType WHERE ID in ('94')

        Insert into #ChangeScript275_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript275_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript275_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 275, 'update permission type'

		print '**************************************************'
		print '*  db.01.00.275: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.275: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript275_stat%')
Begin
	drop table #ChangeScript275_stat
End
go
 
 
/*
 db.01.00.276:
 Does the following:
	update permission type

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 276

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript276_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript276_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 276)
begin
	print '**************************************************'
	print '*  db.01.00.276: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript276_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript276_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* update permission type                            *'
	print '***********************************************************************'

	DELETE FROM userrolepermission WHERE PermissionTypeID in ('235')
	DELETE FROM metadata.PermissionType WHERE ID in ('235')

        Insert into #ChangeScript276_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript276_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript276_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 276, 'update permission type'

		print '**************************************************'
		print '*  db.01.00.276: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.276: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript276_stat%')
Begin
	drop table #ChangeScript276_stat
End
go
 
 
/*
 db.01.00.277:
 Does the following:
	TODO: <summary of what this patch does?>

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 277

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript277_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript277_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 277)
begin
	print '**************************************************'
	print '*  db.01.00.277: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript277_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript277_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: <summary of what this patch does?>                            *'
	print '***********************************************************************'

	update metadata.permissiontype set [SectionPermission] = 1006, [PartyType] = 3 where id = 345
	update metadata.permissiontype set [SectionPermission] = 1007, [PartyType] = 3 where id = 346
	update metadata.permissiontype set [SectionPermission] = 1008, [PartyType] = 3 where id = 347
	
        Insert into #ChangeScript277_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript277_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript277_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 277, 'TODO: <summary of what this patch does?>'

		print '**************************************************'
		print '*  db.01.00.277: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.277: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript277_stat%')
Begin
	drop table #ChangeScript277_stat
End
go
 
 
/*
 db.01.00.278:
 Does the following:
	TODO: <summary of what this patch does?>

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 278

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript278_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript278_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 278)
begin
	print '**************************************************'
	print '*  db.01.00.278: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript278_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript278_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: <summary of what this patch does?>                            *'
	print '***********************************************************************'
	
	update metadata.permissiontype set [PermissionTypeGroupID] = null where id = 333
	update metadata.PermissionTypeGroup set [Name] = 'Party contact information' where id = 315
	
        Insert into #ChangeScript278_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript278_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript278_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 278, 'TODO: <summary of what this patch does?>'

		print '**************************************************'
		print '*  db.01.00.278: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.278: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript278_stat%')
Begin
	drop table #ChangeScript278_stat
End
go
 
 
/****** Object:  UserDefinedFunction [dbo].[SuggestAgencyByCreatedAndOrderingParty]    Script Date: 07/22/2009 09:14:28 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SuggestAgencyByCreatedAndOrderingParty]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
	DROP FUNCTION [dbo].[SuggestAgencyByCreatedAndOrderingParty]

GO
/****** Object:  UserDefinedFunction [dbo].[GetAgencyByCreatedAndOPUser]    Script Date: 05/22/2009 20:11:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[SuggestAgencyByCreatedAndOrderingParty]
(	
	@InsuranceID uniqueidentifier,
	@CurrentUserID uniqueidentifier, 
	@OrderingPartyID uniqueidentifier,
	@Keyword varchar(255)
)
RETURNS TABLE 
AS
RETURN 
(
	-- Add the SELECT statement with parameter references here
	select * from agency a
	where a.id IN (
		select a1.ID FROM Agency a1
		WHERE a1.CreatedBy = @CurrentUserID
		
		UNION
		
		select opa.AgencyID
		FROM OrderingPartyAgency opa
		INNER JOIN Agency a2 ON opa.AgencyID = a2.ID AND a2.DeletedDate IS NULL AND a2.IsShared = 1
		WHERE opa.OrderingPartyID = @OrderingPartyID
	) and a.DeletedDate is null and a.Inactive = 0 and a.FullName LIKE '%'+@Keyword+'%'
)

GO
 
 
/*
 db.01.00.279:
 Does the following:
	Permission of search order

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 279

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript279_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript279_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 279)
begin
	print '**************************************************'
	print '*  db.01.00.279: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript279_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript279_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Permission of search order                                          *'
	print '***********************************************************************'
	
	INSERT [metadata].[permissiontype] ([ID],[Name],[Description],[PermissionTypeGroupID],[OrderStatusID],[OrderTypeID],[ActionName])VALUES(905,'Search_Order',NULL,803,NULL,NULL,'Search Order')	
	
        Insert into #ChangeScript279_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript279_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript279_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 279, 'Permission of search order'

		print '**************************************************'
		print '*  db.01.00.279: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.279: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript279_stat%')
Begin
	drop table #ChangeScript279_stat
End
go
 
 
/****** Object:  UserDefinedFunction [dbo].[BuildFullName]    Script Date: 07/22/2009 09:14:28 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[BuildFullName]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
	DROP FUNCTION [dbo].[BuildFullName]

GO
/****** Object:  UserDefinedFunction [dbo].[GetAgencyByCreatedAndOPUser]    Script Date: 05/22/2009 20:11:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[BuildFullName]
(
	@ApplicantID uniqueidentifier
)
RETURNS VARCHAR(8000)
BEGIN
	declare @ret varchar(1000);
	declare @FirstName varchar(255);
	declare @MiddleName varchar(255);
	declare @LastName varchar(255);
	set @FirstName=(select FirstName
	from applicant where ID=@ApplicantID)

	set @MiddleName=(select MiddleName
	from applicant where ID=@ApplicantID)

	set @LastName=(select LastName
	from applicant where ID=@ApplicantID)

	select @FirstName = ltrim(rtrim(@FirstName))
	select @MiddleName = ltrim(rtrim(@MiddleName))
	select @LastName = ltrim(rtrim(@LastName))

	select @ret = @FirstName;

	if (@MiddleName != '') begin
		select @ret = @ret + ' ' + @MiddleName;
	end

	if (@LastName != '') begin
		select @ret = @ret + ' ' + @LastName;
	end

	RETURN @ret
END

GO 
 
/*
 db.01.00.280:
 Does the following:
	Delete Column ReferralFeeForSP

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 280

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript280_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript280_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 280)
begin
	print '**************************************************'
	print '*  db.01.00.280: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript280_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript280_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Delete Column ReferralFeeForSP                            *'
	print '***********************************************************************'

	ALTER TABLE Orderingparty
	DROP COLUMN ReferralFeeForSP;

        Insert into #ChangeScript280_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript280_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript280_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 280, 'Delete Column ReferralFeeForSP'

		print '**************************************************'
		print '*  db.01.00.280: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.280: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript280_stat%')
Begin
	drop table #ChangeScript280_stat
End
go
 
 
/*
 db.01.00.281:
 Does the following:
	TODO: <summary of what this patch does?>

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 281

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript281_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript281_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 281)
begin
	print '**************************************************'
	print '*  db.01.00.281: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript281_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript281_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* TODO: <summary of what this patch does?>                            *'
	print '***********************************************************************'

	alter table dbo.requirementtype add AssignTimes int not null default 1
	
	ALTER TABLE dbo.OrderAssignmentReq ADD
		ID uniqueidentifier NOT NULL ROWGUIDCOL CONSTRAINT DF_OrderAssignmentReq_ID DEFAULT (newid()),
		IsReassigned bit NOT NULL CONSTRAINT DF_OrderAssignmentReq_IsReassigned DEFAULT 0

IF dbo.SMM_CheckExists(2, 'PK_OrderAssignmentReq', 'OrderAssignmentReq') = 0
	ALTER TABLE dbo.OrderAssignmentReq
		DROP CONSTRAINT PK_OrderAssignmentReq

	ALTER TABLE dbo.OrderAssignmentReq ADD CONSTRAINT
		PK_OrderAssignmentReq_1 PRIMARY KEY CLUSTERED 
		(
		ID
		) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]


        Insert into #ChangeScript281_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript281_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript281_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 281, 'TODO: <summary of what this patch does?>'

		print '**************************************************'
		print '*  db.01.00.281: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.281: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript281_stat%')
Begin
	drop table #ChangeScript281_stat
End
go
 
 
/*
 db.01.00.283:
 Does the following:
	Replace supplier by supplier management

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 283

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript283_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript283_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 283)
begin
	print '**************************************************'
	print '*  db.01.00.283: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript283_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript283_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Replace supplier by supplier management                              *'
	print '***********************************************************************'
	
	update metadata.PermissionTypeGroup set [Name]='Provides Medical Item Type' where [id] = 607
	
        Insert into #ChangeScript283_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript283_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript283_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 283, 'Replace supplier by supplier management'

		print '**************************************************'
		print '*  db.01.00.283: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.283: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript283_stat%')
Begin
	drop table #ChangeScript283_stat
End
go
 
 
/*
 db.01.00.284:
 Does the following:
	Change Permission Metadata

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 284

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript284_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript284_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 284)
begin
	print '**************************************************'
	print '*  db.01.00.284: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript284_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript284_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Change Permission Metadata                            *'
	print '***********************************************************************'

	UPDATE metadata.PermissionType
	SET [Name] = 'ServiceProvider_CredentialingProfile_Create'
	WHERE ID = 244

	UPDATE metadata.PermissionType
	SET [Name] = 'ServiceProvider_CredentialingProfile_Update'
	WHERE ID = 245

	UPDATE metadata.PermissionType
	SET [Name] = 'ServiceProvider_CredentialingProfile_View'
	WHERE ID = 246

	UPDATE metadata.PermissionTypeGroup
	SET [Name] = 'Credentialing'
	WHERE ID = 38

        Insert into #ChangeScript284_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript284_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript284_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 284, 'Change Permission Metadata'

		print '**************************************************'
		print '*  db.01.00.284: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.284: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript284_stat%')
Begin
	drop table #ChangeScript284_stat
End
go
 
 
/*
 db.01.00.285:
 Does the following:
	Update Body in EmailTemplate for Shipping kit notification

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 285

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript285_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript285_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 285)
begin
	print '**************************************************'
	print '*  db.01.00.285: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript285_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript285_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update Body in EmailTemplate for Shipping kit notification*'
	print '***********************************************************************'
	
	Update [dbo].[EmailTemplate]
	set Body = 'Dear {SPName},

	We are writing this email to notify you that the kits with below details have just been shipped to your address:
	1. Shipping address:
		Address: {address}
		Zipcode: {zipcode}
		City: {city}
		State: {state}	
	2. The list of medical items of the order with below columns as below:
        Medical items:
        {ListMedicalItems}

	When receiving kits, please click on below link to go to the confirmation page
	{URL}
	Thank you very much for your co-operation.

	Sincerely,
	SUPERIOR MOBILE MEDICS 3838 Camino Del Rio N., Suite 250
	San Diego, CA 92108
	P.O. Box 639014
	San Diego, CA 92163-9014
	Toll Free Number Phone (800) 898-EXAM (3926)
	Fax (888) 548-3926
	Email: cs@superiormobilemedics.com
	'
		where id='b532738e-60d8-44a2-a785-2c68c1360544'
	
	Insert into #ChangeScript285_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript285_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript285_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 285, 'Update Body in EmailTemplate for Shipping kit notification'

		print '**************************************************'
		print '*  db.01.00.285: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.285: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript285_stat%')
Begin
	drop table #ChangeScript285_stat
End
go 
 
/*
 db.01.00.286:
 Does the following:
	Add PartyNetwork table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 286

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript286_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript286_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 286)
begin
	print '**************************************************'
	print '*  db.01.00.286: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript286_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript286_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add PartyNetwork table												 *'
	print '***********************************************************************'

	CREATE TABLE metadata.NetworkRole(
		ID int NOT NULL,
		[Name] nvarchar(100),
		CONSTRAINT PK_NetworkRole PRIMARY KEY(ID)
	)

	INSERT INTO metadata.NetworkRole(ID,[Name]) VALUES(1,'Unknown')
	INSERT INTO metadata.NetworkRole(ID,[Name]) VALUES(2,'Group')
	INSERT INTO metadata.NetworkRole(ID,[Name]) VALUES(3,'Group Contact')
	INSERT INTO metadata.NetworkRole(ID,[Name]) VALUES(4,'Group Member')
	INSERT INTO metadata.NetworkRole(ID,[Name]) VALUES(5,'Other')

	CREATE TABLE PartyNetwork(
		ID [uniqueidentifier] NOT NULL,
		PartyID [uniqueidentifier] NOT NULL,
		RelatedPartyID [uniqueidentifier] NOT NULL,
		RelationDescription nvarchar(255),
		PartyRoleID int NOT NULL,
		RelatedPartyRoleID int NOT NULL,
		IsPreferred bit NOT NULL,
		Inactive bit NOT NULL,
		CreatedDate DATETIME NOT NULL,
		ModifiedDate DATETIME NOT NULL,
		DeletedDate DATETIME,
		CONSTRAINT PK_PartyNetwork PRIMARY KEY(ID)
	)		
	
	ALTER TABLE PartyNetwork
	ADD CONSTRAINT FK_Party_Party FOREIGN KEY(PartyID) REFERENCES Party(ID)

	ALTER TABLE PartyNetwork
	ADD CONSTRAINT FK_Party_RelatedParty FOREIGN KEY(RelatedPartyID) REFERENCES Party(ID)

	ALTER TABLE PartyNetwork
	ADD CONSTRAINT FK_Party_NetworkRole1 FOREIGN KEY(PartyRoleID) REFERENCES metadata.NetworkRole(ID)

	ALTER TABLE PartyNetwork
	ADD CONSTRAINT FK_Party_NetworkRole2 FOREIGN KEY(RelatedPartyRoleID) REFERENCES metadata.NetworkRole(ID)

	Insert into #ChangeScript286_stat (PatchStatus) Values (1)
    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript286_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript286_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 286, 'Update Body in EmailTemplate for Shipping kit notification'

		print '**************************************************'
		print '*  db.01.00.286: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.286: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript286_stat%')
Begin
	drop table #ChangeScript286_stat
End
go 
 
/*
 db.01.00.287:
 Does the following:
	Add metadata

Modifications:
	

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 287

*/

set nocount on
IF dbo.SMM_CheckExists(3, '#ChangeScript287_stat', '') = 0
	DROP TABLe #ChangeScript287_stat
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript287_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 287)
begin
	print '**************************************************'
	print '*  db.01.00.287: already applied                    *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript287_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript287_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add metadata                                                        *'
	print '***********************************************************************'
	
	INSERT INTO [metadata].[State] ([ID], [Name], [Abbr], [CountryID], [Inactive]) VALUES (1000, N'ALL', N'XX', 1, 0)

        Insert into #ChangeScript287_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript287_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript287_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 287, 'Add metadata'

		print '**************************************************'
		print '*  db.01.00.287: Done                               *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.287: NOT completed successfully         *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript287_stat%')
Begin
	drop table #ChangeScript287_stat
End
go
 
 
/*
 db.01.00.288:
 Does the following:
	Update username of administrator

Modifications:
	

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 288

*/

set nocount on
IF dbo.SMM_CheckExists(3, '#ChangeScript288_stat', '') = 0
	DROP TABLe #ChangeScript288_stat
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript288_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 288)
begin
	print '**************************************************'
	print '*  db.01.00.288: already applied                    *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript288_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript288_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Add metadata                                                        *'
	print '***********************************************************************'
	
		UPDATE [user] SET UserName='administrator' where UserName='admin'
		UPDATE [Party] SET GovIDTypeID=0 WHERE ID='B0A630FC-3F64-4FF8-B195-167F7A14DCA1'

        Insert into #ChangeScript288_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript288_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript288_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 288, 'Add metadata'

		print '**************************************************'
		print '*  db.01.00.288: Done                               *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.288: NOT completed successfully         *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript288_stat%')
Begin
	drop table #ChangeScript288_stat
End
go
 
 
/*
 db.01.00.289:
 Does the following:
	Update lastname of administrator

Modifications:
	

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 289

*/

set nocount on
IF dbo.SMM_CheckExists(3, '#ChangeScript289_stat', '') = 0
	DROP TABLe #ChangeScript289_stat
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript289_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 289)
begin
	print '**************************************************'
	print '*  db.01.00.289: already applied                    *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript289_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript289_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update lastname of administrator                                                        *'
	print '***********************************************************************'
	
		UPDATE Person SET FirstName='Admin', LastName='User' WHERE ID='B0A630FC-3F64-4FF8-B195-167F7A14DCA1'

        Insert into #ChangeScript289_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript289_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript289_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 289, 'Update lastname of administrator'

		print '**************************************************'
		print '*  db.01.00.289: Done                               *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.289: NOT completed successfully         *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript289_stat%')
Begin
	drop table #ChangeScript289_stat
End
go
 
 
/*
 db.01.00.290:
 Does the following tasks:
	- Add PaperworkStatusID into OrderAssignment table

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 290
*/
set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript290_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript290_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 290)
begin
	print '**************************************************'
	print '*  db.01.00.290: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript290_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript290_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '******************************************************************************************'
	print '* Add PaperworkStatusID into OrderAssignment table										*'
	print '******************************************************************************************'
	

	IF dbo.SMM_CheckExists(6, 'PaperworkStatusID', 'OrderAssignment') = -1
		ALTER TABLE dbo.OrderAssignment
		ADD PaperworkStatusID int

	IF dbo.SMM_CheckExists(2, 'FK_OrderAssignment_PaperworkStatus', 'OrderAssignment') = -1
		ALTER TABLE OrderAssignment
		ADD CONSTRAINT FK_OrderAssignment_PaperworkStatus FOREIGN KEY(PaperworkStatusID) REFERENCES metadata.PaperworkStatus(ID)
		
	Insert into #ChangeScript290_stat (PatchStatus) Values (1)
	COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript290_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript290_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 290, 'DiscussionThread (Drop column PartyID)'

		print '**************************************************'
		print '*  db.01.00.290: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.290: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript290_stat%')
Begin
	drop table #ChangeScript290_stat
End
go
 
 
/*
 db.01.00.291:
 Does the following:
	Update table User: Add column UserTypeID

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 291

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript291_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript291_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 291)
begin
	print '**************************************************'
	print '*  db.01.00.291: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript291_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript291_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update table User: Add column UserTypeID                            *'
	print '***********************************************************************'

	alter table [User] add UserTypeID int not null default 0
	
        Insert into #ChangeScript291_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript291_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript291_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 291, 'Update table User: Add column UserTypeID'

		print '**************************************************'
		print '*  db.01.00.291: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.291: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript291_stat%')
Begin
	drop table #ChangeScript291_stat
End
go
 
 
/*
 db.01.00.293:
 Does the following:
	Update UserTypeID of table User

Undo:
DELETE FROM metadata.Version where release = 1.0 and build = 293

*/

set nocount on

IF dbo.SMM_CheckExists(3, '#ChangeScript293_stat', '') = -1
	-- create temporary status table
	select PatchStatus = convert(int,0)
	 into #ChangeScript293_stat
go

if exists (select * from metadata.Version where Release = 1.0 and Build = 293)
begin
	print '**************************************************'
	print '*  db.01.00.293: already applied                 *'
	print '**************************************************'
	-- patch already run: avoid re-running on target Db
	Insert into #ChangeScript293_stat (PatchStatus) Values (-1)
end
go

/*  Add the first and only script here, which is mandotary */
If not exists (select * from #ChangeScript293_stat where PatchStatus = -1)
Begin

    BEGIN TRANSACTION

	print '***********************************************************************'
	print '* Update UserTypeID of table User                            *'
	print '***********************************************************************'

	/* Update UserTypeID for ServiceProvider */
	update [User]
	set UserTypeID = 1
	where PersonID IN (
		select p.id
		from ServiceProvider sp, Party p
		where sp.PartyID = p.ID
	)
	
	/* Update UserTypeID for OrderingPartyUser */
	update [User]
	set UserTypeID = 3
	where PersonID IN (
		select opu.PersonID
		from OrderingPartyUser opu
	)
	
	/* Update UserTypeID for Employee */
	update [User]
	set UserTypeID = 4
	where PersonID IN (
		select e.PersonID
		from Employee e
	)
	
	/* Update UserTypeID for PartnerUser */
	update [User]
	set UserTypeID = 6
	where PersonID IN (
		select e.PersonID
		from PartnerUser e
	)

        Insert into #ChangeScript293_stat (PatchStatus) Values (1)

    COMMIT TRANSACTION

End
go
/*  End of the script  */


/*  No more scripts allowed */


If not exists (select 'x' from #ChangeScript293_stat where PatchStatus = -1)
Begin
	If exists (select 'x' from #ChangeScript293_stat where PatchStatus = 1)
	begin
		insert into metadata.Version(Release, Build, Description)
		select 1.0, 293, 'Update UserTypeID of table User'

		print '**************************************************'
		print '*  db.01.00.293: Done                            *'
		print '**************************************************'

	end
	else
	begin

		print '**************************************************'
		print '*  db.01.00.293: NOT completed successfully      *'
		print '**************************************************'
	end
End
go

If exists (select * from tempdb.dbo.sysobjects where name like '#ChangeScript293_stat%')
Begin
	drop table #ChangeScript293_stat
End
go
